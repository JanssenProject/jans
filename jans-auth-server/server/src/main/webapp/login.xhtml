<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  template="/WEB-INF/incl/layout/login-template.xhtml"
>
  <f:metadata>
    <f:viewAction action="#{authenticator.prepareAuthenticationForStep}" />
  </f:metadata>
  <ui:define name="head">
    <meta name="description" content="Janssen Project" />
  </ui:define>
  <ui:define name="pageTitle">
    <h:outputText value="#{msgs['login.pageTitle']}" />
  </ui:define>
  <ui:define name="body">
    <div class="container">
      <h:panelGroup rendered="true">
        <h:form
          id="loginForm"
          class="bg-highlight position-relative d-flex flex-column align-items-center"
          style="justify-content: center; height: 100vh; gap: 2rem"
        >
          <img
            id="AppLogo"
            src="#{request.contextPath}/servlet/logo"
            alt="janssen-logo"
            class="absolute-logo"
          />
          <div class="container mt-4">
            <div class="jans-form-container">
              <h:messages class="error-text no-padding text-center" />
              <div class="device-authz-title">
                <h:outputText value="#{msgs['login.login']}" />
              </div>
              <div class="w-100 mt-8">
                <h:inputText
                  placeholder="#{msgs['login.username']}"
                  id="username"
                  name="username"
                  required="true"
                  colMd="10"
                  labelColMd="2"
                  autocomplete="off"
                  value="#{credentials.username}"
                  styleClass="form-control app-input-styles"
                >
                </h:inputText>
              </div>
              <div class="w-100 mt-7">
                <h:inputSecret
                  placeholder="#{msgs['login.password']}"
                  colMd="10"
                  id="password"
                  name="password"
                  labelColMd="2"
                  value="#{credentials.password}"
                  autocomplete="off"
                  styleClass="form-control app-input-styles"
                >
                </h:inputSecret>
              </div>
              <div class="d-flex align-items-center mt-8" style="gap: 10px">
                <input
                  type="checkbox"
                  value="rememberme"
                  id="rememberme"
                  name="rememberme"
                  class="remember-me__input"
                />
                <h:outputLabel
                  for="rememberme"
                  value="#{msgs['login.rememberMe']}"
                  class="no-margin remember-me-text"
                />
              </div>
              <h:commandButton
                id="loginButton"
                style="background-color: #00be79; color: white"
                styleClass="btn device-authz-continue-btn mt-8"
                value="    #{msgs['login.login']}"
                onclick="checkRemembeMe()"
                iconAwesome="fa-sign-in"
                action="#{authenticator.authenticate}"
              />
              <h:panelGroup
                layout="block"
                rendered="#{not empty facesContext.messageList and cookie['X-Correlation-Id'] != null}"
              >
                <br />
                <p class="no-margin" style="font-size: 0.7em">
                  <strong>Correlation Id: </strong>
                  <h:outputText value="#{cookie['X-Correlation-Id'].value}" />
                </p>
              </h:panelGroup>
              <h:inputHidden id="platform" />
            </div>
          </div>
          <div class="d-flex flex-column align-items-center">
            <div class="d-flex">
              <p class="text-white no-margin text-lg">Don't have an account?</p>
              <span class="ml-2 login__sign-up--link text-lg"> Sign Up </span>
            </div>
            <a
              class="text-white text-lg"
              href="/identity/person/passwordReminder.htm"
            >
              <h:outputText value="#{msgs['login.forgotYourPassword']}" />
            </a>
          </div>
        </h:form>
        <div>
          <div align="center" class="col-sm-offset-4">
            <ui:repeat
              value="#{identity.getWorkingParameter('download_url').entrySet().toArray()}"
              var="_entry"
            >
              <ui:param name="app_name" value="#{_entry.key}" />
              <ui:param name="app_link" value="#{_entry.value}" />
              <h:outputLink
                style="margin-right: 5px"
                value="#{app_link}"
                title="#{app_name}"
              >
                <h:graphicImage value="img/#{app_name}.png" />
              </h:outputLink>
            </ui:repeat>
          </div>
          <h:panelGroup
            layout="block"
            rendered="#{external_registration_uri != Null}"
          >
            <div class="reg_link">
              <a href="#{external_registration_uri}">
                <h:outputText value="Register Now " />
              </a>
            </div>
          </h:panelGroup>
        </div>
      </h:panelGroup>
    </div>
    <script type="text/javascript">
       		$(document).ready(function () {
       			$('.other').click(function(){
       				$('#social_new').toggle();
       			});
                   if (localStorage.chkbx &amp;&amp; localStorage.chkbx != '') {
                       $('#rememberme').attr('checked', 'checked')
                       document.getElementById("loginForm:username").value = localStorage.usrname;
                   } else {
                       $('#rememberme').removeAttr('checked');
                       document.getElementById("loginForm:username").value = "";
                   }

                   $('#rememberme').click(function() {
                       checkRemembeMe();
                   });

                   fillPlatformField();

      	var userNameField = document.getElementById("loginForm:username");
      	var passwordField = document.getElementById("loginForm:password");

      	passwordField.value = "";
      	var userName = '#{!empty authorizeAction.loginHint ? authorizeAction.loginHint : ""}';
      	if (userName) {
      		userNameField.value = userName;
      		passwordField.focus();
      	} else {
      		userNameField.focus();
      	}

      	var displayRegister = #{display_register_action or identity.sessionId.sessionAttributes['display_register_action']};
      	if (displayRegister) {
      		var registerButton = document.getElementById("loginForm:registerId");
      		if (registerButton != null) {
      			registerButton.style.display = 'inline';
      		}
      	}
       		});

       		function checkRemembeMe() {
                   if ($('#rememberme').is(':checked')) {
                       localStorage.usrname = document.getElementById("loginForm:username").value;
                       localStorage.chkbx = $('#rememberme').val();
                   } else {
                       localStorage.usrname = '';
                       localStorage.chkbx = '';
                   }
      }

               function fillPlatformField() {
                   try {
                       re = /^([^\.]+\.[^\.]+)\..+/;
                       result = re.exec(platform.version);
                       if (result != null) {
                           platform.version=result[1];
                       }
       			    document.getElementById("loginForm:platform").value = JSON.stringify(platform);
                   } catch (e) {
                   }
               }
    </script>
  </ui:define>
</ui:composition>
