<!--  
    This software is available under the Apache-2.0 license.  
    See https://www.apache.org/licenses/LICENSE-2.0.txt for full text.  

    Copyright (c) 2024, Gluu, Inc.  
-->
<!doctype html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello world cedarling WASM example</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        crossorigin="anonymous">

    <style>
        textarea {
            width: 100%;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- div to make init cedarling -->
        <div class="row">
            <h1>Cedarling WASM Example</h1>
            <p>This example demonstrates both standard and multi-issuer authorization. Results are written to the browser console.</p>
        </div>

        <br><br>
        <div class="row">
            Click here to move to the <a href="/cedarling_app.html">Cedarling test app</a>
        </div>
    </div>

    <script type="module">
        import { BOOTSTRAP_CONFIG, REQUEST } from "/example_data.js" // Import js objects: bootstrap config and request
        import initWasm, { init } from "/pkg/cedarling_wasm.js";

        async function main() {
            await initWasm(); // Initialize the WebAssembly module

            let instance = await init(BOOTSTRAP_CONFIG);
            
            // Standard authorization
            let result = await instance.authorize(REQUEST);
            console.log("Standard authorization result:", result);
            
            // Multi-issuer authorization example
            const multiIssuerRequest = {
                tokens: [
                    {
                        mapping: "Jans::Access_Token",
                        payload: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
                    },
                    {
                        mapping: "Acme::DolphinToken", 
                        payload: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
                    }
                ],
                resource: {
                    entity_type: "Jans::Resource",
                    entity_id: "resource123"
                },
                action: "Read",
                context: {
                    location: "miami"
                }
            };
            
            try {
                let multiResult = await instance.authorize_multi_issuer(multiIssuerRequest);
                console.log("Multi-issuer authorization result:", multiResult);
            } catch (error) {
                console.log("Multi-issuer authorization failed (expected with test data):", error);
            }
        }
        main().catch(console.error);
    </script>
</body>

</html>