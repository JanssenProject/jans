# Integrate Duo Security with Janssen

This document will explain how to use Janssen Server Duo interception script to configure the Janssen Server for a two-step authentication process with username and password as the first step, and Duo as the second step. 

[Duo Security](https://duo.com/) is a SaaS authentication provider that supports multifactor authetication including push-approvals, SMS-OTP etc. 

## Prerequisites
- An account with Duo Security  
- User being authenticated will need to download the Duo mobile app
- Janssen Server with [Casa integrated](../integration/casa.md) 


## Enable Janssen Server Custom Script for Duo
- Go to Janssen Server installation
- Get `duo_web` python library using commands below
```shell
cd /opt/jans/python/libs
wget https://raw.githubusercontent.com/GluuFederation/community-edition-setup/master/static/auth/lib/duo_web.py
sudo systemctl restart jans-auth
```
- Now use `jans-cli` to enable Duo script using instructions [here](../../../admin/config-guide/jans-cli/im/im-custom-scripts.md#update-custom-scripts). Set the `enabled` property for duo script to `true`
- confirm that the script is enabled in [cli script listing](../../../admin/config-guide/jans-cli/im/im-custom-scripts.md#get-list-of-custom-scripts)

## Configuring Duo credentials
- In order to connect to Duo Security via web SDK, Janssen needs to be provided with values below.
    - ikey (integration key): Obtained from Duo security account
    - skey (secret key): Obtained from Duo security account
    - akey: Is an random alpha-numeric key that need to be generated by following the instructions [here](https://duo.com/docs/duoweb-v2)
- Provide these values by editing the placeholder JSON file located at `/etc/certs/duo_creds.json` on Janssen Server. Replace actual values in the placeholders and save the file.

## Configuring Custom Script Properties

- There are two mandatory properties that Duo custom script requires
    - duo_creds_file : Path to the file where values for ikey, skey and akey are stored. For example, `/etc/certs/duo_creds.json`
    - duo_host : Name of the host supplied by the Duo Security for your web-sdk to connect. For example: `api-random.duosecurity.com`
      [Update the custom script](https://jans.io/docs/admin/config-guide/jans-cli/cli-custom-scripts/#update-an-existing-custom-script) using `jans-cli` to set values for these two properties. There are other optional properties that you can set as per the requirements. Find complete list [here](TODO)

## Install Casa Duo plugin
Follow [these instructions](https://gluu.org/docs/casa/plugins/duo/#add-the-plugin-to-casa) to install Casa plugin and [test](https://gluu.org/docs/casa/plugins/duo/#testing) Duo as authentication method.  


