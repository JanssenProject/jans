apiVersion: v1
stringData:
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    MIIDNDCCAhygAwIBAgIUJg+HTzcEQRVVhywCKgjRwIo9y6wwDQYJKoZIhvcNAQEL
    BQAwGzEZMBcGA1UEAwwQamFucy1haW8uamFucy5pbzAeFw0yMzEwMTkyMDUwNTRa
    Fw0yNDEwMTgyMDUwNTRaMBsxGTAXBgNVBAMMEGphbnMtYWlvLmphbnMuaW8wggEi
    MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCjU8zFEFq2b/RXyPd/3ziGGDso
    Cm5PAzbOGtY+TMf+N3dXE1luWLYFdsnwxyl+J24ga96Ad1cvxa97ntreOVxSimKG
    gJOMOAmT8UrL51f5qUOs/4+ngCM8vC9Vw4jBMGQgrxr6Dk33EGyOWYe5xR+1Rf5J
    2r3GjjVpKyQ9lIMCQXYVDpQNa+k/kZyeeVoXbFIfNGIFfmnZIXML/6RgswMonlyQ
    FfPJHEG+wCazuZiMkHK5TXtzIKyi0V2I3EHZEX6AAkDK1FMFbYIvcpJTPKgR0snn
    e/ehhcMi6lucbKVkdHdBU3Qlf/BEZca2MY1TYAodZlEN6MXiCBQdWsVvpEfhAgMB
    AAGjcDBuMB0GA1UdDgQWBBSMMzOqckxjpxVcVCw6vuBWPr34xjAfBgNVHSMEGDAW
    gBSMMzOqckxjpxVcVCw6vuBWPr34xjAPBgNVHRMBAf8EBTADAQH/MBsGA1UdEQQU
    MBKCEGphbnMtYWlvLmphbnMuaW8wDQYJKoZIhvcNAQELBQADggEBAIIKQuMvr1L+
    yz7iR8173h+K6qgJYniK4/s8S9i0iPtg/1i2lh25IcTxN5XK03AknLV317YkC1bw
    pGzX3aRs9MdkWes0f/krsnmGTJEAWWhGj4z06yVYCXFPV6xHC+kEBmRRvF9b14nL
    gCajFoxXct1vULCb4VYJThv1gO6++hncTHP4VpkJ7qY/o+v3lJ3IrIX1FzhN+hsU
    lJNuTEqSRJGXv1tR2gfNNW7hEowtGOpJdFlbmAtYOQfWmWcaRVcKNoItl2CbIGLk
    sTNVfGneSFfYkTcXjdRRWy7uRiO/ubmalu9vAxPV4oUR7FB4orDvGLDqa3rAfKsh
    sqoy+0x0w6A=
    -----END CERTIFICATE-----
  tls.key: |
    -----BEGIN PRIVATE KEY-----
    MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCjU8zFEFq2b/RX
    yPd/3ziGGDsoCm5PAzbOGtY+TMf+N3dXE1luWLYFdsnwxyl+J24ga96Ad1cvxa97
    ntreOVxSimKGgJOMOAmT8UrL51f5qUOs/4+ngCM8vC9Vw4jBMGQgrxr6Dk33EGyO
    WYe5xR+1Rf5J2r3GjjVpKyQ9lIMCQXYVDpQNa+k/kZyeeVoXbFIfNGIFfmnZIXML
    /6RgswMonlyQFfPJHEG+wCazuZiMkHK5TXtzIKyi0V2I3EHZEX6AAkDK1FMFbYIv
    cpJTPKgR0snne/ehhcMi6lucbKVkdHdBU3Qlf/BEZca2MY1TYAodZlEN6MXiCBQd
    WsVvpEfhAgMBAAECggEACjrVSwyHWgDwzCTKwmgaqWTQI7sPhgRnWjPFHS7VofRw
    avRLzYUMlZKx+vzxJN/XCScoebcVL2lRi0vRB/U4yp9fT28IjtJIYKCkNNmfIYSQ
    DWsOYN6Tlm9vruP/PKEezGCbWckr6fXN5CvzES1/GxgGDDMsCskydY1ds5EJ6Z9S
    k97Qy/VANypKjhQ9PT3UBR4bkHAEl1rDPaZkMpnlRZ2CN5W0TfsvwBF+5jz9iqvB
    n5T3FfnDaGRnFevlR0A6WO02ju0PjXgpqVzqNZIiCv1KuSxCYOV8L2/nnmxypnBK
    Hy9GtCTnWdM4VK0nBgvVKuYn8sd0BvEHyUktJ2kyqQKBgQC3C2Rt1dfB3fUS0TIW
    oQKfdlatF+16Q1sFMPb2sB/IiC2rXnnGFlpTzUsBFS9ddrgaFPygSO7FVqHQlssi
    IS3Ylq2/lOmOSPS0kmLiqPpdaGL2XEGdo8hrS+4mmMmhNsAyYqb1DsDPdvnNJ6TI
    ZRkMurG2oAXB1/ozt6GJs3FH1QKBgQDkbJqReqZdN+YgUZbXxNf8QRpIk1QbX6P8
    rZT9VLnHX+UrkeLzECkr6IDSW25gpoZehlKqJjPawJ+iFoqex2WnO3YxhQUxKCHr
    fCigvWTrDu0a+bBQC2f6/ifOttxWBQEJhS+IiCQjyB3E5/EFDQhPPHndTKxCs888
    qw44cfOx3QKBgHKdupQgHArz/fp7bb7HsUnCowGeAwDU3lDA2VOc8znxM4+kB+Jm
    qsbgvL9/0XnX1e3XCF0hbgm5dneThLzpQ7jkmQVmrFyBCGFtbGf7YVJOA/G50Qhx
    vxSYphYbA95j1zN1nI/EXi1KlZ7F3SPyUh4rZQ4y44f+wlfR+1+rMhrFAoGATnJJ
    xwpzFfJ7kr/SaPmOH3CQQTpvmRMIc199ml69io4RWxw377euHAk2LIf/6StnXBEP
    VKXYCxk5+WV6Z7sc2wjdt3XyaYZZ19CE92bzwJIYtbnoZiT0qcsdCq3cD6KaT5Ww
    1FfE6ZDxQE1ThaOLJgMj6u9I/YNY+YHZWWMxCPUCgYEAqaAK6pa2wJST653a/Maj
    XVgB+IByelf96k+/z4jy+ZNap7PyfBOOo3asFYt9zz+Kh9n6S9I3KVfiLS2D9afW
    yB3QSx8onKEI1Bd0NpLwPUv6GSRE6uH/ywZSOX4GFZhh4hT8nYc2W06w8e/njSLW
    APfbTcT/F1g0Zpct75HLRmc=
    -----END PRIVATE KEY-----
kind: Secret
metadata:
  name: istio-tls-certificate
  namespace: istio-system
type: kubernetes.io/tls

---

apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: jans-aio-gateway
  namespace: jans
spec:
  selector:
    istio: ingressgateway
  servers:
    - port:
        number: 80
        name: http
        protocol: HTTP
      hosts:
        - jans-aio.jans.io
      tls:
        httpsRedirect: true
    - port:
        number: 443
        name: https
        protocol: HTTPS
      hosts:
        - jans-aio.jans.io
      tls:
        mode: SIMPLE
        credentialName: istio-tls-certificate

---

apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: istio-ingress-jans-aio
  namespace: jans
spec:
  hosts:
    - jans-aio.jans.io
  gateways:
    - jans-aio-gateway
  http:
    - name: jans-aio-base
      match:
        - uri:
            prefix: /
      route:
        - destination:
            host: jans-aio.jans.svc.cluster.local
            port:
              number: 8080

---

apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: istio-ingress-jans-aio
  namespace: jans
spec:
  host: jans-aio.jans.io
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
    loadBalancer:
      consistentHash:
        httpCookie:
          name: jans-aio-route
          ttl: 60s
