# Warning: customize this file as per your needs, see plugin docs

<VirtualHost *:444>
    DocumentRoot "/var/www/html"
    ServerName acme.co:444
    LogLevel warn

    SSLEngine on
    SSLProtocol -all +TLSv1.2 +TLSv1.3
    SSLCipherSuite ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256
    SSLHonorCipherOrder On

    Header always set X-Content-Type-Options nosniff
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header unset Set-Cookie        

    ProxyTimeout 60
    ProxyRequests Off
    ProxyVia Off
    ProxyPreserveHost On
    ProxyErrorOverride On
    
    SSLVerifyClient optional_no_ca
    #SSLVerifyDepth 10
    SSLOptions -StdEnvVars +StrictRequire +ExportCertData

    RequestHeader set X-Forwarded-Proto "https" env=HTTPS
    RequestHeader set X-ClientCert %{SSL_CLIENT_CERT}s

    #ProxyPass / http://localhost:8080/jans-casa/pl/cert-authn/index.zul retry=5 connectiontimeout=20
    
    #The regex matching mechanism below is preferred because ProxyPass would send all requests, i.e. /*
    #to the backend server. We just need to handle a single slash, i.e. /
    ProxyPassMatch ^(\/)$ http://localhost:8080/jans-casa/pl/cert-authn$1 retry=5 connectiontimeout=20
    
    ErrorDocument 404 /custom_404.html
    ErrorDocument 500 /custom_500.html
    ErrorDocument 502 /custom_502.html
    ErrorDocument 503 /custom_503.html
    ErrorDocument 504 /custom_504.html
    
    ServerAlias acme.co
    #SSLCertificateFile /etc/letsencrypt/live/acme.co/fullchain.pem
    #SSLCertificateKeyFile /etc/letsencrypt/live/acme.co/privkey.pem
    #Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
