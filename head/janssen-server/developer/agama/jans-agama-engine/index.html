

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Janssen Project Deployment and Operation References">
      
      
        <meta name="author" content="Janssen, Inc.">
      
      
        <link rel="canonical" href="https://docs.jans.io/head/janssen-server/developer/agama/jans-agama-engine/">
      
      
        <link rel="prev" href="../../../auth-server/international/scope-descriptions/">
      
      
        <link rel="next" href="../../">
      
      
        
      
      
      <link rel="icon" href="../../../../assets/janssen_project_favicon_transparent_50px_50px.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Agama Engine - Janssen Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../../css/tabs.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/mermaid-extra.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/home.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/navigation.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#janssen-agama-engine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Janssen Documentation" class="md-header__button md-logo" aria-label="Janssen Documentation" data-md-component="logo">
      
  <img src="../../../../assets/janssen_project.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Janssen Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Agama Engine
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/JanssenProject/jans/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../.." class="md-tabs__link">
          
  
  
    
  
  Get Started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../architecture/" class="md-tabs__link">
          
  
  
    
  
  Architecture & Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../auth-server/" class="md-tabs__link">
          
  
  
    
  
  Integrate & Authenticate

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../config-guide/" class="md-tabs__link">
          
  
  
    
  
  Configure Identity & Policies

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../test-debug/" class="md-tabs__link">
          
  
  
    
  
  Test & Debug

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../" class="md-tabs__link">
          
  
  
    
  
  Deploy & Operate

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../CHANGELOG/" class="md-tabs__link">
          
  
  
    
  
  Product & Releases

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Janssen Documentation" class="md-nav__button md-logo" aria-label="Janssen Documentation" data-md-component="logo">
      
  <img src="../../../../assets/janssen_project.svg" alt="logo">

    </a>
    Janssen Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/JanssenProject/jans/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../.." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Get Started
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../architecture/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Architecture & Concepts
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture & Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../planning/components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Components Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../../auth-server/endpoints/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Auth Server Internals
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Agama Engine
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Agama Engine
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launching-flows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Launching flows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-and-finish" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication and Finish
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crashes-timeouts-and-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Crashes, timeouts, and failures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crashes, timeouts, and failures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-timeouts-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        How timeouts work
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logging
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rfac-and-callback-url" class="md-nav__link">
    <span class="md-ellipsis">
      
        RFAC and Callback URL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rrf-navigation-and-assets-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        RRF, navigation, and assets handling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foreign-calls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Foreign calls
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foreign calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#highlights" class="md-nav__link">
    <span class="md-ellipsis">
      
        Highlights
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exception-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exception handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arguments-conversion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Arguments conversion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-java-to-agama" class="md-nav__link">
    <span class="md-ellipsis">
      
        From Java to Agama
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#classpath" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classpath
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classpath">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#limitations-of-code-added-on-the-fly" class="md-nav__link">
    <span class="md-ellipsis">
      
        Limitations of code added "on the fly"
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oop-prose-warning" class="md-nav__link">
    <span class="md-ellipsis">
      
        OOP prose warning
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Developer Guide
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../../contribute/implementation-design/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Implementation Design
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../reference/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../auth-server/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Integrate & Authenticate
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../config-guide/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Configure Identity & Policies
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../test-debug/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Test & Debug
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Deploy & Operate
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../../CHANGELOG/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Product & Releases
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launching-flows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Launching flows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-and-finish" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication and Finish
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crashes-timeouts-and-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Crashes, timeouts, and failures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crashes, timeouts, and failures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-timeouts-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        How timeouts work
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logging
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rfac-and-callback-url" class="md-nav__link">
    <span class="md-ellipsis">
      
        RFAC and Callback URL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rrf-navigation-and-assets-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        RRF, navigation, and assets handling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foreign-calls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Foreign calls
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foreign calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#highlights" class="md-nav__link">
    <span class="md-ellipsis">
      
        Highlights
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exception-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exception handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arguments-conversion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Arguments conversion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-java-to-agama" class="md-nav__link">
    <span class="md-ellipsis">
      
        From Java to Agama
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#classpath" class="md-nav__link">
    <span class="md-ellipsis">
      
        Classpath
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classpath">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#limitations-of-code-added-on-the-fly" class="md-nav__link">
    <span class="md-ellipsis">
      
        Limitations of code added "on the fly"
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oop-prose-warning" class="md-nav__link">
    <span class="md-ellipsis">
      
        OOP prose warning
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                




              
              <article class="md-content__inner md-typeset">
                
  
                  

  <nav class="md-tags" >
    
      
      
      
      
        <span class="md-tag">administration</span>
      
    
      
      
      
      
        <span class="md-tag">agama</span>
      
    
      
      
      
      
        <span class="md-tag">developer</span>
      
    
  </nav>


  
  


<h1 id="janssen-agama-engine">Janssen Agama Engine<a class="headerlink" href="#janssen-agama-engine" title="Permanent link">#</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">#</a></h2>
<p>The Janssen Server implements the <a href="../../../../agama/introduction/">Agama framework</a> through several components bundled in its authentication server (AS):</p>
<ul>
<li>
<p>The engine: the piece of software that actually runs the flows and interacts with the user's browser - sort of a small web application. As expected, these flows are mainly targetted at user authentication</p>
</li>
<li>
<p>A transpiler: code written in Agama language is transpiled to an intermediate representation which can then be interpreted at runtime by the engine</p>
</li>
<li>
<p>The bridge: since the engine itself does not implement an authentication protocol, another piece is required to put flows in the context of a standard authorization framework like OpenId Connect. This is what the bridge does</p>
</li>
<li>
<p>The deployer: a piece of software capable of deploying <a href="../projects-deployment/">Agama projects</a> to the engine.</p>
</li>
</ul>
<p>The rest of this document describes implementation-specific details of the engine bundled with the Jans Server. These details give shape to the requirements abstractly defined for an Agama-compliant <a href="../../../../agama/execution-rules/">engine</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ensure both the Agama engine and the bridge are <a href="../engine-bridge-config/#availability">enabled</a> in the Janssen server to effectively use engine's features</p>
</div>
<h2 id="launching-flows">Launching flows<a class="headerlink" href="#launching-flows" title="Permanent link">#</a></h2>
<p>Flows can be launched by sending an (OpenId Connect) authentication request to the user's browser. This usually boils down to making a redirection to a URL looking like <code>https://&lt;jans-server-name&gt;/jans-auth/restv1/authorize?acr_values=agama_flowQname&amp;scope=...&amp;response_type=...&amp;redirect_uri=https...&amp;client_id=...&amp;state=...</code>. Check the OpenId Connect <a href="https://openid.net/specs/openid-connect-core-1_0.html">spec</a> for more details. Note Jans Server is spec-compliant.</p>
<p>Things to highlight:</p>
<ul>
<li>
<p>The <code>acr_values</code> parameter carries the qualified name (identifier) of the flow to launch prefixed with the string <code>agama_</code>, for example <code>acr_values=agama_test.acme.co</code></p>
</li>
<li>
<p>If the flow to call receives input parameters, this data can be appended to the <code>acr_values</code> parameter: use a hyphen to separate the flow name and the parameters expressed in Base64 URL encoded format. For example, if the flow had inputs  <code>height</code> and <code>color</code>, you would encode the string <code>{"height": 190, "color": "blue"}</code> and the resulting value would be <code>agama_test.acme.co-eyJoZWlnaHQiOiAxOTAsICJjb2xvciI6ICJibHVlIn0</code>. When a given input variable is not provided, the engine will assign a <code>null</code> value automatically</p>
</li>
</ul>
<h2 id="authentication-and-finish">Authentication and <code>Finish</code><a class="headerlink" href="#authentication-and-finish" title="Permanent link">#</a></h2>
<p>When a top-level flow (i.e. one with no parents) finishes successfully, the selection of the user to authenticate is driven by the <code>userId</code> passed in <code>data</code>, as in</p>
<div class="highlight"><pre><span></span><code>obj = { success: true, data: { userId: &quot;john_doe&quot; } }
// map literals cannot be passed directly to Finish - a variable can be used instead
Finish obj 
</code></pre></div>
<p>By default <code>userId</code> maps to the <code>uid</code> attribute that generally all user entries already have in the database of Jans Server, in other words, the "user name". This attribute is configurable though via property <code>finish_userid_db_attribute</code> of the <a href="../engine-bridge-config/#bridge-configuration">bridge script</a>. In some cases, you would like to change that to <code>mail</code> in order to pass things like <code>{ success: true, data: { userId: "john_doe@jd.me" } }</code> for instance.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If the database lookup does not produce exactly one user entry, this is treated as a failed authentication attempt by the authentication server.</p>
</div>
<p>When the authentication succeeds, the whole contents of <code>data</code> are stored in the authentication server's session of the given user under the key <code>agamaData</code>. Contents are serialized to a JSON string previously.</p>
<h2 id="crashes-timeouts-and-failures">Crashes, timeouts, and failures<a class="headerlink" href="#crashes-timeouts-and-failures" title="Permanent link">#</a></h2>
<p><a href="../../../../agama/execution-rules/">Execution rules</a> define several possible <a href="../../../../agama/execution-rules/#flows-lifecycle">flow states</a>. For crashed, timed out, and finished failed flows, the engine will present proper error pages to users. These are configurable by properties <code>crashErrorPage</code>, <code>interruptionErrorPage</code>, and <code>finishedFlowPage</code> respectively, of the <a href="../engine-bridge-config/#engine-configuration">engine-configuration</a>.</p>
<h3 id="how-timeouts-work">How timeouts work<a class="headerlink" href="#how-timeouts-work" title="Permanent link">#</a></h3>
<p>Authentication flows are normally short-lived. They usually span no more than a few minutes. In Agama, the maximum amount of time an end-user can take to fully complete a flow is driven by the <a href="../../../config-guide/auth-server-config/jans-authorization-server-config/">configuration of the authentication server</a>, specifically the <code>sessionIdUnauthenticatedUnusedLifetime</code> property which is measured in seconds. As an example, if this value is 120, any attempt to authenticate taking more than two minutes will throw the given error page.</p>
<p>Moreover, when a flow specifies its own timeout in the <a href="../../../../agama/language-reference/#header-basics">header</a> the effective timeout is the smallest value between <code>sessionIdUnauthenticatedUnusedLifetime</code> and the value in the header.</p>
<p>Depending on specific needs, <code>sessionIdUnauthenticatedUnusedLifetime</code> may have to be set to a higher value than the server's default. This may be the case where flows send e-mail notifications with temporary codes, for instance.</p>
<h2 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">#</a></h2>
<p>There are three relevant sources of log data:</p>
<ul>
<li>The engine. It emits information related to flows transpilation, projects deployment, and flow crashes - generally low-level information</li>
<li><a href="../../../../agama/language-reference/#logging">Log</a> instructions. These are statements originated directly from the Agama code</li>
<li><a href="#foreign-calls">Call</a> directives. Foreign code can issue logging statements as well as any other code a <code>Call</code> may depend on. See the <a href="../faq/#how-to-add-log-statements">FAQ</a></li>
</ul>
<p>The following table details the location of log data. Paths are relative to directory <code>/opt/jans/jetty/jans-auth/log</code>:</p>
<table>
<thead>
<tr>
<th>Source</th>
<th>Destination file</th>
</tr>
</thead>
<tbody>
<tr>
<td>Engine</td>
<td><code>jans-auth.log</code></td>
</tr>
<tr>
<td><code>Log</code> instructions</td>
<td><code>jans-auth_script.log</code></td>
</tr>
<tr>
<td>Foreign code</td>
<td><code>jans-auth.log</code></td>
</tr>
</tbody>
</table>
<p>Depending on the specificity required, you may have to change the logging level so more or less details appear in the logs. This can be done by altering the <code>loggingLevel</code> property of the <a href="../../../config-guide/auth-server-config/jans-authorization-server-config/">auth server configuration</a>. <code>DEBUG</code> usually suffices for troubleshooting.</p>
<p>The available levels for statements issued with the <code>Log</code> instruction are:</p>
<table>
<thead>
<tr>
<th>Level name</th>
<th>shortcut</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>error</code></td>
<td>e</td>
</tr>
<tr>
<td><code>warn</code></td>
<td>w</td>
</tr>
<tr>
<td><code>info</code></td>
<td>i</td>
</tr>
<tr>
<td><code>debug</code></td>
<td>d</td>
</tr>
<tr>
<td><code>trace</code></td>
<td>t</td>
</tr>
</tbody>
</table>
<p>For instance, these two instructions are equivalent: <code>Log "@e Universe collapsed"</code> and <code>Log "@error Universe collapsed"</code></p>
<p>The engine will use <code>info</code> when the level is not specified explicitly, as in <code>Log "Look ma!"</code>.</p>
<h2 id="rfac-and-callback-url">RFAC and Callback URL<a class="headerlink" href="#rfac-and-callback-url" title="Permanent link">#</a></h2>
<p>Engine's callback URL is <code>https://&lt;your-server-name&gt;/jans-auth/fl/callback</code>. This resource is only be available for a given browser session while <code>RFAC</code> is in execution. Once the callback is visited or the flow times out (whichever occurs first), subsequent requests will respond with an HTTP 404 error.</p>
<p>The mechanism used for redirection is a "302 Found" HTTP redirect that entails a subsequent GET request to the external site. In cases where a POST is expected, the 3-param version of <a href="../flows-navigation-ui/#3-param-variant">RRF</a> can be useful.</p>
<h2 id="rrf-navigation-and-assets-handling">RRF, navigation, and assets handling<a class="headerlink" href="#rrf-navigation-and-assets-handling" title="Permanent link">#</a></h2>
<p>Understanding how <code>RRF</code> works in the engine is key to writing meaningful flows. This topic is fully covered <a href="../flows-navigation-ui/">here</a>.</p>
<h2 id="foreign-calls">Foreign calls<a class="headerlink" href="#foreign-calls" title="Permanent link">#</a></h2>
<p>In the Jans Agama engine, Java or Groovy code can be called by means of the <code>Call</code> instruction. Specifically, public methods from public classes or static methods from public interfaces.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Java language background is required for this section.</p>
</div>
<p>The following exemplifies different kind of usages of Java from Agama code:</p>
<table>
    <tr><th>Example</th><th>Notes</th></tr>
    <tr>
<td>

<div class="highlight"><pre><span></span><code>Call java.lang.Integer#parseInt &quot;FF&quot; 16
</code></pre></div>

</td>
        <td>Invokes the <code>parseInt</code> method of <code>Integer</code> class passing the given arguments (i.e. conversion of hexadecimal string to a primitive <code>int</code>). The returned value is ignored</td>
    </tr>
    <tr>
<td>

<div class="highlight"><pre><span></span><code>numbers = [ 2, -2, 0, 3, -3, 4 ]
small = Call java.util.Collections#min numbers
</code></pre></div>

</td>
        <td>Invokes the <code>min</code> method of the <code>Collections</code> class.<br/>Supplies a list of numbers as argument.<br/>The smallest number is stored in variable <code>small</code></td>
    </tr>
    <tr>
<td>

<div class="highlight"><pre><span></span><code>jLocale = Call java.util.Locale#getDefault
localeName = jLocale.displayName
</code></pre></div>

</td>
        <td>Computes the display name of the JVM default locale</td>
    </tr>
    <tr>
<td>

<div class="highlight"><pre><span></span><code>car = { brand: &quot;Ford&quot;, model: 1963 }
sidecar = Call java.util.Map#copyOf car
</code></pre></div>

</td>
        <td>Makes a deep clone of a map</td>
    </tr>
    <tr>
<td>

<div class="highlight"><pre><span></span><code>number | E = Call java.lang.Integer#parseInt &quot;AGA&quot; 16
When E is not null
    Log &quot;An error occurred:&quot; E.message 
</code></pre></div>

</td>
        <td>Similar to the first example.<br/>If an exception is thrown by the invocation, it's caught and assigned to variable <code>E</code>.<br/>Note both checked and unchecked exceptions are caught</td>
    </tr>
    <tr>
<td>

<div class="highlight"><pre><span></span><code>| E = Call com.acme.Worker#notifyExternalSystem
//Do something with E
//... 
</code></pre></div>

</td>
        <td>If exception catching is required when calling a method that returns <code>void</code>, there is no need to put a variable before the pipe</td>
    </tr>
    <tr>
<td>

<div class="highlight"><pre><span></span><code>p1 = Call java.awt.Point#new
p2 = Call java.awt.Point#new 1 3
Call p2 translate -1 1
</code></pre></div>

</td>
        <td>Creates instances of class <code>java.awt.Point</code> with different constructors. For <code>p1</code> the no-args constructor is used.<br/>Method <code>translate</code> is invoked on the <code>p2</code> instance. Note usage of a space here instead of hash (<code>#</code>)</td>
    </tr>
    <tr>
<td>

<div class="highlight"><pre><span></span><code>cls1 = Call java.lang.CharSequence#class
cls2 = Call java.lang.Integer#class
Call cls2 parseInt &quot;FF&quot; 16
</code></pre></div>

</td>
        <td>Stores in <code>cls1</code> a reference to interface class <code>CharSequence.class</code>.<br/>Stores in <code>cls2</code> a reference to <code>Integer.class</code>.<br/>The 3rd line statement achieves the same effect of <code>Call java.lang.Integer#parseInt "FF" 16</code></td>
    </tr>
    <tr>
<td>

<div class="highlight"><pre><span></span><code>L = [ &quot;A&quot;, &quot;B&quot;, &quot;C&quot; ]
S = Call java.util.Set#of 0 2 4 6
map = { numbers: S, letters: L  }
hasOne = Call map.numbers contains 1
</code></pre></div>

</td>
        <td>Calls the <code>contains</code> method of the <code>java.util.Set</code> object stored in <code>map.numbers</code> passing <code>1</code> as argument and storing the result in <code>hasOne</code></td>
    </tr>
</table>

<p>The usage of a hash sign (or spaces) before a method name helps disambiguate whether the invocation is on a static class method or an object method. This is so because an expression like <code>hey.You</code> may reference the class <code>You</code> on package <code>hey</code>, or the value of key <code>You</code> in a map named <code>hey</code>.</p>
<h3 id="highlights">Highlights<a class="headerlink" href="#highlights" title="Permanent link">#</a></h3>
<p>Any method that meets the conditions mentioned (public or interface static) and that is reachable in the JVM <a href="#classpath">classpath</a> can be called; developers are not restricted solely to <code>java.*</code> packages.</p>
<p>When using <code>Call</code>, the method to execute is picked based on the name (e.g. after the <code>#</code> sign) and the number of arguments supplied. If a class/interface exhibits several methods with the same name and arity (number of parameters), the method that best matches the datatypes of the arguments with respect to its signature is selected. Sometimes this requires to perform arguments <a href="#arguments-conversion">conversions</a> and they may fail. In such case, the second best suited method is tried and so on.</p>
<p>When all attempts fail or there are no candidate methods to choose from, the <code>Call</code> simply throws a <code>NoSuchMethodException</code>.</p>
<p>For non-static method invocations, i.e. no hash sign, the class used for method lookup is that of the instance passed (the first parameter in the <code>Call</code> directive). This includes all associated superclasses too, as expected. When the instance does not hold a Java but an Agama value, the following is used to pick a class:</p>
<table>
<thead>
<tr>
<th>Agama type</th>
<th>Java class for method lookup</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code>String</code></td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><code>Boolean</code></td>
</tr>
<tr>
<td><code>number</code></td>
<td><code>Double</code></td>
</tr>
<tr>
<td><code>list</code></td>
<td><code>java.util.List</code></td>
</tr>
<tr>
<td><code>map</code></td>
<td><code>java.util.Map</code></td>
</tr>
</tbody>
</table>
<p><strong>Limitations:</strong></p>
<ul>
<li>
<p><em>list</em> and <em>map</em> literals cannot be passed as arguments to method calls directly. This means the following is illegal: <code>Call co.Utils#myMethod { key: [ 1, 2 , 3] } [ "Yeeha!" ]</code>. To achieve the same effect assign the literal value to a variable and pass that instead</p>
</li>
<li>
<p><code>Call</code>ing a method that mutates one or more of the arguments passed will not work properly if the corresponding parameters in the method signature have type information attached. For example, copying a list into another using <code>java.util.Collections#copy​(List&lt;? super T&gt; dest, List&lt;? extends T&gt; src)</code> may not behave as expected. Conversely, calling <code>java.lang.reflect.Array#set​(Object array, int index, Object value)</code> works fine because <code>array</code> does not have a parameterized type. The practice of mutating passed arguments is unusual and sometimes discouraged in programming</p>
</li>
</ul>
<h3 id="exception-handling">Exception handling<a class="headerlink" href="#exception-handling" title="Permanent link">#</a></h3>
<p>As seen in the examples Agama engine can deal with Java exceptions, however, this feature should be used sparingly. When exception handling adds undesired complexity to your code, create wrapper methods in Java and do the processing there instead of delegating that to the DSL.</p>
<h3 id="arguments-conversion">Arguments conversion<a class="headerlink" href="#arguments-conversion" title="Permanent link">#</a></h3>
<p><a href="../../../../agama/language-reference/#data-types">Agama types</a> do not match Java types. This means passing a "native" Agama value as parameter in a method <code>Call</code> requires some form of compatibility with the target (Java) type in the method signature.</p>
<p>An argument (Agama value) is compatible with a method parameter if it can be "converted" successfully. As we'll see, conversion feels pretty natural in practice. If this process fails a <code>java.lang.IllegalArgumentException</code> is thrown and the flow will crash unless the exception is caught. Note however the recommended practice is to let flows <a href="../agama-best-practices/#about-crashes">crash</a>.</p>
<p>The following lists some of the most common successful conversions:</p>
<table>
<thead>
<tr>
<th>Agama value</th>
<th>Can be converted to</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>string</code></td>
<td><code>String</code> or <code>char[]</code></td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><code>Boolean</code> or primitive equivalent</td>
</tr>
<tr>
<td><code>number</code></td>
<td><code>Double</code>/<code>Float</code>/<code>Integer</code>/<code>Long</code>/<code>Short</code>/<code>Byte</code> or primitive equivalent</td>
</tr>
<tr>
<td><code>null</code></td>
<td>Any non-primitive</td>
</tr>
<tr>
<td><code>list</code></td>
<td>Array or class implementing <code>Collection&lt;T&gt;</code> as long as items can be converted to type <code>T</code></td>
</tr>
<tr>
<td><code>map</code></td>
<td>Class implementing <code>Map&lt;K, V&gt;</code> as long as keys and values can be converted to types <code>K</code> and <code>V</code>, respectively</td>
</tr>
<tr>
<td><code>map</code></td>
<td>Java bean. Unrecognized properties in Agama value are ignored</td>
</tr>
</tbody>
</table>
<p>The below table shows some examples of interesting and handy conversions:</p>
<table>
<thead>
<tr>
<th>Agama value</th>
<th>Param data type in target Java method</th>
<th>Argument value (Agama)</th>
<th>Received param value (in method)</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Positive <code>number</code> having fractional part</td>
<td><code>Integer</code>/<code>Long</code>/<code>Short</code>/<code>Byte</code> or primitive equivalent</td>
<td>2.6</td>
<td>2</td>
<td>Integer part kept</td>
</tr>
<tr>
<td>Negative <code>number</code> having fractional part</td>
<td><code>Integer</code>/<code>Long</code>/<code>Short</code>/<code>Byte</code> or primitive equivalent</td>
<td>-2.4</td>
<td>2</td>
<td>Integer part kept</td>
</tr>
<tr>
<td>Integer <code>number</code></td>
<td><code>Float</code>/<code>Double</code> or primitive equivalent</td>
<td>1</td>
<td>1.0</td>
<td></td>
</tr>
<tr>
<td><code>list</code> of <code>number</code>s</td>
<td><code>List&lt;Integer&gt;</code></td>
<td>[1, 2.0, 3.1, -4.2]</td>
<td>[1, 2, 3, -4]</td>
<td>Only integer parts kept</td>
</tr>
<tr>
<td><code>list</code> of integer <code>number</code>s</td>
<td><code>List&lt;Float&gt;</code>/<code>List&lt;Double&gt;</code></td>
<td>[1, 2, 3, -4]</td>
<td>[1.0, 2.0, 3.0, -4.0]</td>
<td></td>
</tr>
<tr>
<td><code>string</code> of length 1</td>
<td><code>Character</code> or primitive equivalent</td>
<td>a</td>
<td>a</td>
<td>Passing a zero, two, or more lengthed string will make the call fail</td>
</tr>
</tbody>
</table>
<p>When the argument is not an Agama but a Java object/primitive, the following rules apply:</p>
<ul>
<li>If the value can be cast to the target type, no conversion is needed, otherwise</li>
<li>If it is an instance of <code>java.lang.Number</code> and the type is a numeric primitive or wrapper (e.g. <code>Integer</code>), the value is truncated if required, otherwise</li>
<li>The value is serialized to JSON - if possible - and then an attempt to create a Java instance based on the given JSON contents is made. For this purpose, the FasterXML Jackson library is used</li>
</ul>
<p>This is powerful because it allows to send data of similar shape/structure when data types do not necessarily match. Consider the following example:</p>
<div class="highlight"><pre><span></span><code>s = &quot;a man&#39;s gotta do what a man&#39;s gotta do&quot;
jStrArr = Call s split &quot; &quot;
words = Call java.util.Collections#unmodifiableSet jStrArr
</code></pre></div>
<p>This Agama snippet creates the (Java) <code>Set</code> of different words found in a given (Agama) <code>string</code>. Note <code>jStrArr</code> is of type <code>String[]</code> and is passed directly to method <code>unmodifiableSet</code> which originally expects an instance of <code>Set</code> as parameter.</p>
<h3 id="from-java-to-agama">From Java to Agama<a class="headerlink" href="#from-java-to-agama" title="Permanent link">#</a></h3>
<p>We just saw how Agama values are treated in Java code. Here we make an analysis in the reverse direction: from Java to Agama where Java values are obtained through <code>Call</code> invocations.</p>
<p>The following table relates Java types to Agama types:</p>
<table>
<thead>
<tr>
<th>Java value (<code>x</code>)</th>
<th>Agama equivalent</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>x</code> is a Java array or implements <code>java.util.List</code></td>
<td>list</td>
<td>Changing the list contents (includes updates on x.length) can only be achieved if the Java list is modifiable</td>
</tr>
<tr>
<td><code>x</code> implements <code>java.util.Map</code> and keys are of type<code>java.lang.String</code></td>
<td>map</td>
<td>Changing the map contents can only be achieved if the Java map is modifiable</td>
</tr>
<tr>
<td><code>x</code> is a <code>java.lang.(Double|Float|Long|Integer|Short|Byte)</code> or an equivalent primitive</td>
<td>number</td>
<td></td>
</tr>
<tr>
<td><code>x</code> is a (non-null) <code>java.lang.Boolean</code> or equivalent primitive</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td><code>x</code> is a <code>java.lang.String</code></td>
<td>string (limited)</td>
<td>Neither indexing nor <code>x.length</code> can be used</td>
</tr>
<tr>
<td>null</td>
<td>null</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Except</strong> for maps, the following holds for a value <code>x</code> obtained through a Java <code>Call</code>:</p>
<ul>
<li>
<p>If <code>x</code>'s class has getters and/or setters for some fields, they can be called. As an example if <code>age</code> and <code>name</code> are available fields, <code>x.age</code> can be used to get the value of <code>age</code> </p>
</li>
<li>
<p>Likewise, setting a value is possible too: <code>x.name = "Larry"</code> (if a suitable setter exists) </p>
</li>
<li>
<p>In general, a no-args method starting with <code>get</code> or <code>is</code> can be invoked. This is useful for instance to get the (Java) class name of your object (<code>x.class.name</code>) or determine if a list has no elements (<code>x.empty</code>)</p>
</li>
</ul>
<h3 id="classpath">Classpath<a class="headerlink" href="#classpath" title="Permanent link">#</a></h3>
<p>A class/interface is accessible to Agama code as long as it is part of:</p>
<ul>
<li><code>jans-auth.war &gt; WEB-INF/lib/*.jar</code> or,</li>
<li><code>jans-auth.war &gt; WEB-INF/classes</code> or,</li>
<li><code>/opt/jans/jetty/jans-auth/custom/libs/*.jar</code> (may require edition of <code>jans-auth.xml</code> descriptor)   </li>
</ul>
<p>Additionally, it is possible to upload source code on the fly to augment the classpath. Any valid Java or Groovy file is accepted and must be located under <code>/opt/jans/jetty/jans-auth/agama/scripts</code>. For instance, a class named <code>com.acme.Person</code> must reside in folder <code>/opt/jans/jetty/jans-auth/agama/scripts/com/acme</code>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Only files with extensions <code>.java</code> or <code>.groovy</code> are accounted</p>
</div>
<p>The <code>scripts</code> directory provides automatic "hot" reloading. This is a valuable time saver for developers because there is no need to restart the jans-auth webapp when sources are modified. This feature has some limitations which are explained in the following.</p>
<h4 id="limitations-of-code-added-on-the-fly">Limitations of code added "on the fly"<a class="headerlink" href="#limitations-of-code-added-on-the-fly" title="Permanent link">#</a></h4>
<p>Classes in <code>scripts</code> directory can only be accessed through <code>Call</code> directives. As an example suppose you added classes <code>A</code> and <code>B</code> to <code>scripts</code>, and <code>A</code> depends on <code>B</code>. <code>Call</code>s using class <code>A</code> will work and any change to files <code>A</code> and/or <code>B</code> will be picked automatically. On the contrary, trying to load this kind of classes using <code>Class.forName</code> either from a jar file in <code>custom/libs</code> or from Agama itself will degenerate in <code>ClassNotFoundException</code>. Note <code>A</code> and <code>B</code> can also depend on classes found at any of the locations listed at the beginning of this section.</p>
<p>Note Java sources are actually interpreted as Groovy code. 99% of times this is not a concern since Groovy can be considered a superset of Java, however, there are some minor discrepancies that may exhibit unexpected behaviors. These differences are described <a href="https://groovy-lang.org/differences.html">here</a>.</p>
<p>We consider the following to be remarkable:</p>
<ul>
<li>Array literals in shorthand syntax not allowed, e.g. <code>int[] array = {1, 2, 3}</code>. Use <code>int[] array = new int[] {1, 2, 3}</code> instead</li>
<li>String interpolation: <code>"hello $mark"</code> evaluates the value of variable <code>mark</code> and prepends <code>hello</code> to it!. To avoid this use a backslash, like in <code>"hello \$mark"</code>. Learn more about interpolation <a href="http://groovy-lang.org/syntax.html#_string_interpolation">here</a>. In general, prepend ocurrences of <code>$</code> in your string literals with a <code>\</code></li>
<li>Usage of <code>==</code> operator actually calls the <code>equals</code> method. Most of times this is fine but can be a problem when you are overriding <code>equals</code> in your class and make use of <code>==</code>. This will introduce a recursive call in your implementation and may degenerate in a stack overflow. If possible, use the <code>===</code> operator or the <code>is</code> method in these cases</li>
</ul>
<h3 id="oop-prose-warning">OOP prose warning<a class="headerlink" href="#oop-prose-warning" title="Permanent link">#</a></h3>
<p>See the recommended <a href="../agama-best-practices/#oop-prose-warning">practices</a> to learn more about this topic.</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="December 16, 2025 09:22:28 UTC"><span class="timeago" datetime="2025-12-16T09:22:28+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="December 16, 2025 09:22:28 UTC">2025-12-16</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="June 6, 2023 16:44:10 UTC"><span class="timeago" datetime="2023-06-06T16:44:10+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="June 6, 2023 16:44:10 UTC">2023-06-06</span>
  </span>

    
    
    
  </aside>





                

              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026, The Janssen Project
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/JanssenProject/jans" target="_blank" rel="noopener" title="Janssen on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://jans.io/docs" target="_blank" rel="noopener" title="Janssen Website" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2C505.9 32 576 102 576 188.5c0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1C429.8 399.5 390 416 348.5 416 262.1 416 192 346 192 259.5c0-1.5 0-3 .1-4.5.5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9v2.6c0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zm-144.3 77.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1l-71.1 71.1C73.8 275.5 64 299.1 64 323.6c0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2C70.1 480.2 0 410.2 0 323.7c0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9v3.9c-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8v-2.3c0-33.7-18-63.3-44.8-79.6z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.prune", "navigation.path", "navigation.top", "navigation.instant", "navigation.instant.progress", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.copy", "content.code.select", "content.code.annotate", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    

      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../../js/timeago.min.js"></script>
      
        <script src="../../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../../javascripts/skeleton-loader.js"></script>
      
        <script src="../../../../javascripts/full-screen-sections.js"></script>
      
    



  </body>
</html>