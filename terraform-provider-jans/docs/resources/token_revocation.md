---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "jans_token_revocation Resource - jans"
subcategory: ""
description: |-
  Resource for revoking OAuth tokens. This is a command-style resource that revokes tokens on create/update.
  This resource revokes a specific OAuth access token or refresh token identified by its token code.
  Use this for security operations such as emergency token revocation, token rotation, or implementing
  token lifecycle management. The resource supports triggers to re-execute revocation when specified
  values change.
  Example Usage
  
  # Revoke a specific token
  resource "jans_token_revocation" "revoke_token" {
    token_code = var.token_to_revoke
  }
  
  # Emergency revocation with triggers
  resource "jans_token_revocation" "emergency" {
    token_code = var.compromised_token
  
    triggers = {
      alert_id  = var.security_alert_id
      timestamp = timestamp()
    }
  }
  
  # Token rotation scenario
  resource "jans_token_revocation" "rotate_old" {
    count      = length(var.old_tokens)
    token_code = var.old_tokens[count.index]
  
    triggers = {
      secret_version = var.client_secret_version
    }
  }
  
  OAuth Scopes Required
  https://jans.io/oauth/config/token.delete
  Known Issues
  None currently known. The resource correctly handles both successful revocations and 404 responses
  for non-existent tokens.
---

# jans_token_revocation (Resource)

Resource for revoking OAuth tokens. This is a command-style resource that revokes tokens on create/update.

This resource revokes a specific OAuth access token or refresh token identified by its token code.
Use this for security operations such as emergency token revocation, token rotation, or implementing
token lifecycle management. The resource supports triggers to re-execute revocation when specified
values change.

## Example Usage

```hcl
# Revoke a specific token
resource "jans_token_revocation" "revoke_token" {
  token_code = var.token_to_revoke
}

# Emergency revocation with triggers
resource "jans_token_revocation" "emergency" {
  token_code = var.compromised_token

  triggers = {
    alert_id  = var.security_alert_id
    timestamp = timestamp()
  }
}

# Token rotation scenario
resource "jans_token_revocation" "rotate_old" {
  count      = length(var.old_tokens)
  token_code = var.old_tokens[count.index]

  triggers = {
    secret_version = var.client_secret_version
  }
}
```

## OAuth Scopes Required

- `https://jans.io/oauth/config/token.delete`

## Known Issues

None currently known. The resource correctly handles both successful revocations and 404 responses
for non-existent tokens.

## Example Usage

```terraform
# Configure the Janssen Provider
terraform {
  required_providers {
    jans = {
      source = "jans/jans"
    }
  }
}

provider "jans" {
  url           = "https://moabu-noble-sawfish.gluu.info"
  client_id     = var.client_id
  client_secret = var.client_secret
  insecure_client = true  # Only for development/testing
}

# Example 1: Revoke a specific token
resource "jans_token_revocation" "revoke_token" {
  token_code = var.token_to_revoke
}

# Example 2: Emergency token revocation with triggers
resource "jans_token_revocation" "emergency_revocation" {
  token_code = var.compromised_token

  triggers = {
    # Trigger when security alert is raised
    alert_id  = var.security_alert_id
    timestamp = timestamp()
  }
}

# Example 3: Revoke token on client deactivation
data "jans_tokens" "client_tokens" {
  limit = 100
}

# Note: In practice, you'd use a null_resource with local-exec to iterate
# This example shows the pattern
resource "jans_token_revocation" "revoke_on_client_removal" {
  for_each = toset(var.tokens_to_revoke)
  
  token_code = each.value

  triggers = {
    client_id = var.deactivated_client_id
  }
}

# Example 4: Token rotation scenario
resource "jans_oidc_client" "rotating_client" {
  client_name                = "Rotating Client"
  grant_types                = ["client_credentials"]
  application_type           = "web"
  token_endpoint_auth_method = "client_secret_basic"
}

# Revoke old tokens when client secret is rotated
resource "jans_token_revocation" "rotate_tokens" {
  count = length(var.old_tokens)
  
  token_code = var.old_tokens[count.index]

  triggers = {
    # Trigger when client secret changes
    client_secret_version = var.client_secret_version
  }
}

# Variables
variable "token_to_revoke" {
  description = "Token code to revoke"
  type        = string
  sensitive   = true
}

variable "compromised_token" {
  description = "Compromised token to revoke"
  type        = string
  sensitive   = true
}

variable "security_alert_id" {
  description = "Security alert ID that triggered revocation"
  type        = string
  default     = "ALERT-2025-001"
}

variable "tokens_to_revoke" {
  description = "List of token codes to revoke"
  type        = list(string)
  sensitive   = true
  default     = []
}

variable "deactivated_client_id" {
  description = "Client ID being deactivated"
  type        = string
}

variable "old_tokens" {
  description = "Old tokens to revoke during rotation"
  type        = list(string)
  sensitive   = true
  default     = []
}

variable "client_secret_version" {
  description = "Client secret version for tracking rotations"
  type        = string
  default     = "v1"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `token_code` (String) Token code to revoke

### Optional

- `triggers` (Map of String) Map of values which should trigger a token revocation when changed

### Read-Only

- `id` (String) The ID of this resource.
