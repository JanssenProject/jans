version: 1

dn: inum=%(inumOrg)s!0011!031C.4A65,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Id Generator script
displayName: id_generator
gluuStatus: false
inum: %(inumOrg)s!0011!031C.4A65
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5pZCBpbXBvcnQgS
 WRHZW5lcmF0b3JUeXBlCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXIsIEFy
 cmF5SGVscGVyCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdAoKaW1wb3J
 0IGphdmEKCmNsYXNzIElkR2VuZXJhdG9yKElkR2VuZXJhdG9yVHlwZSk6CiAgICBkZWYgX19pbm
 l0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOgogICAgICAgIHNlbGYuY3VycmVudFRpbWVNa
 WxsaXMgPSBjdXJyZW50VGltZU1pbGxpcwoKICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKToKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXphdGl
 vbiIKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbH
 kiCgogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIERlc3Ryb3ki
 CiAgICAgICAgcHJpbnQgIklkIGdlbmVyYXRvci4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSIKICA
 gICAgICByZXR1cm4gVHJ1ZSAgIAoKICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOgogICAgIC
 AgIHJldHVybiAxCgogICAgIyBJZCBnZW5lcmF0b3IgaW5pdCBtZXRob2QKICAgICMgICBhcHBJZ
 CBpcyBhcHBsaWNhdGlvbiBJZAogICAgIyAgIGlkVHlwZSBpcyBJZCBUeXBlCiAgICAjICAgaWRQ
 cmVmaXggaXMgSWQgUHJlZml4CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGV
 sLkdsdXVDdXN0b21QZXJzb24KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcyBpcyBqYX
 ZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+CiAgICBkZWYgZ2VuZXJhd
 GVJZChzZWxmLCBhcHBJZCwgaWRUeXBlLCBpZFByZWZpeCwgY29uZmlndXJhdGlvbkF0dHJpYnV0
 ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkIgogICAgICAgIHB
 yaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkLiBBcHBJZDogJyIsIGFwcElkLCAiJywgSW
 RUeXBlOiAnIiwgaWRUeXBlLCAiJywgSWRQcmVmaXg6ICciLCBpZFByZWZpeCwgIiciCgogICAgI
 CAgICMgUmV0dXJuIE5vbmUgb3IgZW1wdHkgc3RyaW5nIHRvIHRyaWdnZXIgZGVmYXVsdCBJZCBn
 ZW5lcmF0aW9uIG1ldGhvZAogICAgICAgIHJldHVybiBOb25lCg==
oxScriptType: id_generator
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!13D3.E7AD,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Cache Refresh script
displayName: cache_refresh
gluuStatus: false
inum: %(inumOrg)s!0011!13D3.E7AD
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBDYWNoZVJlZnJlc2hUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVy
 LCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQp
 mcm9tIG9yZy5nbHV1Lm94dHJ1c3QubW9kZWwgaW1wb3J0IEdsdXVDdXN0b21BdHRyaWJ1dGUNCg
 0KaW1wb3J0IGphdmENCg0KY2xhc3MgQ2FjaGVSZWZyZXNoKENhY2hlUmVmcmVzaFR5cGUpOg0KI
 CAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYu
 Y3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2V
 sZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcm
 VzaC4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLiBJbml0a
 WFsaXplZCBzdWNjZXNzZnVsbHkiDQoNCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRl
 ZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQ
 gIkNhY2hlIHJlZnJlc2guIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLi
 BEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgI
 yBVcGRhdGUgdXNlciBlbnRyeSBiZWZvcmUgcGVyc2lzdCBpdA0KICAgICMgICB1c2VyIGlzIG9y
 Zy5nbHV1Lm94dHJ1c3QubW9kZWwuR2x1dUN1c3RvbVBlcnNvbg0KICAgICMgICBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcG
 VydHk+DQogICAgZGVmIHVwZGF0ZVVzZXIoc2VsZiwgdXNlciwgY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcmVzaC4gVXBkYXRlVXNlciBtZXRob2Qi
 DQoNCiAgICAgICAgYXR0cmlidXRlcyA9IHVzZXIuZ2V0Q3VzdG9tQXR0cmlidXRlcygpDQoNCiA
 gICAgICAgIyBBZGQgbmV3IGF0dHJpYnV0ZSBwcmVmZXJyZWRMYW5ndWFnZQ0KICAgICAgICBhdH
 RyUHJlZmZlcmVkTGFuZ3VhZ2UgPSBHbHV1Q3VzdG9tQXR0cmlidXRlKCJwcmVmZXJyZWRMYW5nd
 WFnZSIsICJlbi11cyIpDQogICAgICAgIGF0dHJpYnV0ZXMuYWRkKGF0dHJQcmVmZmVyZWRMYW5n
 dWFnZSkNCg0KICAgICAgICAjIEFkZCBuZXcgYXR0cmlidXRlIHVzZXJQYXNzd29yZA0KICAgICA
 gICBhdHRyVXNlclBhc3N3b3JkID0gR2x1dUN1c3RvbUF0dHJpYnV0ZSgidXNlclBhc3N3b3JkIi
 wgInRlc3QiKQ0KICAgICAgICBhdHRyaWJ1dGVzLmFkZChhdHRyVXNlclBhc3N3b3JkKQ0KDQogI
 CAgICAgICMgVXBkYXRlIGdpdmVuTmFtZSBhdHRyaWJ1dGUNCiAgICAgICAgZm9yIGF0dHJpYnV0
 ZSBpbiBhdHRyaWJ1dGVzOg0KICAgICAgICAgICAgYXR0ck5hbWUgPSBhdHRyaWJ1dGUuZ2V0TmF
 tZSgpDQogICAgICAgICAgICBpZiAoKCJnaXZlbm5hbWUiID09IFN0cmluZ0hlbHBlci50b0xvd2
 VyQ2FzZShhdHRyTmFtZSkpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eShhdHRyaWJ1dGUuZ
 2V0VmFsdWUoKSkpOg0KICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZShTdHJpbmdI
 ZWxwZXIucmVtb3ZlTXVsdGlwbGVTcGFjZXMoYXR0cmlidXRlLmdldFZhbHVlKCkpICsgIiAodXB
 kYXRlZCkiKQ0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbi
 hzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg==
oxScriptType: cache_refresh
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!2DAF.F995,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample UMA Authorization policy
displayName: uma_authorization_policy
gluuStatus: true
inum: %(inumOrg)s!0011!2DAF.F995
oxConfigurationProperty: {"value1":"allowed_clients","value2":"%(scim_rp_client_id)s","description":""}
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51bWEgaW1wb3J0IEF1d
 Ghvcml6YXRpb25Qb2xpY3lUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVy
 LCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0LCBIYXN
 oU2V0DQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UudW1hLmF1dGhvcml6YXRpb24gaW1wb3J0IE
 F1dGhvcml6YXRpb25Db250ZXh0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEF1dGhvcml6YXRpb25Qb
 2xpY3koQXV0aG9yaXphdGlvblBvbGljeVR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJy
 ZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGl
 tZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KIC
 AgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiBJbml0aWFsaXphdGlvbiINCg0KI
 CAgICAgICBzZWxmLmNsaWVudHNTZXQgPSBzZWxmLnByZXBhcmVDbGllbnRzU2V0KGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKQ0KICAgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiBJbml
 0aWFsaXphdGlvbi4gQ291bnQgYXV0aG9yaXplZCBjbGllbnRzOiAlcyIgJSBzZWxmLmNsaWVudHNTZX
 Quc2l6ZSgpDQoNCiAgICAgICAgcHJpbnQgIlVNQSBhdXRob3JpemF0aW9uIHBvbGljeS4gSW5pdGlhb
 Gl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVz
 dHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVTUEgYXV
 0aG9yaXphdGlvbiBwb2xpY3kuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJVTUEgYXV0aG9yaXphdG
 lvbiBwb2xpY3kuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlICAgD
 QoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgICMg
 UHJvY2VzcyBwb2xpY3kgcnVsZQ0KICAgICMgICBhdXRob3JpemF0aW9uQ29udGV4dCBpcyBvcmcueGR
 pLm94YXV0aC5zZXJ2aWNlLnVtYS5hdXRob3JpemF0aW9uLkF1dGhvcml6YXRpb25Db250ZXh0DQogIC
 AgIyAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wb
 GVDdXN0b21Qcm9wZXJ0eT4NCiAgICBkZWYgYXV0aG9yaXplKHNlbGYsIGF1dGhvcml6YXRpb25Db250
 ZXh0LCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVTUEgQXV0aG9yaXp
 hdGlvbiBwb2xpY3kuIEF0dGVtcHRpbmcgdG8gYXV0aG9yaXplIGNsaWVudCINCiAgICAgICAgY2xpZW
 50X2lkID0gYXV0aG9yaXphdGlvbkNvbnRleHQuZ2V0R3JhbnQoKS5nZXRDbGllbnRJZCgpDQoNCiAgI
 CAgICAgcHJpbnQgIlVNQSBBdXRob3JpemF0aW9uIHBvbGljeS4gQ2xpZW50OiAiLCBjbGllbnRfaWQN
 CiAgICAgICAgaWYgKHNlbGYuY2xpZW50c1NldC5jb250YWlucyhjbGllbnRfaWQpKToNCiAgICAgICA
 gICAgIHByaW50ICJVTUEgQXV0aG9yaXphdGlvbiBwb2xpY3kuIEF1dGhvcml6aW5nIGNsaWVudCINCi
 AgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludCAiV
 U1BIEF1dGhvcml6YXRpb24gcG9saWN5LiBDbGllbnQgaXNuJ3QgYXV0aG9yaXplZCINCiAgICAgICAg
 ICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHByaW50ICJVTUEgQXV0aG9yaXphdGlvbiBwb2xpY3k
 uIEF1dGhvcml6aW5nIGNsaWVudCINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBwcmVwYX
 JlQ2xpZW50c1NldChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIGNsaWVud
 HNTZXQgPSBIYXNoU2V0KCkNCiAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5j
 b250YWluc0tleSgiYWxsb3dlZF9jbGllbnRzIikpOg0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudHN
 TZXQNCg0KICAgICAgICBhbGxvd2VkQ2xpZW50c0xpc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 5nZXQoImFsbG93ZWRfY2xpZW50cyIpLmdldFZhbHVlMigpDQogICAgICAgIGlmIChTdHJpbmdIZWxwZ
 XIuaXNFbXB0eShhbGxvd2VkQ2xpZW50c0xpc3QpKToNCiAgICAgICAgICAgIHByaW50ICJVTUEgYXV0
 aG9yaXphdGlvbiBwb2xpY3kuIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgYWxsb3dlZF9jbGl
 lbnRzIGlzIGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudHNTZXQgICAgDQoNCiAgICAgIC
 AgYWxsb3dlZENsaWVudHNMaXN0QXJyYXkgPSBTdHJpbmdIZWxwZXIuc3BsaXQoYWxsb3dlZENsaWVud
 HNMaXN0LCAiLCIpDQogICAgICAgIGlmIChBcnJheUhlbHBlci5pc0VtcHR5KGFsbG93ZWRDbGllbnRz
 TGlzdEFycmF5KSk6DQogICAgICAgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiB
 Jbml0aWFsaXphdGlvbi4gVGhlcmUgYXJlbid0IGNsaWVudHMgc3BlY2lmaWVkIGluIGFsbG93ZWRfY2
 xpZW50cyBwcm9wZXJ0eSINCiAgICAgICAgICAgIHJldHVybiBjbGllbnRzU2V0DQogICAgICAgIA0KI
 CAgICAgICAjIENvbnZlcnQgdG8gSGFzaFNldCB0byBxdWljayBzZWFyY2gNCiAgICAgICAgaSA9IDAN
 CiAgICAgICAgY291bnQgPSBsZW4oYWxsb3dlZENsaWVudHNMaXN0QXJyYXkpDQogICAgICAgIHdoaWx
 lIChpIDwgY291bnQpOg0KICAgICAgICAgICAgY2xpZW50ID0gYWxsb3dlZENsaWVudHNMaXN0QXJyYX
 lbaV0NCiAgICAgICAgICAgIGNsaWVudHNTZXQuYWRkKGNsaWVudCkNCiAgICAgICAgICAgIGkgPSBpI
 CsgMQ0KDQogICAgICAgIHJldHVybiBjbGllbnRzU2V0DQo=
oxScriptType: uma_authorization_policy
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!522F.CDC5,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Update User script
displayName: update_user
gluuStatus: false
inum: %(inumOrg)s!0011!522F.CDC5
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBVcGRhdGVVc2VyVHlwZQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyLCBB
 cnJheUhlbHBlcgpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QKCmltcG9
 ydCBqYXZhCgpjbGFzcyBVcGRhdGVVc2VyKFVwZGF0ZVVzZXJUeXBlKToKICAgIGRlZiBfX2luaX
 RfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6CiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pb
 GxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzCgogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlv
 bkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gSW5pdGlhbGl6YXRpb24
 iCiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiCg
 ogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhd
 GlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gRGVzdHJveSIKICAg
 ICAgICBwcmludCAiVXBkYXRlIHVzZXIuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiCiAgICAgICA
 gcmV0dXJuIFRydWUgICAKCiAgICAjIFVwZGF0ZSB1c2VyIGVudHJ5IGJlZm9yZSBwZXJzaXN0ZW
 50IGl0CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZ
 XJzb24KICAgICMgICBwZXJzaXN0ZWQgaXMgYm9vbGVhbiB2YWx1ZSB0byBzcGVjaWZ5IGlmIG9w
 ZXJhdGlvbiB0eXBlOiBhZGQvbW9kaWZ5CiAgICAjICAgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 gaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5PgogICAgZGVmIH
 VwZGF0ZVVzZXIoc2VsZiwgdXNlciwgcGVyc2lzdGVkLCBjb25maWd1cmF0aW9uQXR0cmlidXRlc
 yk6CiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBVcGRhdGVVc2VyIG1ldGhvZCIKCiAgICAg
 ICAgdWlkID0gdXNlci5nZXRVaWQoKQogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gVXNlciB
 VaWQ6IiwgdWlkCiAgICAgICAgCiAgICAgICAgbWFpbCA9IHVpZCArICJAZXhhbXBsZS5vcmciCi
 AgICAgICAgdXNlci5zZXRNYWlsKG1haWwpCgogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmI
 GdldEFwaVZlcnNpb24oc2VsZik6CiAgICAgICAgcmV0dXJuIDEK
oxScriptType: update_user
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!6EA0.8F0C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample User Registration script
displayName: user_registration
gluuStatus: false
inum: %(inumOrg)s!0011!6EA0.8F0C
oxConfigurationProperty: {"value1":"enable_user","value2":"false","description":
 ""}
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9ydCBVc
 2VyUmVnaXN0cmF0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLmxkYXAubW9kZWwgaW1wb3J0IEdsdXVTdGF0
 dXMNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXIsIEFycmF5SGVscGVyDQpmcm9
 tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QNCg0KaW1wb3J0IGphdmENCg0KY2xhc3
 MgVXNlclJlZ2lzdHJhdGlvbihVc2VyUmVnaXN0cmF0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fK
 HNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9
 IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cml
 idXRlcyk6DQogICAgICAgIHByaW50ICJVc2VyIHJlZ2lzdHJhdGlvbi4gSW5pdGlhbGl6YXRpb24iDQ
 oNCiAgICAgICAgc2VsZi5lbmFibGVfdXNlciA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJlbmFibGVfdXNlciIpLmdldFZhbHVlMigpLCBGYWxzZSkNCg0K
 ICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb24uIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSI
 NCg0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb24uIERlc3Ryb
 3kiDQogICAgICAgIHByaW50ICJVc2VyIHJlZ2lzdHJhdGlvbi4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxs
 eSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgICMgVXNlciByZWdpc3RyYXRpb24gaW5pdCB
 tZXRob2QNCiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZX
 Jzb24NCiAgICAjICAgcmVxdWVzdFBhcmFtZXRlcnMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFN0c
 mluZ1tdPg0KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0
 cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+DQogICAgZGVmIGluaXRSZWdpc3RyYXRpb24oc2VsZiw
 gdXNlciwgcmVxdWVzdFBhcmFtZXRlcnMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgIC
 AgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW9uLiBJbml0IG1ldGhvZCINCg0KICAgICAgICByZXR1cm4gV
 HJ1ZQ0KDQogICAgIyBVc2VyIHJlZ2lzdHJhdGlvbiBwcmUgbWV0aG9kDQogICAgIyAgIHVzZXIgaXMg
 b3JnLmdsdXUub3h0cnVzdC5tb2RlbC5HbHV1Q3VzdG9tUGVyc29uDQogICAgIyAgIHJlcXVlc3RQYXJ
 hbWV0ZXJzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTdHJpbmdbXT4NCiAgICAjICAgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3Blc
 nR5Pg0KICAgIGRlZiBwcmVSZWdpc3RyYXRpb24oc2VsZiwgdXNlciwgcmVxdWVzdFBhcmFtZXRlcnMs
 IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW9
 uLiBQcmUgbWV0aG9kIg0KDQogICAgICAgIHVzZXJTdGF0dXMgPSBHbHV1U3RhdHVzLkFDVElWRQ0KIC
 AgICAgICBpZiBub3Qgc2VsZi5lbmFibGVfdXNlcjoNCiAgICAgICAgICAgIHVzZXJTdGF0dXMgPSBHb
 HV1U3RhdHVzLklOQUNUSVZFDQoNCiAgICAgICAgIyBEaXNhYmxlL0VuYWJsZSByZWdpc3RlcmVkIHVz
 ZXINCiAgICAgICAgdXNlci5zZXRTdGF0dXModXNlclN0YXR1cykNCg0KICAgICAgICByZXR1cm4gVHJ
 1ZQ0KDQogICAgIyBVc2VyIHJlZ2lzdHJhdGlvbiBwb3N0IG1ldGhvZA0KICAgICMgICB1c2VyIGlzIG
 9yZy5nbHV1Lm94dHJ1c3QubW9kZWwuR2x1dUN1c3RvbVBlcnNvbg0KICAgICMgICByZXF1ZXN0UGFyY
 W1ldGVycyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU3RyaW5nW10+DQogICAgIyAgIGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21Qcm9wZXJ
 0eT4NCiAgICBkZWYgcG9zdFJlZ2lzdHJhdGlvbihzZWxmLCB1c2VyLCByZXF1ZXN0UGFyYW1ldGVycy
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb
 24uIFBvc3QgbWV0aG9kIg0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVy
 c2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg==
oxScriptType: user_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!A51E.76DA,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Authentication script
displayName: basic
gluuStatus: false
inum: %(inumOrg)s!0011!A51E.76DA
oxLevel: 100
oxModuleProperty: {"value1":"usage_type","value2":"both","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb
 20gb3JnLnhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0
 aGVudGljYXRpb25UeXBlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J0IFVzZXJ
 TZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQoNCmltcG9ydC
 BqYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uV
 HlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAg
 ICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWY
 gaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJCYX
 NpYy4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJCYXNpYy4gSW5pdGlhbGl6ZWQgc
 3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3ko
 c2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQmFzaWMuIER
 lc3Ryb3kiDQogICAgICAgIHByaW50ICJCYXNpYy4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCi
 AgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICAgI
 CAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxm
 LCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIFR
 ydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIH
 VzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9uZ
 Q0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywg
 cmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICA
 gICAgICAgIHByaW50ICJCYXNpYy4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQoNCiAgICAgIC
 AgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpD
 QogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAg
 ICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KDQogICA
 gICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci
 5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U
 3RyaW5nKHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c2VyU2VydmljZSA9IFVz
 ZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2V
 ydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgIC
 AgICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNC
 iAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1
 cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR
 0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PS
 AxKToNCiAgICAgICAgICAgIHByaW50ICJCYXNpYy4gUHJlcGFyZSBmb3IgU3RlcCAxIg0KICAgI
 CAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBG
 YWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJ
 hdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIG
 dldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlc
 yk6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiwgY29u
 ZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gIiINCg0KICAgIGR
 lZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZX
 JzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!8BAF.80D6,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Fido U2F authentication module
displayName: u2f
gluuStatus: false
inum: %(inumOrg)s!0011!8BAF.80D6
oxConfigurationProperty: {"value1":"u2f_application_id","value2":"https://%(hostname)s","description":""}
oxConfigurationProperty: {"value1":"u2f_server_uri","value2":"https://%(hostname)s","description":""}
oxLevel: 10
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZ
 XJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLmpib3NzLnNlYW0uY29udGV4dHMgaW1wb3J0
 IENvbnRleHQsIENvbnRleHRzDQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGltcG9ydCBJZGV
 udGl0eQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2VydmljZQ0KZnJvbS
 BvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlcg0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0I
 EFycmF5SGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLmNsaWVudC5maWRvLnUyZiBpbXBvcnQgRmlk
 b1UyZkNsaWVudEZhY3RvcnkNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZS5maWRvLnUyZiBpbXB
 vcnQgRGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC51dGlsIGltcG
 9ydCBTZXJ2ZXJVdGlsDQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLmNvbmZpZyBpbXBvcnQgQ29uc
 3RhbnRzDQpmcm9tIG9yZy5qYm9zcy5yZXN0ZWFzeS5jbGllbnQgaW1wb3J0IENsaWVudFJlc3BvbnNl
 RmFpbHVyZQ0KZnJvbSBqYXZheC53cy5ycy5jb3JlIGltcG9ydCBSZXNwb25zZQ0KZnJvbSBqYXZhLnV
 0aWwgaW1wb3J0IEFycmF5cw0KDQppbXBvcnQgc3lzDQppbXBvcnQgamF2YQ0KDQpjbGFzcyBQZXJzb2
 5BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNhdGlvblR5cGUpOg0KICAgIGRlZiBfX2luaXRfX
 yhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMg
 PSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJ
 pYnV0ZXMpOg0KICAgICAgICBwcmludCAiVTJGLiBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBwcm
 ludCAiVTJGLiBJbml0aWFsaXphdGlvbi4gRG93bmxvYWRpbmcgVTJGIG1ldGFkYXRhIg0KICAgICAgI
 CB1MmZfc2VydmVyX3VyaSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgidTJmX3NlcnZlcl91
 cmkiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICB1MmZfc2VydmVyX21ldGFkYXRhX3VyaSA9IHUyZl9zZXJ
 2ZXJfdXJpICsgIi8ud2VsbC1rbm93bi9maWRvLXUyZi1jb25maWd1cmF0aW9uIg0KDQogICAgICAgIG
 1ldGFEYXRhQ29uZmlndXJhdGlvblNlcnZpY2UgPSBGaWRvVTJmQ2xpZW50RmFjdG9yeS5pbnN0YW5jZ
 SgpLmNyZWF0ZU1ldGFEYXRhQ29uZmlndXJhdGlvblNlcnZpY2UodTJmX3NlcnZlcl9tZXRhZGF0YV91
 cmkpDQoNCiAgICAgICAgbWF4X2F0dGVtcHRzID0gMw0KICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5
 nZSgxLCBtYXhfYXR0ZW1wdHMpOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHNlbG
 YubWV0YURhdGFDb25maWd1cmF0aW9uID0gbWV0YURhdGFDb25maWd1cmF0aW9uU2VydmljZS5nZXRNZ
 XRhZGF0YUNvbmZpZ3VyYXRpb24oKQ0KICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICBl
 eGNlcHQgQ2xpZW50UmVzcG9uc2VGYWlsdXJlLCBleDoNCiAgICAgICAgICAgICAgICAjIERldGVjdCB
 pZiBsYXN0IHRyeSBvciB3ZSBzdGlsbCBnZXQgU2VydmljZSBVbmF2YWlsYWJsZSBIVFRQIGVycm9yDQ
 ogICAgICAgICAgICAgICAgaWYgKGF0dGVtcHQgPT0gbWF4X2F0dGVtcHRzKSBvciAoZXguZ2V0UmVzc
 G9uc2UoKS5nZXRSZXNwb25zZVN0YXR1cygpICE9IFJlc3BvbnNlLlN0YXR1cy5TRVJWSUNFX1VOQVZB
 SUxBQkxFKToNCiAgICAgICAgICAgICAgICAgICAgcmFpc2UgZXgNCg0KICAgICAgICAgICAgICAgIGp
 hdmEubGFuZy5UaHJlYWQuc2xlZXAoMzAwMCkNCiAgICAgICAgICAgICAgICBwcmludCAiQXR0ZW1wdG
 luZyB0byBsb2FkIG1ldGFkYXRhOiAlZCIgJSBhdHRlbXB0DQogICAgICAgIA0KICAgICAgICBwcmlud
 CAiVTJGLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlICAgDQoN
 CiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHB
 yaW50ICJVMkYuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJVMkYuIERlc3Ryb3llZCBzdWNjZXNzZn
 VsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNC
 iAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2Vs
 ZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnV
 lDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZV
 R5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgI
 GRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJh
 bWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmd
 ldENyZWRlbnRpYWxzKCkNCiAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbW
 UoKQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIlUyRi4gQXV0a
 GVudGljYXRlIGZvciBzdGVwIDEiDQoNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50
 aWFscy5nZXRQYXNzd29yZCgpDQogICAgICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICA
 gICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0
 hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c
 2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgICAgICBsb2dnZWRf
 aW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQo
 gICAgICAgICAgICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbH
 NlDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogI
 CAgICAgICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAg
 ICAgdG9rZW5fcmVzcG9uc2UgPSBTZXJ2ZXJVdGlsLmdldEZpcnN0VmFsdWUocmVxdWVzdFBhcmFtZXR
 lcnMsICJ0b2tlblJlc3BvbnNlIikNCiAgICAgICAgICAgIGlmIHRva2VuX3Jlc3BvbnNlID09IE5vbm
 U6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIHRva
 2VuUmVzcG9uc2UgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAg
 ICAgICAgIGF1dGhfbWV0aG9kID0gU2VydmVyVXRpbC5nZXRGaXJzdFZhbHVlKHJlcXVlc3RQYXJhbWV
 0ZXJzLCAiYXV0aE1ldGhvZCIpDQogICAgICAgICAgICBpZiBhdXRoX21ldGhvZCA9PSBOb25lOg0KIC
 AgICAgICAgICAgICAgIHByaW50ICJVMkYuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBhdXRoTWV0a
 G9kIGlzIGVtcHR5Ig0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBj
 cmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICA
 gICAgdXNlciA9IGNyZWRlbnRpYWxzLmdldFVzZXIoKQ0KICAgICAgICAgICAgaWYgKHVzZXIgPT0gTm
 9uZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZ
 WQgdG8gZGV0ZXJtaW5lIHVzZXIgbmFtZSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0K
 ICAgICAgICAgICAgaWYgKGF1dGhfbWV0aG9kID09ICdhdXRoZW50aWNhdGUnKToNCiAgICAgICAgICA
 gICAgICBwcmludCAiVTJGLiBQcmVwYXJlIGZvciBzdGVwIDIuIENhbGwgRklETyBVMkYgaW4gb3JkZX
 IgdG8gZmluaXNoIGF1dGhlbnRpY2F0aW9uIHdvcmtmbG93Ig0KICAgICAgICAgICAgICAgIGF1dGhlb
 nRpY2F0aW9uUmVxdWVzdFNlcnZpY2UgPSBGaWRvVTJmQ2xpZW50RmFjdG9yeS5pbnN0YW5jZSgpLmNy
 ZWF0ZUF1dGhlbnRpY2F0aW9uUmVxdWVzdFNlcnZpY2Uoc2VsZi5tZXRhRGF0YUNvbmZpZ3VyYXRpb24
 pDQogICAgICAgICAgICAgICAgYXV0aGVudGljYXRpb25TdGF0dXMgPSBhdXRoZW50aWNhdGlvblJlcX
 Vlc3RTZXJ2aWNlLmZpbmlzaEF1dGhlbnRpY2F0aW9uKHVzZXIuZ2V0VXNlcklkKCksIHRva2VuX3Jlc
 3BvbnNlKQ0KDQogICAgICAgICAgICAgICAgaWYgKGF1dGhlbnRpY2F0aW9uU3RhdHVzLmdldFN0YXR1
 cygpICE9IENvbnN0YW50cy5SRVNVTFRfU1VDQ0VTUyk6DQogICAgICAgICAgICAgICAgICAgIHByaW5
 0ICJVMkYuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBHZXQgaW52YWxpZCBhdXRoZW50aWNhdGlvbi
 BzdGF0dXMgZnJvbSBGSURPIFUyRiBzZXJ2ZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGY
 WxzZQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgICAgIGVsaWYgKGF1dGhf
 bWV0aG9kID09ICdlbnJvbGwnKToNCiAgICAgICAgICAgICAgICBwcmludCAiVTJGLiBQcmVwYXJlIGZ
 vciBzdGVwIDIuIENhbGwgRklETyBVMkYgaW4gb3JkZXIgdG8gZmluaXNoIHJlZ2lzdHJhdGlvbiB3b3
 JrZmxvdyINCiAgICAgICAgICAgICAgICByZWdpc3RyYXRpb25SZXF1ZXN0U2VydmljZSA9IEZpZG9VM
 mZDbGllbnRGYWN0b3J5Lmluc3RhbmNlKCkuY3JlYXRlUmVnaXN0cmF0aW9uUmVxdWVzdFNlcnZpY2Uo
 c2VsZi5tZXRhRGF0YUNvbmZpZ3VyYXRpb24pDQogICAgICAgICAgICAgICAgcmVnaXN0cmF0aW9uU3R
 hdHVzID0gcmVnaXN0cmF0aW9uUmVxdWVzdFNlcnZpY2UuZmluaXNoUmVnaXN0cmF0aW9uKHVzZXIuZ2
 V0VXNlcklkKCksIHRva2VuX3Jlc3BvbnNlKQ0KDQogICAgICAgICAgICAgICAgaWYgKHJlZ2lzdHJhd
 GlvblN0YXR1cy5nZXRTdGF0dXMoKSAhPSBDb25zdGFudHMuUkVTVUxUX1NVQ0NFU1MpOg0KICAgICAg
 ICAgICAgICAgICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gR2V0IGludmF
 saWQgcmVnaXN0cmF0aW9uIHN0YXR1cyBmcm9tIEZJRE8gVTJGIHNlcnZlciINCiAgICAgICAgICAgIC
 AgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgI
 CAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcmludCAiVTJGLiBQcmVwYXJlIGZvciBzdGVwIDIu
 IEF1dGhlbnRpY2F0aW9kIG1ldGhvZCBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiB
 GYWxzZQ0KDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAgIC
 AgIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb
 25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBD
 b250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICA
 gICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIH
 ByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgP
 SBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXIgPSBj
 cmVkZW50aWFscy5nZXRVc2VyKCkNCg0KICAgICAgICAgICAgaWYgKHVzZXIgPT0gTm9uZSk6DQogICA
 gICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZGV0ZX
 JtaW5lIHVzZXIgbmFtZSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgI
 CAgdTJmX2FwcGxpY2F0aW9uX2lkID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJ1MmZfYXBw
 bGljYXRpb25faWQiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICAgICAjIENoZWNrIGlmIHVzZXIgaGF
 2ZSByZWdpc3RlcmVkIGRldmljZXMNCiAgICAgICAgICAgIGRldmljZVJlZ2lzdHJhdGlvblNlcnZpY2
 UgPSBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICAgICAgdXNlc
 kludW0gPSB1c2VyLmdldEF0dHJpYnV0ZSgiaW51bSIpDQoNCiAgICAgICAgICAgIGF1dGhlbnRpY2F0
 aW9uUmVxdWVzdCA9IE5vbmUNCg0KICAgICAgICAgICAgZGV2aWNlUmVnaXN0cmF0aW9ucyA9IGRldml
 jZVJlZ2lzdHJhdGlvblNlcnZpY2UuZmluZFVzZXJEZXZpY2VSZWdpc3RyYXRpb25zKHVzZXJJbnVtLC
 B1MmZfYXBwbGljYXRpb25faWQpDQogICAgICAgICAgICBpZiAoZGV2aWNlUmVnaXN0cmF0aW9ucy5za
 XplKCkgPiAwKToNCiAgICAgICAgICAgICAgICBwcmludCAiVTJGLiBQcmVwYXJlIGZvciBzdGVwIDIu
 IENhbGwgRklETyBVMkYgaW4gb3JkZXIgdG8gc3RhcnQgYXV0aGVudGljYXRpb24gd29ya2Zsb3ciDQo
 NCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uUm
 VxdWVzdFNlcnZpY2UgPSBGaWRvVTJmQ2xpZW50RmFjdG9yeS5pbnN0YW5jZSgpLmNyZWF0ZUF1dGhlb
 nRpY2F0aW9uUmVxdWVzdFNlcnZpY2Uoc2VsZi5tZXRhRGF0YUNvbmZpZ3VyYXRpb24pDQogICAgICAg
 ICAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uUmVxdWVzdCA9IGF1dGhlbnRpY2F0aW9uUmVxdWVzdFN
 lcnZpY2Uuc3RhcnRBdXRoZW50aWNhdGlvbih1c2VyLmdldFVzZXJJZCgpLCB1MmZfYXBwbGljYXRpb2
 5faWQpDQogICAgICAgICAgICAgICAgZXhjZXB0IENsaWVudFJlc3BvbnNlRmFpbHVyZSwgZXg6DQogI
 CAgICAgICAgICAgICAgICAgIGlmIChleC5nZXRSZXNwb25zZSgpLmdldFJlc3BvbnNlU3RhdHVzKCkg
 IT0gUmVzcG9uc2UuU3RhdHVzLk5PVF9GT1VORCk6DQogICAgICAgICAgICAgICAgICAgICAgICBwcml
 udCAiVTJGLiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBzdGFydCBhdXRoZW50aWNhdGlvbi
 B3b3JrZmxvdy4gRXhjZXB0aW9uOiIsIHN5cy5leGNfaW5mbygpWzFdDQogICAgICAgICAgICAgICAgI
 CAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Ig
 c3RlcCAyLiBDYWxsIEZJRE8gVTJGIGluIG9yZGVyIHRvIHN0YXJ0IHJlZ2lzdHJhdGlvbiB3b3JrZmx
 vdyINCiAgICAgICAgICAgIHJlZ2lzdHJhdGlvblJlcXVlc3RTZXJ2aWNlID0gRmlkb1UyZkNsaWVudE
 ZhY3RvcnkuaW5zdGFuY2UoKS5jcmVhdGVSZWdpc3RyYXRpb25SZXF1ZXN0U2VydmljZShzZWxmLm1ld
 GFEYXRhQ29uZmlndXJhdGlvbikNCiAgICAgICAgICAgIHJlZ2lzdHJhdGlvblJlcXVlc3QgPSByZWdp
 c3RyYXRpb25SZXF1ZXN0U2VydmljZS5zdGFydFJlZ2lzdHJhdGlvbih1c2VyLmdldFVzZXJJZCgpLCB
 1MmZfYXBwbGljYXRpb25faWQpDQoNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJmaWRvX3UyZl9hdX
 RoZW50aWNhdGlvbl9yZXF1ZXN0IiwgU2VydmVyVXRpbC5hc0pzb24oYXV0aGVudGljYXRpb25SZXF1Z
 XN0KSkNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJmaWRvX3UyZl9yZWdpc3RyYXRpb25fcmVxdWVz
 dCIsIFNlcnZlclV0aWwuYXNKc29uKHJlZ2lzdHJhdGlvblJlcXVlc3QpKQ0KDQogICAgICAgICAgICB
 yZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09IDMpOg0KICAgICAgICAgICAgcHJpbnQgIl
 UyRi4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgI
 CBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgZ2V0RXh0cmFQYXJhbWV0
 ZXJzRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIHJ
 ldHVybiBOb25lDQoNCiAgICBkZWYgZ2V0Q291bnRBdXRoZW50aWNhdGlvblN0ZXBzKHNlbGYsIGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlR
 m9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIChz
 dGVwID09IDIpOg0KICAgICAgICAgICAgcmV0dXJuICIvYXV0aC91MmYvbG9naW4ueGh0bWwiDQoNCiA
 gICAgICAgcmV0dXJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaW
 J1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQo=
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!92F0.BF9E,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Gluu oxPush2 authentication module
displayName: oxpush2
gluuStatus: false
inum: %(inumOrg)s!0011!92F0.BF9E
oxConfigurationProperty: {"value1":"application_id","value2":"https://%(hostname)s","description":""}
oxConfigurationProperty: {"value1":"authentication_mode","value2":"two_step","de
 scription":""}
oxConfigurationProperty: {"value1":"credentials_file","value2":"/etc/certs/oxpus
 h2_creds.json","description":""}
oxLevel: 15
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""
 }
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZ
 XJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLmpib3NzLnNlYW0uY29udGV4dHMgaW1wb3J0
 IENvbnRleHQsIENvbnRleHRzDQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGltcG9ydCBJZGV
 udGl0eQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2VydmljZQ0KZnJvbS
 BvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBTZXNzaW9uU3RhdGVTZXJ2aWNlDQpmcm9tIG9yZ
 y54ZGkub3hhdXRoLnNlcnZpY2UuZmlkby51MmYgaW1wb3J0IERldmljZVJlZ2lzdHJhdGlvblNlcnZp
 Y2UNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGl
 sIGltcG9ydCBBcnJheUhlbHBlcg0KZnJvbSBvcmcueGRpLm94YXV0aC51dGlsIGltcG9ydCBTZXJ2ZX
 JVdGlsDQpmcm9tIG9yZy54ZGkudXRpbC5zZWN1cml0eSBpbXBvcnQgU3RyaW5nRW5jcnlwdGVyIA0KZ
 nJvbSBvcmcueGRpLm94YXV0aC5tb2RlbC5jb25maWcgaW1wb3J0IENvbnN0YW50cw0KZnJvbSBvcmcu
 eGRpLm94YXV0aC5tb2RlbC5jb25maWcgaW1wb3J0IENvbmZpZ3VyYXRpb25GYWN0b3J5DQpmcm9tIGp
 hdmEudXRpbCBpbXBvcnQgSGFzaE1hcCwgQXJyYXlzDQoNCmZyb20gY29tLmRldnN1LnB1c2guc2VuZG
 VyLnNlcnZpY2Uuc3luYyBpbXBvcnQgU3luY0FuZHJvaWRQdXNoU2VydmljZSwgU3luY0FwcGxlUHVza
 FNlcnZpY2UNCg0KaW1wb3J0IHN5cw0KaW1wb3J0IGphdmENCmltcG9ydCBkYXRldGltZQ0KaW1wb3J0
 IGJhc2U2NA0KDQp0cnk6DQogICAgaW1wb3J0IGpzb24NCmV4Y2VwdCBJbXBvcnRFcnJvcjoNCiAgICB
 pbXBvcnQgc2ltcGxlanNvbiBhcyBqc29uDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcn
 NvbkF1dGhlbnRpY2F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lT
 WlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlz
 DQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHB
 yaW50ICJveFB1c2gyLiBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBpZiBub3QgKGNvbmZpZ3VyYX
 Rpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJhcHBsaWNhdGlvbl9pZCIpIGFuZA0KICAgICAgICAgI
 CAgICAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJhdXRoZW50aWNhdGlvbl9t
 b2RlIikpOg0KICAgICAgICAgICAgcHJpbnQgIm94UHVzaDIuIEluaXRpYWxpemF0aW9uLiBQcm9wZXJ
 0aWVzIGFwcGxpY2F0aW9uX2lkIGFuZCBhdXRoZW50aWNhdGlvbl9tb2RlIGFyZSBtYW5kYXRvcnkiDQ
 ogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBzZWxmLmFwcGxpY2F0aW9uX2lkID0gY
 29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJhcHBsaWNhdGlvbl9pZCIpLmdldFZhbHVlMigpDQog
 ICAgICAgIGlmIFN0cmluZ0hlbHBlci5pc0VtcHR5KHNlbGYuYXBwbGljYXRpb25faWQpOg0KICAgICA
 gICAgICAgcHJpbnQgIm94UHVzaDIuIEluaXRpYWxpemF0aW9uLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIG
 FwcGxpY2F0aW9uX2lkLiBhcHBsaWNhdGlvbl9pZCBjb25maWd1cmF0aW9uIHBhcmFtZXRlciBpcyBlb
 XB0eSINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIGF1dGhlbnRpY2F0aW9uX21v
 ZGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImF1dGhlbnRpY2F0aW9uX21vZGUiKS5nZXR
 WYWx1ZTIoKQ0KICAgICAgICBpZiBTdHJpbmdIZWxwZXIuaXNFbXB0eShhdXRoZW50aWNhdGlvbl9tb2
 RlKToNCiAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBJbml0aWFsaXphdGlvbi4gRmFpbGVkIHRvI
 GRldGVybWluZSBhdXRoZW50aWNhdGlvbl9tb2RlLiBhdXRoZW50aWNhdGlvbl9tb2RlIGNvbmZpZ3Vy
 YXRpb24gcGFyYW1ldGVyIGlzIGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICA
 gIA0KICAgICAgICBzZWxmLm9uZVN0ZXAgPSBTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShhdX
 RoZW50aWNhdGlvbl9tb2RlLCAib25lX3N0ZXAiKQ0KICAgICAgICBzZWxmLnR3b1N0ZXAgPSBTdHJpb
 mdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShhdXRoZW50aWNhdGlvbl9tb2RlLCAidHdvX3N0ZXAiKQ0K
 DQogICAgICAgIGlmIG5vdCAoc2VsZi5vbmVTdGVwIG9yIHNlbGYudHdvU3RlcCk6DQogICAgICAgICA
 gICBwcmludCAib3hQdXNoMi4gSW5pdGlhbGl6YXRpb24uIFZhbGlkIGF1dGhlbnRpY2F0aW9uX21vZG
 UgdmFsdWVzIGFyZSBvbmVfc3RlcCBhbmQgdHdvX3N0ZXAiDQogICAgICAgICAgICByZXR1cm4gRmFsc
 2UNCiAgICAgICAgDQogICAgICAgIHNlbGYuZW5hYmxlZFB1c2hOb3RpZmljYXRpb25zID0gc2VsZi5p
 bml0UHVzaE5vdGlmaWNhdGlvblNlcnZpY2UoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpDQoNCiAgICA
 gICAgcHJpbnQgIm94UHVzaDIuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseS4gb25lU3RlcDogJyVzJy
 wgdHdvU3RlcDogJyVzJywgcHVzaE5vdGlmaWNhdGlvbnM6ICclcyciICUgKHNlbGYub25lU3RlcCwgc
 2VsZi50d29TdGVwLCBzZWxmLmVuYWJsZWRQdXNoTm90aWZpY2F0aW9ucykNCg0KICAgICAgICByZXR1
 cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 pOg0KICAgICAgICBwcmludCAib3hQdXNoMi4gRGVzdHJveSINCiAgICAgICAgcHJpbnQgIm94UHVzaD
 IuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ
 2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0
 aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk
 6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdG
 lvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgI
 CAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY3JlZGVudGlhbHMgPSB
 JZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgdXNlcl9uYW1lID0gY3
 JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFd
 mVudENvbnRleHQoKQ0KDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2Uo
 KQ0KICAgICAgICBkZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlID0gRGV2aWNlUmVnaXN0cmF0aW9uU2V
 ydmljZS5pbnN0YW5jZSgpDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbn
 QgIm94UHVzaDIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgaWYgc2VsZi5vb
 mVTdGVwOg0KICAgICAgICAgICAgICAgIHNlc3Npb25fYXR0cmlidXRlcyA9IGNvbnRleHQuZ2V0KCJz
 ZXNzaW9uQXR0cmlidXRlcyIpDQogIA0KICAgICAgICAgICAgICAgIHNlc3Npb25fZGV2aWNlX3N0YXR
 1cyA9IHNlbGYuZ2V0U2Vzc2lvbkRldmljZVN0YXR1cyhzZXNzaW9uX2F0dHJpYnV0ZXMpOw0KICAgIC
 AgICAgICAgICAgIGlmIHNlc3Npb25fZGV2aWNlX3N0YXR1cyA9PSBOb25lOg0KICAgICAgICAgICAgI
 CAgICAgICByZXR1cm4NCg0KICAgICAgICAgICAgICAgIHUyZl9kZXZpY2VfaWQgPSBzZXNzaW9uX2Rl
 dmljZV9zdGF0dXNbJ2RldmljZV9pZCddDQoNCiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX3Jlc3V
 sdCA9IHNlbGYudmFsaWRhdGVTZXNzaW9uRGV2aWNlU3RhdHVzKHNlc3Npb25fZGV2aWNlX3N0YXR1cy
 kNCiAgICAgICAgICAgICAgICBpZiB2YWxpZGF0aW9uX3Jlc3VsdDoNCiAgICAgICAgICAgICAgICAgI
 CAgcHJpbnQgIm94UHVzaDIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBVc2VyIHN1Y2Nlc3NmdWxs
 eSBhdXRoZW50aWNhdGVkIHdpdGggdTJmX2RldmljZSAnJXMnIiAlIHUyZl9kZXZpY2VfaWQNCiAgICA
 gICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgIC
 AgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgbm90IHNlc3Npb25fZGV2aWNlX3N0YXR1c
 1snb25lX3N0ZXAnXToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIm94UHVzaDIuIEF1dGhlbnRp
 Y2F0ZSBmb3Igc3RlcCAxLiB1MmZfZGV2aWNlICclcycgaXMgbm90IG9uZSBzdGVwIGRldmljZSIgJSB
 1MmZfZGV2aWNlX2lkDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgIC
 AgICAgICAgICANCiAgICAgICAgICAgICAgICAjIFRoZXJlIGFyZSB0d28gc3RlcHMgb25seSBpbiBlb
 nJvbGxtZW50IG1vZGUNCiAgICAgICAgICAgICAgICBpZiBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ2Vu
 cm9sbCddOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGlvbl9yZXN1bHQNCg0KICA
 gICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJveHB1c2gyX2NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCg
 0KICAgICAgICAgICAgICAgIHVzZXJfaW51bSA9IHNlc3Npb25fZGV2aWNlX3N0YXR1c1sndXNlcl9pb
 nVtJ10NCg0KICAgICAgICAgICAgICAgIHUyZl9kZXZpY2UgPSBkZXZpY2VSZWdpc3RyYXRpb25TZXJ2
 aWNlLmZpbmRVc2VyRGV2aWNlUmVnaXN0cmF0aW9uKHVzZXJfaW51bSwgdTJmX2RldmljZV9pZCwgIm9
 4SWQiKQ0KICAgICAgICAgICAgICAgIGlmIHUyZl9kZXZpY2UgPT0gTm9uZToNCiAgICAgICAgICAgIC
 AgICAgICAgcHJpbnQgIm94UHVzaDIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gb
 G9hZCB1MmZfZGV2aWNlICclcyciICUgdTJmX2RldmljZV9pZA0KICAgICAgICAgICAgICAgICAgICBy
 ZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGh
 lbnRpY2F0ZSh1c2VyX25hbWUpDQogICAgICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRfaW4pOg0KIC
 AgICAgICAgICAgICAgICAgICBwcmludCAib3hQdXNoMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuI
 EZhaWxlZCB0byBhdXRoZW50aWNhdGUgdXNlciAnJXMnIiAlIHVzZXJfbmFtZQ0KICAgICAgICAgICAg
 ICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBBdXR
 oZW50aWNhdGUgZm9yIHN0ZXAgMS4gVXNlciAnJXMnIHN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkIH
 dpdGggdTJmX2RldmljZSAnJXMnIiAlICh1c2VyX25hbWUsIHUyZl9kZXZpY2VfaWQpDQogICAgICAgI
 CAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWU7DQogICAgICAgICAgICBlbGlmIHNl
 bGYudHdvU3RlcDoNCiAgICAgICAgICAgICAgICBhdXRoZW50aWNhdGVkX3VzZXIgPSBzZWxmLnByb2N
 lc3NCYXNpY0F1dGhlbnRpY2F0aW9uKGNyZWRlbnRpYWxzKQ0KICAgICAgICAgICAgICAgIGlmIGF1dG
 hlbnRpY2F0ZWRfdXNlciA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNC
 iAgICANCiAgICAgICAgICAgICAgICBhdXRoX21ldGhvZCA9ICdhdXRoZW50aWNhdGUnDQogICAgICAg
 ICAgICAgICAgZW5yb2xsbWVudF9tb2RlID0gU2VydmVyVXRpbC5nZXRGaXJzdFZhbHVlKHJlcXVlc3R
 QYXJhbWV0ZXJzLCAibG9naW5Gb3JtOnJlZ2lzdGVyQnV0dG9uIikNCiAgICAgICAgICAgICAgICBpZi
 BTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eShlbnJvbGxtZW50X21vZGUpOg0KICAgICAgICAgICAgICAgI
 CAgICBhdXRoX21ldGhvZCA9ICdlbnJvbGwnDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAg
 ICAgaWYgKGF1dGhfbWV0aG9kID09ICdhdXRoZW50aWNhdGUnKToNCiAgICAgICAgICAgICAgICAgICA
 gdXNlcl9pbnVtID0gdXNlclNlcnZpY2UuZ2V0VXNlckludW0oYXV0aGVudGljYXRlZF91c2VyKQ0KIC
 AgICAgICAgICAgICAgICAgICB1MmZfZGV2aWNlc19saXN0ID0gZGV2aWNlUmVnaXN0cmF0aW9uU2Vyd
 mljZS5maW5kVXNlckRldmljZVJlZ2lzdHJhdGlvbnModXNlcl9pbnVtLCBzZWxmLmFwcGxpY2F0aW9u
 X2lkLCAib3hJZCIpDQogICAgICAgICAgICAgICAgICAgIGlmICh1MmZfZGV2aWNlc19saXN0LnNpemU
 oKSA9PSAwKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhfbWV0aG9kID0gJ2Vucm9sbCcNCi
 AgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBBdXRoZW50aWNhdGUgZm9yIHN0Z
 XAgMS4gVGhlcmUgaXMgbm8gVTJGICclcycgdXNlciBkZXZpY2VzIGFzc29jaWF0ZWQgd2l0aCBhcHBs
 aWNhdGlvbiAnJXMnLiBDaGFuZ2luZyBhdXRoX21ldGhvZCB0byAnJXMnIiAlICh1c2VyX25hbWUsIHN
 lbGYuYXBwbGljYXRpb25faWQsIGF1dGhfbWV0aG9kKQ0KICAgIA0KICAgICAgICAgICAgICAgIHByaW
 50ICJveFB1c2gyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gYXV0aF9tZXRob2Q6ICclcyciICUgY
 XV0aF9tZXRob2QNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgi
 b3hwdXNoMl9hdXRoX21ldGhvZCIsIGF1dGhfbWV0aG9kKQ0KDQogICAgICAgICAgICAgICAgcmV0dXJ
 uIFRydWUNCg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMi
 k6DQogICAgICAgICAgICBwcmludCAib3hQdXNoMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIiDQogI
 CAgICAgICAgICBzZXNzaW9uX2F0dHJpYnV0ZXMgPSBjb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0
 ZXMiKQ0KDQogICAgICAgICAgICBzZXNzaW9uX2RldmljZV9zdGF0dXMgPSBzZWxmLmdldFNlc3Npb25
 EZXZpY2VTdGF0dXMoc2Vzc2lvbl9hdHRyaWJ1dGVzKTsNCiAgICAgICAgICAgIGlmIHNlc3Npb25fZG
 V2aWNlX3N0YXR1cyA9PSBOb25lOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgI
 CAgICAgICB1MmZfZGV2aWNlX2lkID0gc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWydkZXZpY2VfaWQnXQ0K
 DQogICAgICAgICAgICAjIFRoZXJlIGFyZSB0d28gc3RlcHMgb25seSBpbiBlbnJvbGxtZW50IG1vZGU
 NCiAgICAgICAgICAgIGlmIHNlbGYub25lU3RlcCBhbmQgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWydlbn
 JvbGwnXToNCiAgICAgICAgICAgICAgICBhdXRoZW50aWNhdGVkX3VzZXIgPSBzZWxmLnByb2Nlc3NCY
 XNpY0F1dGhlbnRpY2F0aW9uKGNyZWRlbnRpYWxzKQ0KICAgICAgICAgICAgICAgIGlmIGF1dGhlbnRp
 Y2F0ZWRfdXNlciA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICA
 gICAgICAgICAgICAgIHVzZXJfaW51bSA9IHVzZXJTZXJ2aWNlLmdldFVzZXJJbnVtKGF1dGhlbnRpY2
 F0ZWRfdXNlcikNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBhdHRhY2hfcmVzdWx0I
 D0gZGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5hdHRhY2hVc2VyRGV2aWNlUmVnaXN0cmF0aW9uKHVz
 ZXJfaW51bSwgdTJmX2RldmljZV9pZCkNCg0KICAgICAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiB
 BdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gUmVzdWx0IGFmdGVyIGF0dGFjaGluZyB1MmZfZGV2aWNlIC
 clcycgdG8gdXNlciAnJXMnOiAnJXMnIiAlICh1MmZfZGV2aWNlX2lkLCB1c2VyX25hbWUsIGF0dGFja
 F9yZXN1bHQpIA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGF0dGFjaF9yZXN1bHQNCiAgICAgICAg
 ICAgIGVsaWYgc2VsZi50d29TdGVwOg0KICAgICAgICAgICAgICAgIGlmICh1c2VyX25hbWUgPT0gTm9
 uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBBdXRoZW50aWNhdGUgZm9yIH
 N0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZSB1c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgICAgI
 HJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9yZXN1bHQgPSBzZWxmLnZh
 bGlkYXRlU2Vzc2lvbkRldmljZVN0YXR1cyhzZXNzaW9uX2RldmljZV9zdGF0dXMsIHVzZXJfbmFtZSk
 NCiAgICAgICAgICAgICAgICBpZiB2YWxpZGF0aW9uX3Jlc3VsdDoNCiAgICAgICAgICAgICAgICAgIC
 AgcHJpbnQgIm94UHVzaDIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBVc2VyICclcycgc3VjY2Vzc
 2Z1bGx5IGF1dGhlbnRpY2F0ZWQgd2l0aCB1MmZfZGV2aWNlICclcyciICUgKHVzZXJfbmFtZSwgdTJm
 X2RldmljZV9pZCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICByZXR
 1cm4gRmFsc2UNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBveHB1c2gyX3JlcXVlc3
 QgPSBqc29uLmxvYWRzKHNlc3Npb25fZGV2aWNlX3N0YXR1c1snb3hwdXNoMl9yZXF1ZXN0J10pDQogI
 CAgICAgICAgICAgICAgYXV0aF9tZXRob2QgPSBveHB1c2gyX3JlcXVlc3RbJ21ldGhvZCddDQogICAg
 ICAgICAgICAgICAgaWYgYXV0aF9tZXRob2QgaW4gWydlbnJvbGwnLCAnYXV0aGVudGljYXRlJ106DQo
 gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGF0aW9uX3Jlc3VsdA0KDQogICAgICAgICAgIC
 AgICAgcHJpbnQgIm94UHVzaDIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBVMkYgYXV0aF9tZXRob
 2QgaXMgaW52YWxpZCINCg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsc2U6DQog
 ICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25
 maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb2
 50ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCg0KICAgICAgICBpZiBzdGVwID09IDE6D
 QogICAgICAgICAgICBwcmludCAib3hQdXNoMi4gUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgICAg
 ICAgaWYgc2VsZi5vbmVTdGVwOg0KICAgICAgICAgICAgICAgIHNlc3Npb25fc3RhdGUgPSBTZXNzaW9
 uU3RhdGVTZXJ2aWNlLmluc3RhbmNlKCkuZ2V0U2Vzc2lvblN0YXRlRnJvbUNvb2tpZSgpDQogICAgIC
 AgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkoc2Vzc2lvbl9zdGF0ZSk6DQogICAgICAgI
 CAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBk
 ZXRlcm1pbmUgc2Vzc2lvbl9zdGF0ZSINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQo
 gICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpc3N1ZXIgPSBDb25maWd1cmF0aW9uRmFjdG9yeS
 5pbnN0YW5jZSgpLmdldENvbmZpZ3VyYXRpb24oKS5nZXRJc3N1ZXIoKQ0KICAgICAgICAgICAgICAgI
 G94cHVzaDJfcmVxdWVzdCA9IGpzb24uZHVtcHMoeydhcHAnOiBzZWxmLmFwcGxpY2F0aW9uX2lkLA0K
 ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXNzdWVyJzogaXNzdWVyLA0KICAgICA
 gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdGUnOiBzZXNzaW9uX3N0YXRlLA0KICAgIC
 AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZCc6IGRhdGV0aW1lLmRhdGV0aW1lL
 m5vdygpLmlzb2Zvcm1hdCgpfSwgc2VwYXJhdG9ycz0oJywnLCc6JykpDQogICAgICAgICAgICAgICAg
 cHJpbnQgIm94UHVzaDIuIFByZXBhcmUgZm9yIHN0ZXAgMS4gUHJlcGFyZWQgb3hwdXNoMl9yZXF1ZXN
 0OiIsIG94cHVzaDJfcmVxdWVzdA0KICAgIA0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJveH
 B1c2gyX3JlcXVlc3QiLCBveHB1c2gyX3JlcXVlc3QpDQogICAgICAgICAgICBlbGlmIHNlbGYudHdvU
 3RlcDoNCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiZGlzcGxheV9yZWdpc3Rlcl9hY3Rpb24i
 LCBUcnVlKQ0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIHN0ZXAgPT0gMjo
 NCiAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBQcmVwYXJlIGZvciBzdGVwIDIiDQogICAgICAgIC
 AgICBpZiBzZWxmLm9uZVN0ZXA6DQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgI
 CAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAg
 ICAgICAgICAgIHVzZXIgPSBjcmVkZW50aWFscy5nZXRVc2VyKCkNCiAgICAgICAgICAgIGlmIHVzZXI
 gPT0gTm9uZToNCiAgICAgICAgICAgICAgICBwcmludCAib3hQdXNoMi4gUHJlcGFyZSBmb3Igc3RlcC
 AyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHVzZXIgbmFtZSINCiAgICAgICAgICAgICAgICByZXR1cm4gR
 mFsc2UNCg0KICAgICAgICAgICAgc2Vzc2lvbl9hdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Np
 b25BdHRyaWJ1dGVzIikNCiAgICAgICAgICAgIGlmIHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0t
 leSgib3hwdXNoMl9yZXF1ZXN0Iik6DQogICAgICAgICAgICAgICAgcHJpbnQgIm94UHVzaDIuIFByZX
 BhcmUgZm9yIHN0ZXAgMi4gUmVxdWVzdCB3YXMgZ2VuZXJhdGVkIGFscmVhZHkiDQogICAgICAgICAgI
 CAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc2Vzc2lvbl9zdGF0ZSA9
 IFNlc3Npb25TdGF0ZVNlcnZpY2UuaW5zdGFuY2UoKS5nZXRTZXNzaW9uU3RhdGVGcm9tQ29va2llKCk
 NCiAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBlci5pc0VtcHR5KHNlc3Npb25fc3RhdGUpOg0KICAgIC
 AgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBkZ
 XRlcm1pbmUgc2Vzc2lvbl9zdGF0ZSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAg
 ICAgICAgICAgYXV0aF9tZXRob2QgPSBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJveHB1c2gyX2F1dGh
 fbWV0aG9kIikNCiAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBlci5pc0VtcHR5KGF1dGhfbWV0aG9kKT
 oNCiAgICAgICAgICAgICAgICBwcmludCAib3hQdXNoMi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZ
 WQgdG8gZGV0ZXJtaW5lIGF1dGhfbWV0aG9kIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0K
 DQogICAgICAgICAgICBwcmludCAib3hQdXNoMi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBhdXRoX21ldGh
 vZDogJyVzJyIgJSBhdXRoX21ldGhvZA0KICAgICAgICAgICAgDQogICAgICAgICAgICBpc3N1ZXIgPS
 BDb25maWd1cmF0aW9uRmFjdG9yeS5pbnN0YW5jZSgpLmdldENvbmZpZ3VyYXRpb24oKS5nZXRJc3N1Z
 XIoKQ0KICAgICAgICAgICAgb3hwdXNoMl9yZXF1ZXN0ID0ganNvbi5kdW1wcyh7J3VzZXJuYW1lJzog
 dXNlci5nZXRVc2VySWQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXBwJzogc2V
 sZi5hcHBsaWNhdGlvbl9pZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXNzdWVyJz
 ogaXNzdWVyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZXRob2QnOiBhdXRoX21ld
 GhvZCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdGUnOiBzZXNzaW9uX3N0YXRl
 LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZCc6IGRhdGV0aW1lLmRhdGV
 0aW1lLm5vdygpLmlzb2Zvcm1hdCgpfSwgc2VwYXJhdG9ycz0oJywnLCc6JykpDQogICAgICAgICAgIC
 BwcmludCAib3hQdXNoMi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBQcmVwYXJlZCBveHB1c2gyX3JlcXVlc
 3Q6Iiwgb3hwdXNoMl9yZXF1ZXN0DQoNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJveHB1c2gyX3Jl
 cXVlc3QiLCBveHB1c2gyX3JlcXVlc3QpDQoNCiAgICAgICAgICAgIGlmIGF1dGhfbWV0aG9kIGluIFs
 nYXV0aGVudGljYXRlJ106DQogICAgICAgICAgICAgICAgc2VsZi5zZW5kUHVzaE5vdGlmaWNhdGlvbi
 h1c2VyLCBveHB1c2gyX3JlcXVlc3QpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgI
 GVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRl
 cnNGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWY
 gKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBpZiBzZWxmLm9uZVN0ZXA6ICAgICAgICANCiAgICAgIC
 AgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgib3hwdXNoMl9yZXF1ZXN0IikNCiAgICAgICAgI
 CAgIGVsaWYgc2VsZi50d29TdGVwOg0KICAgICAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0
 KCJkaXNwbGF5X3JlZ2lzdGVyX2FjdGlvbiIpDQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICA
 gICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgib3hwdXNoMl9hdXRoX21ldGhvZCIsICJveHB1c2
 gyX3JlcXVlc3QiKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb
 3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAg
 ICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnR
 leHQuaXNTZXQoIm94cHVzaDJfY291bnRfbG9naW5fc3RlcHMiKSk6DQogICAgICAgICAgICByZXR1cm
 4gY29udGV4dC5nZXQoIm94cHVzaDJfY291bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICBlbHNlOg0KI
 CAgICAgICAgICAgcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1
 cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICA
 gICAgaWYgc2VsZi5vbmVTdGVwOiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuICIvYXV0aC
 9veHB1c2gyL2xvZ2luLnhodG1sIg0KICAgICAgICBlbGlmIChzdGVwID09IDIpOg0KICAgICAgICAgI
 CAgaWYgc2VsZi5vbmVTdGVwOg0KICAgICAgICAgICAgICAgIHJldHVybiAiL2xvZ2luLnhodG1sIg0K
 ICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICByZXR1cm4gIi9hdXRoL294cHVzaDIvbG9
 naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUc
 nVlDQoNCiAgICBkZWYgcHJvY2Vzc0Jhc2ljQXV0aGVudGljYXRpb24oc2VsZiwgY3JlZGVudGlhbHMp
 Og0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICB
 1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgICAgIHVzZXJfcGFzc3dvcm
 QgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQoNCiAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNC
 iAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0
 cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgIGx
 vZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcm
 QpDQoNCiAgICAgICAgaWYgKG5vdCBsb2dnZWRfaW4pOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNC
 g0KICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlcih1c2VyX25hbWUp
 DQogICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgcHJpbnQ
 gIm94UHVzaC4gUHJvY2VzcyBiYXNpYyBhdXRoZW50aWNhdGlvbi4gRmFpbGVkIHRvIGZpbmQgdXNlci
 AnJXMnIiAlIHVzZXJfbmFtZQ0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgI
 CAgIHJldHVybiBmaW5kX3VzZXJfYnlfdWlkDQoNCiAgICBkZWYgdmFsaWRhdGVTZXNzaW9uRGV2aWNl
 U3RhdHVzKHNlbGYsIHNlc3Npb25fZGV2aWNlX3N0YXR1cywgdXNlcl9uYW1lID0gTm9uZSk6DQogICA
 gICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBkZXZpY2VSZW
 dpc3RyYXRpb25TZXJ2aWNlID0gRGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5pbnN0YW5jZSgpDQoNC
 iAgICAgICAgdTJmX2RldmljZV9pZCA9IHNlc3Npb25fZGV2aWNlX3N0YXR1c1snZGV2aWNlX2lkJ10N
 Cg0KICAgICAgICB1MmZfZGV2aWNlID0gTm9uZQ0KICAgICAgICBpZiBzZXNzaW9uX2RldmljZV9zdGF
 0dXNbJ2Vucm9sbCddIGFuZCBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ29uZV9zdGVwJ106DQogICAgIC
 AgICAgICB1MmZfZGV2aWNlID0gZGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5maW5kT25lU3RlcFVzZ
 XJEZXZpY2VSZWdpc3RyYXRpb24odTJmX2RldmljZV9pZCkNCiAgICAgICAgICAgIGlmICh1MmZfZGV2
 aWNlID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBWYWxpZGF0ZSBzZXN
 zaW9uIGRldmljZSBzdGF0dXMuIFRoZXJlIGlzIG5vIG9uZSBzdGVwIHUyZl9kZXZpY2UgJyVzJyIgJS
 B1MmZfZGV2aWNlX2lkDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsc2U6D
 QogICAgICAgICAgICAjIFZhbGlkYXRlIGlmIHVzZXIgaGFzIHNwZWNpZmllZCBkZXZpY2VfaWQgZW5y
 b2xsbWVudA0KICAgICAgICAgICAgdXNlcl9pbnVtID0gdXNlclNlcnZpY2UuZ2V0VXNlckludW0odXN
 lcl9uYW1lKQ0KDQogICAgICAgICAgICBpZiBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ29uZV9zdGVwJ1
 06DQogICAgICAgICAgICAgICAgdXNlcl9pbnVtID0gc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWyd1c2VyX
 2ludW0nXQ0KICAgIA0KICAgICAgICAgICAgdTJmX2RldmljZSA9IGRldmljZVJlZ2lzdHJhdGlvblNl
 cnZpY2UuZmluZFVzZXJEZXZpY2VSZWdpc3RyYXRpb24odXNlcl9pbnVtLCB1MmZfZGV2aWNlX2lkKQ0
 KICAgICAgICAgICAgaWYgdTJmX2RldmljZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgIHByaW50IC
 JveFB1c2gyLiBWYWxpZGF0ZSBzZXNzaW9uIGRldmljZSBzdGF0dXMuIFRoZXJlIGlzIG5vIHUyZl9kZ
 XZpY2UgJyVzJyBhc3NvY2lhdGVkIHdpdGggdXNlciAnJXMnIiAlICh1MmZfZGV2aWNlX2lkLCB1c2Vy
 X2ludW0pDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgaWYgbm90IFN0cml
 uZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKHNlbGYuYXBwbGljYXRpb25faWQsIHUyZl9kZXZpY2UuYX
 BwbGljYXRpb24pOg0KICAgICAgICAgICAgcHJpbnQgIm94UHVzaDIuIFZhbGlkYXRlIHNlc3Npb24gZ
 GV2aWNlIHN0YXR1cy4gdTJmX2RldmljZSAnJXMnIGFzc29jaWF0ZWQgd2l0aCBvdGhlciBhcHBsaWNh
 dGlvbiAnJXMnIiAlICh1MmZfZGV2aWNlX2lkLCB1MmZfZGV2aWNlLmFwcGxpY2F0aW9uKQ0KICAgICA
 gICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZG
 VmIGdldFNlc3Npb25EZXZpY2VTdGF0dXMoc2VsZiwgc2Vzc2lvbl9hdHRyaWJ1dGVzKToNCiAgICAgI
 CAgcHJpbnQgIm94UHVzaDIuIEdldCBzZXNzaW9uIGRldmljZSBzdGF0dXMiDQoNCiAgICAgICAgaWYg
 bm90IHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSgib3hwdXNoMl9yZXF1ZXN0Iik6DQogICA
 gICAgICAgICBwcmludCAib3hQdXNoMi4gR2V0IHNlc3Npb24gZGV2aWNlIHN0YXR1cy4gVGhlcmUgaX
 Mgbm8gb3hQdXNoMiByZXF1ZXN0IGluIHNlc3Npb24gYXR0cmlidXRlcyINCiAgICAgICAgICAgIHJld
 HVybiBOb25lDQoNCiAgICAgICAgIyBDaGVjayBzZXNzaW9uIHN0YXRlIGV4dGVuZGVkDQogICAgICAg
 IGlmIG5vdCBzZXNzaW9uX2F0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNlc3Npb25fY3VzdG9tX3N0YXR
 lIik6DQogICAgICAgICAgICBwcmludCAib3hQdXNoMi4gR2V0IHNlc3Npb24gZGV2aWNlIHN0YXR1cy
 4gVGhlcmUgaXMgbm8gc2Vzc2lvbl9jdXN0b21fc3RhdGUgaW4gc2Vzc2lvbiBhdHRyaWJ1dGVzIg0KI
 CAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICBzZXNzaW9uX2N1c3RvbV9zdGF0ZSA9IHNl
 c3Npb25fYXR0cmlidXRlcy5nZXQoInNlc3Npb25fY3VzdG9tX3N0YXRlIikNCiAgICAgICAgaWYgbm9
 0IFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKCJhcHByb3ZlZCIsIHNlc3Npb25fY3VzdG9tX3
 N0YXRlKToNCiAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3Rhd
 HVzLiBVc2VyICclcycgbm90IGFwcHJvdmUgb3IgcGFzcyBVMkYgYXV0aGVudGljYXRpb24uIHNlc3Np
 b25fY3VzdG9tX3N0YXRlOiAnJXMnIiAlICh1c2VyX25hbWUsIHNlc3Npb25fY3VzdG9tX3N0YXRlKQ0
 KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAjIFRyeSB0byBmaW5kIGRldmljZV9pZC
 BpbiBzZXNzaW9uIGF0dHJpYnV0ZQ0KICAgICAgICBpZiBub3Qgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvb
 nRhaW5zS2V5KCJveHB1c2gyX3UyZl9kZXZpY2VfaWQiKToNCiAgICAgICAgICAgIHByaW50ICJveFB1
 c2gyLiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBUaGVyZSBpcyBubyB1MmZfZGV2aWNlIGFzc29
 jaWF0ZWQgd2l0aCB0aGlzIHJlcXVlc3QiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgIC
 AgICMgVHJ5IHRvIGZpbmQgdXNlcl9pbnVtIGluIHNlc3Npb24gYXR0cmlidXRlDQogICAgICAgIGlmI
 G5vdCBzZXNzaW9uX2F0dHJpYnV0ZXMuY29udGFpbnNLZXkoIm94cHVzaDJfdTJmX2RldmljZV91c2Vy
 X2ludW0iKToNCiAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3R
 hdHVzLiBUaGVyZSBpcyBubyB1c2VyX2ludW0gYXNzb2NpYXRlZCB3aXRoIHRoaXMgcmVxdWVzdCINCi
 AgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBlbnJvbGwgPSBGYWxzZQ0KI
 CAgICAgICBpZiBzZXNzaW9uX2F0dHJpYnV0ZXMuY29udGFpbnNLZXkoIm94cHVzaDJfdTJmX2Rldmlj
 ZV9lbnJvbGwiKToNCiAgICAgICAgICAgIGVucm9sbCA9IFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmV
 DYXNlKCJ0cnVlIiwgc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgib3hwdXNoMl91MmZfZGV2aWNlX2Vucm
 9sbCIpKQ0KDQogICAgICAgIG9uZV9zdGVwID0gRmFsc2UNCiAgICAgICAgaWYgc2Vzc2lvbl9hdHRya
 WJ1dGVzLmNvbnRhaW5zS2V5KCJveHB1c2gyX3UyZl9kZXZpY2Vfb25lX3N0ZXAiKToNCiAgICAgICAg
 ICAgIG9uZV9zdGVwID0gU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UoInRydWUiLCBzZXNzaW9
 uX2F0dHJpYnV0ZXMuZ2V0KCJveHB1c2gyX3UyZl9kZXZpY2Vfb25lX3N0ZXAiKSkNCiAgICAgICAgIC
 AgICAgICAgICAgICAgIA0KICAgICAgICBveHB1c2gyX3JlcXVlc3QgPSBzZXNzaW9uX2F0dHJpYnV0Z
 XMuZ2V0KCJveHB1c2gyX3JlcXVlc3QiKQ0KICAgICAgICB1MmZfZGV2aWNlX2lkID0gc2Vzc2lvbl9h
 dHRyaWJ1dGVzLmdldCgib3hwdXNoMl91MmZfZGV2aWNlX2lkIikNCiAgICAgICAgdXNlcl9pbnVtID0
 gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgib3hwdXNoMl91MmZfZGV2aWNlX3VzZXJfaW51bSIpDQoNCi
 AgICAgICAgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzID0geyJveHB1c2gyX3JlcXVlc3QiOiBveHB1c2gyX
 3JlcXVlc3QsICJkZXZpY2VfaWQiOiB1MmZfZGV2aWNlX2lkLCAidXNlcl9pbnVtIiA6IHVzZXJfaW51
 bSwgImVucm9sbCIgOiBlbnJvbGwsICJvbmVfc3RlcCIgOiBvbmVfc3RlcH0NCiAgICAgICAgcHJpbnQ
 gIm94UHVzaDIuIEdldCBzZXNzaW9uIGRldmljZSBzdGF0dXMuIHNlc3Npb25fZGV2aWNlX3N0YXR1cz
 ogJyVzJyIgJSAoc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuI
 HNlc3Npb25fZGV2aWNlX3N0YXR1cw0KICAgIA0KICAgIGRlZiBpbml0UHVzaE5vdGlmaWNhdGlvblNl
 cnZpY2Uoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAib3hQdXN
 oMi4gSW5pdGlhbGl6ZSBub3RpZmljYXRpb24gc2VydmljZXMiDQogICAgICAgIGlmIG5vdCBjb25maW
 d1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiY3JlZGVudGlhbHNfZmlsZSIpOg0KICAgICAgI
 CAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgb3hwdXNoMl9jcmVkc19maWxlID0gY29uZmlndXJh
 dGlvbkF0dHJpYnV0ZXMuZ2V0KCJjcmVkZW50aWFsc19maWxlIikuZ2V0VmFsdWUyKCkNCg0KICAgICA
 gICAjIExvYWQgY3JlZGVudGlhbHMgZnJvbSBmaWxlDQogICAgICAgIGYgPSBvcGVuKG94cHVzaDJfY3
 JlZHNfZmlsZSwgJ3InKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjcmVkcyA9IGpzb24ubG9hZ
 HMoZi5yZWFkKCkpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBJ
 bml0aWFsaXplIG5vdGlmaWNhdGlvbiBzZXJ2aWNlcy4gRmFpbGVkIHRvIGxvYWQgY3JlZGVudGlhbHM
 gZnJvbSBmaWxlOiIsIG94cHVzaDJfY3JlZHNfZmlsZQ0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQ
 ogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBmLmNsb3NlKCkNCiAgICAgICAgDQogICAgICAgI
 HRyeToNCiAgICAgICAgICAgIGFuZHJvaWRfY3JlZHMgPSBjcmVkc1siYW5kcm9pZCJdWyJnY20iXQ0K
 ICAgICAgICAgICAgaW9zX2NyZWFkcyA9IGNyZWRzWyJpb3MiXVsiYXBucyJdDQogICAgICAgIGV4Y2V
 wdDoNCiAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBJbml0aWFsaXplIG5vdGlmaWNhdGlvbiBzZX
 J2aWNlcy4gSW52YWxpZCBjcmVkZW50aWFscyBmaWxlICclcycgZm9ybWF0OiIgJSBveHB1c2gyX2NyZ
 WRzX2ZpbGUNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgc2VsZi5w
 dXNoQW5kcm9pZFNlcnZpY2UgPSBOb25lDQogICAgICAgIHNlbGYucHVzaEFwcGxlU2VydmljZSA9IE5
 vbmUNCiAgICAgICAgaWYgYW5kcm9pZF9jcmVkc1siZW5hYmxlZCJdOg0KICAgICAgICAgICAgc2VsZi
 5wdXNoQW5kcm9pZFNlcnZpY2UgPSBTeW5jQW5kcm9pZFB1c2hTZXJ2aWNlKGFuZHJvaWRfY3JlZHNbI
 mFwaV9rZXkiXSkNCiAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBJbml0aWFsaXplIG5vdGlmaWNh
 dGlvbiBzZXJ2aWNlcy4gQ3JlYXRlZCBBbmRyb2lkIG5vdGlmaWNhdGlvbiBzZXJ2aWNlIg0KICAgICA
 gICAgICAgDQogICAgICAgIGlmIGlvc19jcmVhZHNbImVuYWJsZWQiXToNCiAgICAgICAgICAgIHAxMl
 9maWxlX3BhdGggPSBpb3NfY3JlYWRzWyJwMTJfZmlsZV9wYXRoIl0NCiAgICAgICAgICAgIHAxMl9wY
 XNzb3dyZCA9IGlvc19jcmVhZHNbInAxMl9wYXNzd29yZCJdDQoNCiAgICAgICAgICAgIHRyeToNCiAg
 ICAgICAgICAgICAgICBzdHJpbmdFbmNyeXB0ZXIgPSBTdHJpbmdFbmNyeXB0ZXIuZGVmYXVsdEluc3R
 hbmNlKCkNCiAgICAgICAgICAgICAgICBwMTJfcGFzc293cmQgPSBzdHJpbmdFbmNyeXB0ZXIuZGVjcn
 lwdChwMTJfcGFzc293cmQpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgIyBJZ
 25vcmUgZXhjZXB0aW9uLiBQYXNzd29yZCBpcyBub3QgZW5jcnlwdGVkDQogICAgICAgICAgICAgICAg
 cHJpbnQgIm94UHVzaDIuIEluaXRpYWxpemUgbm90aWZpY2F0aW9uIHNlcnZpY2VzLiBBc3N1bWluZyB
 0aGF0ICdwMTJfcGFzc293cmQnIHBhc3N3b3JkIGluIG5vdCBlbmNyeXB0ZWQiDQoNCiAgICAgICAgIC
 AgIHNlbGYucHVzaEFwcGxlU2VydmljZSA9IFN5bmNBcHBsZVB1c2hTZXJ2aWNlKHAxMl9maWxlX3Bhd
 GgsIHAxMl9wYXNzb3dyZCwgaW9zX2NyZWFkc1sicHJvZHVjdGlvbiJdKQ0KICAgICAgICAgICAgcHJp
 bnQgIm94UHVzaDIuIEluaXRpYWxpemUgbm90aWZpY2F0aW9uIHNlcnZpY2VzLiBDcmVhdGVkIGlPUyB
 ub3RpZmljYXRpb24gc2VydmljZSINCg0KICAgICAgICBlbmFibGVkID0gc2VsZi5wdXNoQW5kcm9pZF
 NlcnZpY2UgIT0gTm9uZSBvciBzZWxmLnB1c2hBcHBsZVNlcnZpY2UgIT0gTm9uZQ0KDQogICAgICAgI
 HJldHVybiBlbmFibGVkDQoNCiAgICBkZWYgc2VuZFB1c2hOb3RpZmljYXRpb24oc2VsZiwgdXNlciwg
 b3hwdXNoMl9yZXF1ZXN0KToNCiAgICAgICAgaWYgbm90IHNlbGYuZW5hYmxlZFB1c2hOb3RpZmljYXR
 pb25zOg0KICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgdXNlcl9uYW1lID0gdXNlci5nZXRVc2
 VySWQoKQ0KICAgICAgICBwcmludCAib3hQdXNoMi4gU2VuZCBwdXNoIG5vdGlmaWNhdGlvbi4gTG9hZ
 GluZyB1c2VyICclcycgZGV2aWNlcyIgJSB1c2VyLmdldFVzZXJJZCgpDQoNCiAgICAgICAgc2VuZF9u
 b3RpZmljYXRpb24gPSBGYWxzZQ0KICAgICAgICBzZW5kX25vdGlmaWNhdGlvbl9yZXN1bHQgPSBUcnV
 lDQoNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIG
 RldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UgPSBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmluc3Rhb
 mNlKCkNCg0KICAgICAgICB1c2VyX2ludW0gPSB1c2VyU2VydmljZS5nZXRVc2VySW51bSh1c2VyX25h
 bWUpDQoNCiAgICAgICAgdTJmX2RldmljZXNfbGlzdCA9IGRldmljZVJlZ2lzdHJhdGlvblNlcnZpY2U
 uZmluZFVzZXJEZXZpY2VSZWdpc3RyYXRpb25zKHVzZXJfaW51bSwgc2VsZi5hcHBsaWNhdGlvbl9pZC
 wgIm94SWQiLCAib3hEZXZpY2VEYXRhIikNCiAgICAgICAgaWYgdTJmX2RldmljZXNfbGlzdC5zaXplK
 CkgPiAwOg0KICAgICAgICAgICAgZm9yIHUyZl9kZXZpY2UgaW4gdTJmX2RldmljZXNfbGlzdDoNCiAg
 ICAgICAgICAgICAgICBkZXZpY2VfZGF0YSA9IHUyZl9kZXZpY2UuZ2V0RGV2aWNlRGF0YSgpDQoNCiA
 gICAgICAgICAgICAgICAjIERldmljZSBkYXRhIHdoaWNoIG94UHVzaDIgZ2V0cyBkdXJpbmcgZW5yb2
 xsbWVudA0KICAgICAgICAgICAgICAgIGlmIGRldmljZV9kYXRhID09IE5vbmU6DQogICAgICAgICAgI
 CAgICAgICAgIGNvbnRpbnVlDQoNCiAgICAgICAgICAgICAgICBwbGF0Zm9ybSA9IGRldmljZV9kYXRh
 LmdldFBsYXRmb3JtKCkNCiAgICAgICAgICAgICAgICBwdXNoX3Rva2VuID0gZGV2aWNlX2RhdGEuZ2V
 0UHVzaFRva2VuKCkNCg0KICAgICAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcm
 VDYXNlKHBsYXRmb3JtLCAiaW9zIikgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KHB1c2hfdG9rZ
 W4pOg0KICAgICAgICAgICAgICAgICAgICAjIFNlbmRpbmcgbm90aWZpY2F0aW9uIHRvIGlPUyB1c2Vy
 J3MgZGV2aWNlDQogICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnB1c2hBcHBsZVNlcnZpY2UgPT0
 gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAib3hQdXNoMi4gU2VuZCBwdXNoIG
 5vdGlmaWNhdGlvbi4gQXBwbGUgcHVzaCBub3RpZmljYXRpb24gc2VydmljZSBpcyBub3QgZW5hYmxlZ
 CINCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRf
 bm90aWZpY2F0aW9uID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICA
 gICAgICAgICAgICB0aXRsZSA9ICJveFB1c2gyIg0KICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2
 FnZSA9ICJveFB1c2gyIGxvZ2luIHJlcXVlc3QgdG86ICVzIiAlIHNlbGYuYXBwbGljYXRpb25faWQNC
 g0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbF9maWVsZHMgPSBIYXNoTWFwKCkNCiAg
 ICAgICAgICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxfZmllbGRzLnB1dCgicmVxdWVzdCIsIG94cHV
 zaDJfcmVxdWVzdCkNCg0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZF9ub3RpZmljYXRpb25fcm
 VzdWx0ID0gc2VsZi5wdXNoQXBwbGVTZXJ2aWNlLnNlbmRQdXNoKHRpdGxlLCBtZXNzYWdlLCBhZGRpd
 GlvbmFsX2ZpZWxkcywgcHVzaF90b2tlbikNCg0KICAgICAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBl
 ci5lcXVhbHNJZ25vcmVDYXNlKHBsYXRmb3JtLCAiYW5kcm9pZCIpIGFuZCBTdHJpbmdIZWxwZXIuaXN
 Ob3RFbXB0eShwdXNoX3Rva2VuKToNCiAgICAgICAgICAgICAgICAgICAgIyBTZW5kaW5nIG5vdGlmaW
 NhdGlvbiB0byBBbmRyb2lkIHVzZXIncyBkZXZpY2UNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlb
 GYucHVzaEFuZHJvaWRTZXJ2aWNlID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJp
 bnQgIm94UHVzaDIuIFNlbmQgcHVzaCBub3RpZmljYXRpb24uIEFuZHJvaWQgcHVzaCBub3RpZmljYXR
 pb24gc2VydmljZSBpcyBub3QgZW5hYmxlZCINCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgIC
 AgICAgICAgICAgICAgICAgICAgIHNlbmRfbm90aWZpY2F0aW9uID0gVHJ1ZQ0KICAgICAgICAgICAgI
 CAgICAgICAgICAgc2VuZF9ub3RpZmljYXRpb25fcmVzdWx0PSBzZWxmLnB1c2hBbmRyb2lkU2Vydmlj
 ZS5zZW5kUHVzaCgib3hQdXNoMiIsIG94cHVzaDJfcmVxdWVzdCwgcHVzaF90b2tlbikNCg0KDQogICA
 gICAgIHByaW50ICJveFB1c2gyLiBTZW5kIHB1c2ggbm90aWZpY2F0aW9uLiBzZW5kX25vdGlmaWNhdG
 lvbjogJyVzJywgc2VuZF9ub3RpZmljYXRpb25fcmVzdWx0OiAnJXMnIiAlIChzZW5kX25vdGlmaWNhd
 Glvbiwgc2VuZF9ub3RpZmljYXRpb25fcmVzdWx0KQ0KICAgICAgICANCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!5018.F9CF,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: DUO authentication module
displayName: duo
gluuStatus: false
inum: %(inumOrg)s!0011!5018.F9CF
oxConfigurationProperty: {"value1":"duo_creds_file","value2":"/etc/certs/duo
 _creds.json","description":""}
oxConfigurationProperty: {"value1":"duo_host","value2":"api-random.duosecuri
 ty.com","description":""}
oxLevel: 20
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29ud
 GV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9t
 IG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGh
 lbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2
 VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyR3JvdXBTZXJ2a
 WNlDQpmcm9tIG9yZy54ZGkuc2VydmljZSBpbXBvcnQgTWFpbFNlcnZpY2UNCmZyb20gb3JnLnhk
 aS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJ
 heUhlbHBlcg0KDQppbXBvcnQgamF2YQ0KaW1wb3J0IGR1b193ZWINCnRyeToNCiAgICBpbXBvcn
 QganNvbg0KZXhjZXB0IEltcG9ydEVycm9yOg0KICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb
 24NCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25UeXBl
 KToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICB
 zZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbm
 l0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR1by4gS
 W5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgZHVvX2NyZWRzX2ZpbGUgPSBjb25maWd1cmF0aW9u
 QXR0cmlidXRlcy5nZXQoImR1b19jcmVkc19maWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgIyB
 Mb2FkIGNyZWRlbnRpYWxzIGZyb20gZmlsZQ0KICAgICAgICBmID0gb3BlbihkdW9fY3JlZHNfZm
 lsZSwgJ3InKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjcmVkcyA9IGpzb24ubG9hZHMoZ
 i5yZWFkKCkpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJEdW8uIEluaXRp
 YWxpemF0aW9uLiBGYWlsZWQgdG8gbG9hZCBjcmVkcyBmcm9tIGZpbGU6IiwgZHVvX2NyZWRzX2Z
 pbGUNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgIC
 AgICAgZi5jbG9zZSgpDQoNCiAgICAgICAgc2VsZi5pa2V5ID0gc3RyKGNyZWRzWyJpa2V5Il0pD
 QogICAgICAgIHNlbGYuc2tleSA9IHN0cihjcmVkc1sic2tleSJdKQ0KICAgICAgICBzZWxmLmFr
 ZXkgPSBzdHIoY3JlZHNbImFrZXkiXSkNCg0KICAgICAgICBzZWxmLnVzZV9kdW9fZ3JvdXAgPSB
 GYWxzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoIm
 R1b19ncm91cCIpKToNCiAgICAgICAgICAgIHNlbGYuZHVvX2dyb3VwID0gY29uZmlndXJhdGlvb
 kF0dHJpYnV0ZXMuZ2V0KCJkdW9fZ3JvdXAiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgc2Vs
 Zi51c2VfZHVvX2dyb3VwID0gVHJ1ZQ0KICAgICAgICAgICAgcHJpbnQgIkR1by4gSW5pdGlhbGl
 6YXRpb24uIFVzaW5nIER1byBvbmx5IGlmIHVzZXIgYmVsb25nIHRvIGdyb3VwOiIsIHNlbGYuZH
 VvX2dyb3VwDQoNCiAgICAgICAgc2VsZi51c2VfYXVkaXRfZ3JvdXAgPSBGYWxzZQ0KICAgICAgI
 CBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImF1ZGl0X2dyb3VwIikp
 Og0KICAgICAgICAgICAgc2VsZi5hdWRpdF9ncm91cCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGV
 zLmdldCgiYXVkaXRfZ3JvdXAiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICAgICBpZiAobm90IG
 NvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJhdWRpdF9ncm91cF9lbWFpbCIpK
 ToNCiAgICAgICAgICAgICAgICBwcmludCAiRHVvLiBJbml0aWFsaXphdGlvbi4gUHJvcGVydHkg
 YXVkaXRfZ3JvdXBfZW1haWwgaXMgbm90IHNwZWNpZmllZCINCiAgICAgICAgICAgICAgICByZXR
 1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2VsZi5hdWRpdF9lbWFpbCA9IGNvbmZpZ3VyYXRpb2
 5BdHRyaWJ1dGVzLmdldCgiYXVkaXRfZ3JvdXBfZW1haWwiKS5nZXRWYWx1ZTIoKQ0KICAgICAgI
 CAgICAgc2VsZi51c2VfYXVkaXRfZ3JvdXAgPSBUcnVlDQoNCiAgICAgICAgICAgIHByaW50ICJE
 dW8uIEluaXRpYWxpemF0aW9uLiBVc2luZyBhdWRpdG8gZ3JvdXA6Iiwgc2VsZi5hdWRpdF9ncm9
 1cA0KICAgICAgICAgICAgDQogICAgICAgIGlmIChzZWxmLnVzZV9kdW9fZ3JvdXAgb3Igc2VsZi
 51c2VfYXVkaXRfZ3JvdXApOg0KICAgICAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0c
 mlidXRlcy5jb250YWluc0tleSgiYXVkaXRfYXR0cmlidXRlIikpOg0KICAgICAgICAgICAgICAg
 IHByaW50ICJEdW8uIEluaXRpYWxpemF0aW9uLiBQcm9wZXJ0eSBhdWRpdF9hdHRyaWJ1dGUgaXM
 gbm90IHNwZWNpZmllZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgIC
 AgIGVsc2U6DQogICAgICAgICAgICAgICAgc2VsZi5hdWRpdF9hdHRyaWJ1dGUgPSBjb25maWd1c
 mF0aW9uQXR0cmlidXRlcy5nZXQoImF1ZGl0X2F0dHJpYnV0ZSIpLmdldFZhbHVlMigpDQoNCg0K
 ICAgICAgICBwcmludCAiRHVvLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJ
 ldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcyk6DQogICAgICAgIHByaW50ICJEdW8uIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJEd
 W8uIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBk
 ZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1Z
 hbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpd
 mVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2V
 sZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCi
 AgICAgICAgZHVvX2hvc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImR1b19ob3N0I
 ikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNl
 KCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXR
 Vc2VybmFtZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludC
 AiRHVvLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgICAgdXNlcl9wYXNzd
 29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9
 IEZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXN
 lcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZC
 kpOg0KICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoK
 Q0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1
 c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2l
 uKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgdXNlciA9IG
 NyZWRlbnRpYWxzLmdldFVzZXIoKQ0KICAgICAgICAgICAgaWYgKHNlbGYudXNlX2R1b19ncm91c
 Ck6DQogICAgICAgICAgICAgICAgcHJpbnQgIkR1by4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEu
 IENoZWNraW5nIGlmIHVzZXIgYmVsb25nIHRvIER1byBncm91cCINCiAgICAgICAgICAgICAgICB
 pc19tZW1iZXJfZHVvX2dyb3VwID0gc2VsZi5pc1VzZXJNZW1iZXJPZkdyb3VwKHVzZXIsIHNlbG
 YuYXVkaXRfYXR0cmlidXRlLCBzZWxmLmR1b19ncm91cCkNCiAgICAgICAgICAgICAgICBpZiAoa
 XNfbWVtYmVyX2R1b19ncm91cCk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBVc2VyICciICsgdXNlci5nZXRVc2VySWQoKSArICInIG1
 lbWJlciBvZiBEdW8gZ3JvdXAiDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3VudF9sb2dpbl
 9zdGVwcyA9IDINCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBzZ
 WxmLnByb2Nlc3NBdWRpdEdyb3VwKHVzZXIpDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3Vu
 dF9sb2dpbl9zdGVwcyA9IDENCg0KICAgICAgICAgICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5
 nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJkdW9fY291bn
 RfbG9naW5fc3RlcHMiLCBkdW9fY291bnRfbG9naW5fc3RlcHMpDQoNCiAgICAgICAgICAgIHJld
 HVybiBUcnVlDQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAi
 RHVvLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgc2lnX3Jlc3BvbnN
 lX2FycmF5ID0gcmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJzaWdfcmVzcG9uc2UiKQ0KICAgICAgIC
 AgICAgaWYgQXJyYXlIZWxwZXIuaXNFbXB0eShzaWdfcmVzcG9uc2VfYXJyYXkpOg0KICAgICAgI
 CAgICAgICAgIHByaW50ICJEdW8uIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBzaWdfcmVzcG9u
 c2UgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICA
 gIGR1b19zaWdfcmVzcG9uc2UgPSBzaWdfcmVzcG9uc2VfYXJyYXlbMF0NCg0KICAgICAgICAgIC
 AgcHJpbnQgIkR1by4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIGR1b19zaWdfcmVzcG9uc2U6I
 CIgKyBkdW9fc2lnX3Jlc3BvbnNlDQoNCiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRfdXNlcm5h
 bWUgPSBkdW9fd2ViLnZlcmlmeV9yZXNwb25zZShzZWxmLmlrZXksIHNlbGYuc2tleSwgc2VsZi5
 ha2V5LCBkdW9fc2lnX3Jlc3BvbnNlKQ0KDQogICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW
 50aWNhdGUgZm9yIHN0ZXAgMi4gYXV0aGVudGljYXRlZF91c2VybmFtZTogIiArIGF1dGhlbnRpY
 2F0ZWRfdXNlcm5hbWUgKyAiLCBleHBlY3RlZCB1c2VyX25hbWU6ICIgKyB1c2VyX25hbWUNCg0K
 ICAgICAgICAgICAgaWYgKG5vdCBTdHJpbmdIZWxwZXIuZXF1YWxzKHVzZXJfbmFtZSwgYXV0aGV
 udGljYXRlZF91c2VybmFtZSkpOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogIC
 AgICAgICAgICBzZWxmLnByb2Nlc3NBdWRpdEdyb3VwKGNyZWRlbnRpYWxzLmdldFVzZXIoKSkNC
 g0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJl
 dHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPS
 BDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KDQogICAgICAgIGR1b19ob3N0ID0gY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJkdW9faG9zdCIpLmdldFZhbHVlMigpDQoNCiAgICAgICAg
 Y3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICA
 gICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGlmIC
 hzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkR1by4gUHJlcGFyZSBmb3Igc3RlcCAxI
 g0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09IDIpOg0K
 ICAgICAgICAgICAgcHJpbnQgIkR1by4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICA
 gICBkdW9fc2lnX3JlcXVlc3QgPSBkdW9fd2ViLnNpZ25fcmVxdWVzdChzZWxmLmlrZXksIHNlbG
 Yuc2tleSwgc2VsZi5ha2V5LCB1c2VyX25hbWUpDQogICAgICAgICAgICBwcmludCAiRHVvLiBQc
 mVwYXJlIGZvciBzdGVwIDIuIGR1b19zaWdfcmVxdWVzdDogIiArIGR1b19zaWdfcmVxdWVzdA0K
 ICAgICAgICAgICAgDQogICAgICAgICAgICBjb250ZXh0LnNldCgiZHVvX2hvc3QiLCBkdW9faG9
 zdCkNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJkdW9fc2lnX3JlcXVlc3QiLCBkdW9fc2lnX3
 JlcXVlc3QpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgI
 CAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVw
 KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0dXJuIE5
 vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb
 250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRleHQuaXNTZXQoImR1b19jb3VudF9sb2dpbl9zdGVw
 cyIpKToNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldCgiZHVvX2NvdW50X2xvZ2luX3N
 0ZXBzIikNCg0KICAgICAgICByZXR1cm4gMg0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbG
 YsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gM
 ik6DQogICAgICAgICAgICByZXR1cm4gIi9hdXRoL2R1by9kdW9sb2dpbi54aHRtbCINCiAgICAg
 ICAgcmV0dXJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ
 1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZW
 YgaXNVc2VyTWVtYmVyT2ZHcm91cChzZWxmLCB1c2VyLCBhdHRyaWJ1dGUsIGdyb3VwKToNCiAgI
 CAgICAgaXNfbWVtYmVyID0gRmFsc2UNCiAgICAgICAgbWVtYmVyX29mX2xpc3QgPSB1c2VyLmdl
 dEF0dHJpYnV0ZVZhbHVlcyhhdHRyaWJ1dGUpDQogICAgICAgIGlmIChtZW1iZXJfb2ZfbGlzdCA
 hPSBOb25lKToNCiAgICAgICAgICAgIGZvciBtZW1iZXJfb2YgaW4gbWVtYmVyX29mX2xpc3Q6DQ
 ogICAgICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGdyb3VwL
 CBtZW1iZXJfb2YpKToNCiAgICAgICAgICAgICAgICAgICAgaXNfbWVtYmVyID0gVHJ1ZQ0KICAg
 ICAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgICAgIHJldHVybiBpc19tZW1iZXINCg0KICA
 gIGRlZiBwcm9jZXNzQXVkaXRHcm91cChzZWxmLCB1c2VyKToNCiAgICAgICAgaWYgKHNlbGYudX
 NlX2F1ZGl0X2dyb3VwKToNCiAgICAgICAgICAgIGlzX21lbWJlciA9IHNlbGYuaXNVc2VyTWVtY
 mVyT2ZHcm91cCh1c2VyLCBzZWxmLmF1ZGl0X2F0dHJpYnV0ZSwgc2VsZi5hdWRpdF9ncm91cCkN
 CiAgICAgICAgICAgIGlmIChpc19tZW1iZXIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJEdW8
 uIEF1dGhlbnRpY2F0ZSBmb3IgcHJvY2Vzc0F1ZGl0R3JvdXAuIFVzZXIgJyIgKyB1c2VyLmdldF
 VzZXJJZCgpICsgIicgbWVtYmVyIG9mIGF1ZGl0IGdyb3VwIg0KICAgICAgICAgICAgICAgIHBya
 W50ICJEdW8uIEF1dGhlbnRpY2F0ZSBmb3IgcHJvY2Vzc0F1ZGl0R3JvdXAuIFNlbmRpbmcgZS1t
 YWlsIGFib3V0IHVzZXIgJyIgKyB1c2VyLmdldFVzZXJJZCgpICsgIicgbG9naW4gdG8iLCBzZWx
 mLmF1ZGl0X2VtYWlsDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBTZW5kIG
 UtbWFpbCB0byBhZG1pbmlzdHJhdG9yDQogICAgICAgICAgICAgICAgdXNlcl9pZCA9IHVzZXIuZ
 2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBtYWlsU2VydmljZSA9IE1haWxTZXJ2aWNlLmlu
 c3RhbmNlKCkNCiAgICAgICAgICAgICAgICBzdWJqZWN0ID0gIlVzZXIgbG9nIGluOiAiICsgdXN
 lcl9pZA0KICAgICAgICAgICAgICAgIGJvZHkgPSAiVXNlciBsb2cgaW46ICIgKyB1c2VyX2lkDQ
 ogICAgICAgICAgICAgICAgbWFpbFNlcnZpY2Uuc2VuZE1haWwoc2VsZi5hdWRpdF9lbWFpbCwgc
 3ViamVjdCwgYm9keSkNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!14AF.A70C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: CAS authentication module
displayName: cas
gluuStatus: false
inum: %(inumOrg)s!0011!14AF.A70C
oxConfigurationProperty: {"value1":"cas_map_user","value2":"true","description":""}
oxConfigurationProperty: {"value1":"cas_renew_opt","value2":"false","description":""}
oxConfigurationProperty: {"value1":"cas_host","value2":"https://%(hostname)s/cas","description":""}
oxLevel: 30
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29ud
 GV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9t
 IG9yZy5qYm9zcy5zZWFtIGltcG9ydCBDb21wb25lbnQNCmZyb20gamF2YXguZmFjZXMuY29udGV
 4dCBpbXBvcnQgRmFjZXNDb250ZXh0DQpmcm9tIG9yZy5qYm9zcy5zZWFtIGltcG9ydCBDb21wb2
 5lbnQNCmZyb20gb3JnLmFwYWNoZS5odHRwLmVudGl0eSBpbXBvcnQgQ29udGVudFR5cGUgDQpmc
 m9tIG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1
 dGhlbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2V
 yU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBBdXRoZW50aWNhdG
 lvblNlcnZpY2UNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZS5uZXQgaW1wb3J0IEh0dHBTZ
 XJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy54
 ZGkudXRpbCBpbXBvcnQgQXJyYXlIZWxwZXINCmZyb20gb3JnLmFwYWNoZS5odHRwLnBhcmFtcyB
 pbXBvcnQgQ29yZUNvbm5lY3Rpb25QTmFtZXMNCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheX
 MNCmZyb20gamF2YS51dGlsIGltcG9ydCBIYXNoTWFwDQoNCmltcG9ydCBqYXZhDQppbXBvcnQgc
 3lzDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlw
 ZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICA
 gc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW
 5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDQVMyL
 iBJbml0aWFsaXphdGlvbiINCiAgICAgICAgcHJpbnQgIkNBUzIuIEluaXRpYWxpemVkIHN1Y2Nl
 c3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGY
 sIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkNBUzIuIERlc3Ryb3
 kiDQogICAgICAgIHByaW50ICJDQVMyLiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgI
 CByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJl
 dHVybiAxDQoNCiAgICBkZWYgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWd
 lVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ0FTMi4gUm
 VzdCBBUEkgYXV0aGVudGljYXRlIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZCINCg0KICAgI
 CAgICBpZiAobm90IChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiY2FzX3Zh
 bGlkYXRpb25fdXJpIikgYW5kDQogICAgICAgICAgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5
 jb250YWluc0tleSgiY2FzX3ZhbGlkYXRpb25fcGF0dGVybiIpIGFuZA0KICAgICAgICAgICAgY2
 9uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImNhc192YWxpZGF0aW9uX3RpbWVvd
 XQiKSkpOg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICBjYXNfdmFsaWRhdGlv
 bl91cmkgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc192YWxpZGF0aW9uX3VyaSI
 pLmdldFZhbHVlMigpDQogICAgICAgIGNhc192YWxpZGF0aW9uX3BhdHRlcm4gPSBjb25maWd1cm
 F0aW9uQXR0cmlidXRlcy5nZXQoImNhc192YWxpZGF0aW9uX3BhdHRlcm4iKS5nZXRWYWx1ZTIoK
 Q0KICAgICAgICBjYXNfdmFsaWRhdGlvbl90aW1lb3V0ID0gaW50KGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzLmdldCgiY2FzX3ZhbGlkYXRpb25fdGltZW91dCIpLmdldFZhbHVlMigpKSAqIDEwMDA
 NCg0KICAgICAgICBodHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCk7DQoNCiAgIC
 AgICAgaHR0cF9jbGllbnQgPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpOw0KICAgICAgI
 CBodHRwX2NsaWVudF9wYXJhbXMgPSBodHRwX2NsaWVudC5nZXRQYXJhbXMoKTsNCiAgICAgICAg
 aHR0cF9jbGllbnRfcGFyYW1zLnNldEludFBhcmFtZXRlcihDb3JlQ29ubmVjdGlvblBOYW1lcy5
 DT05ORUNUSU9OX1RJTUVPVVQsIGNhc192YWxpZGF0aW9uX3RpbWVvdXQpOw0KDQogICAgICAgIH
 RyeToNCiAgICAgICAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZSA9IGh0dHBTZXJ2aWNlLmV4Z
 WN1dGVHZXQoaHR0cF9jbGllbnQsIGNhc192YWxpZGF0aW9uX3VyaSkNCiAgICAgICAgICAgIGh0
 dHBfcmVzcG9uc2UgPSBodHRwX3NlcnZpY2VfcmVzcG9uc2UuZ2V0SHR0cFJlc3BvbnNlKCkNCiA
 gICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIFJlc3QgQVBJIGF1dGhlbn
 RpY2F0ZSBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2QuIEV4Y2VwdGlvbjogIiwgc3lzLmV4Y
 19pbmZvKClbMV0NCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHRyeToNCiAg
 ICAgICAgICAgIGlmIChodHRwX3Jlc3BvbnNlLmdldFN0YXR1c0xpbmUoKS5nZXRTdGF0dXNDb2R
 lKCkgIT0gMjAwKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gUmVzdCBBUEkgYXV0aG
 VudGljYXRlIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZC4gR2V0IGludmFsaWQgcmVzcG9uc
 2UgZnJvbSBDQVMyIHNlcnZlcjogIiwgc3RyKGh0dHBfcmVzcG9uc2VfdGlja2V0LmdldFN0YXR1
 c0xpbmUoKS5nZXRTdGF0dXNDb2RlKCkpDQogICAgICAgICAgICAgICAgaHR0cFNlcnZpY2UuY29
 uc3VtZShodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgIA
 0KICAgICAgICAgICAgdmFsaWRhdGlvbl9yZXNwb25zZV9ieXRlcyA9IGh0dHBTZXJ2aWNlLmdld
 FJlc3BvbnNlQ29udGVudChodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgdmFsaWRhdGlvbl9y
 ZXNwb25zZV9zdHJpbmcgPSBodHRwU2VydmljZS5jb252ZXJ0RW50aXR5VG9TdHJpbmcodmFsaWR
 hdGlvbl9yZXNwb25zZV9ieXRlcykNCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLmNvbnN1bWUoaH
 R0cF9yZXNwb25zZSkNCiAgICAgICAgZmluYWxseToNCiAgICAgICAgICAgIGh0dHBfc2VydmljZ
 V9yZXNwb25zZS5jbG9zZUNvbm5lY3Rpb24oKQ0KDQogICAgICAgIGlmICh2YWxpZGF0aW9uX3Jl
 c3BvbnNlX3N0cmluZyA9PSBOb25lIG9yIHZhbGlkYXRpb25fcmVzcG9uc2Vfc3RyaW5nLmZpbmQ
 oY2FzX3ZhbGlkYXRpb25fcGF0dGVybikgPT0gLTEpOg0KICAgICAgICAgICAgcHJpbnQgIkNBUz
 IuIFJlc3QgQVBJIGF1dGhlbnRpY2F0ZSBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2QuIEdld
 CBpbnZhbGlkIGxvZ2luIHBhZ2UgZnJvbSBDQVMyIHNlcnZlcjoiDQogICAgICAgICAgICByZXR1
 cm4gRmFsc2UNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFsdGVybmF0aXZ
 lQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcyk6DQogICAgICAgIGNhc19hbHRfYXV0aF9tb2RlID0gY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMuZ2V0KCJjYXNfYWx0X2F1dGhfbW9kZSIpLmdldFZhbHVlMigpDQogICAgICAgIHJldHVy
 biBjYXNfYWx0X2F1dGhfbW9kZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd
 1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb2
 50ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgYXV0aGVudGljYXRpb
 25TZXJ2aWNlID0gQXV0aGVudGljYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgdXNl
 clNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIGh0dHBTZXJ2aWNlID0
 gSHR0cFNlcnZpY2UuaW5zdGFuY2UoKTsNCg0KICAgICAgICBjYXNfaG9zdCA9IGNvbmZpZ3VyYX
 Rpb25BdHRyaWJ1dGVzLmdldCgiY2FzX2hvc3QiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBjYXNfb
 WFwX3VzZXIgPSBTdHJpbmdIZWxwZXIudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVz
 LmdldCgiY2FzX21hcF91c2VyIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KICAgICAgICBjYXNfcmV
 uZXdfb3B0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 5nZXQoImNhc19yZW5ld19vcHQiKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQoNCiAgICAgICAgY2FzX
 2V4dHJhX29wdHMgPSBOb25lDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5j
 b250YWluc0tleSgiY2FzX2V4dHJhX29wdHMiKSk6DQogICAgICAgICAgICBjYXNfZXh0cmFfb3B
 0cyA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2FzX2V4dHJhX29wdHMiKS5nZXRWYW
 x1ZTIoKQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkNBU
 zIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgdGlja2V0X2FycmF5ID0g
 cmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJ0aWNrZXQiKQ0KICAgICAgICAgICAgaWYgQXJyYXlIZWx
 wZXIuaXNFbXB0eSh0aWNrZXRfYXJyYXkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLi
 BBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gdGlja2V0IGlzIGVtcHR5Ig0KICAgICAgICAgICAgI
 CAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICB0aWNrZXQgPSB0aWNrZXRfYXJyYXlbMF0N
 CiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gdGlja2V
 0OiAiICsgdGlja2V0DQoNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNFbXB0eVN0cm
 luZyh0aWNrZXQpKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlI
 GZvciBzdGVwIDEuIHRpY2tldCBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBG
 YWxzZQ0KDQogICAgICAgICAgICAjIFZhbGlkYXRlIHRpY2tldA0KICAgICAgICAgICAgcmVxdWV
 zdCA9IEZhY2VzQ29udGV4dC5nZXRDdXJyZW50SW5zdGFuY2UoKS5nZXRFeHRlcm5hbENvbnRleH
 QoKS5nZXRSZXF1ZXN0KCkNCg0KICAgICAgICAgICAgcGFyYW1ldGVyc01hcCA9IEhhc2hNYXAoK
 Q0KICAgICAgICAgICAgcGFyYW1ldGVyc01hcC5wdXQoInNlcnZpY2UiLCBodHRwU2VydmljZS5j
 b25zdHJ1Y3RTZXJ2ZXJVcmwocmVxdWVzdCkgKyAiL3Bvc3Rsb2dpbiIpDQogICAgICAgICAgICB
 pZiAoY2FzX3JlbmV3X29wdCk6DQogICAgICAgICAgICAgICAgcGFyYW1ldGVyc01hcC5wdXQoIn
 JlbmV3IiwgInRydWUiKQ0KICAgICAgICAgICAgcGFyYW1ldGVyc01hcC5wdXQoInRpY2tldCIsI
 HRpY2tldCkNCiAgICAgICAgICAgIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpID0gYXV0aGVudGlj
 YXRpb25TZXJ2aWNlLnBhcmFtZXRlcnNBc1N0cmluZyhwYXJhbWV0ZXJzTWFwKQ0KICAgICAgICA
 gICAgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgPSBjYXNfaG9zdCArICIvc2VydmljZVZhbGlkYX
 RlPyIgKyBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaQ0KICAgICAgICAgICAgaWYgKGNhc19leHRyY
 V9vcHRzICE9IE5vbmUpOg0KICAgICAgICAgICAgICAgIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJp
 ID0gY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgKyAiJiIgKyBjYXNfZXh0cmFfb3B0cw0KDQogICA
 gICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGNhc19zZXJ2aW
 NlX3JlcXVlc3RfdXJpOiAiICsgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkNCg0KICAgICAgICAgI
 CAgaHR0cF9jbGllbnQgPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpOw0KICAgICAgICAg
 ICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlID0gaHR0cFNlcnZpY2UuZXhlY3V0ZUdldChodHRwX2N
 saWVudCwgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkpDQogICAgICAgICAgICANCiAgICAgICAgIC
 AgIHRyeToNCiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX2NvbnRlbnQgPSBodHRwU2VydmljZ
 S5jb252ZXJ0RW50aXR5VG9TdHJpbmcoaHR0cFNlcnZpY2UuZ2V0UmVzcG9uc2VDb250ZW50KGh0
 dHBfc2VydmljZV9yZXNwb25zZS5nZXRIdHRwUmVzcG9uc2UoKSkpDQogICAgICAgICAgICBmaW5
 hbGx5Og0KICAgICAgICAgICAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZS5jbG9zZUNvbm5lY3
 Rpb24oKQ0KDQogICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwI
 DEuIHZhbGlkYXRpb25fY29udGVudDogIiArIHZhbGlkYXRpb25fY29udGVudA0KICAgICAgICAg
 ICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkodmFsaWRhdGlvbl9jb250ZW50KToNCiAgICAgICA
 gICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFRpY2tldCB2YW
 xpZGF0aW9uIHJlc3BvbnNlIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhb
 HNlDQoNCiAgICAgICAgICAgIGNhczJfYXV0aF9mYWlsdXJlID0gc2VsZi5wYXJzZV90YWcodmFs
 aWRhdGlvbl9jb250ZW50LCAiY2FzOmF1dGhlbnRpY2F0aW9uRmFpbHVyZSIpDQogICAgICAgICA
 gICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGNhczJfYXV0aF9mYWlsdX
 JlOiAiLCBjYXMyX2F1dGhfZmFpbHVyZQ0KDQogICAgICAgICAgICBjYXMyX3VzZXJfdWlkID0gc
 2VsZi5wYXJzZV90YWcodmFsaWRhdGlvbl9jb250ZW50LCAiY2FzOnVzZXIiKQ0KICAgICAgICAg
 ICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBjYXMyX3VzZXJfdWlkOiA
 iLCBjYXMyX3VzZXJfdWlkDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICgoY2FzMl9hdX
 RoX2ZhaWx1cmUgIT0gTm9uZSkgb3IgKGNhczJfdXNlcl91aWQgPT0gTm9uZSkpOg0KICAgICAgI
 CAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVGlja2V0IGlz
 IGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGl
 mIChjYXNfbWFwX3VzZXIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aW
 NhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgb3hFeHRlcm5hbFVpZ
 DogY2FzMjoiICsgY2FzMl91c2VyX3VpZA0KDQogICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0
 aGUgaXMgdXNlciB3aXRoIHNwZWNpZmllZCBjYXMyX3VzZXJfdWlkDQogICAgICAgICAgICAgICA
 gZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFeH
 Rlcm5hbFVpZCIsICJjYXMyOiIgKyBjYXMyX3VzZXJfdWlkKQ0KDQogICAgICAgICAgICAgICAga
 WYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50
 ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGZpbmQgdXNlciINCiA
 gICAgICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLi
 BTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDIiDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc
 2V0KCJjYXMyX2NvdW50X2xvZ2luX3N0ZXBzIiwgMikNCiAgICAgICAgICAgICAgICAgICAgY29u
 dGV4dC5zZXQoImNhczJfdXNlcl91aWQiLCBjYXMyX3VzZXJfdWlkKQ0KICAgICAgICAgICAgICA
 gICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgICAgICAgICAgICAgZm91bmRfdXNlcl9uYW1lID0gZm
 luZF91c2VyX2J5X3VpZC5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyL
 iBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gZm91bmRfdXNlcl9uYW1lOiAiICsgZm91bmRfdXNl
 cl9uYW1lDQoNCiAgICAgICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmN
 lKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzLnNldFVzZX
 JuYW1lKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBjcmVkZW50aWFscy5zZXRVc
 2VyKGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBwcmlu
 dCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8
 gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2FzMl9jb3VudF9sb2dpbl9zdGVwcy
 IsIDEpDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZWxzZToNC
 iAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0
 dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IHVpZDoiICsgY2FzMl91c2VyX3VpZA0KDQogICAgICA
 gICAgICAgICAgIyBDaGVjayBpZiB0aGUgaXMgdXNlciB3aXRoIHNwZWNpZmllZCBjYXMyX3VzZX
 JfdWlkDQogICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdld
 FVzZXIoY2FzMl91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICBpZiAoZmluZF91c2VyX2J5X3Vp
 ZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F
 0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZmluZCB1c2VyIg0KICAgICAgICAgICAgICAgICAgIC
 ByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIGZvdW5kX3VzZXJfbmFtZSA9IGZpbmRfd
 XNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0
 aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZXJfbmFtZTogIiArIGZvdW5kX3VzZXJfbmF
 tZQ0KDQogICAgICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLm
 dldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgICAgICBjcmVkZW50aWFscy5zZXRVc2VybmFtZ
 Shmb3VuZF91c2VyX25hbWUpDQogICAgICAgICAgICAgICAgY3JlZGVudGlhbHMuc2V0VXNlcihm
 aW5kX3VzZXJfYnlfdWlkKQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnR
 pY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgIC
 AgICAgY29udGV4dC5zZXQoImNhczJfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgI
 CAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAg
 ICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICA
 gc2Vzc2lvbkF0dHJpYnV0ZXMgPSBjb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKQ0KIC
 AgICAgICAgICAgaWYgKHNlc3Npb25BdHRyaWJ1dGVzID09IE5vbmUpIG9yIG5vdCBzZXNzaW9uQ
 XR0cmlidXRlcy5jb250YWluc0tleSgiY2FzMl91c2VyX3VpZCIpOg0KICAgICAgICAgICAgICAg
 IHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gY2FzMl91c2VyX3VpZCBpcyB
 lbXB0eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgY2FzMl
 91c2VyX3VpZCA9IHNlc3Npb25BdHRyaWJ1dGVzLmdldCgiY2FzMl91c2VyX3VpZCIpDQogICAgI
 CAgICAgICBwYXNzZWRfc3RlcDEgPSBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyhjYXMy
 X3VzZXJfdWlkKQ0KICAgICAgICAgICAgaWYgKG5vdCBwYXNzZWRfc3RlcDEpOg0KICAgICAgICA
 gICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aX
 R5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY
 3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNy
 ZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2U
 NCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbW
 UpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogI
 CAgICAgICAgICAgICAgbG9nZ2VkX2luID0gdXNlclNlcnZpY2UuYXV0aGVudGljYXRlKHVzZXJf
 bmFtZSwgdXNlcl9wYXNzd29yZCkNCg0KICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRfaW4pOg0
 KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAjIENoZWNrIGlmIH
 RoZXJlIGlzIHVzZXIgd2hpY2ggaGFzIGNhczJfdXNlcl91aWQNCiAgICAgICAgICAgICMgQXZva
 WQgbWFwcGluZyBDQVMyIGFjY291bnQgdG8gbW9yZSB0aGFuIG9uZSBJRFAgYWNjb3VudA0KICAg
 ICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV
 0ZSgib3hFeHRlcm5hbFVpZCIsICJjYXMyOiIgKyBjYXMyX3VzZXJfdWlkKQ0KDQogICAgICAgIC
 AgICBpZiAoZmluZF91c2VyX2J5X3VpZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAjIEFkZ
 CBjYXMyX3VzZXJfdWlkIHRvIHVzZXIgb25lIGlkIFVJRHMNCiAgICAgICAgICAgICAgICBmaW5k
 X3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuYWRkVXNlckF0dHJpYnV0ZSh1c2VyX25hbWUsICJ
 veEV4dGVybmFsVWlkIiwgImNhczI6IiArIGNhczJfdXNlcl91aWQpDQogICAgICAgICAgICAgIC
 AgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHBya
 W50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIHVwZGF0ZSBjdXJy
 ZW50IHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICA
 gICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgZm
 91bmRfdXNlcl9uYW1lID0gZmluZF91c2VyX2J5X3VpZC5nZXRVc2VySWQoKQ0KICAgICAgICAgI
 CAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gZm91bmRfdXNlcl9u
 YW1lOiAiICsgZm91bmRfdXNlcl9uYW1lDQogICAgDQogICAgICAgICAgICAgICAgaWYgU3RyaW5
 nSGVscGVyLmVxdWFscyh1c2VyX25hbWUsIGZvdW5kX3VzZXJfbmFtZSk6DQogICAgICAgICAgIC
 AgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlD
 QogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVw
 YXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXR
 lcnMsIHN0ZXApOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KC
 kNCiAgICAgICAgYXV0aGVudGljYXRpb25TZXJ2aWNlID0gQXV0aGVudGljYXRpb25TZXJ2aWNlL
 mluc3RhbmNlKCkNCiAgICAgICAgaHR0cFNlcnZpY2UgPSBIdHRwU2VydmljZS5pbnN0YW5jZSgp
 Ow0KDQogICAgICAgIGNhc19ob3N0ID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjYXN
 faG9zdCIpLmdldFZhbHVlMigpDQogICAgICAgIGNhc19yZW5ld19vcHQgPSBTdHJpbmdIZWxwZX
 IudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2FzX3JlbmV3X29wdCIpL
 mdldFZhbHVlMigpLCBGYWxzZSkNCg0KICAgICAgICBjYXNfZXh0cmFfb3B0cyA9IE5vbmUNCiAg
 ICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJjYXNfZXh0cmF
 fb3B0cyIpKToNCiAgICAgICAgICAgIGNhc19leHRyYV9vcHRzID0gY29uZmlndXJhdGlvbkF0dH
 JpYnV0ZXMuZ2V0KCJjYXNfZXh0cmFfb3B0cyIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgaWYgK
 HN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gUHJlcGFyZSBmb3Igc3RlcCAx
 Ig0KDQogICAgICAgICAgICByZXF1ZXN0ID0gRmFjZXNDb250ZXh0LmdldEN1cnJlbnRJbnN0YW5
 jZSgpLmdldEV4dGVybmFsQ29udGV4dCgpLmdldFJlcXVlc3QoKQ0KICAgICAgICAgICAgcGFyYW
 1ldGVyc01hcCA9IEhhc2hNYXAoKQ0KICAgICAgICAgICAgcGFyYW1ldGVyc01hcC5wdXQoInNlc
 nZpY2UiLCBodHRwU2VydmljZS5jb25zdHJ1Y3RTZXJ2ZXJVcmwocmVxdWVzdCkgKyAiL3Bvc3Rs
 b2dpbiIpDQogICAgICAgICAgICBpZiAoY2FzX3JlbmV3X29wdCk6DQogICAgICAgICAgICAgICA
 gcGFyYW1ldGVyc01hcC5wdXQoInJlbmV3IiwgInRydWUiKQ0KICAgICAgICAgICAgY2FzX3Nlcn
 ZpY2VfcmVxdWVzdF91cmkgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UucGFyYW1ldGVyc0FzU3Rya
 W5nKHBhcmFtZXRlcnNNYXApDQogICAgICAgICAgICBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSA9
 IGNhc19ob3N0ICsgIi9sb2dpbj8iICsgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkNCiAgICAgICA
 gICAgIGlmIGNhc19leHRyYV9vcHRzICE9IE5vbmU6DQogICAgICAgICAgICAgICAgY2FzX3Nlcn
 ZpY2VfcmVxdWVzdF91cmkgPSBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSArICImIiArIGNhc19le
 HRyYV9vcHRzDQoNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBQcmVwYXJlIGZvciBzdGVwIDEu
 IGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpOiAiICsgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkNCg0
 KICAgICAgICAgICAgY29udGV4dC5zZXQoImNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpIiwgY2FzX3
 NlcnZpY2VfcmVxdWVzdF91cmkpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgI
 GVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gUHJlcGFyZSBmb3Ig
 c3RlcCAyIg0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICA
 gICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgZ2V0RXh0cmFQYXJhbWV0ZXJzRm9yU3RlcC
 hzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIChzdGVwI
 D09IDIpOg0KICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5hc0xpc3QoImNhczJfdXNlcl91aWQi
 KQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGh
 lbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgIC
 Bjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRle
 HQuaXNTZXQoImNhczJfY291bnRfbG9naW5fc3RlcHMiKSk6DQogICAgICAgICAgICByZXR1cm4g
 Y29udGV4dC5nZXQoImNhczJfY291bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICANCiAgICAgICA
 gcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgc
 mV0dXJuICIvYXV0aC9jYXMyL2NhczJsb2dpbi54aHRtbCINCiAgICAgICAgcmV0dXJuICIvYXV0
 aC9jYXMyL2NhczJwb3N0bG9naW4ueGh0bWwiDQoNCiAgICBkZWYgcGFyc2VfdGFnKHNlbGYsIHN
 0ciwgdGFnKToNCiAgICAgICAgdGFnMV9wb3MxID0gc3RyLmZpbmQoIjwiICsgdGFnKQ0KICAgIC
 AgICAjICBObyB0YWcgZm91bmQsIHJldHVybiBlbXB0eSBzdHJpbmcuDQogICAgICAgIGlmIHRhZ
 zFfcG9zMSA9PSAtMTogcmV0dXJuIE5vbmUNCiAgICAgICAgdGFnMV9wb3MyID0gc3RyLmZpbmQo
 Ij4iLCB0YWcxX3BvczEpDQogICAgICAgIGlmIHRhZzFfcG9zMiA9PSAtMTogcmV0dXJuIE5vbmU
 NCiAgICAgICAgdGFnMl9wb3MxID0gc3RyLmZpbmQoIjwvIiArIHRhZywgdGFnMV9wb3MyKQ0KIC
 AgICAgICBpZiB0YWcyX3BvczEgPT0gLTE6IHJldHVybiBOb25lDQoNCiAgICAgICAgcmV0dXJuI
 HN0clt0YWcxX3BvczIrMTp0YWcyX3BvczFdLnN0cmlwKCkNCg0KICAgIGRlZiBsb2dvdXQoc2Vs
 ZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICA
 gcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!7523.8F2D,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Google+ authentication module
displayName: gplus
gluuStatus: false
inum: %(inumOrg)s!0011!7523.8F2D
oxConfigurationProperty: {"value1":"gplus_client_secrets_file","value2":"/et
 c/certs/gplus_client_secrets.json","description":""}
oxConfigurationProperty: {"value1":"gplus_deployment_type","value2":"enroll"
 ,"description":""}
oxConfigurationProperty: {"value1":"gplus_remote_attributes_list","value2":"
 email, email, name, family_name, given_name, locale","description":""}
oxConfigurationProperty: {"value1":"gplus_local_attributes_list","value2":"u
 id, mail, givenName, sn, cn, preferredLanguage","description":""}
oxLevel: 40
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4d
 HMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIGphdmF4
 LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3R
 vbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3
 JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIENsaWVudFNlcnZpY2UsIEF1d
 GhlbnRpY2F0aW9uU2VydmljZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlciwg
 QXJyYXlIZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdCwgSGFzaE1
 hcCwgSWRlbnRpdHlIYXNoTWFwDQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLmNvbW1vbiBpbXBvcn
 QgVXNlcg0KZnJvbSBvcmcueGRpLm94YXV0aC5jbGllbnQgaW1wb3J0IFRva2VuQ2xpZW50LCBUb2tlb
 lJlcXVlc3QsIFVzZXJJbmZvQ2xpZW50DQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLmNvbW1vbiBp
 bXBvcnQgR3JhbnRUeXBlLCBBdXRoZW50aWNhdGlvbk1ldGhvZA0KZnJvbSBvcmcueGRpLm94YXV0aC5
 tb2RlbC5qd3QgaW1wb3J0IEp3dCwgSnd0Q2xhaW1OYW1lDQoNCmltcG9ydCBqYXZhDQoNCnRyeToNCi
 AgICBpbXBvcnQganNvbg0KZXhjZXB0IEltcG9ydEVycm9yOg0KICAgIGltcG9ydCBzaW1wbGVqc29uI
 GFzIGpzb24NCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25U
 eXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICB
 zZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbml0KH
 NlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pd
 GlhbGl6YXRpb24iDQoNCiAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250
 YWluc0tleSgiZ3BsdXNfY2xpZW50X3NlY3JldHNfZmlsZSIpKToNCiAgICAgICAgICAgIHByaW50ICJ
 Hb29nbGUrIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgZ3BsdXNfY2xpZW50X3NlY3JldHNfZm
 lsZSBpcyBlbXB0eSINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgI
 CAgIGNsaWVudFNlY3JldHNGaWxlID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c19j
 bGllbnRfc2VjcmV0c19maWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgc2VsZi5jbGllbnRTZWNyZXR
 zID0gc2VsZi5sb2FkQ2xpZW50U2VjcmV0cyhjbGllbnRTZWNyZXRzRmlsZSkNCiAgICAgICAgaWYgKH
 NlbGYuY2xpZW50U2VjcmV0cyA9PSBOb25lKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIElua
 XRpYWxpemF0aW9uLiBGaWxlIHdpdGggR29vZ2xlKyBjbGllbnQgc2VjcmV0cyBzaG91bGQgYmUgbm90
 IGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2VsZi5hdHRyaWJ1dGV
 zTWFwcGluZyA9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW
 5zS2V5KCJncGx1c19yZW1vdGVfYXR0cmlidXRlc19saXN0IikgYW5kDQogICAgICAgICAgICBjb25ma
 Wd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZ3BsdXNfbG9jYWxfYXR0cmlidXRlc19saXN0
 IikpOg0KDQogICAgICAgICAgICByZW1vdGVBdHRyaWJ1dGVzTGlzdCA9IGNvbmZpZ3VyYXRpb25BdHR
 yaWJ1dGVzLmdldCgiZ3BsdXNfcmVtb3RlX2F0dHJpYnV0ZXNfbGlzdCIpLmdldFZhbHVlMigpDQogIC
 AgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkocmVtb3RlQXR0cmlidXRlc0xpc3QpKToNC
 iAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gVGhlIHByb3BlcnR5
 IGdwbHVzX3JlbW90ZV9hdHRyaWJ1dGVzX2xpc3QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV
 0dXJuIEZhbHNlICAgIA0KDQogICAgICAgICAgICBsb2NhbEF0dHJpYnV0ZXNMaXN0ID0gY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c19sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiKS5nZXRWYWx1Z
 TIoKQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc0VtcHR5KGxvY2FsQXR0cmlidXRlc0xp
 c3QpKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gVGhlIHB
 yb3BlcnR5IGdwbHVzX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCBpcyBlbXB0eSINCiAgICAgICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2VsZi5hdHRyaWJ1dGVzTWFwcGluZyA9IHNlb
 GYucHJlcGFyZUF0dHJpYnV0ZXNNYXBwaW5nKHJlbW90ZUF0dHJpYnV0ZXNMaXN0LCBsb2NhbEF0dHJp
 YnV0ZXNMaXN0KQ0KICAgICAgICAgICAgaWYgKHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPT0gTm9uZSk
 6DQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pdGlhbGl6YXRpb24uIFRoZSBhdHRyaW
 J1dGVzIG1hcHBpbmcgaXNuJ3QgdmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNC
 iAgICAgICAgc2VsZi5leHRlbnNpb25Nb2R1bGUgPSBOb25lDQogICAgICAgIGlmIChjb25maWd1cmF0
 aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZXh0ZW5zaW9uX21vZHVsZSIpKToNCiAgICAgICAgICA
 gIGV4dGVuc2lvbk1vZHVsZU5hbWUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImV4dGVuc2
 lvbl9tb2R1bGUiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgI
 HNlbGYuZXh0ZW5zaW9uTW9kdWxlID0gX19pbXBvcnRfXyhleHRlbnNpb25Nb2R1bGVOYW1lKQ0KICAg
 ICAgICAgICAgICAgIGV4dGVuc2lvbk1vZHVsZUluaXRSZXN1bHQgPSBzZWxmLmV4dGVuc2lvbk1vZHV
 sZS5pbml0KGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKQ0KICAgICAgICAgICAgICAgIGlmIChub3QgZX
 h0ZW5zaW9uTW9kdWxlSW5pdFJlc3VsdCk6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZ
 Q0KICAgICAgICAgICAgZXhjZXB0IEltcG9ydEVycm9yLCBleDoNCiAgICAgICAgICAgICAgICBwcmlu
 dCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gRmFpbGVkIHRvIGxvYWQgZ3BsdXNfZXh0ZW5zaW9uX21
 vZHVsZToiLCBleHRlbnNpb25Nb2R1bGVOYW1lDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZS
 sgSW5pdGlhbGl6YXRpb24uIFVuZXhwZWN0ZWQgZXJyb3I6IiwgZXgNCiAgICAgICAgICAgICAgICByZ
 XR1cm4gRmFsc2UNCg0KICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXplZCBzdWNjZXNzZnVs
 bHkiDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBhdXRoQ29
 uZmlndXJhdGlvbik6DQogICAgICAgIHByaW50ICJHb29nbGUrIERlc3Ryb3kiDQogICAgICAgIHByaW
 50ICJHb29nbGUrIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvb
 ihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25N
 ZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJ
 ldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZW
 xmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vb
 mUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJl
 cXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW5
 0Q29udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2
 VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY
 2UoKQ0KDQogICAgICAgIG1hcFVzZXJEZXBsb3ltZW50ID0gRmFsc2UNCiAgICAgICAgZW5yb2xsVXNl
 ckRlcGxveW1lbnQgPSBGYWxzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29
 udGFpbnNLZXkoImdwbHVzX2RlcGxveW1lbnRfdHlwZSIpKToNCiAgICAgICAgICAgIGRlcGxveW1lbn
 RUeXBlID0gU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdld
 CgiZ3BsdXNfZGVwbG95bWVudF90eXBlIikuZ2V0VmFsdWUyKCkpDQogICAgICAgICAgICANCiAgICAg
 ICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkZXBsb3ltZW50VHlwZSwgIm1
 hcCIpKToNCiAgICAgICAgICAgICAgICBtYXBVc2VyRGVwbG95bWVudCA9IFRydWUNCiAgICAgICAgIC
 AgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkZXBsb3ltZW50VHlwZSwgImVucm9sb
 CIpKToNCiAgICAgICAgICAgICAgICBlbnJvbGxVc2VyRGVwbG95bWVudCA9IFRydWUNCg0KICAgICAg
 ICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxIg0KIA0KICAgICAgICAgICAgZ3BsdXNBdXRoQ29kZUFycmF5ID0gcmVxdWVzdFBhcm
 FtZXRlcnMuZ2V0KCJncGx1c19hdXRoX2NvZGUiKQ0KICAgICAgICAgICAgZ3BsdXNBdXRoQ29kZSA9I
 GdwbHVzQXV0aENvZGVBcnJheVswXQ0KDQogICAgICAgICAgICAjIENoZWNrIGlmIHVzZXIgdXNlcyBi
 YXNpYyBtZXRob2QgdG8gbG9nIGluDQogICAgICAgICAgICB1c2VCYXNpY0F1dGggPSBGYWxzZQ0KICA
 gICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc0VtcHR5U3RyaW5nKGdwbHVzQXV0aENvZGUpKToNCi
 AgICAgICAgICAgICAgICB1c2VCYXNpY0F1dGggPSBUcnVlDQoNCiAgICAgICAgICAgICMgVXNlIGJhc
 2ljIG1ldGhvZCB0byBsb2cgaW4NCiAgICAgICAgICAgIGlmICh1c2VCYXNpY0F1dGgpOg0KICAgICAg
 ICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBCYXNpYyBhdXR
 oZW50aWNhdGlvbiINCiAgICAgICAgDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2
 NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCiAgICAgICAgDQogICAgICAgICAgICAgICAgY3JlZGVudGlhb
 HMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgICAgICB1
 c2VyTmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgICAgICB1c2VyUGF
 zc3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQogICAgICAgIA0KICAgICAgICAgICAgIC
 AgIGxvZ2dlZEluID0gRmFsc2UNCiAgICAgICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90R
 W1wdHlTdHJpbmcodXNlck5hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2Vy
 UGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5
 pbnN0YW5jZSgpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlZEluID0gdXNlclNlcnZpY2UuYXV0aG
 VudGljYXRlKHVzZXJOYW1lLCB1c2VyUGFzc3dvcmQpDQogICAgICAgIA0KICAgICAgICAgICAgICAgI
 GlmIChub3QgbG9nZ2VkSW4pOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAg
 ICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgIyBVc2UgR29vZ2x
 lKyBtZXRob2QgdG8gbG9nIGluDQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdG
 UgZm9yIHN0ZXAgMS4gZ3BsdXNBdXRoQ29kZToiLCBncGx1c0F1dGhDb2RlDQoNCiAgICAgICAgICAgI
 GN1cnJlbnRDbGllbnRTZWNyZXRzID0gc2VsZi5nZXRDdXJyZW50Q2xpZW50U2VjcmV0cyhzZWxmLmNs
 aWVudFNlY3JldHMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycykNCiA
 gICAgICAgICAgIGlmIChjdXJyZW50Q2xpZW50U2VjcmV0cyA9PSBOb25lKToNCiAgICAgICAgICAgIC
 AgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQ2xpZW50IHNlY3JldHMgY
 29uZmlndXJhdGlvbiBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAg
 ICAgICAgICAgDQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXA
 gMS4gQXR0ZW1wdGluZyB0byBnZXRzIHRva2VucyINCiAgICAgICAgICAgIHRva2VuUmVzcG9uc2UgPS
 BzZWxmLmdldFRva2Vuc0J5Q29kZShzZWxmLmNsaWVudFNlY3JldHMsIGNvbmZpZ3VyYXRpb25BdHRya
 WJ1dGVzLCBncGx1c0F1dGhDb2RlKTsNCiAgICAgICAgICAgIGlmICgodG9rZW5SZXNwb25zZSA9PSBO
 b25lKSBvciAodG9rZW5SZXNwb25zZS5nZXRJZFRva2VuKCkgPT0gTm9uZSkgb3IgKHRva2VuUmVzcG9
 uc2UuZ2V0QWNjZXNzVG9rZW4oKSA9PSBOb25lKSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2
 dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBnZXQgdG9rZW5zIg0KICAgICAgI
 CAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBw
 cmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU3VjY2Vzc2Z1bGx5IGdldHMgdG9
 rZW5zIg0KDQogICAgICAgICAgICBqd3QgPSBKd3QucGFyc2UodG9rZW5SZXNwb25zZS5nZXRJZFRva2
 VuKCkpDQogICAgICAgICAgICAjIFRPRE86IFZhbGlkYXRlIElEIFRva2VuIFNpZ25hdHVyZSAgDQoNC
 iAgICAgICAgICAgIGdwbHVzVXNlclVpZCA9IGp3dC5nZXRDbGFpbXMoKS5nZXRDbGFpbUFzU3RyaW5n
 KEp3dENsYWltTmFtZS5TVUJKRUNUX0lERU5USUZJRVIpOw0KICAgICAgICAgICAgcHJpbnQgIkdvb2d
 sZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZvdW5kIEdvb2dsZSB1c2VyIElEIGluIHRoZSBJRC
 B0b2tlbjogIiwgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChtYXBVc
 2VyRGVwbG95bWVudCk6DQogICAgICAgICAgICAgICAgIyBVc2UgbWFwcGluZyB0byBsb2NhbCBJRFAg
 dXNlcg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCA
 xLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBncGx1czoiLCBncGx1c1
 VzZXJVaWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aXRoIHNwZ
 WNpZmllZCBncGx1c1VzZXJVaWQNCiAgICAgICAgICAgICAgICBmb3VuZFVzZXIgPSB1c2VyU2Vydmlj
 ZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiZ3BsdXM6IiArIGdwbHVzVXNlclV
 pZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgIC
 AgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZ
 mluZCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUg
 Zm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAyIg0KICAgICAgICAgICAgICAgICAgICB
 jb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAyKQ0KICAgICAgICAgICAgICAgIC
 AgICBjb250ZXh0LnNldCgiZ3BsdXNfdXNlcl91aWQiLCBncGx1c1VzZXJVaWQpDQogICAgICAgICAgI
 CAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgICAgICAgICBmb3VuZFVzZXJOYW1lID0gZm91
 bmRVc2VyLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGl
 jYXRlIGZvciBzdGVwIDEuIGZvdW5kVXNlck5hbWU6IiwgZm91bmRVc2VyTmFtZQ0KICAgICAgICAgIC
 AgICAgIA0KICAgICAgICAgICAgICAgIHVzZXJBdXRoZW50aWNhdGVkID0gYXV0aGVudGljYXRpb25TZ
 XJ2aWNlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lKQ0KICAgICAgICAgICAgICAgIGlmICh1c2Vy
 QXV0aGVudGljYXRlZCA9PSBGYWxzZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGU
 rIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogIC
 AgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgI
 CAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3Rl
 cHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3R
 lcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlbnNpb2
 5Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZvdW5kVXNlcikNCiAgICAgICAgICAgI
 CAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcG9zdExvZ2luUmVzdWx0
 OiIsIHBvc3RMb2dpblJlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2dpblJlc3V
 sdA0KICAgICAgICAgICAgZWxpZiAoZW5yb2xsVXNlckRlcGxveW1lbnQpOg0KICAgICAgICAgICAgIC
 AgICMgVXNlIGF1dG8gZW5yb2xsbWVudCB0byBsb2NhbCBJRFANCiAgICAgICAgICAgICAgICBwcmlud
 CAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIg
 Ynkgb3hFeHRlcm5hbFVpZDogZ3BsdXM6IiwgZ3BsdXNVc2VyVWlkDQogDQogICAgICAgICAgICAgICA
 gIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdpdGggc3BlY2lmaWVkIGdwbHVzVXNlclVpZA0KICAgIC
 AgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFe
 HRlcm5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNVc2VyVWlkKQ0KIA0KICAgICAgICAgICAgICAgIGlm
 IChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICMgQXV0byB1c2VyIGVucm9
 sbGVtbnQNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvci
 BzdGVwIDEuIFRoZXJlIGlzIG5vIHVzZXIgaW4gTERBUC4gQWRkaW5nIHVzZXIgdG8gbG9jYWwgTERBU
 CINCg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0
 ZXAgMS4gQXR0ZW1wdGluZyB0byBnZXRzIHVzZXIgaW5mbyINCiAgICAgICAgICAgICAgICAgICAgdXN
 lckluZm9SZXNwb25zZSA9IHNlbGYuZ2V0VXNlckluZm8oY3VycmVudENsaWVudFNlY3JldHMsIGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzLCB0b2tlblJlc3BvbnNlLmdldEFjY2Vzc1Rva2VuKCkpDQogICAgI
 CAgICAgICAgICAgICAgIGlmICgodXNlckluZm9SZXNwb25zZSA9PSBOb25lKSBvciAodXNlckluZm9S
 ZXNwb25zZS5nZXRDbGFpbXMoKS5zaXplKCkgPT0gMCkpOg0KICAgICAgICAgICAgICAgICAgICAgICA
 gcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBnZXQgdXNlci
 BpbmZvIg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgI
 CAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50
 aWNhdGUgZm9yIHN0ZXAgMS4gU3VjY2Vzc2Z1bGx5IGdldHMgdXNlciBpbmZvIg0KICAgICAgICAgICA
 gICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZ3BsdXNSZXNwb25zZUF0dHJpYnV0ZXMgPSB1c2
 VySW5mb1Jlc3BvbnNlLmdldENsYWltcygpDQogDQogICAgICAgICAgICAgICAgICAgICMgQ29udmVyd
 CBHb29nbGUrIHVzZXIgY2xhaW1zIHRvIGxvdmVyIGNhc2UNCiAgICAgICAgICAgICAgICAgICAgZ3Bs
 dXNSZXNwb25zZU5vcm1hbGl6ZWRBdHRyaWJ1dGVzID0gSGFzaE1hcCgpDQogICAgICAgICAgICAgICA
 gICAgIGZvciBncGx1c1Jlc3BvbnNlQXR0cmlidXRlRW50cnkgaW4gZ3BsdXNSZXNwb25zZUF0dHJpYn
 V0ZXMuZW50cnlTZXQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGdwbHVzUmVzcG9uc2VOb3JtY
 WxpemVkQXR0cmlidXRlcy5wdXQoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nSGVs
 cGVyLnRvTG93ZXJDYXNlKGdwbHVzUmVzcG9uc2VBdHRyaWJ1dGVFbnRyeS5nZXRLZXkoKSksIGdwbHV
 zUmVzcG9uc2VBdHRyaWJ1dGVFbnRyeS5nZXRWYWx1ZSgpKQ0KIA0KICAgICAgICAgICAgICAgICAgIC
 BjdXJyZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLmdldEN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZ
 yhzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBh
 cmFtZXRlcnMpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxLiBVc2luZyBuZXh0IGF0dHJpYnV0ZXMgbWFwcGluZyIsIGN1cnJlbnRBdHRyaWJ1dG
 VzTWFwcGluZw0KIA0KICAgICAgICAgICAgICAgICAgICBuZXdVc2VyID0gVXNlcigpDQogICAgICAgI
 CAgICAgICAgICAgIGZvciBhdHRyaWJ1dGVzTWFwcGluZ0VudHJ5IGluIGN1cnJlbnRBdHRyaWJ1dGVz
 TWFwcGluZy5lbnRyeVNldCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3RlQXR0cmlidXR
 lID0gYXR0cmlidXRlc01hcHBpbmdFbnRyeS5nZXRLZXkoKQ0KICAgICAgICAgICAgICAgICAgICAgIC
 AgbG9jYWxBdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzTWFwcGluZ0VudHJ5LmdldFZhbHVlKCkNCiANCiAgI
 CAgICAgICAgICAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlVmFsdWUgPSBncGx1c1Jlc3BvbnNlTm9y
 bWFsaXplZEF0dHJpYnV0ZXMuZ2V0KHJlbW90ZUF0dHJpYnV0ZSkNCiAgICAgICAgICAgICAgICAgICA
 gICAgIGlmIChsb2NhbEF0dHJpYnV0ZSAhPSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIC
 AgICBuZXdVc2VyLnNldEF0dHJpYnV0ZShsb2NhbEF0dHJpYnV0ZSwgbG9jYWxBdHRyaWJ1dGVWYWx1Z
 SkNCiANCiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1VzZXIuZ2V0QXR0cmlidXRlKCJzbiIpID09
 IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3VXNlci5zZXRBdHRyaWJ1dGUoInNuIiw
 gZ3BsdXNVc2VyVWlkKQ0KIA0KICAgICAgICAgICAgICAgICAgICBpZiAobmV3VXNlci5nZXRBdHRyaW
 J1dGUoImNuIikgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdVc2VyLnNldEF0d
 HJpYnV0ZSgiY24iLCBncGx1c1VzZXJVaWQpDQoNCiAgICAgICAgICAgICAgICAgICAgbmV3VXNlci5z
 ZXRBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiZ3BsdXM6IiArIGdwbHVzVXNlclVpZCkNCiAgICA
 gICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dG
 VtcHRpbmcgdG8gYWRkIHVzZXIiLCBncGx1c1VzZXJVaWQsICIgd2l0aCBuZXh0IGF0dHJpYnV0ZXMiL
 CBuZXdVc2VyLmdldEN1c3RvbUF0dHJpYnV0ZXMoKQ0KIA0KICAgICAgICAgICAgICAgICAgICBmb3Vu
 ZFVzZXIgPSB1c2VyU2VydmljZS5hZGRVc2VyKG5ld1VzZXIsIFRydWUpDQogICAgICAgICAgICAgICA
 gICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBZGRlZCBuZXcgdXNlci
 B3aXRoIFVJRCIsIGZvdW5kVXNlci5nZXRVc2VySWQoKQ0KDQogICAgICAgICAgICAgICAgZm91bmRVc
 2VyTmFtZSA9IGZvdW5kVXNlci5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgICAgIHByaW50ICJHb29n
 bGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZFVzZXJOYW1lOiIsIGZvdW5kVXNlck5hbWU
 NCg0KICAgICAgICAgICAgICAgIHVzZXJBdXRoZW50aWNhdGVkID0gYXV0aGVudGljYXRpb25TZXJ2aW
 NlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lKQ0KICAgICAgICAgICAgICAgIGlmICh1c2VyQXV0a
 GVudGljYXRlZCA9PSBGYWxzZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICA
 gICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZS
 sgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8gMSINCiAgICAgI
 CAgICAgICAgICBjb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAg
 ICAgICAgICAgICAgcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlbnNpb25Qb3N0TG9naW4oY29uZml
 ndXJhdGlvbkF0dHJpYnV0ZXMsIGZvdW5kVXNlcikNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2
 xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcG9zdExvZ2luUmVzdWx0OiIsIHBvc3RMb2dpblJlc
 3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2dpblJlc3VsdA0KICAgICAgICAgICAg
 ZWxzZToNCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZXJlIGlzIHVzZXIgd2l0aCBzcGVjaWZ
 pZWQgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYX
 RlIGZvciBzdGVwIDEuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IHVpZDoiLCBncGx1c1VzZXJVa
 WQNCg0KICAgICAgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXIoZ3BsdXNV
 c2VyVWlkKQ0KICAgICAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICA
 gICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG
 8gZmluZCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgI
 CAgICAgIGZvdW5kVXNlck5hbWUgPSBmb3VuZFVzZXIuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAg
 ICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gZm91bmRVc2VyTmFtZToiLCB
 mb3VuZFVzZXJOYW1lDQoNCiAgICAgICAgICAgICAgICB1c2VyQXV0aGVudGljYXRlZCA9IGF1dGhlbn
 RpY2F0aW9uU2VydmljZS5hdXRoZW50aWNhdGUoZm91bmRVc2VyTmFtZSkNCiAgICAgICAgICAgICAgI
 CBpZiAodXNlckF1dGhlbnRpY2F0ZWQgPT0gRmFsc2UpOg0KICAgICAgICAgICAgICAgICAgICBwcmlu
 dCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB
 1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIH
 ByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzI
 HRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBz
 IiwgMSkNCg0KICAgICAgICAgICAgICAgIHBvc3RMb2dpblJlc3VsdCA9IHNlbGYuZXh0ZW5zaW9uUG9
 zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmb3VuZFVzZXIpDQogICAgICAgICAgICAgIC
 AgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHBvc3RMb2dpblJlc3VsdDoiL
 CBwb3N0TG9naW5SZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQN
 CiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAyIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZXNzaW9uQXR0cm
 lidXRlcyA9IGNvbnRleHQuZ2V0KCJzZXNzaW9uQXR0cmlidXRlcyIpDQogICAgICAgICAgICBpZiAoc
 2Vzc2lvbkF0dHJpYnV0ZXMgPT0gTm9uZSkgb3Igbm90IHNlc3Npb25BdHRyaWJ1dGVzLmNvbnRhaW5z
 S2V5KCJncGx1c191c2VyX3VpZCIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAyLiBncGx1c191c2VyX3VpZCBpcyBlbXB0eSINCiAgICAgICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgZ3BsdXNVc2VyVWlkID0gc2Vzc2lvbkF0dHJpY
 nV0ZXMuZ2V0KCJncGx1c191c2VyX3VpZCIpDQogICAgICAgICAgICBwYXNzZWRfc3RlcDEgPSBTdHJp
 bmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyhncGx1c1VzZXJVaWQpDQogICAgICAgICAgICBpZiAobm9
 0IHBhc3NlZF9zdGVwMSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgIC
 AgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgI
 CAgICAgICB1c2VyTmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVz
 ZXJQYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2V
 kSW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKH
 VzZXJOYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlclBhc3N3b3JkKSk6D
 QogICAgICAgICAgICAgICAgbG9nZ2VkSW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlck5h
 bWUsIHVzZXJQYXNzd29yZCkNCg0KICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRJbik6DQogICAgICA
 gICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdX
 NlciB3aGljaCBoYXMgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICAjIEF2b2lkIG1hcHBpbmcgR29vZ
 2xlIGFjY291bnQgdG8gbW9yZSB0aGFuIG9uZSBJRFAgYWNjb3VudA0KICAgICAgICAgICAgZm91bmRV
 c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgImdwbHV
 zOiIgKyBncGx1c1VzZXJVaWQpDQoNCiAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQ
 ogICAgICAgICAgICAgICAgIyBBZGQgZ3BsdXNVc2VyVWlkIHRvIHVzZXIgb25lIGlkIFVJRHMNCiAgI
 CAgICAgICAgICAgICBmb3VuZFVzZXIgPSB1c2VyU2VydmljZS5hZGRVc2VyQXR0cmlidXRlKHVzZXJO
 YW1lLCAib3hFeHRlcm5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNVc2VyVWlkKQ0KICAgICAgICAgICA
 gICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb2
 9nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gdXBkYXRlIGN1cnJlbnQgdXNlc
 iINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBwb3N0
 TG9naW5SZXN1bHQgPSBzZWxmLmV4dGVuc2lvblBvc3RMb2dpbihjb25maWd1cmF0aW9uQXR0cmlidXR
 lcywgZm91bmRVc2VyKQ0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZS
 Bmb3Igc3RlcCAyLiBwb3N0TG9naW5SZXN1bHQ6IiwgcG9zdExvZ2luUmVzdWx0DQoNCiAgICAgICAgI
 CAgICAgICByZXR1cm4gcG9zdExvZ2luUmVzdWx0DQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAg
 ICAgICAgIGZvdW5kVXNlck5hbWUgPSBmb3VuZFVzZXIuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICA
 gICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gZm91bmRVc2VyTmFtZToiLC
 Bmb3VuZFVzZXJOYW1lDQogICAgDQogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFsc
 yh1c2VyTmFtZSwgZm91bmRVc2VyTmFtZSk6DQogICAgICAgICAgICAgICAgICAgIHBvc3RMb2dpblJl
 c3VsdCA9IHNlbGYuZXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmb3V
 uZFVzZXIpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3
 Igc3RlcCAyLiBwb3N0TG9naW5SZXN1bHQ6IiwgcG9zdExvZ2luUmVzdWx0DQogICAgDQogICAgICAgI
 CAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCiAgICAgICAgDQogICAgICAgICAgICBy
 ZXR1cm4gRmFsc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICA
 gZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UG
 FyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRle
 HQoKQ0KICAgICAgICBhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW50aWNhdGlvblNlcnZpY2Uu
 aW5zdGFuY2UoKQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkd
 vb2dsZSsgUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBjdXJyZW
 50Q2xpZW50U2VjcmV0cyA9IHNlbGYuZ2V0Q3VycmVudENsaWVudFNlY3JldHMoc2VsZi5jbGllbnRTZ
 WNyZXRzLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAg
 ICAgICBpZiAoY3VycmVudENsaWVudFNlY3JldHMgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcHJ
 pbnQgIkdvb2dsZSsgUHJlcGFyZSBmb3Igc3RlcCAxLiBHb29nbGUrIGNsaWVudCBjb25maWd1cmF0aW
 9uIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICANC
 iAgICAgICAgICAgIGNvbnRleHQuc2V0KCJncGx1c19jbGllbnRfaWQiLCBjdXJyZW50Q2xpZW50U2Vj
 cmV0c1sid2ViIl1bImNsaWVudF9pZCJdKQ0KICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2N
 saWVudF9zZWNyZXQiLCBjdXJyZW50Q2xpZW50U2VjcmV0c1sid2ViIl1bImNsaWVudF9zZWNyZXQiXS
 kNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgI
 CAgICAgICAgIHByaW50ICJHb29nbGUrIFByZXBhcmUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAg
 cmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICA
 gZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZX
 MsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHJldHVybiBBcnJhe
 XMuYXNMaXN0KCJncGx1c191c2VyX3VpZCIpDQoNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRl
 ZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 pOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaW
 YgKGNvbnRleHQuaXNTZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBzIikpOg0KICAgICAgICAgICAgc
 mV0dXJuIGNvbnRleHQuZ2V0KCJncGx1c19jb3VudF9sb2dpbl9zdGVwcyIpDQogICAgICAgIA0KICAg
 ICAgICByZXR1cm4gMg0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICByZX
 R1cm4gIi9hdXRoL2dwbHVzL2dwbHVzbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIvYXV0a
 C9ncGx1cy9ncGx1c3Bvc3Rsb2dpbi54aHRtbCINCg0KICAgIGRlZiBsb2dvdXQoc2VsZiwgY29uZmln
 dXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgIyBUT0RPIFJldm9
 rZSB0b2tlbg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGxvYWRDbGllbnRTZWNyZXRzKH
 NlbGYsIGNsaWVudFNlY3JldHNGaWxlKToNCiAgICAgICAgY2xpZW50U2VjcmV0cyA9IE5vbmUNCg0KI
 CAgICAgICAjIExvYWQgY2VydGlmaWNhdGUgZnJvbSBmaWxlDQogICAgICAgIGYgPSBvcGVuKGNsaWVu
 dFNlY3JldHNGaWxlLCAncicpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGNsaWVudFNlY3JldHM
 gPSBqc29uLmxvYWRzKGYucmVhZCgpKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludC
 AiRmFpbGVkIHRvIGxvYWQgR29vZ2xlKyBjbGllbnQgc2VjcmV0cyBmcm9tIGZpbGU6IiwgY2xpZW50U
 2VjcmV0cw0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgZmluYWxseToNCiAgICAgICAg
 ICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGNsaWVudFNlY3JldHMNCg0KICA
 gIGRlZiBnZXRDbGllbnRDb25maWd1cmF0aW9uKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLC
 ByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgICMgR2V0IGNsaWVudCBjb25maWd1cmF0aW9uDQogI
 CAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZ3BsdXNfY2xpZW50
 X2NvbmZpZ3VyYXRpb25fYXR0cmlidXRlIikpOg0KICAgICAgICAgICAgY2xpZW50Q29uZmlndXJhdGl
 vbkF0dHJpYnV0ZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiZ3BsdXNfY2xpZW50X2Nvbm
 ZpZ3VyYXRpb25fYXR0cmlidXRlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgICAgIHByaW50ICJHb29nb
 GUrIEdldENsaWVudENvbmZpZ3VyYXRpb24uIFVzaW5nIGNsaWVudCBhdHRyaWJ1dGU6IiwgY2xpZW50
 Q29uZmlndXJhdGlvbkF0dHJpYnV0ZQ0KDQogICAgICAgICAgICBpZiAocmVxdWVzdFBhcmFtZXRlcnM
 gPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW
 50SWQgPSBOb25lDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgQXR0ZW1wdCB0byBkZXRlcm1pb
 mUgY2xpZW50X2lkIGZyb20gcmVxdWVzdA0KICAgICAgICAgICAgY2xpZW50SWRBcnJheSA9IHJlcXVl
 c3RQYXJhbWV0ZXJzLmdldCgiY2xpZW50X2lkIikNCiAgICAgICAgICAgIGlmIChBcnJheUhlbHBlci5
 pc05vdEVtcHR5KGNsaWVudElkQXJyYXkpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZy
 hjbGllbnRJZEFycmF5WzBdKSk6DQogICAgICAgICAgICAgICAgY2xpZW50SWQgPSBjbGllbnRJZEFyc
 mF5WzBdDQoNCiAgICAgICAgICAgICMgQXR0ZW1wdCB0byBkZXRlcm1pbmUgY2xpZW50X2lkIGZyb20g
 ZXZlbnQgY29udGV4dA0KICAgICAgICAgICAgaWYgKGNsaWVudElkID09IE5vbmUpOg0KICAgICAgICA
 gICAgICAgIGV2ZW50Q29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIC
 AgICAgICAgaWYgKGV2ZW50Q29udGV4dC5pc1NldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKSk6DQogICAgI
 CAgICAgICAgICAgICAgIGNsaWVudElkID0gZXZlbnRDb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0
 ZXMiKS5nZXQoImNsaWVudF9pZCIpDQoNCiAgICAgICAgICAgIGlmIChjbGllbnRJZCA9PSBOb25lKTo
 NCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBjbG
 llbnRfaWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgI
 CAgY2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgY2xp
 ZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZW50SWQpDQogICAgICAgICAgICBpZiAoY2x
 pZW50ID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEdldENsaWVudENvbm
 ZpZ3VyYXRpb24uIEZhaWxlZCB0byBmaW5kIGNsaWVudCIsIGNsaWVudElkLCAiIGluIGxvY2FsIExEQ
 VAiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW50Q29uZmln
 dXJhdGlvbiA9IGNsaWVudFNlcnZpY2UuZ2V0Q3VzdG9tQXR0cmlidXRlKGNsaWVudCwgY2xpZW50Q29
 uZmlndXJhdGlvbkF0dHJpYnV0ZSkNCiAgICAgICAgICAgIGlmICgoY2xpZW50Q29uZmlndXJhdGlvbi
 A9PSBOb25lKSBvciBTdHJpbmdIZWxwZXIuaXNFbXB0eShjbGllbnRDb25maWd1cmF0aW9uLmdldFZhb
 HVlKCkpKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0
 aW9uLiBDbGllbnQiLCBjbGllbnRJZCwgIiBhdHRyaWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR
 0cmlidXRlLCAiIGlzIGVtcHR5Ig0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcm
 ludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBDbGllbnQiLCBjbGllbnRJZCwgIiBhd
 HRyaWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR0cmlidXRlLCAiIGlzIiwgY2xpZW50Q29uZmln
 dXJhdGlvbg0KICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnRDb25maWd1cmF0aW9uDQoNCiAgICA
 gICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDdXJyZW50Q2xpZW50U2VjcmV0cyhzZWxmLCBjdX
 JyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0Z
 XJzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJh
 dGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgIGl
 mIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbn
 RDbGllbnRTZWNyZXRzDQogICAgICAgIA0KICAgICAgICBjbGllbnRDb25maWd1cmF0aW9uVmFsdWUgP
 SBqc29uLmxvYWRzKGNsaWVudENvbmZpZ3VyYXRpb24uZ2V0VmFsdWUoKSkNCg0KICAgICAgICByZXR1
 cm4gY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJncGx1cyJdDQoNCiAgICBkZWYgZ2V0Q3VycmVudEF
 0dHJpYnV0ZXNNYXBwaW5nKHNlbGYsIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZywgY29uZmlndXJhdG
 lvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhd
 GlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywg
 cmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgIGlmIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmU
 pOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZw0KDQogICAgICAgIG
 NsaWVudENvbmZpZ3VyYXRpb25WYWx1ZSA9IGpzb24ubG9hZHMoY2xpZW50Q29uZmlndXJhdGlvbi5nZ
 XRWYWx1ZSgpKQ0KDQogICAgICAgIGNsaWVudEF0dHJpYnV0ZXNNYXBwaW5nID0gc2VsZi5wcmVwYXJl
 QXR0cmlidXRlc01hcHBpbmcoY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJncGx1c19yZW1vdGVfYXR
 0cmlidXRlc19saXN0Il0sIGNsaWVudENvbmZpZ3VyYXRpb25WYWx1ZVsiZ3BsdXNfbG9jYWxfYXR0cm
 lidXRlc19saXN0Il0pDQogICAgICAgIGlmIChjbGllbnRBdHRyaWJ1dGVzTWFwcGluZyA9PSBOb25lK
 ToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEdldEN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZy4g
 Q2xpZW50IGF0dHJpYnV0ZXMgbWFwcGluZyBpcyBpbnZhbGlkLiBVc2luZyBkZWZhdWx0IG9uZSINCiA
 gICAgICAgICAgIHJldHVybiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICByZXR1cm
 4gY2xpZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgIGRlZiBwcmVwYXJlQXR0cmlidXRlc01hcHBpb
 mcoc2VsZiwgcmVtb3RlQXR0cmlidXRlc0xpc3QsIGxvY2FsQXR0cmlidXRlc0xpc3QpOg0KICAgICAg
 ICByZW1vdGVBdHRyaWJ1dGVzTGlzdEFycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KHJlbW90ZUF0dHJ
 pYnV0ZXNMaXN0LCAiLCIpDQogICAgICAgIGlmIChBcnJheUhlbHBlci5pc0VtcHR5KHJlbW90ZUF0dH
 JpYnV0ZXNMaXN0QXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIFByZXBhcmVBdHRya
 WJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gYXR0cmlidXRlcyBzcGVjaWZpZWQgaW4gcmVtb3RlQXR0
 cmlidXRlc0xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiA
 gICAgICAgbG9jYWxBdHRyaWJ1dGVzTGlzdEFycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KGxvY2FsQX
 R0cmlidXRlc0xpc3QsICIsIikNCiAgICAgICAgaWYgKEFycmF5SGVscGVyLmlzRW1wdHkobG9jYWxBd
 HRyaWJ1dGVzTGlzdEFycmF5KSk6DQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQcmVwYXJlQXR0
 cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIGF0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIGxvY2FsQXR
 0cmlidXRlc0xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIG
 lmIChsZW4ocmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkgIT0gbGVuKGxvY2FsQXR0cmlidXRlc0xpc
 3RBcnJheSkpOg0KICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUHJlcGFyZUF0dHJpYnV0ZXNNYXBw
 aW5nLiBUaGUgbnVtYmVyIG9mIGF0dHJpYnV0ZXMgaW4gcmVtb3RlQXR0cmlidXRlc0xpc3QgYW5kIGx
 vY2FsQXR0cmlidXRlc0xpc3QgaXNuJ3QgZXF1YWwiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KIC
 AgICAgICANCiAgICAgICAgYXR0cmlidXRlTWFwcGluZyA9IElkZW50aXR5SGFzaE1hcCgpDQogICAgI
 CAgIGNvbnRhaW5zVWlkID0gRmFsc2UNCiAgICAgICAgaSA9IDANCiAgICAgICAgY291bnQgPSBsZW4o
 cmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkNCiAgICAgICAgd2hpbGUgKGkgPCBjb3VudCk6DQogICA
 gICAgICAgICByZW1vdGVBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2UocmVtb3RlQX
 R0cmlidXRlc0xpc3RBcnJheVtpXSkNCiAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlID0gU3RyaW5nS
 GVscGVyLnRvTG93ZXJDYXNlKGxvY2FsQXR0cmlidXRlc0xpc3RBcnJheVtpXSkNCiAgICAgICAgICAg
 IGF0dHJpYnV0ZU1hcHBpbmcucHV0KHJlbW90ZUF0dHJpYnV0ZSwgbG9jYWxBdHRyaWJ1dGUpDQoNCiA
 gICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShsb2NhbEF0dHJpYnV0ZS
 wgInVpZCIpKToNCiAgICAgICAgICAgICAgICBjb250YWluc1VpZCA9IFRydWUNCg0KICAgICAgICAgI
 CAgaSA9IGkgKyAxDQoNCiAgICAgICAgaWYgKG5vdCBjb250YWluc1VpZCk6DQogICAgICAgICAgICBw
 cmludCAiR29vZ2xlKyBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIG1hcHBpbmc
 gdG8gbWFuZGF0b3J5ICd1aWQnIGF0dHJpYnV0ZSINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogIC
 AgICAgIA0KICAgICAgICByZXR1cm4gYXR0cmlidXRlTWFwcGluZw0KDQogICAgZGVmIGdldFRva2Vuc
 0J5Q29kZShzZWxmLCBjdXJyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMs
 IGNvZGUpOg0KICAgICAgICB0b2tlblJlcXVlc3QgPSBUb2tlblJlcXVlc3QoR3JhbnRUeXBlLkNMSUV
 OVF9DUkVERU5USUFMUykNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhlbnRpY2F0aW9uTWV0aG
 9kKEF1dGhlbnRpY2F0aW9uTWV0aG9kLkNMSUVOVF9TRUNSRVRfUE9TVCkNCiAgICAgICAgdG9rZW5SZ
 XF1ZXN0LnNldENvZGUoY29kZSkNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhVc2VybmFtZShj
 dXJyZW50Q2xpZW50U2VjcmV0c1sid2ViIl1bImNsaWVudF9pZCJdKQ0KICAgICAgICB0b2tlblJlcXV
 lc3Quc2V0QXV0aFBhc3N3b3JkKGN1cnJlbnRDbGllbnRTZWNyZXRzWyJ3ZWIiXVsiY2xpZW50X3NlY3
 JldCJdKQ0KICAgICAgICB0b2tlblJlcXVlc3Quc2V0UmVkaXJlY3RVcmkoInBvc3RtZXNzYWdlIikNC
 iAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEdyYW50VHlwZShHcmFudFR5cGUuQVVUSE9SSVpBVElPTl9D
 T0RFKQ0KDQogICAgICAgIHRva2VuQ2xpZW50ID0gVG9rZW5DbGllbnQoY3VycmVudENsaWVudFNlY3J
 ldHNbIndlYiJdWyJ0b2tlbl91cmkiXSkNCiAgICAgICAgdG9rZW5DbGllbnQuc2V0UmVxdWVzdCh0b2
 tlblJlcXVlc3QpDQogICAgICAgIA0KICAgICAgICB0b2tlblJlc3BvbnNlID0gdG9rZW5DbGllbnQuZ
 XhlYygpDQogICAgICAgIGlmICgodG9rZW5SZXNwb25zZSA9PSBOb25lKSBvciAodG9rZW5SZXNwb25z
 ZS5nZXRTdGF0dXMoKSAhPSAyMDApKToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICA
 gcmV0dXJuIHRva2VuUmVzcG9uc2UNCg0KICAgIGRlZiBnZXRVc2VySW5mbyhzZWxmLCBjdXJyZW50Q2
 xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGFjY2Vzc1Rva2VuKToNCiAgICAgI
 CAgdXNlckluZm9DbGllbnQgPSBVc2VySW5mb0NsaWVudCgiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5j
 b20vcGx1cy92MS9wZW9wbGUvbWUvb3BlbklkQ29ubmVjdCIpDQoNCiAgICAgICAgdXNlckluZm9SZXN
 wb25zZSA9IHVzZXJJbmZvQ2xpZW50LmV4ZWNVc2VySW5mbyhhY2Nlc3NUb2tlbikNCiAgICAgICAgaW
 YgKCh1c2VySW5mb1Jlc3BvbnNlID09IE5vbmUpIG9yICh1c2VySW5mb1Jlc3BvbnNlLmdldFN0YXR1c
 ygpICE9IDIwMCkpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICByZXR1cm4gdXNl
 ckluZm9SZXNwb25zZQ0KDQogICAgZGVmIGV4dGVuc2lvblBvc3RMb2dpbihzZWxmLCBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcywgdXNlcik6DQogICAgICAgIGlmIChzZWxmLmV4dGVuc2lvbk1vZHVsZSAhPS
 BOb25lKToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBwb3N0TG9naW5SZXN1bHQgP
 SBzZWxmLmV4dGVuc2lvbk1vZHVsZS5wb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHVz
 ZXIpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUG9zdExvZ2luIHJlc3VsdDoiLCBwb3N
 0TG9naW5SZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCiAgIC
 AgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nb
 GUrIFBvc3RMb2dpbi4gRmFpbGVkIHRvIGV4ZWN1dGUgcG9zdExvZ2luIG1ldGhvZCINCiAgICAgICAg
 ICAgICAgICBwcmludCAiR29vZ2xlKyBQb3N0TG9naW4uIFVuZXhwZWN0ZWQgZXJyb3I6IiwgZXgNCiA
 gICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgIGV4Y2VwdCBqYXZhLmxhbmcuVG
 hyb3dhYmxlLCBleDoNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQb3N0TG9naW4uIEZha
 WxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAgICAgICAgICAgZXgucHJpbnRT
 dGFja1RyYWNlKCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgICA
 gICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!D40C.1CA3,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Saml authentication module
displayName: saml
gluuStatus: false
inum: %(inumOrg)s!0011!D40C.1CA3
oxConfigurationProperty: {"value1":"saml_certificate_file","value2":"/etc/ce
 rts/saml.pem","description":""}
oxConfigurationProperty: {"value1":"saml_deployment_type","value2":"enroll",
 "description":""}
oxConfigurationProperty: {"value1":"saml_idp_attributes_list","value2":"http
 ://schemas.xmlsoap.org/ws/2005/05/identity/claims/name, http://schemas.xmls
 oap.org/ws/2005/05/identity/claims/emailaddress, http://schemas.xmlsoap.org
 /ws/2005/05/identity/claims/givenname, http://schemas.xmlsoap.org/ws/2005/0
 5/identity/claims/surname, http://schemas.xmlsoap.org/ws/2005/05/identity/c
 laims/surname","description":""}
oxConfigurationProperty: {"value1":"saml_local_attributes_list","value2":"ui
 d, mail, givenName, sn, cn","description":""}
oxConfigurationProperty: {"value1":"saml_name_identifier_format","value2":"u
 rn:oasis:names:tc:SAML:2.0:nameid-format:persistent","description":""}
oxConfigurationProperty: {"value1":"saml_use_authn_context","value2":"true",
 "description":""}
oxConfigurationProperty: {"value1":"saml_validate_response","value2":"true",
 "description":""}
oxConfigurationProperty: {"value1":"saml_idp_sso_target_url","value2":"https
 ://idp.gluu.info/idp/profile/SAML2/Redirect/SSO","description":""}
oxConfigurationProperty: {"value1":"saml_issuer","value2":"https://sp.gluu.i
 nfo/shibboleth","description":""}
oxLevel: 50
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4d
 HMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIGphdmF4
 LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3R
 vbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3
 JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIENsaWVudFNlcnZpY2UsIEF1d
 GhlbnRpY2F0aW9uU2VydmljZSwgQXR0cmlidXRlU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5z
 ZXJ2aWNlLm5ldCBpbXBvcnQgSHR0cFNlcnZpY2UNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJ
 pbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJheUhlbHBlcg0KZnJvbSBvcmcuZ2
 x1dS5zYW1sIGltcG9ydCBTYW1sQ29uZmlndXJhdGlvbiwgQXV0aFJlcXVlc3QsIFJlc3BvbnNlDQpmc
 m9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QsIEhhc2hNYXAsIElkZW50aXR5SGFz
 aE1hcA0KZnJvbSBvcmcueGRpLm94YXV0aC5tb2RlbC5jb21tb24gaW1wb3J0IFVzZXINCmZyb20gb3J
 nLnhkaS5sZGFwLm1vZGVsIGltcG9ydCBDdXN0b21BdHRyaWJ1dGUNCg0KaW1wb3J0IGphdmENCg0KdH
 J5Og0KICAgIGltcG9ydCBqc29uDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgaW1wb3J0IHNpbXBsZ
 Wpzb24gYXMganNvbg0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNh
 dGlvblR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICA
 gICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIG
 luaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2FtbC4gS
 W5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgc2FtbF9jZXJ0aWZpY2F0ZV9maWxlID0gY29uZmlndXJh
 dGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2NlcnRpZmljYXRlX2ZpbGUiKS5nZXRWYWx1ZTIoKQ0KICA
 gICAgICBzYW1sX2lkcF9zc29fdGFyZ2V0X3VybCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldC
 gic2FtbF9pZHBfc3NvX3RhcmdldF91cmwiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBzYW1sX2lzc3Vlc
 iA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2FtbF9pc3N1ZXIiKS5nZXRWYWx1ZTIoKQ0K
 ICAgICAgICBzYW1sX3VzZV9hdXRobl9jb250ZXh0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25
 maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfdXNlX2F1dGhuX2NvbnRleHQiKS5nZXRWYWx1ZT
 IoKSwgVHJ1ZSkNCiAgICAgICAgaWYgKHNhbWxfdXNlX2F1dGhuX2NvbnRleHQpOg0KICAgICAgICAgI
 CAgc2FtbF9uYW1lX2lkZW50aWZpZXJfZm9ybWF0ID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0
 KCJzYW1sX25hbWVfaWRlbnRpZmllcl9mb3JtYXQiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBlbHNlOg0
 KICAgICAgICAgICAgc2FtbF9uYW1lX2lkZW50aWZpZXJfZm9ybWF0ID0gTm9uZQ0KDQogICAgICAgIH
 NhbWxfY2VydGlmaWNhdGUgPSBzZWxmLmxvYWRDZXJpdGlmaWNhdGUoc2FtbF9jZXJ0aWZpY2F0ZV9ma
 WxlKQ0KICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkoc2FtbF9jZXJ0aWZpY2F0ZSkpOg0K
 ICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBGaWxlIHdpdGggeDUwOSBjZXJ
 0aWZpY2F0ZSBzaG91bGQgYmUgbm90IGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgc2FtbENvbmZpZ3VyYXRpb24gPSBTYW1sQ29uZmlndXJhdGlvbigpDQoNCiAgICAgICAgI
 yBTZXQgdGhlIGlzc3VlciBvZiB0aGUgYXV0aGVudGljYXRpb24gcmVxdWVzdC4gVGhpcyB3b3VsZCB1
 c3VhbGx5IGJlIHRoZSBVUkwgb2YgdGhlIGlzc3Vpbmcgd2ViIGFwcGxpY2F0aW9uDQogICAgICAgIHN
 hbWxDb25maWd1cmF0aW9uLnNldElzc3VlcihzYW1sX2lzc3VlcikNCg0KICAgICAgICAjIFRlbGxzIH
 RoZSBJZFAgdG8gcmV0dXJuIGEgcGVyc2lzdGVudCBpZGVudGlmaWVyIGZvciB0aGUgdXNlcg0KICAgI
 CAgICBzYW1sQ29uZmlndXJhdGlvbi5zZXROYW1lSWRlbnRpZmllckZvcm1hdChzYW1sX25hbWVfaWRl
 bnRpZmllcl9mb3JtYXQpDQogIA0KICAgICAgICAjIFRoZSBVUkwgYXQgdGhlIElkZW50aXR5IFByb3Z
 pZGVyIHdoZXJlIHRvIHRoZSBhdXRoZW50aWNhdGlvbiByZXF1ZXN0IHNob3VsZCBiZSBzZW50DQogIC
 AgICAgIHNhbWxDb25maWd1cmF0aW9uLnNldElkcFNzb1RhcmdldFVybChzYW1sX2lkcF9zc29fdGFyZ
 2V0X3VybCkNCg0KICAgICAgICAjIEVuYWJsZWRpYWJsZSBSZXF1ZXN0ZWRBdXRobkNvbnRleHQNCiAg
 ICAgICAgc2FtbENvbmZpZ3VyYXRpb24uc2V0VXNlUmVxdWVzdGVkQXV0aG5Db250ZXh0KHNhbWxfdXN
 lX2F1dGhuX2NvbnRleHQpDQogICAgICAgIA0KICAgICAgICAjIExvYWQgeDUwOSBjZXJ0aWZpY2F0ZQ
 0KICAgICAgICBzYW1sQ29uZmlndXJhdGlvbi5sb2FkQ2VydGlmaWNhdGVGcm9tU3RyaW5nKHNhbWxfY
 2VydGlmaWNhdGUpDQogICAgICAgIA0KICAgICAgICBzZWxmLnNhbWxDb25maWd1cmF0aW9uID0gc2Ft
 bENvbmZpZ3VyYXRpb24NCg0KICAgICAgICBzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nID0gTm9uZQ0KICA
 gICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfaWRwX2F0dH
 JpYnV0ZXNfbGlzdCIpIGFuZA0KICAgICAgICAgICAgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29ud
 GFpbnNLZXkoInNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IikpOg0KDQogICAgICAgICAgICBzYW1s
 X2lkcF9hdHRyaWJ1dGVzX2xpc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfaWR
 wX2F0dHJpYnV0ZXNfbGlzdCIpLmdldFZhbHVlMigpDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscG
 VyLmlzRW1wdHkoc2FtbF9pZHBfYXR0cmlidXRlc19saXN0KSk6DQogICAgICAgICAgICAgICAgcHJpb
 nQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgc2FtbF9pZHBfYXR0cmlidXRlc19s
 aXN0IGlzIGVtcHR5Ig0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICB
 zYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2
 FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgaWYgKFN0c
 mluZ0hlbHBlci5pc0VtcHR5KHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0KSk6DQogICAgICAgICAg
 ICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgc2FtbF9sb2NhbF9
 hdHRyaWJ1dGVzX2xpc3QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgICAgIHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLnByZXBhcmVBdHRyaWJ1dGVzT
 WFwcGluZyhzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QsIHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0
 KQ0KICAgICAgICAgICAgaWYgKHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPT0gTm9uZSk6DQogICAgICA
 gICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBUaGUgYXR0cmlidXRlcyBtYXBwaW
 5nIGlzbid0IHZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHNlb
 GYuc2FtbEV4dGVuc2lvbk1vZHVsZSA9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzLmNvbnRhaW5zS2V5KCJzYW1sX2V4dGVuc2lvbl9tb2R1bGUiKSk6DQogICAgICAgICAgICB
 zYW1sX2V4dGVuc2lvbl9tb2R1bGVfbmFtZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2
 FtbF9leHRlbnNpb25fbW9kdWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgICAgIHRyeToNCiAgICAgI
 CAgICAgICAgICBzZWxmLnNhbWxFeHRlbnNpb25Nb2R1bGUgPSBfX2ltcG9ydF9fKHNhbWxfZXh0ZW5z
 aW9uX21vZHVsZV9uYW1lKQ0KICAgICAgICAgICAgICAgIHNhbWxfZXh0ZW5zaW9uX21vZHVsZV9pbml
 0X3Jlc3VsdCA9IHNlbGYuc2FtbEV4dGVuc2lvbk1vZHVsZS5pbml0KGNvbmZpZ3VyYXRpb25BdHRyaW
 J1dGVzKQ0KICAgICAgICAgICAgICAgIGlmIChub3Qgc2FtbF9leHRlbnNpb25fbW9kdWxlX2luaXRfc
 mVzdWx0KToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICBleGNl
 cHQgSW1wb3J0RXJyb3IsIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBJbml0aWFsaXp
 hdGlvbi4gRmFpbGVkIHRvIGxvYWQgc2FtbF9leHRlbnNpb25fbW9kdWxlOiIsIHNhbWxfZXh0ZW5zaW
 9uX21vZHVsZV9uYW1lDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uL
 iBVbmV4cGVjdGVkIGVycm9yOiIsIGV4DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAg
 ICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJ
 uIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKT
 oNCiAgICAgICAgcHJpbnQgIlNhbWwuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJTYW1sLiBEZXN0c
 m95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZl
 cnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgaXNWYWxpZEF1dGhlbnRpY2F
 0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgIC
 AgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFsdGVybmF0aXZlQXV0aGVudGljYXRpb25NZXRob
 2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVy
 biBOb25lDQoNCiAgICBkZWYgYXV0aGVudGljYXRlKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGV
 zLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZX
 RFdmVudENvbnRleHQoKQ0KICAgICAgICBhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW50aWNhd
 GlvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmlu
 c3RhbmNlKCkNCg0KICAgICAgICBzYW1sX21hcF91c2VyID0gRmFsc2UNCiAgICAgICAgc2FtbF9lbnJ
 vbGxfdXNlciA9IEZhbHNlDQogICAgICAgIHNhbWxfZW5yb2xsX2FsbF91c2VyX2F0dHIgPSBGYWxzZQ
 0KICAgICAgICAjIFVzZSBzYW1sX2RlcGxveW1lbnRfdHlwZSBvbmx5IGlmIHRoZXJlIGlzIG5vIGF0d
 HJpYnV0ZXMgbWFwcGluZw0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFp
 bnNLZXkoInNhbWxfZGVwbG95bWVudF90eXBlIikpOg0KICAgICAgICAgICAgc2FtbF9kZXBsb3ltZW5
 0X3R5cGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2UoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2
 V0KCJzYW1sX2RlcGxveW1lbnRfdHlwZSIpLmdldFZhbHVlMigpKQ0KICAgICAgICAgICAgDQogICAgI
 CAgICAgICBpZiAoU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2Uoc2FtbF9kZXBsb3ltZW50X3R5
 cGUsICJtYXAiKSk6DQogICAgICAgICAgICAgICAgc2FtbF9tYXBfdXNlciA9IFRydWUNCg0KICAgICA
 gICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKHNhbWxfZGVwbG95bWVudF90eX
 BlLCAiZW5yb2xsIikpOg0KICAgICAgICAgICAgICAgIHNhbWxfZW5yb2xsX3VzZXIgPSBUcnVlDQoNC
 iAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShzYW1sX2RlcGxveW1l
 bnRfdHlwZSwgImVucm9sbF9hbGxfYXR0ciIpKToNCiAgICAgICAgICAgICAgICBzYW1sX2Vucm9sbF9
 hbGxfdXNlcl9hdHRyID0gVHJ1ZQ0KDQogICAgICAgIHNhbWxfYWxsb3dfYmFzaWNfbG9naW4gPSBGYW
 xzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfY
 Wxsb3dfYmFzaWNfbG9naW4iKSk6DQogICAgICAgICAgICBzYW1sX2FsbG93X2Jhc2ljX2xvZ2luID0g
 U3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfYWx
 sb3dfYmFzaWNfbG9naW4iKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQoNCiAgICAgICAgdXNlX2Jhc2ljX2
 F1dGggPSBGYWxzZQ0KICAgICAgICBpZiAoc2FtbF9hbGxvd19iYXNpY19sb2dpbik6DQogICAgICAgI
 CAgICAjIERldGVjdCBpZiB1c2VyIHVzZWQgYmFzaWMgYXV0aG5ldGljYXRpb24gbWV0aG9kDQogICAg
 ICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0
 KDQogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgIC
 AgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KICAgICAgICAgI
 CAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5p
 c05vdEVtcHR5KHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c2VfYmFzaWNfYXV0aCA
 9IFRydWUNCg0KICAgICAgICBpZiAoKHN0ZXAgPT0gMSkgYW5kIHNhbWxfYWxsb3dfYmFzaWNfbG9naW
 4gYW5kIHVzZV9iYXNpY19hdXRoKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhd
 GUgZm9yIHN0ZXAgMS4gQmFzaWMgYXV0aGVudGljYXRpb24iDQoNCiAgICAgICAgICAgIGNvbnRleHQu
 c2V0KCJzYW1sX2NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHM
 gPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXJfbm
 FtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgP
 SBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQoNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNl
 DQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSB
 hbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgIC
 AgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgI
 CAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFz
 c3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgICB
 yZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICBpZiAoc3RlcC
 A9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINC
 g0KICAgICAgICAgICAgY3VycmVudFNhbWxDb25maWd1cmF0aW9uID0gc2VsZi5nZXRDdXJyZW50U2Ft
 bENvbmZpZ3VyYXRpb24oc2VsZi5zYW1sQ29uZmlndXJhdGlvbiwgY29uZmlndXJhdGlvbkF0dHJpYnV
 0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKQ0KICAgICAgICAgICAgaWYgKGN1cnJlbnRTYW1sQ29uZmlndX
 JhdGlvbiA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gUHJlcGFyZSBmb3Igc
 3RlcCAxLiBDbGllbnQgc2FtbCBjb25maWd1cmF0aW9uIGlzIGludmFsaWQiDQogICAgICAgICAgICAg
 ICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHNhbWxfcmVzcG9uc2VfYXJyYXkgPSByZXF1ZXN
 0UGFyYW1ldGVycy5nZXQoIlNBTUxSZXNwb25zZSIpDQogICAgICAgICAgICBpZiBBcnJheUhlbHBlci
 5pc0VtcHR5KHNhbWxfcmVzcG9uc2VfYXJyYXkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sL
 iBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gc2FtbF9yZXNwb25zZSBpcyBlbXB0eSINCiAgICAgICAg
 ICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2FtbF9yZXNwb25zZSA9IHNhbWxfcmV
 zcG9uc2VfYXJyYXlbMF0NCg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3
 Igc3RlcCAxLiBzYW1sX3Jlc3BvbnNlOiIsIHNhbWxfcmVzcG9uc2UNCg0KICAgICAgICAgICAgc2Ftb
 FJlc3BvbnNlID0gUmVzcG9uc2UoY3VycmVudFNhbWxDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAg
 c2FtbFJlc3BvbnNlLmxvYWRYbWxGcm9tQmFzZTY0KHNhbWxfcmVzcG9uc2UpDQogICAgICAgICAgICA
 NCiAgICAgICAgICAgIHNhbWxfdmFsaWRhdGVfcmVzcG9uc2UgPSBUcnVlDQogICAgICAgICAgICBpZi
 AoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfdmFsaWRhdGVfcmVzcG9uc
 2UiKSk6DQogICAgICAgICAgICAgICAgc2FtbF92YWxpZGF0ZV9yZXNwb25zZSA9IFN0cmluZ0hlbHBl
 ci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX3ZhbGlkYXRlX3Jlc3B
 vbnNlIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAgICAgICBpZiAoc2FtbF92YWxpZGF0ZV
 9yZXNwb25zZSk6DQogICAgICAgICAgICAgICAgaWYgKG5vdCBzYW1sUmVzcG9uc2UuaXNWYWxpZCgpK
 ToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAx
 LiBzYW1sX3Jlc3BvbnNlIGlzbid0IHZhbGlkIg0KDQogICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX25
 hbWVfaWQgPSBzYW1sUmVzcG9uc2UuZ2V0TmFtZUlkKCkNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZW
 xwZXIuaXNFbXB0eShzYW1sX3Jlc3BvbnNlX25hbWVfaWQpKToNCiAgICAgICAgICAgICAgICBwcmlud
 CAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHNhbWxfcmVzcG9uc2VfbmFtZV9pZCBpcyBp
 bnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBwcmludCA
 iU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHNhbWxfcmVzcG9uc2VfbmFtZV9pZDoiLCBzYW
 1sX3Jlc3BvbnNlX25hbWVfaWQNCg0KICAgICAgICAgICAgc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVzI
 D0gc2FtbFJlc3BvbnNlLmdldEF0dHJpYnV0ZXMoKQ0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBhdHRyaWJ1dGVzOiAiLCBzYW1sX3Jlc3BvbnNlX2F0dHJpYnV
 0ZXMNCg0KICAgICAgICAgICAgIyBVc2UgcGVyc2lzdGVudCBJZCBhcyBzYW1sX3VzZXJfdWlkDQogIC
 AgICAgICAgICBzYW1sX3VzZXJfdWlkID0gc2FtbF9yZXNwb25zZV9uYW1lX2lkDQogICAgICAgICAgI
 CANCiAgICAgICAgICAgIGlmIChzYW1sX21hcF91c2VyKToNCiAgICAgICAgICAgICAgICAjIFVzZSBt
 YXBwaW5nIHRvIGxvY2FsIElEUCB1c2VyDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVW
 lkOiBzYW1sOiIsIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlI
 GlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpbmRf
 dXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQ
 iLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZX
 JfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVud
 GljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBmaW5kIHVzZXIiDQogICAgICAgICAgICAgICAgICAg
 IHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB
 0byAyIg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic2FtbF9jb3VudF9sb2dpbl9zdG
 VwcyIsIDIpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzYW1sX3VzZXJfdWlkIiwgc
 2FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAg
 ICAgICAgIGZvdW5kX3VzZXJfbmFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICA
 gICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZX
 JfbmFtZToiLCBmb3VuZF91c2VyX25hbWUNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgI
 CB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZv
 dW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZ
 hbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3
 RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJld
 HVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICA
 gICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgIC
 AgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQg
 IlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2x
 vZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogIC
 AgICAgICAgICBlbGlmIChzYW1sX2Vucm9sbF91c2VyKToNCiAgICAgICAgICAgICAgICAjIFVzZSBhd
 XRvIGVucm9sbG1lbnQgdG8gbG9jYWwgSURQDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmF
 sVWlkOiBzYW1sOiIsIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdG
 hlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpb
 mRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxV
 aWQiLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3V
 zZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAjIEF1dG8gdXNlciBlbnJvbG
 xlbW50DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0Z
 XAgMS4gVGhlcmUgaXMgbm8gdXNlciBpbiBMREFQLiBBZGRpbmcgdXNlciB0byBsb2NhbCBMREFQIg0K
 DQogICAgICAgICAgICAgICAgICAgICMgQ29udmVydCBzYW1sIHJlc3VsdCBhdHRyaWJ1dGVzIGtleXM
 gdG8gbG92ZXIgY2FzZQ0KICAgICAgICAgICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZW
 RfYXR0cmlidXRlcyA9IEhhc2hNYXAoKQ0KICAgICAgICAgICAgICAgICAgICBmb3Igc2FtbF9yZXNwb
 25zZV9hdHRyaWJ1dGVfZW50cnkgaW4gc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVzLmVudHJ5U2V0KCk6
 DQogICAgICAgICAgICAgICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZWRfYXR0cmlidXR
 lcy5wdXQoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nSGVscGVyLnRvTG93ZXJDYX
 NlKHNhbWxfcmVzcG9uc2VfYXR0cmlidXRlX2VudHJ5LmdldEtleSgpKSwgc2FtbF9yZXNwb25zZV9hd
 HRyaWJ1dGVfZW50cnkuZ2V0VmFsdWUoKSkNCg0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXR0
 cmlidXRlc01hcHBpbmcgPSBzZWxmLnByZXBhcmVDdXJyZW50QXR0cmlidXRlc01hcHBpbmcoc2VsZi5
 hdHRyaWJ1dGVzTWFwcGluZywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZX
 JzKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwI
 DEuIFVzaW5nIG5leHQgYXR0cmlidXRlcyBtYXBwaW5nIiwgY3VycmVudEF0dHJpYnV0ZXNNYXBwaW5n
 DQoNCiAgICAgICAgICAgICAgICAgICAgbmV3VXNlciA9IFVzZXIoKQ0KICAgICAgICAgICAgICAgICA
 gICBmb3IgYXR0cmlidXRlc01hcHBpbmdFbnRyeSBpbiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcuZW
 50cnlTZXQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkcEF0dHJpYnV0ZSA9IGF0dHJpYnV0Z
 XNNYXBwaW5nRW50cnkuZ2V0S2V5KCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsQXR0cmli
 dXRlID0gYXR0cmlidXRlc01hcHBpbmdFbnRyeS5nZXRWYWx1ZSgpDQoNCiAgICAgICAgICAgICAgICA
 gICAgICAgIGxvY2FsQXR0cmlidXRlVmFsdWUgPSBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZWRfYXR0cm
 lidXRlcy5nZXQoaWRwQXR0cmlidXRlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsQ
 XR0cmlidXRlICE9IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1VzZXIuc2V0
 QXR0cmlidXRlKGxvY2FsQXR0cmlidXRlLCBsb2NhbEF0dHJpYnV0ZVZhbHVlKQ0KDQogICAgICAgICA
 gICAgICAgICAgIG5ld1VzZXIuc2V0QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgInNhbWw6IiArIH
 NhbWxfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhd
 GUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBhZGQgdXNlciIsIHNhbWxfdXNlcl91aWQsICIgd2l0
 aCBuZXh0IGF0dHJpYnV0ZXMiLCBuZXdVc2VyLmdldEN1c3RvbUF0dHJpYnV0ZXMoKQ0KDQogICAgICA
 gICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5hZGRVc2VyKG5ld1VzZX
 IsIFRydWUpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yI
 HN0ZXAgMS4gQWRkZWQgbmV3IHVzZXIgd2l0aCBVSUQiLCBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJ
 ZCgpDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmd
 ldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3
 RlcCAxLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgICAgICAgI
 CB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZv
 dW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZ
 hbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3
 RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJld
 HVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Ig
 c3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5
 zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdF9sb2
 dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2xvZ2luX3Jlc3VsdA0
 KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgICAgICBlbG
 lmIChzYW1sX2Vucm9sbF9hbGxfdXNlcl9hdHRyKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2Ftb
 C4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IG94RXh0
 ZXJuYWxVaWQ6IHNhbWw6IiArIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2s
 gaWYgdGhlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgIC
 AgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0Z
 XJuYWxVaWQiLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgICAgIGlmIChm
 aW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4
 gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBmaW5kIHVzZXIiDQoNCiAgICAgICAgIC
 AgICAgICAgICAgdXNlciA9IFVzZXIoKQ0KICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1d
 GVzID0gQXJyYXlMaXN0KCkNCiAgICAgICAgICAgICAgICAgICAgZm9yIGtleSBpbiBhdHRyaWJ1dGVz
 LmtleVNldCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgbGRhcEF0dHJpYnV0ZXMgPSBhdHRyaWJ
 1dGVTZXJ2aWNlLmdldEFsbEF0dHJpYnV0ZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG
 xkYXBBdHRyaWJ1dGUgaW4gbGRhcEF0dHJpYnV0ZXM6DQogICAgICAgICAgICAgICAgICAgICAgICAgI
 CAgc2FtbDJVcmkgPSBsZGFwQXR0cmlidXRlLmdldFNhbWwyVXJpKCkNCiAgICAgICAgICAgICAgICAg
 ICAgICAgICAgICBpZihzYW1sMlVyaSA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgICA
 gICAgICAgc2FtbDJVcmkgPSBhdHRyaWJ1dGVTZXJ2aWNlLmdldERlZmF1bHRTYW1sMlVyaShsZGFwQX
 R0cmlidXRlLmdldE5hbWUoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzYW1sMlVya
 SA9PSBrZXkpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBDdXN0
 b21BdHRyaWJ1dGUobGRhcEF0dHJpYnV0ZS5nZXROYW1lKCkpDQogICAgICAgICAgICAgICAgICAgICA
 gICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZXMoYXR0cmlidXRlcy5nZXQoa2V5KSkNCiAgICAgIC
 AgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tQXR0cmlidXRlcy5hZGQoYXR0cmlidXRlKQ0KD
 QogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IEN1c3RvbUF0dHJpYnV0ZSgib3hFeHRlcm5h
 bFVpZCIpDQogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZSgic2FtbDoiICsgc2F
 tbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgY3VzdG9tQXR0cmlidXRlcy5hZGQoYXR0cm
 lidXRlKQ0KICAgICAgICAgICAgICAgICAgICB1c2VyLnNldEN1c3RvbUF0dHJpYnV0ZXMoY3VzdG9tQ
 XR0cmlidXRlcykNCg0KICAgICAgICAgICAgICAgICAgICBpZih1c2VyLmdldEF0dHJpYnV0ZSgic24i
 KSA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IEN1c3RvbUF0dHJ
 pYnV0ZSgic24iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLnNldFZhbHVlKHNhbW
 xfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1dGVzLmFkZChhd
 HRyaWJ1dGUpDQoNCiAgICAgICAgICAgICAgICAgICAgaWYodXNlci5nZXRBdHRyaWJ1dGUoImNuIikg
 PT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBDdXN0b21BdHRyaWJ
 1dGUoImNuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZShzYW1sX3
 VzZXJfdWlkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tQXR0cmlidXRlcy5hZGQoYXR0c
 mlidXRlKQ0KDQogICAgICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2Vydmlj
 ZS5hZGRVc2VyKHVzZXIsIFRydWUpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXR
 oZW50aWNhdGUgZm9yIHN0ZXAgMS4gQWRkZWQgbmV3IHVzZXIgd2l0aCBVSUQiLCBmaW5kX3VzZXJfYn
 lfdWlkLmdldFVzZXJJZCgpDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX
 3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQoNCiA
 gICAgICAgICAgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYX
 V0aGVudGljYXRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZ
 W50aWNhdGVkID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICA
 gICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dG
 hlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgI
 CAgICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAg
 ICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZml
 ndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbn
 QgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X
 2xvZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQog
 ICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l
 0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdX
 RoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgdWlkOiIsIHNhb
 WxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2Vydmlj
 ZS5nZXRVc2VyKHNhbWxfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV9
 1aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdG
 UgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGZpbmQgdXNlciINCiAgICAgICAgICAgICAgICAgICAgcmV0d
 XJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlf
 dWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgIC
 AgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljY
 XRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVk
 ID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgIC
 AgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0Z
 SBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29u
 dGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9
 zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbk
 F0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuI
 EF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2xvZ2luX3Jl
 c3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgIGV
 saWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvci
 BzdGVwIDIiDQoNCiAgICAgICAgICAgIHNlc3Npb25BdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc
 3Npb25BdHRyaWJ1dGVzIikNCiAgICAgICAgICAgIGlmIChzZXNzaW9uQXR0cmlidXRlcyA9PSBOb25l
 KSBvciBub3Qgc2Vzc2lvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfdXNlcl91aWQiKToNCiA
 gICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIHNhbWxfdX
 Nlcl91aWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgI
 CAgIHNhbWxfdXNlcl91aWQgPSBzZXNzaW9uQXR0cmlidXRlcy5nZXQoInNhbWxfdXNlcl91aWQiKQ0K
 ICAgICAgICAgICAgcGFzc2VkX3N0ZXAxID0gU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcoc2F
 tbF91c2VyX3VpZCkNCiAgICAgICAgICAgIGlmIChub3QgcGFzc2VkX3N0ZXAxKToNCiAgICAgICAgIC
 AgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pb
 nN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRp
 YWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50aWFscy5
 nZXRQYXNzd29yZCgpDQoNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgIC
 BpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVsc
 GVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgIGxvZ2dl
 ZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQo
 NCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRm
 Fsc2UNCg0KICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdoaWNoIGhhcyBzYW1sX
 3VzZXJfdWlkDQogICAgICAgICAgICAjIEF2b2lkIG1hcHBpbmcgU2FtbCBhY2NvdW50IHRvIG1vcmUg
 dGhhbiBvbmUgSURQIGFjY291bnQNCiAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2V
 ydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAic2FtbDoiICsgc2FtbF91c2
 VyX3VpZCkNCg0KICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgI
 CAgICAgICAgICAgIyBBZGQgc2FtbF91c2VyX3VpZCB0byB1c2VyIG9uZSBpZCBVSURzDQogICAgICAg
 ICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmFkZFVzZXJBdHRyaWJ1dGUodXN
 lcl9uYW1lLCAib3hFeHRlcm5hbFVpZCIsICJzYW1sOiIgKyBzYW1sX3VzZXJfdWlkKQ0KICAgICAgIC
 AgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgI
 CBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEZhaWxlZCB0byB1cGRhdGUgY3Vy
 cmVudCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICA
 gICAgIHBvc3RfbG9naW5fcmVzdWx0ID0gc2VsZi5zYW1sRXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3
 VyYXRpb25BdHRyaWJ1dGVzLCBmaW5kX3VzZXJfYnlfdWlkKQ0KICAgICAgICAgICAgICAgIHByaW50I
 CJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gcG9zdF9sb2dpbl9yZXN1bHQ6IiwgcG9zdF9s
 b2dpbl9yZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc3VsdA0KICA
 gICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZX
 JfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY
 2F0ZSBmb3Igc3RlcCAyLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQogICAgDQog
 ICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFscyh1c2VyX25hbWUsIGZvdW5kX3VzZXJ
 fbmFtZSk6DQogICAgICAgICAgICAgICAgICAgIHBvc3RfbG9naW5fcmVzdWx0ID0gc2VsZi5zYW1sRX
 h0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmaW5kX3VzZXJfYnlfdWlkK
 Q0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIu
 IHBvc3RfbG9naW5fcmVzdWx0OiIsIHBvc3RfbG9naW5fcmVzdWx0DQogICAgDQogICAgICAgICAgICA
 gICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc3VsdA0KICAgICAgICANCiAgICAgICAgICAgIHJldH
 VybiBGYWxzZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZ
 WYgcHJlcGFyZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJh
 bWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCg
 pDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2VydmljZS5pbn
 N0YW5jZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiU2Ftb
 C4gUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBodHRwU2Vydmlj
 ZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCk7DQogICAgICAgICAgICByZXF1ZXN0ID0gRmFjZXNDb25
 0ZXh0LmdldEN1cnJlbnRJbnN0YW5jZSgpLmdldEV4dGVybmFsQ29udGV4dCgpLmdldFJlcXVlc3QoKQ
 0KICAgICAgICAgICAgYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJsID0gaHR0cFNlcnZpY2UuY29uc
 3RydWN0U2VydmVyVXJsKHJlcXVlc3QpICsgIi9wb3N0bG9naW4iDQogICAgICAgICAgICBwcmludCAi
 U2FtbC4gUHJlcGFyZSBmb3Igc3RlcCAxLiBQcmVwYXJlZCBhc3NlcnRpb25Db25zdW1lclNlcnZpY2V
 Vcmw6IiwgYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJsDQogICAgICAgICAgICANCiAgICAgICAgIC
 AgIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q3VycmVudFNhbWxDb25maWd1cmF0a
 W9uKHNlbGYuc2FtbENvbmZpZ3VyYXRpb24sIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0
 UGFyYW1ldGVycykNCiAgICAgICAgICAgIGlmIChjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24gPT0gTm9
 uZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmUgZm9yIHN0ZXAgMS4gQ2xpZW
 50IHNhbWwgY29uZmlndXJhdGlvbiBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGY
 WxzZQ0KDQogICAgICAgICAgICAjIEdlbmVyYXRlIGFuIEF1dGhSZXF1ZXN0IGFuZCBzZW5kIGl0IHRv
 IHRoZSBpZGVudGl0eSBwcm92aWRlcg0KICAgICAgICAgICAgc2FtbEF1dGhSZXF1ZXN0ID0gQXV0aFJ
 lcXVlc3QoY3VycmVudFNhbWxDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgZXh0ZXJuYWxfYXV0aF
 9yZXF1ZXN0X3VyaSA9IGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbi5nZXRJZHBTc29UYXJnZXRVcmwoK
 SArICI/U0FNTFJlcXVlc3Q9IiArIHNhbWxBdXRoUmVxdWVzdC5nZXRSZXF1ZXN0KFRydWUsIGFzc2Vy
 dGlvbkNvbnN1bWVyU2VydmljZVVybCkNCg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmU
 gZm9yIHN0ZXAgMS4gZXh0ZXJuYWxfYXV0aF9yZXF1ZXN0X3VyaToiLCBleHRlcm5hbF9hdXRoX3JlcX
 Vlc3RfdXJpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJleHRlcm5hbF9hd
 XRoX3JlcXVlc3RfdXJpIiwgZXh0ZXJuYWxfYXV0aF9yZXF1ZXN0X3VyaSkNCg0KICAgICAgICAgICAg
 cmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJ
 TYW1sLiBQcmVwYXJlIGZvciBzdGVwIDIiDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgIC
 AgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZ
 XRlcnNGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAg
 aWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgic2FtbF91c2V
 yX3VpZCIpDQoNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2
 F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBjb250ZXh0I
 D0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRleHQuaXNTZXQoInNh
 bWxfY291bnRfbG9naW5fc3RlcHMiKSk6DQogICAgICAgICAgICByZXR1cm4gY29udGV4dC5nZXQoInN
 hbWxfY291bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIDINCg0KICAgIG
 RlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogI
 CAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgc2FtbF9hbGxvd19iYXNpY19sb2dpbiA9
 IEZhbHNlDQogICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXk
 oInNhbWxfYWxsb3dfYmFzaWNfbG9naW4iKSk6DQogICAgICAgICAgICAgICAgc2FtbF9hbGxvd19iYX
 NpY19sb2dpbiA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ
 2V0KCJzYW1sX2FsbG93X2Jhc2ljX2xvZ2luIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAg
 ICAgICBpZiAoc2FtbF9hbGxvd19iYXNpY19sb2dpbik6DQogICAgICAgICAgICAgICAgcmV0dXJuICI
 vbG9naW4ueGh0bWwiDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHJldHVybiAiL2
 F1dGgvc2FtbC9zYW1sbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIvYXV0aC9zYW1sL3Nhb
 Wxwb3N0bG9naW4ueGh0bWwiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWY
 gaXNQYXNzZWRTdGVwMSgpOg0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKC
 kuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2Vyb
 mFtZSgpDQogICAgICAgIHBhc3NlZF9zdGVwMSA9IFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5n
 KHVzZXJfbmFtZSkNCg0KICAgICAgICByZXR1cm4gcGFzc2VkX3N0ZXAxDQoNCiAgICBkZWYgbG9hZEN
 lcml0aWZpY2F0ZShzZWxmLCBzYW1sX2NlcnRpZmljYXRlX2ZpbGUpOg0KICAgICAgICBzYW1sX2Nlcn
 RpZmljYXRlID0gTm9uZQ0KDQogICAgICAgICMgTG9hZCBjZXJ0aWZpY2F0ZSBmcm9tIGZpbGUNCiAgI
 CAgICAgZiA9IG9wZW4oc2FtbF9jZXJ0aWZpY2F0ZV9maWxlLCAncicpDQogICAgICAgIHRyeToNCiAg
 ICAgICAgICAgIHNhbWxfY2VydGlmaWNhdGUgPSBmLnJlYWQoKQ0KICAgICAgICBleGNlcHQ6DQogICA
 gICAgICAgICBwcmludCAiRmFpbGVkIHRvIGxvYWQgY2VydGlmaWNhdGUgZnJvbSBmaWxlOiIsIHNhbW
 xfY2VydGlmaWNhdGVfZmlsZQ0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgZmluYWxse
 ToNCiAgICAgICAgICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHNhbWxfY2Vy
 dGlmaWNhdGUNCg0KICAgIGRlZiBnZXRDbGllbnRDb25maWd1cmF0aW9uKHNlbGYsIGNvbmZpZ3VyYXR
 pb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgICMgR2V0IGNsaWVudCBjb2
 5maWd1cmF0aW9uDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tle
 Sgic2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKSk6DQogICAgICAgICAgICBzYW1s
 X2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmd
 ldCgic2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKS5nZXRWYWx1ZTIoKQ0KICAgIC
 AgICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIFVzaW5nIGNsaWVudCBhd
 HRyaWJ1dGU6Iiwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUNCg0KICAgICAgICAg
 ICAgaWYgKHJlcXVlc3RQYXJhbWV0ZXJzID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHJldHVybiB
 Ob25lDQoNCiAgICAgICAgICAgIGNsaWVudF9pZCA9IE5vbmUNCiAgICAgICAgICAgIGNsaWVudF9pZF
 9hcnJheSA9IHJlcXVlc3RQYXJhbWV0ZXJzLmdldCgiY2xpZW50X2lkIikNCiAgICAgICAgICAgIGlmI
 ChBcnJheUhlbHBlci5pc05vdEVtcHR5KGNsaWVudF9pZF9hcnJheSkgYW5kIFN0cmluZ0hlbHBlci5p
 c05vdEVtcHR5U3RyaW5nKGNsaWVudF9pZF9hcnJheVswXSkpOg0KICAgICAgICAgICAgICAgIGNsaWV
 udF9pZCA9IGNsaWVudF9pZF9hcnJheVswXQ0KDQogICAgICAgICAgICBpZiAoY2xpZW50X2lkID09IE
 5vbmUpOg0KICAgICAgICAgICAgICAgIGV2ZW50Q29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29ud
 GV4dCgpDQogICAgICAgICAgICAgICAgaWYgKGV2ZW50Q29udGV4dC5pc1NldCgic2Vzc2lvbkF0dHJp
 YnV0ZXMiKSk6DQogICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZCA9IGV2ZW50Q29udGV4dC5nZXQ
 oInNlc3Npb25BdHRyaWJ1dGVzIikuZ2V0KCJjbGllbnRfaWQiKQ0KDQogICAgICAgICAgICBpZiAoY2
 xpZW50X2lkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBHZXRDbGllbnRDb
 25maWd1cmF0aW9uLiBjbGllbnRfaWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5v
 bmUNCg0KICAgICAgICAgICAgY2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW5zdGFuY2UoKQ0
 KICAgICAgICAgICAgY2xpZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZW50X2lkKQ0KIC
 AgICAgICAgICAgaWYgKGNsaWVudCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2Ftb
 C4gR2V0Q2xpZW50Q29uZmlndXJhdGlvbi4gRmFpbGVkIHRvIGZpbmQgY2xpZW50IiwgY2xpZW50X2lk
 LCAiIGluIGxvY2FsIExEQVAiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICA
 gICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9IGNsaWVudFNlcnZpY2UuZ2V0Q3VzdG9tQXR0cm
 lidXRlKGNsaWVudCwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUpDQogICAgICAgI
 CAgICBpZiAoKHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb24gPT0gTm9uZSkgb3IgU3RyaW5nSGVscGVy
 LmlzRW1wdHkoc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbi5nZXRWYWx1ZSgpKSk6DQogICAgICAgICA
 gICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIENsaWVudCIsIGNsaWVudF
 9pZCwgIiBhdHRyaWJ1dGUiLCBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSwgIiBpc
 yBlbXB0eSINCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEdl
 dENsaWVudENvbmZpZ3VyYXRpb24uIENsaWVudCIsIGNsaWVudF9pZCwgIiBhdHRyaWJ1dGUiLCBzYW1
 sX2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSwgIiBpcyIsIHNhbWxfY2xpZW50X2NvbmZpZ3
 VyYXRpb24NCiAgICAgICAgICAgICAgICByZXR1cm4gc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbg0KD
 QogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgZ2V0Q3VycmVudFNhbWxDb25maWd1cmF0aW9u
 KHNlbGYsIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJ
 lcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9IHNlbG
 YuZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhc
 mFtZXRlcnMpDQogICAgICAgIGlmIChzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uID09IE5vbmUpOg0K
 ICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbg0KICAgICAgICANCiAgICA
 gICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1ZSA9IGpzb24ubG9hZHMoc2FtbF9jbGllbn
 RfY29uZmlndXJhdGlvbi5nZXRWYWx1ZSgpKQ0KDQogICAgICAgIGNsaWVudF9zYW1sX2NlcnRpZmljY
 XRlID0gTm9uZSAgICAgIA0KICAgICAgICBjbGllbnRfc2FtbF9jZXJ0aWZpY2F0ZV9maWxlID0gc2Ft
 bF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1ZVsic2FtbF9jZXJ0aWZpY2F0ZV9maWxlIl0NCiAgICA
 gICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KGNsaWVudF9zYW1sX2NlcnRpZmljYXRlX2ZpbG
 UpKToNCiAgICAgICAgICAgIGNsaWVudF9zYW1sX2NlcnRpZmljYXRlID0gc2VsZi5sb2FkQ2VyaXRpZ
 mljYXRlKGNsaWVudF9zYW1sX2NlcnRpZmljYXRlX2ZpbGUpDQogICAgICAgICAgICBpZiAoU3RyaW5n
 SGVscGVyLmlzRW1wdHkoY2xpZW50X3NhbWxfY2VydGlmaWNhdGUpKToNCiAgICAgICAgICAgICAgICB
 wcmludCAiU2FtbC4gQnVpbGRDbGllbnRTYW1sQ29uZmlndXJhdGlvbi4gRmlsZSB3aXRoIHg1MDkgY2
 VydGlmaWNhdGUgc2hvdWxkIGJlIG5vdCBlbXB0eS4gVXNpbmcgZGVmYXVsdCBjb25maWd1cmF0aW9uI
 g0KICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24NCg0KICAgICAg
 ICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbiA9IGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbi5jbG9uZSg
 pDQogICAgICAgIA0KICAgICAgICBpZiAoY2xpZW50X3NhbWxfY2VydGlmaWNhdGUgIT0gTm9uZSk6DQ
 ogICAgICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbi5sb2FkQ2VydGlmaWNhdGVGcm9tU3Rya
 W5nKGNsaWVudF9zYW1sX2NlcnRpZmljYXRlKQ0KDQogICAgICAgIGNsaWVudF9zYW1sX2lzc3VlciA9
 IHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb25fdmFsdWVbInNhbWxfaXNzdWVyIl0NCiAgICAgICAgY2x
 pZW50U2FtbENvbmZpZ3VyYXRpb24uc2V0SXNzdWVyKGNsaWVudF9zYW1sX2lzc3VlcikNCiAgICAgIC
 AgDQogICAgICAgIHNhbWxfdXNlX2F1dGhuX2NvbnRleHQgPSBzYW1sX2NsaWVudF9jb25maWd1cmF0a
 W9uX3ZhbHVlWyJzYW1sX3VzZV9hdXRobl9jb250ZXh0Il0NCiAgICAgICAgY2xpZW50X3VzZV9zYW1s
 X3VzZV9hdXRobl9jb250ZXh0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihzYW1sX3VzZV9hdXRobl9
 jb250ZXh0LCBUcnVlKQ0KICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbi5zZXRVc2VSZXF1ZX
 N0ZWRBdXRobkNvbnRleHQoY2xpZW50X3VzZV9zYW1sX3VzZV9hdXRobl9jb250ZXh0KQ0KDQogICAgI
 CAgIHJldHVybiBjbGllbnRTYW1sQ29uZmlndXJhdGlvbg0KDQogICAgZGVmIHByZXBhcmVBdHRyaWJ1
 dGVzTWFwcGluZyhzZWxmLCBzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QsIHNhbWxfbG9jYWxfYXR0cml
 idXRlc19saXN0KToNCiAgICAgICAgc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5ID0gU3RyaW
 5nSGVscGVyLnNwbGl0KHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCwgIiwiKQ0KICAgICAgICBpZiAoQ
 XJyYXlIZWxwZXIuaXNFbXB0eShzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXkpKToNCiAgICAg
 ICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIGF
 0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCBwcm9wZXJ0eSINCi
 AgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBzYW1sX2xvY2FsX2F0dHJpY
 nV0ZXNfbGlzdF9hcnJheSA9IFN0cmluZ0hlbHBlci5zcGxpdChzYW1sX2xvY2FsX2F0dHJpYnV0ZXNf
 bGlzdCwgIiwiKQ0KICAgICAgICBpZiAoQXJyYXlIZWxwZXIuaXNFbXB0eShzYW1sX2xvY2FsX2F0dHJ
 pYnV0ZXNfbGlzdF9hcnJheSkpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVBdHRyaW
 J1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gYXR0cmlidXRlcyBzcGVjaWZpZWQgaW4gc2FtbF9sb2Nhb
 F9hdHRyaWJ1dGVzX2xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAg
 ICAgIGlmIChsZW4oc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5KSAhPSBsZW4oc2FtbF9sb2N
 hbF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYX
 JlQXR0cmlidXRlc01hcHBpbmcuIFRoZSBudW1iZXIgb2YgYXR0cmlidXRlcyBpbiBzYW1sX2lkcF9hd
 HRyaWJ1dGVzX2xpc3QgYW5kIHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IGlzbid0IGVxdWFsIg0K
 ICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgICAgIGF0dHJpYnV0ZU1hcHBpbmc
 gPSBJZGVudGl0eUhhc2hNYXAoKQ0KICAgICAgICBjb250YWluc1VpZCA9IEZhbHNlDQogICAgICAgIG
 kgPSAwDQogICAgICAgIGNvdW50ID0gbGVuKHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSkNC
 iAgICAgICAgd2hpbGUgKGkgPCBjb3VudCk6DQogICAgICAgICAgICBpZHBBdHRyaWJ1dGUgPSBTdHJp
 bmdIZWxwZXIudG9Mb3dlckNhc2Uoc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5W2ldKQ0KICA
 gICAgICAgICAgbG9jYWxBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2Uoc2FtbF9sb2
 NhbF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXlbaV0pDQogICAgICAgICAgICBhdHRyaWJ1dGVNYXBwaW5nL
 nB1dChpZHBBdHRyaWJ1dGUsIGxvY2FsQXR0cmlidXRlKQ0KDQogICAgICAgICAgICBpZiAoU3RyaW5n
 SGVscGVyLmVxdWFsc0lnbm9yZUNhc2UobG9jYWxBdHRyaWJ1dGUsICJ1aWQiKSk6DQogICAgICAgICA
 gICAgICAgY29udGFpbnNVaWQgPSBUcnVlDQoNCiAgICAgICAgICAgIGkgPSBpICsgMQ0KDQogICAgIC
 AgIGlmIChub3QgY29udGFpbnNVaWQpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVBd
 HRyaWJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gbWFwcGluZyB0byBtYW5kYXRvcnkgJ3VpZCcgYXR0
 cmlidXRlIg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgICAgIHJldHVybiB
 hdHRyaWJ1dGVNYXBwaW5nDQoNCiAgICBkZWYgcHJlcGFyZUN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZy
 hzZWxmLCBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZ
 XF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb24gPSBzZWxm
 LmdldENsaWVudENvbmZpZ3VyYXRpb24oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJ
 hbWV0ZXJzKQ0KICAgICAgICBpZiAoc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9PSBOb25lKToNCi
 AgICAgICAgICAgIHJldHVybiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICBzYW1sX
 2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlID0ganNvbi5sb2FkcyhzYW1sX2NsaWVudF9jb25maWd1
 cmF0aW9uLmdldFZhbHVlKCkpDQoNCiAgICAgICAgY2xpZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWx
 mLnByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZyhzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlWy
 JzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QiXSwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1Z
 Vsic2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiXSkNCiAgICAgICAgaWYgKGNsaWVudEF0dHJpYnV0
 ZXNNYXBwaW5nID09IE5vbmUpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVDdXJyZW5
 0QXR0cmlidXRlc01hcHBpbmcuIENsaWVudCBhdHRyaWJ1dGVzIG1hcHBpbmcgaXMgaW52YWxpZC4gVX
 NpbmcgZGVmYXVsdCBvbmUiDQogICAgICAgICAgICByZXR1cm4gY3VycmVudEF0dHJpYnV0ZXNNYXBwa
 W5nDQoNCiAgICAgICAgcmV0dXJuIGNsaWVudEF0dHJpYnV0ZXNNYXBwaW5nDQoNCiAgICBkZWYgc2Ft
 bEV4dGVuc2lvblBvc3RMb2dpbihzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgdXNlcik6DQo
 gICAgICAgIGlmIChzZWxmLnNhbWxFeHRlbnNpb25Nb2R1bGUgIT0gTm9uZSk6DQogICAgICAgICAgIC
 B0cnk6DQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb
 25Nb2R1bGUucG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCB1c2VyKQ0KICAgICAgICAg
 ICAgICAgIHByaW50ICJTYW1sLiBFeHRlbnNpb25Qb3N0bG9naW4gcmVzdWx0OiIsIHBvc3RfbG9naW5
 fcmVzdWx0DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gcG9zdF9sb2dpbl9yZXN1bHQNCiAgICAgIC
 AgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBFe
 HRlbnNpb25Qb3N0bG9naW4uIEZhaWxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAg
 ICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEV4dGVuc2lvblBvc3Rsb2dpbi4gVW5leHBlY3RlZCBlcnJ
 vcjoiLCBleA0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZXhjZXB0IG
 phdmEubGFuZy5UaHJvd2FibGUsIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBFeHRlb
 nNpb25Qb3N0bG9naW4uIEZhaWxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAg
 ICAgICAgICAgZXgucHJpbnRTdGFja1RyYWNlKCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHN
 lDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!DAA9.B788,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Client Registration script
displayName: client_registration
gluuStatus: false
inum: %(inumOrg)s!0011!DAA9.B788
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5jbGllbnQgaW1wb
 3J0IENsaWVudFJlZ2lzdHJhdGlvblR5cGUNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJp
 bmdIZWxwZXIsIEFycmF5SGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J
 0IFNjb3BlU2VydmljZQ0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQ
 oNCmltcG9ydCBqYXZhDQoNCmNsYXNzIENsaWVudFJlZ2lzdHJhdGlvbihDbGllbnRSZWdpc3RyY
 XRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0K
 ICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICA
 gIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbn
 QgIkNsaWVudCByZWdpc3RyYXRpb24uIEluaXRpYWxpemF0aW9uIg0KDQogICAgICAgIHNlbGYuc
 2NvcGVTZXJ2aWNlID0gU2NvcGVTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBwcmludCAi
 Q2xpZW50IHJlZ2lzdHJhdGlvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICA
 gIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDbGllbnQgcmVnaXN0cmF0aW9uLiBEZXN0cm95I
 g0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzdHJhdGlvbi4gRGVzdHJveWVkIHN1Y2Nlc3Nm
 dWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgICMgVXBkYXRlIGNsaWVudCBlbnR
 yeSBiZWZvcmUgcGVyc2lzdGVudCBpdA0KICAgICMgICByZWdpc3RlclJlcXVlc3QgaXMgb3JnLn
 hkaS5veGF1dGguY2xpZW50LlJlZ2lzdGVyUmVxdWVzdA0KICAgICMgICBjbGllbnQgaXMgb3JnL
 nhkaS5veGF1dGgubW9kZWwucmVnaXN0cmF0aW9uLkNsaWVudA0KICAgICMgICBjb25maWd1cmF0
 aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGV
 ydHk+DQogICAgZGVmIHVwZGF0ZUNsaWVudChzZWxmLCByZWdpc3RlclJlcXVlc3QsIGNsaWVudC
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzd
 HJhdGlvbi4gVXBkYXRlQ2xpZW50IG1ldGhvZCINCg0KICAgICAgICByZWRpcmVjdFVyaXMgPSBj
 bGllbnQuZ2V0UmVkaXJlY3RVcmlzKCkNCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXR
 pb24uIFJlZGlyZWN0IFVyaXM6IiwgcmVkaXJlY3RVcmlzDQoNCiAgICAgICAgYWRkQWRkcmVzc1
 Njb3BlID0gRmFsc2UNCiAgICAgICAgZm9yIHJlZGlyZWN0VXJpIGluIHJlZGlyZWN0VXJpczoNC
 iAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShyZWRpcmVjdFVy
 aSwgImh0dHBzOi8vY2xpZW50LmV4YW1wbGUuY29tL2V4YW1wbGUxIikpOg0KICAgICAgICAgICA
 gICAgIGFkZEFkZHJlc3NTY29wZSA9IFRydWUNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgIC
 AgICANCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIElzIGFkZCBhZGRyZXNzI
 HNjb3BlOiIsIGFkZEFkZHJlc3NTY29wZQ0KDQogICAgICAgIGlmIChhZGRBZGRyZXNzU2NvcGUp
 Og0KICAgICAgICAgICAgY3VycmVudFNjb3BlcyA9IGNsaWVudC5nZXRTY29wZXMoKQ0KICAgICA
 gICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIEN1cnJlbnQgc2NvcGVzOiIsIGN1cn
 JlbnRTY29wZXMNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYWRkcmVzc1Njb3BlID0gc2VsZ
 i5zY29wZVNlcnZpY2UuZ2V0U2NvcGVCeURpc3BsYXlOYW1lKCJhZGRyZXNzIikNCiAgICAgICAg
 ICAgIG5ld1Njb3BlcyA9IEFycmF5SGVscGVyLmFkZEl0ZW1Ub1N0cmluZ0FycmF5KGN1cnJlbnR
 TY29wZXMsIGFkZHJlc3NTY29wZS5nZXREbigpKQ0KICAgIA0KICAgICAgICAgICAgcHJpbnQgIk
 NsaWVudCByZWdpc3RyYXRpb24uIFJlc3VsdCBzY29wZXM6IiwgbmV3U2NvcGVzDQogICAgICAgI
 CAgICBjbGllbnQuc2V0U2NvcGVzKG5ld1Njb3BlcykNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
 DQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFB
 hcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb2
 4oc2VsZik6DQogICAgICAgIHJldHVybiAxDQo=
oxScriptType: client_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!DAA9.B789,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Application Session script
displayName: application_session
gluuStatus: false
inum: %(inumOrg)s!0011!DAA9.B789
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zZXNzaW9uIGltc
 G9ydCBBcHBsaWNhdGlvblNlc3Npb25UeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3Ry
 aW5nSGVscGVyLCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJ
 yYXlMaXN0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEFwcGxpY2F0aW9uU2Vzc2lvbihBcHBsaW
 NhdGlvblNlc3Npb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNa
 WxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxs
 aXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICA
 gICAgcHJpbnQgIkFwcGxpY2F0aW9uIHNlc3Npb24uIEluaXRpYWxpemF0aW9uIg0KICAgICAgIC
 BwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KD
 QogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1
 cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiB
 EZXN0cm95Ig0KICAgICAgICBwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gRGVzdHJveWVkIH
 N1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBnZXRBcGlWZ
 XJzaW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgIyBBcHBsaWNhdGlvbiBjYWxs
 cyBpdCBhdCBlbmQgc2Vzc2lvbiByZXF1ZXN0IHRvIGFsbG93IG5vdGlmeSAzcmQgcGFydCBzeXN
 0ZW1zDQogICAgIyAgIGh0dHBSZXF1ZXN0IGlzIGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2Vydm
 xldFJlcXVlc3QNCiAgICAjICAgYXV0aG9yaXphdGlvbkdyYW50IGlzIG9yZy54ZGkub3hhdXRoL
 m1vZGVsLmNvbW1vbi5BdXRob3JpemF0aW9uR3JhbnQNCiAgICAjICAgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5Pg0
 KICAgIGRlZiBlbmRTZXNzaW9uKHNlbGYsIGh0dHBSZXF1ZXN0LCBhdXRob3JpemF0aW9uR3Jhbn
 QsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkFwcGxpY2F0aW9uI
 HNlc3Npb24uIFN0YXJ0aW5nIGV4dGVybmFsIHNlc3Npb24gZW5kIg0KDQogICAgICAgIHByaW50
 ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiBFeHRlcm5hbCBzZXNzaW9uIGVuZGVkIHN1Y2Nlc3NmdWx
 seSINCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: application_session
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!031C.5621,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Dynamic Scope script
displayName: dynamic_scope
gluuStatus: true
inum: %(inumOrg)s!0011!031C.5621
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zY29wZSBpbXBvcnQgRHluYW1pY1Njb3BlVHlwZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlciwgQXJyYXlIZWxwZXINCmZyb
 20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdA0KDQppbXBvcnQgamF2YQ0KDQpjbGFzcyBEeW5hbWljU2NvcGUoRHluYW1pY1Njb3BlVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWls
 bGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJEeW5hbWljIHN
 jb3BlLiBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29wZS4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLC
 Bjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJEeW5hbWljIHNjb3BlLiBEZXN0cm95Ig0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29wZS4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgc
 mV0dXJuIFRydWUgICANCg0KICAgICMgVXBkYXRlIEpzb24gV2ViIHRva2VuIGJlZm9yZSBzaWduaW5nL2VuY3J5cHJpbmcgaXQNCiAgICAjICAgZHluYW1pY1Njb3BlQ29udGV4dCBpcyBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLmV4
 dGVybmFsLmNvbnRleHQuRHluYW1pY1Njb3BlRXh0ZXJuYWxDb250ZXh0DQogICAgIyAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21Qcm9wZXJ0eT4NCiAgICBkZWY
 gdXBkYXRlKHNlbGYsIGR5bmFtaWNTY29wZUNvbnRleHQsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR5bmFtaWMgc2NvcGUuIFVwZGF0ZSBtZXRob2QiDQoNCiAgICAgICAgZHluYW1pY1Njb3Blcy
 A9IGR5bmFtaWNTY29wZUNvbnRleHQuZ2V0RHluYW1pY1Njb3BlcygpDQogICAgICAgIHVzZXIgPSBkeW5hbWljU2NvcGVDb250ZXh0LmdldFVzZXIoKQ0KICAgICAgICBqc29uV2ViUmVzcG9uc2UgPSBkeW5hbWljU2NvcGVDb250Z
 Xh0LmdldEpzb25XZWJSZXNwb25zZSgpDQogICAgICAgIGNsYWltcyA9IGpzb25XZWJSZXNwb25zZS5nZXRDbGFpbXMoKQ0KDQogICAgICAgICMgSXRlcmF0ZSB0aHJvdWdoIGxpc3Qgb2YgZHluYW1pYyBzY29wZXMgaW4gb3JkZXIg
 dG8gYWRkIGN1c3RvbSBzY29wZXMgaWYgbmVlZGVkDQogICAgICAgIHByaW50ICJEeW5hbWljIHNjb3BlLiBEeW5hbWljIHNjb3BlczoiLCBkeW5hbWljU2NvcGVzDQogICAgICAgIGZvciBkeW5hbWljU2NvcGUgaW4gZHluYW1pY1N
 jb3BlczoNCiAgICAgICAgICAgICMgQWRkIG9yZ2FuaXphdGlvbiBuYW1lIGlmIHRoZXJlIGlzIHNjb3BlID0gb3JnX25hbWUNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkeW5hbWljU2NvcG
 UsICJvcmdfbmFtZSIpKToNCiAgICAgICAgICAgICAgICBjbGFpbXMuc2V0Q2xhaW0oIm9yZ19uYW1lIiwgIkdsdXUsIEluYy4iKQ0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQoNCiAgICAgICAgICAgICMgQWRkIHdvcmsgcGhvb
 mUgaWYgdGhlcmUgaXMgc2NvcGUgPSB3b3JrX3Bob25lDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UoZHluYW1pY1Njb3BlLCAid29ya19waG9uZSIpKToNCiAgICAgICAgICAgICAgICB3b3Jr
 UGhvbmUgPSB1c2VyLmdldEF0dHJpYnV0ZSgidGVsZXBob25lTnVtYmVyIik7DQogICAgICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KHdvcmtQaG9uZSkpOg0KICAgICAgICAgICAgICAgICAgICBjbGFpbXM
 uc2V0Q2xhaW0oIndvcmtfcGhvbmUiLCB3b3JrUGhvbmUpDQogICAgICAgICAgICAgICAgY29udGludWUNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 wgcmVxdWVzdFBhcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQo=
oxScriptType: dynamic_scope
programmingLanguage: python
