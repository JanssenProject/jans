version: 1

dn: inum=%(inumOrg)s!0011!031C.4A65,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Id Generator script
displayName: id_generator
gluuStatus: false
inum: %(inumOrg)s!0011!031C.4A65
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5pZCBpbXBvcnQgS
 WRHZW5lcmF0b3JUeXBlCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXIsIEFy
 cmF5SGVscGVyCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdAoKaW1wb3J
 0IGphdmEKCmNsYXNzIElkR2VuZXJhdG9yKElkR2VuZXJhdG9yVHlwZSk6CiAgICBkZWYgX19pbm
 l0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOgogICAgICAgIHNlbGYuY3VycmVudFRpbWVNa
 WxsaXMgPSBjdXJyZW50VGltZU1pbGxpcwoKICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKToKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXphdGl
 vbiIKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbH
 kiCgogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIERlc3Ryb3ki
 CiAgICAgICAgcHJpbnQgIklkIGdlbmVyYXRvci4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSIKICA
 gICAgICByZXR1cm4gVHJ1ZSAgIAoKICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOgogICAgIC
 AgIHJldHVybiAxCgogICAgIyBJZCBnZW5lcmF0b3IgaW5pdCBtZXRob2QKICAgICMgICBhcHBJZ
 CBpcyBhcHBsaWNhdGlvbiBJZAogICAgIyAgIGlkVHlwZSBpcyBJZCBUeXBlCiAgICAjICAgaWRQ
 cmVmaXggaXMgSWQgUHJlZml4CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGV
 sLkdsdXVDdXN0b21QZXJzb24KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcyBpcyBqYX
 ZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+CiAgICBkZWYgZ2VuZXJhd
 GVJZChzZWxmLCBhcHBJZCwgaWRUeXBlLCBpZFByZWZpeCwgY29uZmlndXJhdGlvbkF0dHJpYnV0
 ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkIgogICAgICAgIHB
 yaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkLiBBcHBJZDogJyIsIGFwcElkLCAiJywgSW
 RUeXBlOiAnIiwgaWRUeXBlLCAiJywgSWRQcmVmaXg6ICciLCBpZFByZWZpeCwgIiciCgogICAgI
 CAgICMgUmV0dXJuIE5vbmUgb3IgZW1wdHkgc3RyaW5nIHRvIHRyaWdnZXIgZGVmYXVsdCBJZCBn
 ZW5lcmF0aW9uIG1ldGhvZAogICAgICAgIHJldHVybiBOb25lCg==
oxScriptType: id_generator
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!13D3.E7AD,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Cache Refresh script
displayName: cache_refresh
gluuStatus: false
inum: %(inumOrg)s!0011!13D3.E7AD
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBDYWNoZVJlZnJlc2hUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVy
 LCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQp
 mcm9tIG9yZy5nbHV1Lm94dHJ1c3QubW9kZWwgaW1wb3J0IEdsdXVDdXN0b21BdHRyaWJ1dGUNCg
 0KaW1wb3J0IGphdmENCg0KY2xhc3MgQ2FjaGVSZWZyZXNoKENhY2hlUmVmcmVzaFR5cGUpOg0KI
 CAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYu
 Y3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2V
 sZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcm
 VzaC4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLiBJbml0a
 WFsaXplZCBzdWNjZXNzZnVsbHkiDQoNCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRl
 ZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQ
 gIkNhY2hlIHJlZnJlc2guIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLi
 BEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgI
 yBVcGRhdGUgdXNlciBlbnRyeSBiZWZvcmUgcGVyc2lzdCBpdA0KICAgICMgICB1c2VyIGlzIG9y
 Zy5nbHV1Lm94dHJ1c3QubW9kZWwuR2x1dUN1c3RvbVBlcnNvbg0KICAgICMgICBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcG
 VydHk+DQogICAgZGVmIHVwZGF0ZVVzZXIoc2VsZiwgdXNlciwgY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcmVzaC4gVXBkYXRlVXNlciBtZXRob2Qi
 DQoNCiAgICAgICAgYXR0cmlidXRlcyA9IHVzZXIuZ2V0Q3VzdG9tQXR0cmlidXRlcygpDQoNCiA
 gICAgICAgIyBBZGQgbmV3IGF0dHJpYnV0ZSBwcmVmZXJyZWRMYW5ndWFnZQ0KICAgICAgICBhdH
 RyUHJlZmZlcmVkTGFuZ3VhZ2UgPSBHbHV1Q3VzdG9tQXR0cmlidXRlKCJwcmVmZXJyZWRMYW5nd
 WFnZSIsICJlbi11cyIpDQogICAgICAgIGF0dHJpYnV0ZXMuYWRkKGF0dHJQcmVmZmVyZWRMYW5n
 dWFnZSkNCg0KICAgICAgICAjIEFkZCBuZXcgYXR0cmlidXRlIHVzZXJQYXNzd29yZA0KICAgICA
 gICBhdHRyVXNlclBhc3N3b3JkID0gR2x1dUN1c3RvbUF0dHJpYnV0ZSgidXNlclBhc3N3b3JkIi
 wgInRlc3QiKQ0KICAgICAgICBhdHRyaWJ1dGVzLmFkZChhdHRyVXNlclBhc3N3b3JkKQ0KDQogI
 CAgICAgICMgVXBkYXRlIGdpdmVuTmFtZSBhdHRyaWJ1dGUNCiAgICAgICAgZm9yIGF0dHJpYnV0
 ZSBpbiBhdHRyaWJ1dGVzOg0KICAgICAgICAgICAgYXR0ck5hbWUgPSBhdHRyaWJ1dGUuZ2V0TmF
 tZSgpDQogICAgICAgICAgICBpZiAoKCJnaXZlbm5hbWUiID09IFN0cmluZ0hlbHBlci50b0xvd2
 VyQ2FzZShhdHRyTmFtZSkpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eShhdHRyaWJ1dGUuZ
 2V0VmFsdWUoKSkpOg0KICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZShTdHJpbmdI
 ZWxwZXIucmVtb3ZlTXVsdGlwbGVTcGFjZXMoYXR0cmlidXRlLmdldFZhbHVlKCkpICsgIiAodXB
 kYXRlZCkiKQ0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbi
 hzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg==
oxScriptType: cache_refresh
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!2DAF.F995,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample UMA Authorization policy
displayName: uma_authorization_policy
gluuStatus: true
inum: %(inumOrg)s!0011!2DAF.F995
oxConfigurationProperty: {"value1":"allowed_clients","value2":"%(scim_rp_client_id)s","description":""}
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51bWEgaW1wb3J0IEF1d
 Ghvcml6YXRpb25Qb2xpY3lUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVy
 LCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0LCBIYXN
 oU2V0DQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UudW1hLmF1dGhvcml6YXRpb24gaW1wb3J0IE
 F1dGhvcml6YXRpb25Db250ZXh0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEF1dGhvcml6YXRpb25Qb
 2xpY3koQXV0aG9yaXphdGlvblBvbGljeVR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJy
 ZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGl
 tZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KIC
 AgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiBJbml0aWFsaXphdGlvbiINCg0KI
 CAgICAgICBzZWxmLmNsaWVudHNTZXQgPSBzZWxmLnByZXBhcmVDbGllbnRzU2V0KGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKQ0KICAgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiBJbml
 0aWFsaXphdGlvbi4gQ291bnQgYXV0aG9yaXplZCBjbGllbnRzOiAlcyIgJSBzZWxmLmNsaWVudHNTZX
 Quc2l6ZSgpDQoNCiAgICAgICAgcHJpbnQgIlVNQSBhdXRob3JpemF0aW9uIHBvbGljeS4gSW5pdGlhb
 Gl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVz
 dHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVTUEgYXV
 0aG9yaXphdGlvbiBwb2xpY3kuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJVTUEgYXV0aG9yaXphdG
 lvbiBwb2xpY3kuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlICAgD
 QoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgICMg
 UHJvY2VzcyBwb2xpY3kgcnVsZQ0KICAgICMgICBhdXRob3JpemF0aW9uQ29udGV4dCBpcyBvcmcueGR
 pLm94YXV0aC5zZXJ2aWNlLnVtYS5hdXRob3JpemF0aW9uLkF1dGhvcml6YXRpb25Db250ZXh0DQogIC
 AgIyAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wb
 GVDdXN0b21Qcm9wZXJ0eT4NCiAgICBkZWYgYXV0aG9yaXplKHNlbGYsIGF1dGhvcml6YXRpb25Db250
 ZXh0LCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVTUEgQXV0aG9yaXp
 hdGlvbiBwb2xpY3kuIEF0dGVtcHRpbmcgdG8gYXV0aG9yaXplIGNsaWVudCINCiAgICAgICAgY2xpZW
 50X2lkID0gYXV0aG9yaXphdGlvbkNvbnRleHQuZ2V0R3JhbnQoKS5nZXRDbGllbnRJZCgpDQoNCiAgI
 CAgICAgcHJpbnQgIlVNQSBBdXRob3JpemF0aW9uIHBvbGljeS4gQ2xpZW50OiAiLCBjbGllbnRfaWQN
 CiAgICAgICAgaWYgKHNlbGYuY2xpZW50c1NldC5jb250YWlucyhjbGllbnRfaWQpKToNCiAgICAgICA
 gICAgIHByaW50ICJVTUEgQXV0aG9yaXphdGlvbiBwb2xpY3kuIEF1dGhvcml6aW5nIGNsaWVudCINCi
 AgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludCAiV
 U1BIEF1dGhvcml6YXRpb24gcG9saWN5LiBDbGllbnQgaXNuJ3QgYXV0aG9yaXplZCINCiAgICAgICAg
 ICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHByaW50ICJVTUEgQXV0aG9yaXphdGlvbiBwb2xpY3k
 uIEF1dGhvcml6aW5nIGNsaWVudCINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBwcmVwYX
 JlQ2xpZW50c1NldChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIGNsaWVud
 HNTZXQgPSBIYXNoU2V0KCkNCiAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5j
 b250YWluc0tleSgiYWxsb3dlZF9jbGllbnRzIikpOg0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudHN
 TZXQNCg0KICAgICAgICBhbGxvd2VkQ2xpZW50c0xpc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 5nZXQoImFsbG93ZWRfY2xpZW50cyIpLmdldFZhbHVlMigpDQogICAgICAgIGlmIChTdHJpbmdIZWxwZ
 XIuaXNFbXB0eShhbGxvd2VkQ2xpZW50c0xpc3QpKToNCiAgICAgICAgICAgIHByaW50ICJVTUEgYXV0
 aG9yaXphdGlvbiBwb2xpY3kuIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgYWxsb3dlZF9jbGl
 lbnRzIGlzIGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudHNTZXQgICAgDQoNCiAgICAgIC
 AgYWxsb3dlZENsaWVudHNMaXN0QXJyYXkgPSBTdHJpbmdIZWxwZXIuc3BsaXQoYWxsb3dlZENsaWVud
 HNMaXN0LCAiLCIpDQogICAgICAgIGlmIChBcnJheUhlbHBlci5pc0VtcHR5KGFsbG93ZWRDbGllbnRz
 TGlzdEFycmF5KSk6DQogICAgICAgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiB
 Jbml0aWFsaXphdGlvbi4gVGhlcmUgYXJlbid0IGNsaWVudHMgc3BlY2lmaWVkIGluIGFsbG93ZWRfY2
 xpZW50cyBwcm9wZXJ0eSINCiAgICAgICAgICAgIHJldHVybiBjbGllbnRzU2V0DQogICAgICAgIA0KI
 CAgICAgICAjIENvbnZlcnQgdG8gSGFzaFNldCB0byBxdWljayBzZWFyY2gNCiAgICAgICAgaSA9IDAN
 CiAgICAgICAgY291bnQgPSBsZW4oYWxsb3dlZENsaWVudHNMaXN0QXJyYXkpDQogICAgICAgIHdoaWx
 lIChpIDwgY291bnQpOg0KICAgICAgICAgICAgY2xpZW50ID0gYWxsb3dlZENsaWVudHNMaXN0QXJyYX
 lbaV0NCiAgICAgICAgICAgIGNsaWVudHNTZXQuYWRkKGNsaWVudCkNCiAgICAgICAgICAgIGkgPSBpI
 CsgMQ0KDQogICAgICAgIHJldHVybiBjbGllbnRzU2V0DQo=
oxScriptType: uma_authorization_policy
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!522F.CDC5,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Update User script
displayName: update_user
gluuStatus: false
inum: %(inumOrg)s!0011!522F.CDC5
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBVcGRhdGVVc2VyVHlwZQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyLCBB
 cnJheUhlbHBlcgpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QKCmltcG9
 ydCBqYXZhCgpjbGFzcyBVcGRhdGVVc2VyKFVwZGF0ZVVzZXJUeXBlKToKICAgIGRlZiBfX2luaX
 RfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6CiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pb
 GxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzCgogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlv
 bkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gSW5pdGlhbGl6YXRpb24
 iCiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiCg
 ogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhd
 GlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gRGVzdHJveSIKICAg
 ICAgICBwcmludCAiVXBkYXRlIHVzZXIuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiCiAgICAgICA
 gcmV0dXJuIFRydWUgICAKCiAgICAjIFVwZGF0ZSB1c2VyIGVudHJ5IGJlZm9yZSBwZXJzaXN0ZW
 50IGl0CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZ
 XJzb24KICAgICMgICBwZXJzaXN0ZWQgaXMgYm9vbGVhbiB2YWx1ZSB0byBzcGVjaWZ5IGlmIG9w
 ZXJhdGlvbiB0eXBlOiBhZGQvbW9kaWZ5CiAgICAjICAgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 gaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5PgogICAgZGVmIH
 VwZGF0ZVVzZXIoc2VsZiwgdXNlciwgcGVyc2lzdGVkLCBjb25maWd1cmF0aW9uQXR0cmlidXRlc
 yk6CiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBVcGRhdGVVc2VyIG1ldGhvZCIKCiAgICAg
 ICAgdWlkID0gdXNlci5nZXRVaWQoKQogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gVXNlciB
 VaWQ6IiwgdWlkCiAgICAgICAgCiAgICAgICAgbWFpbCA9IHVpZCArICJAZXhhbXBsZS5vcmciCi
 AgICAgICAgdXNlci5zZXRNYWlsKG1haWwpCgogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmI
 GdldEFwaVZlcnNpb24oc2VsZik6CiAgICAgICAgcmV0dXJuIDEK
oxScriptType: update_user
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!6EA0.8F0C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample User Registration script
displayName: user_registration
gluuStatus: false
inum: %(inumOrg)s!0011!6EA0.8F0C
oxConfigurationProperty: {"value1":"enable_user","value2":"false","description":
 ""}
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9ydCBVc
 2VyUmVnaXN0cmF0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLmxkYXAubW9kZWwgaW1wb3J0IEdsdXVTdGF0
 dXMNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXIsIEFycmF5SGVscGVyDQpmcm9
 tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QNCg0KaW1wb3J0IGphdmENCg0KY2xhc3
 MgVXNlclJlZ2lzdHJhdGlvbihVc2VyUmVnaXN0cmF0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fK
 HNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9
 IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cml
 idXRlcyk6DQogICAgICAgIHByaW50ICJVc2VyIHJlZ2lzdHJhdGlvbi4gSW5pdGlhbGl6YXRpb24iDQ
 oNCiAgICAgICAgc2VsZi5lbmFibGVfdXNlciA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJlbmFibGVfdXNlciIpLmdldFZhbHVlMigpLCBGYWxzZSkNCg0K
 ICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb24uIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSI
 NCg0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb24uIERlc3Ryb
 3kiDQogICAgICAgIHByaW50ICJVc2VyIHJlZ2lzdHJhdGlvbi4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxs
 eSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgICMgVXNlciByZWdpc3RyYXRpb24gaW5pdCB
 tZXRob2QNCiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZX
 Jzb24NCiAgICAjICAgcmVxdWVzdFBhcmFtZXRlcnMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFN0c
 mluZ1tdPg0KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0
 cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+DQogICAgZGVmIGluaXRSZWdpc3RyYXRpb24oc2VsZiw
 gdXNlciwgcmVxdWVzdFBhcmFtZXRlcnMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgIC
 AgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW9uLiBJbml0IG1ldGhvZCINCg0KICAgICAgICByZXR1cm4gV
 HJ1ZQ0KDQogICAgIyBVc2VyIHJlZ2lzdHJhdGlvbiBwcmUgbWV0aG9kDQogICAgIyAgIHVzZXIgaXMg
 b3JnLmdsdXUub3h0cnVzdC5tb2RlbC5HbHV1Q3VzdG9tUGVyc29uDQogICAgIyAgIHJlcXVlc3RQYXJ
 hbWV0ZXJzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTdHJpbmdbXT4NCiAgICAjICAgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3Blc
 nR5Pg0KICAgIGRlZiBwcmVSZWdpc3RyYXRpb24oc2VsZiwgdXNlciwgcmVxdWVzdFBhcmFtZXRlcnMs
 IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW9
 uLiBQcmUgbWV0aG9kIg0KDQogICAgICAgIHVzZXJTdGF0dXMgPSBHbHV1U3RhdHVzLkFDVElWRQ0KIC
 AgICAgICBpZiBub3Qgc2VsZi5lbmFibGVfdXNlcjoNCiAgICAgICAgICAgIHVzZXJTdGF0dXMgPSBHb
 HV1U3RhdHVzLklOQUNUSVZFDQoNCiAgICAgICAgIyBEaXNhYmxlL0VuYWJsZSByZWdpc3RlcmVkIHVz
 ZXINCiAgICAgICAgdXNlci5zZXRTdGF0dXModXNlclN0YXR1cykNCg0KICAgICAgICByZXR1cm4gVHJ
 1ZQ0KDQogICAgIyBVc2VyIHJlZ2lzdHJhdGlvbiBwb3N0IG1ldGhvZA0KICAgICMgICB1c2VyIGlzIG
 9yZy5nbHV1Lm94dHJ1c3QubW9kZWwuR2x1dUN1c3RvbVBlcnNvbg0KICAgICMgICByZXF1ZXN0UGFyY
 W1ldGVycyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU3RyaW5nW10+DQogICAgIyAgIGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21Qcm9wZXJ
 0eT4NCiAgICBkZWYgcG9zdFJlZ2lzdHJhdGlvbihzZWxmLCB1c2VyLCByZXF1ZXN0UGFyYW1ldGVycy
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb
 24uIFBvc3QgbWV0aG9kIg0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVy
 c2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg==
oxScriptType: user_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!A51E.76DA,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Authentication script
displayName: basic
gluuStatus: false
inum: %(inumOrg)s!0011!A51E.76DA
oxLevel: 100
oxModuleProperty: {"value1":"usage_type","value2":"both","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb2
 0gb3JnLnhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0a
 GVudGljYXRpb25UeXBlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J0IFVzZXJT
 ZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQoNCmltcG9ydCB
 qYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVH
 lwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgI
 CAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYg
 aW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJCYXN
 pYy4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJCYXNpYy4gSW5pdGlhbGl6ZWQgc3
 VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc
 2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQmFzaWMuIERl
 c3Ryb3kiDQogICAgICAgIHByaW50ICJCYXNpYy4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiA
 gICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICAgIC
 AgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmL
 CB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIFRy
 dWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHV
 zYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9uZQ
 0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc
 mVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAg
 ICAgICAgIHByaW50ICJCYXNpYy4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQoNCiAgICAgICA
 gICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQ
 ogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgI
 CAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KDQogICAg
 ICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5
 pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3
 RyaW5nKHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c2VyU2VydmljZSA9IFVzZ
 XJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2Vy
 dmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgICA
 gICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1c
 m4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0
 cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSA
 xKToNCiAgICAgICAgICAgIHByaW50ICJCYXNpYy4gUHJlcGFyZSBmb3IgU3RlcCAxIg0KICAgIC
 AgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGY
 WxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJh
 dGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGd
 ldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 k6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiwgY29uZ
 mlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gIiINCg0KICAgIGRl
 ZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJ
 zKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!4BBE.C6A8,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Basic (with user locking)
displayName: basic_lock
gluuStatus: false
inum: %(inumOrg)s!0011!4BBE.C6A8
oxConfigurationProperty: {"value1":"invalid_login_count_attribute","value2":
 "oxCountInvalidLogin","description":""}
oxConfigurationProperty: {"value1":"maximum_invalid_login_attemps","value2":
 "3","description":""}
oxLevel: 110
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""
 }
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb2
 0gb3JnLnhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0a
 GVudGljYXRpb25UeXBlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J0IFVzZXJT
 ZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy5
 nbHV1LnNpdGUubGRhcC5wZXJzaXN0ZW5jZS5leGNlcHRpb24gaW1wb3J0IEF1dGhlbnRpY2F0aW
 9uRXhjZXB0aW9uDQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uK
 FBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJl
 bnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnR
 UaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 k6DQogICAgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gSW5pdGlhbGl6YXRpb24iD
 QoNCiAgICAgICAgc2VsZi5pbnZhbGlkTG9naW5Db3VudEF0dHJpYnV0ZSA9ICJveENvdW50SW52
 YWxpZExvZ2luIg0KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0t
 leSgiaW52YWxpZF9sb2dpbl9jb3VudF9hdHRyaWJ1dGUiKToNCiAgICAgICAgICAgIHNlbGYuaW
 52YWxpZExvZ2luQ291bnRBdHRyaWJ1dGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoI
 mludmFsaWRfbG9naW5fY291bnRfYXR0cmlidXRlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgZWxz
 ZToNCiAgICAgICAgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gSW5pdGlhbGl6YXR
 pb24uIFVzaW5nIGRlZmF1bHQgYXR0cmlidXRlIg0KDQogICAgICAgIHNlbGYubWF4aW11bUludm
 FsaWRMb2dpbkF0dGVtcHMgPSAzDQogICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzL
 mNvbnRhaW5zS2V5KCJtYXhpbXVtX2ludmFsaWRfbG9naW5fYXR0ZW1wcyIpOg0KICAgICAgICAg
 ICAgc2VsZi5tYXhpbXVtSW52YWxpZExvZ2luQXR0ZW1wcyA9IFN0cmluZ0hlbHBlci50b0ludGV
 nZXIoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJtYXhpbXVtX2ludmFsaWRfbG9naW5fYX
 R0ZW1wcyIpLmdldFZhbHVlMigpKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQgI
 kJhc2ljIChsb2NrIGFjY291bnQpLiBJbml0aWFsaXphdGlvbi4gVXNpbmcgZGVmYXVsdCBudW1i
 ZXIgYXR0ZW1wdHMiDQoNCiAgICAgICAgcHJpbnQgIkJhc2ljIChsb2NrIGFjY291bnQpLiBJbml
 0aWFsaXplZCBzdWNjZXNzZnVsbHkuIGludmFsaWRfbG9naW5fY291bnRfYXR0cmlidXRlOiAnJX
 MnLCBtYXhpbXVtX2ludmFsaWRfbG9naW5fYXR0ZW1wczogJyVzJyIgJSAoc2VsZi5pbnZhbGlkT
 G9naW5Db3VudEF0dHJpYnV0ZSwgc2VsZi5tYXhpbXVtSW52YWxpZExvZ2luQXR0ZW1wcykNCg0K
 ICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJ
 hdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIE
 Rlc3Ryb3kiDQogICAgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gRGVzdHJveWVkI
 HN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJz
 aW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWN
 hdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCi
 AgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0a
 W9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAg
 ICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiBzdG
 VwID09IDE6DQogICAgICAgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIEF1dGhlb
 nRpY2F0ZSBmb3Igc3RlcCAxIg0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5
 Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY3J
 lZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZW
 RlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNC
 iAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUp
 IGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogICA
 gICAgICAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgIC
 AgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2Vyd
 mljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KICAgICAgICAgICAg
 ICAgIGV4Y2VwdCBBdXRoZW50aWNhdGlvbkV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICAgICA
 gcHJpbnQgIkJhc2ljIChsb2NrIGFjY291bnQpLiBBdXRoZW50aWNhdGUuIEZhaWxlZCB0byBhdX
 RoZW50aWNhdGUgdXNlciAnJXMnIiAlIHVzZXJfbmFtZQ0KDQogICAgICAgICAgICBpZiAobm90I
 GxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgY291bnRJbnZhbGlkTG9naW5BcnJpYnV0ZVZh
 bHVlID0gc2VsZi5nZXRVc2VyQXR0cmlidXRlVmFsdWUodXNlcl9uYW1lLCBzZWxmLmludmFsaWR
 Mb2dpbkNvdW50QXR0cmlidXRlKQ0KICAgICAgICAgICAgICAgIGNvdW50SW52YWxpZExvZ2luID
 0gU3RyaW5nSGVscGVyLnRvSW50ZWdlcihjb3VudEludmFsaWRMb2dpbkFycmlidXRlVmFsdWUsI
 DApDQoNCiAgICAgICAgICAgICAgICBpZiBjb3VudEludmFsaWRMb2dpbiA8IHNlbGYubWF4aW11
 bUludmFsaWRMb2dpbkF0dGVtcHM6DQogICAgICAgICAgICAgICAgICAgIGNvdW50SW52YWxpZEx
 vZ2luID0gY291bnRJbnZhbGlkTG9naW4gKyAxDQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2
 V0VXNlckF0dHJpYnV0ZVZhbHVlKHVzZXJfbmFtZSwgc2VsZi5pbnZhbGlkTG9naW5Db3VudEF0d
 HJpYnV0ZSwgU3RyaW5nSGVscGVyLnRvU3RyaW5nKGNvdW50SW52YWxpZExvZ2luKSkNCg0KICAg
 ICAgICAgICAgICAgIGlmIGNvdW50SW52YWxpZExvZ2luID49IHNlbGYubWF4aW11bUludmFsaWR
 Mb2dpbkF0dGVtcHM6DQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9ja1VzZXIodXNlcl9uYW
 1lKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNC
 g0KICAgICAgICAgICAgc2VsZi5zZXRVc2VyQXR0cmlidXRlVmFsdWUodXNlcl9uYW1lLCBzZWxm
 LmludmFsaWRMb2dpbkNvdW50QXR0cmlidXRlLCBTdHJpbmdIZWxwZXIudG9TdHJpbmcoMCkpDQo
 NCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZX
 R1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQ
 XR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiBzdGVwID09
 IDE6DQogICAgICAgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIFByZXBhcmUgZm9
 yIFN0ZXAgMSINCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgIC
 AgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwK
 HNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0dXJuIE5v
 bmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJ
 hdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGdldFBhZ2VGb3
 JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0d
 XJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBy
 ZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0VXN
 lckF0dHJpYnV0ZVZhbHVlKHNlbGYsIHVzZXJfbmFtZSwgYXR0cmlidXRlX25hbWUpOg0KICAgIC
 AgICBpZiBTdHJpbmdIZWxwZXIuaXNFbXB0eSh1c2VyX25hbWUpOg0KICAgICAgICAgICAgcmV0d
 XJuIE5vbmUNCg0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkN
 Cg0KICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlcih1c2VyX25
 hbWUsIGF0dHJpYnV0ZV9uYW1lKQ0KICAgICAgICBpZiBmaW5kX3VzZXJfYnlfdWlkID09IE5vbm
 U6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIGN1c3RvbV9hdHRyaWJ1dGVfd
 mFsdWUgPSB1c2VyU2VydmljZS5nZXRDdXN0b21BdHRyaWJ1dGUoZmluZF91c2VyX2J5X3VpZCwg
 YXR0cmlidXRlX25hbWUpDQogICAgICAgIGlmIGN1c3RvbV9hdHRyaWJ1dGVfdmFsdWUgPT0gTm9
 uZToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBhdHRyaWJ1dG
 VfdmFsdWUgPSBjdXN0b21fYXR0cmlidXRlX3ZhbHVlLmdldFZhbHVlKCkNCg0KICAgICAgICBwc
 mludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIEdldCB1c2VyIGF0dHJpYnV0ZS4gVXNlcidzICcl
 cycgYXR0cmlidXRlICclcycgdmFsdWUgaXMgJyVzJyIgJSAodXNlcl9uYW1lLCBhdHRyaWJ1dGV
 fbmFtZSwgYXR0cmlidXRlX3ZhbHVlKQ0KDQogICAgICAgIHJldHVybiBhdHRyaWJ1dGVfdmFsdW
 UNCg0KICAgIGRlZiBzZXRVc2VyQXR0cmlidXRlVmFsdWUoc2VsZiwgdXNlcl9uYW1lLCBhdHRya
 WJ1dGVfbmFtZSwgYXR0cmlidXRlX3ZhbHVlKToNCiAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlz
 RW1wdHkodXNlcl9uYW1lKToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgdXN
 lclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgZmluZF91c2VyX2
 J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXIodXNlcl9uYW1lKQ0KICAgICAgICBpZiBmaW5kX
 3VzZXJfYnlfdWlkID09IE5vbmU6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICAN
 CiAgICAgICAgdXNlclNlcnZpY2Uuc2V0Q3VzdG9tQXR0cmlidXRlKGZpbmRfdXNlcl9ieV91aWQ
 sIGF0dHJpYnV0ZV9uYW1lLCBhdHRyaWJ1dGVfdmFsdWUpDQogICAgICAgIHVwZGF0ZWRfdXNlci
 A9IHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXIoZmluZF91c2VyX2J5X3VpZCkNCg0KICAgICAgICBwc
 mludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIFNldCB1c2VyIGF0dHJpYnV0ZS4gVXNlcidzICcl
 cycgYXR0cmlidXRlICclcycgdmFsdWUgaXMgJyVzJyIgJSAodXNlcl9uYW1lLCBhdHRyaWJ1dGV
 fbmFtZSwgYXR0cmlidXRlX3ZhbHVlKQ0KDQogICAgICAgIHJldHVybiB1cGRhdGVkX3VzZXINCg
 0KICAgIGRlZiBsb2NrVXNlcihzZWxmLCB1c2VyX25hbWUpOg0KICAgICAgICBpZiBTdHJpbmdIZ
 WxwZXIuaXNFbXB0eSh1c2VyX25hbWUpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAg
 ICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBmaW5
 kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlcih1c2VyX25hbWUpDQogICAgICAgIG
 lmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNC
 g0KICAgICAgICBzdGF0dXNfYXR0cmlidXRlX3ZhbHVlID0gdXNlclNlcnZpY2UuZ2V0Q3VzdG9t
 QXR0cmlidXRlKGZpbmRfdXNlcl9ieV91aWQsICJnbHV1U3RhdHVzIikNCiAgICAgICAgaWYgc3R
 hdHVzX2F0dHJpYnV0ZV92YWx1ZSAhPSBOb25lOg0KICAgICAgICAgICAgdXNlcl9zdGF0dXMgPS
 BzdGF0dXNfYXR0cmlidXRlX3ZhbHVlLmdldFZhbHVlKCkNCiAgICAgICAgICAgIGlmIFN0cmluZ
 0hlbHBlci5lcXVhbHModXNlcl9zdGF0dXMsICJpbmFjdGl2ZSIpOg0KICAgICAgICAgICAgICAg
 IHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gTG9jayB1c2VyLiBVc2VyICclcycgbG9ja2V
 kIGFscmVhZHkiICUgdXNlcl9uYW1lDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA
 0KICAgICAgICB1c2VyU2VydmljZS5zZXRDdXN0b21BdHRyaWJ1dGUoZmluZF91c2VyX2J5X3VpZ
 CwgImdsdXVTdGF0dXMiLCAiaW5hY3RpdmUiKQ0KICAgICAgICB1cGRhdGVkX3VzZXIgPSB1c2Vy
 U2VydmljZS51cGRhdGVVc2VyKGZpbmRfdXNlcl9ieV91aWQpDQoNCiAgICAgICAgcHJpbnQgIkJ
 hc2ljIChsb2NrIGFjY291bnQpLiBMb2NrIHVzZXIuIFVzZXIgJyVzJyBsb2NrZWQiICUgdXNlcl
 9uYW1lDQo=
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!8BAF.80D6,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Fido U2F authentication module
displayName: u2f
gluuStatus: false
inum: %(inumOrg)s!0011!8BAF.80D6
oxConfigurationProperty: {"value1":"u2f_application_id","value2":"https://%(hostname)s","description":""}
oxConfigurationProperty: {"value1":"u2f_server_uri","value2":"https://%(hostname)s","description":""}
oxLevel: 10
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydC
 BQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLmpib3NzLnNlYW0uY29udGV4dHMga
 W1wb3J0IENvbnRleHQsIENvbnRleHRzDQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGlt
 cG9ydCBJZGVudGl0eQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2V
 ydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBTZXNzaW9uU3RhdGVTZX
 J2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy54Z
 GkudXRpbCBpbXBvcnQgQXJyYXlIZWxwZXINCmZyb20gb3JnLnhkaS5veGF1dGguY2xpZW50LmZp
 ZG8udTJmIGltcG9ydCBGaWRvVTJmQ2xpZW50RmFjdG9yeQ0KZnJvbSBvcmcueGRpLm94YXV0aC5
 zZXJ2aWNlLmZpZG8udTJmIGltcG9ydCBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlDQpmcm9tIG
 9yZy54ZGkub3hhdXRoLnV0aWwgaW1wb3J0IFNlcnZlclV0aWwNCmZyb20gb3JnLnhkaS5veGF1d
 GgubW9kZWwuY29uZmlnIGltcG9ydCBDb25zdGFudHMNCmZyb20gb3JnLmpib3NzLnJlc3RlYXN5
 LmNsaWVudCBpbXBvcnQgQ2xpZW50UmVzcG9uc2VGYWlsdXJlDQpmcm9tIGphdmF4LndzLnJzLmN
 vcmUgaW1wb3J0IFJlc3BvbnNlDQpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzDQoNCmltcG
 9ydCBzeXMNCmltcG9ydCBqYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvb
 kF1dGhlbnRpY2F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1l
 TWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWl
 sbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogIC
 AgICAgIHByaW50ICJVMkYuIEluaXRpYWxpemF0aW9uIg0KDQogICAgICAgIHByaW50ICJVMkYuI
 EluaXRpYWxpemF0aW9uLiBEb3dubG9hZGluZyBVMkYgbWV0YWRhdGEiDQogICAgICAgIHUyZl9z
 ZXJ2ZXJfdXJpID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJ1MmZfc2VydmVyX3VyaSI
 pLmdldFZhbHVlMigpDQogICAgICAgIHUyZl9zZXJ2ZXJfbWV0YWRhdGFfdXJpID0gdTJmX3Nlcn
 Zlcl91cmkgKyAiLy53ZWxsLWtub3duL2ZpZG8tdTJmLWNvbmZpZ3VyYXRpb24iDQoNCiAgICAgI
 CAgbWV0YURhdGFDb25maWd1cmF0aW9uU2VydmljZSA9IEZpZG9VMmZDbGllbnRGYWN0b3J5Lmlu
 c3RhbmNlKCkuY3JlYXRlTWV0YURhdGFDb25maWd1cmF0aW9uU2VydmljZSh1MmZfc2VydmVyX21
 ldGFkYXRhX3VyaSkNCg0KICAgICAgICBtYXhfYXR0ZW1wdHMgPSAzDQogICAgICAgIGZvciBhdH
 RlbXB0IGluIHJhbmdlKDEsIG1heF9hdHRlbXB0cyk6DQogICAgICAgICAgICB0cnk6DQogICAgI
 CAgICAgICAgICAgc2VsZi5tZXRhRGF0YUNvbmZpZ3VyYXRpb24gPSBtZXRhRGF0YUNvbmZpZ3Vy
 YXRpb25TZXJ2aWNlLmdldE1ldGFkYXRhQ29uZmlndXJhdGlvbigpDQogICAgICAgICAgICAgICA
 gYnJlYWsNCiAgICAgICAgICAgIGV4Y2VwdCBDbGllbnRSZXNwb25zZUZhaWx1cmUsIGV4Og0KIC
 AgICAgICAgICAgICAgICMgRGV0ZWN0IGlmIGxhc3QgdHJ5IG9yIHdlIHN0aWxsIGdldCBTZXJ2a
 WNlIFVuYXZhaWxhYmxlIEhUVFAgZXJyb3INCiAgICAgICAgICAgICAgICBpZiAoYXR0ZW1wdCA9
 PSBtYXhfYXR0ZW1wdHMpIG9yIChleC5nZXRSZXNwb25zZSgpLmdldFJlc3BvbnNlU3RhdHVzKCk
 gIT0gUmVzcG9uc2UuU3RhdHVzLlNFUlZJQ0VfVU5BVkFJTEFCTEUpOg0KICAgICAgICAgICAgIC
 AgICAgICByYWlzZSBleA0KDQogICAgICAgICAgICAgICAgamF2YS5sYW5nLlRocmVhZC5zbGVlc
 CgzMDAwKQ0KICAgICAgICAgICAgICAgIHByaW50ICJBdHRlbXB0aW5nIHRvIGxvYWQgbWV0YWRh
 dGE6ICVkIiAlIGF0dGVtcHQNCiAgICAgICAgDQogICAgICAgIHByaW50ICJVMkYuIEluaXRpYWx
 pemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZX
 N0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlUyR
 i4gRGVzdHJveSINCiAgICAgICAgcHJpbnQgIlUyRi4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSIN
 CiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICA
 gICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZW
 xmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuI
 FRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYs
 IHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9
 uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 wgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50a
 XR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVk
 ZW50aWFscy5nZXRVc2VybmFtZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICA
 gICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgIC
 AgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCiAgICAgICAgICAgI
 GxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1w
 dHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXN
 lcl9wYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2
 UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1d
 GhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChu
 b3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICA
 gICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIH
 ByaW50ICJVMkYuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICB0b2tlb
 l9yZXNwb25zZSA9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF1ZXN0UGFyYW1ldGVycywg
 InRva2VuUmVzcG9uc2UiKQ0KICAgICAgICAgICAgaWYgdG9rZW5fcmVzcG9uc2UgPT0gTm9uZTo
 NCiAgICAgICAgICAgICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gdG
 9rZW5SZXNwb25zZSBpcyBlbXB0eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KI
 CAgICAgICAgICAgYXV0aF9tZXRob2QgPSBTZXJ2ZXJVdGlsLmdldEZpcnN0VmFsdWUocmVxdWVz
 dFBhcmFtZXRlcnMsICJhdXRoTWV0aG9kIikNCiAgICAgICAgICAgIGlmIGF1dGhfbWV0aG9kID0
 9IE5vbmU6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gQXV0aGVudGljYXRlIGZvciBzdG
 VwIDIuIGF1dGhNZXRob2QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlD
 QoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVk
 ZW50aWFscygpDQogICAgICAgICAgICB1c2VyID0gY3JlZGVudGlhbHMuZ2V0VXNlcigpDQogICA
 gICAgICAgICBpZiAodXNlciA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiVTJGLi
 BQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBkZXRlcm1pbmUgdXNlciBuYW1lIg0KICAgI
 CAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBpZiAoYXV0aF9tZXRob2Qg
 PT0gJ2F1dGhlbnRpY2F0ZScpOg0KICAgICAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmU
 gZm9yIHN0ZXAgMi4gQ2FsbCBGSURPIFUyRiBpbiBvcmRlciB0byBmaW5pc2ggYXV0aGVudGljYX
 Rpb24gd29ya2Zsb3ciDQogICAgICAgICAgICAgICAgYXV0aGVudGljYXRpb25SZXF1ZXN0U2Vyd
 mljZSA9IEZpZG9VMmZDbGllbnRGYWN0b3J5Lmluc3RhbmNlKCkuY3JlYXRlQXV0aGVudGljYXRp
 b25SZXF1ZXN0U2VydmljZShzZWxmLm1ldGFEYXRhQ29uZmlndXJhdGlvbikNCiAgICAgICAgICA
 gICAgICBhdXRoZW50aWNhdGlvblN0YXR1cyA9IGF1dGhlbnRpY2F0aW9uUmVxdWVzdFNlcnZpY2
 UuZmluaXNoQXV0aGVudGljYXRpb24odXNlci5nZXRVc2VySWQoKSwgdG9rZW5fcmVzcG9uc2UpD
 QoNCiAgICAgICAgICAgICAgICBpZiAoYXV0aGVudGljYXRpb25TdGF0dXMuZ2V0U3RhdHVzKCkg
 IT0gQ29uc3RhbnRzLlJFU1VMVF9TVUNDRVNTKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQ
 gIlUyRi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEdldCBpbnZhbGlkIGF1dGhlbnRpY2F0aW
 9uIHN0YXR1cyBmcm9tIEZJRE8gVTJGIHNlcnZlciINCiAgICAgICAgICAgICAgICAgICAgcmV0d
 XJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZWxp
 ZiAoYXV0aF9tZXRob2QgPT0gJ2Vucm9sbCcpOg0KICAgICAgICAgICAgICAgIHByaW50ICJVMkY
 uIFByZXBhcmUgZm9yIHN0ZXAgMi4gQ2FsbCBGSURPIFUyRiBpbiBvcmRlciB0byBmaW5pc2ggcm
 VnaXN0cmF0aW9uIHdvcmtmbG93Ig0KICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvblJlcXVlc
 3RTZXJ2aWNlID0gRmlkb1UyZkNsaWVudEZhY3RvcnkuaW5zdGFuY2UoKS5jcmVhdGVSZWdpc3Ry
 YXRpb25SZXF1ZXN0U2VydmljZShzZWxmLm1ldGFEYXRhQ29uZmlndXJhdGlvbikNCiAgICAgICA
 gICAgICAgICByZWdpc3RyYXRpb25TdGF0dXMgPSByZWdpc3RyYXRpb25SZXF1ZXN0U2VydmljZS
 5maW5pc2hSZWdpc3RyYXRpb24odXNlci5nZXRVc2VySWQoKSwgdG9rZW5fcmVzcG9uc2UpDQoNC
 iAgICAgICAgICAgICAgICBpZiAocmVnaXN0cmF0aW9uU3RhdHVzLmdldFN0YXR1cygpICE9IENv
 bnN0YW50cy5SRVNVTFRfU1VDQ0VTUyk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJVMkY
 uIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBHZXQgaW52YWxpZCByZWdpc3RyYXRpb24gc3RhdH
 VzIGZyb20gRklETyBVMkYgc2VydmVyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc
 2UNCg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICBlbHNlOg0KICAg
 ICAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gQXV0aGVudGljYXR
 pb2QgbWV0aG9kIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0d
 XJuIEZhbHNlDQoNCiAgICBkZWYgcHJlcGFyZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IEN
 vbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogIC
 AgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09IDIpOg0KICAgICAgI
 CAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICBzZXNz
 aW9uX3N0YXRlID0gU2Vzc2lvblN0YXRlU2VydmljZS5pbnN0YW5jZSgpLmdldFNlc3Npb25TdGF
 0ZUZyb21Db29raWUoKQ0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkoc2Vzc2
 lvbl9zdGF0ZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3Rlc
 CAyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHNlc3Npb25fc3RhdGUiDQogICAgICAgICAgICAgICAg
 cmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGF
 uY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICAgICB1c2VyID0gY3JlZGVudGlhbHMuZ2
 V0VXNlcigpDQoNCiAgICAgICAgICAgIGlmICh1c2VyID09IE5vbmUpOg0KICAgICAgICAgICAgI
 CAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZSB1
 c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHU
 yZl9hcHBsaWNhdGlvbl9pZCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgidTJmX2FwcG
 xpY2F0aW9uX2lkIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICAgICAgIyBDaGVjayBpZiB1c2VyI
 GhhdmUgcmVnaXN0ZXJlZCBkZXZpY2VzDQogICAgICAgICAgICBkZXZpY2VSZWdpc3RyYXRpb25T
 ZXJ2aWNlID0gRGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICA
 gICAgIHVzZXJJbnVtID0gdXNlci5nZXRBdHRyaWJ1dGUoImludW0iKQ0KDQogICAgICAgICAgIC
 BhdXRoZW50aWNhdGlvblJlcXVlc3QgPSBOb25lDQoNCiAgICAgICAgICAgIGRldmljZVJlZ2lzd
 HJhdGlvbnMgPSBkZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmZpbmRVc2VyRGV2aWNlUmVnaXN0
 cmF0aW9ucyh1c2VySW51bSwgdTJmX2FwcGxpY2F0aW9uX2lkKQ0KICAgICAgICAgICAgaWYgKGR
 ldmljZVJlZ2lzdHJhdGlvbnMuc2l6ZSgpID4gMCk6DQogICAgICAgICAgICAgICAgcHJpbnQgIl
 UyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBDYWxsIEZJRE8gVTJGIGluIG9yZGVyIHRvIHN0YXJ0I
 GF1dGhlbnRpY2F0aW9uIHdvcmtmbG93Ig0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAg
 ICAgICAgICAgICAgICBhdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlID0gRmlkb1UyZkNsaWV
 udEZhY3RvcnkuaW5zdGFuY2UoKS5jcmVhdGVBdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlKH
 NlbGYubWV0YURhdGFDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgICAgICAgICBhdXRoZW50a
 WNhdGlvblJlcXVlc3QgPSBhdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlLnN0YXJ0QXV0aGVu
 dGljYXRpb24odXNlci5nZXRVc2VySWQoKSwgTm9uZSwgdTJmX2FwcGxpY2F0aW9uX2lkLCBzZXN
 zaW9uX3N0YXRlKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdCBDbGllbnRSZXNwb25zZUZhaWx1cm
 UsIGV4Og0KICAgICAgICAgICAgICAgICAgICBpZiAoZXguZ2V0UmVzcG9uc2UoKS5nZXRSZXNwb
 25zZVN0YXR1cygpICE9IFJlc3BvbnNlLlN0YXR1cy5OT1RfRk9VTkQpOg0KICAgICAgICAgICAg
 ICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gc3R
 hcnQgYXV0aGVudGljYXRpb24gd29ya2Zsb3cuIEV4Y2VwdGlvbjoiLCBzeXMuZXhjX2luZm8oKV
 sxXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgI
 HByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gQ2FsbCBGSURPIFUyRiBpbiBvcmRlciB0
 byBzdGFydCByZWdpc3RyYXRpb24gd29ya2Zsb3ciDQogICAgICAgICAgICByZWdpc3RyYXRpb25
 SZXF1ZXN0U2VydmljZSA9IEZpZG9VMmZDbGllbnRGYWN0b3J5Lmluc3RhbmNlKCkuY3JlYXRlUm
 VnaXN0cmF0aW9uUmVxdWVzdFNlcnZpY2Uoc2VsZi5tZXRhRGF0YUNvbmZpZ3VyYXRpb24pDQogI
 CAgICAgICAgICByZWdpc3RyYXRpb25SZXF1ZXN0ID0gcmVnaXN0cmF0aW9uUmVxdWVzdFNlcnZp
 Y2Uuc3RhcnRSZWdpc3RyYXRpb24odXNlci5nZXRVc2VySWQoKSwgdTJmX2FwcGxpY2F0aW9uX2l
 kLCBzZXNzaW9uX3N0YXRlKQ0KDQogICAgICAgICAgICBjb250ZXh0LnNldCgiZmlkb191MmZfYX
 V0aGVudGljYXRpb25fcmVxdWVzdCIsIFNlcnZlclV0aWwuYXNKc29uKGF1dGhlbnRpY2F0aW9uU
 mVxdWVzdCkpDQogICAgICAgICAgICBjb250ZXh0LnNldCgiZmlkb191MmZfcmVnaXN0cmF0aW9u
 X3JlcXVlc3QiLCBTZXJ2ZXJVdGlsLmFzSnNvbihyZWdpc3RyYXRpb25SZXF1ZXN0KSkNCg0KICA
 gICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAzKToNCiAgICAgIC
 AgICAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgcmV0d
 XJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAg
 ZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV
 0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGdldENvdW50QXV0aG
 VudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgI
 HJldHVybiAyDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHJ
 ldHVybiAiL2F1dGgvdTJmL2xvZ2luLnhodG1sIg0KDQogICAgICAgIHJldHVybiAiIg0KDQogIC
 AgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZ
 XRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!92F0.BF9E,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Super Gluu authentication module
displayName: super_gluu
gluuStatus: false
inum: %(inumOrg)s!0011!92F0.BF9E
oxConfigurationProperty: {"value1":"label","value2":"Super Gluu","description":""}
oxConfigurationProperty: {"value1":"registration_uri","value2":"https://%(hostname)s/identity/register","description":""}
oxConfigurationProperty: {"value1":"authentication_mode","value2":"two_step","de
 scription":""}
oxConfigurationProperty: {"value1":"credentials_file","value2":"/etc/certs/super_gluu_creds.json","description":""}
oxLevel: 15
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""
 }
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuI
 FNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuDQojIENv
 cHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KaW1
 wb3J0IHN5cw0KaW1wb3J0IGRhdGV0aW1lDQppbXBvcnQgdXJsbGliDQoNCmZyb20gb3JnLnhkaS5tb2
 RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0aGVudGljYXRpb25UeXBlD
 Qpmcm9tIG9yZy5qYm9zcy5zZWFtLmNvbnRleHRzIGltcG9ydCBDb250ZXh0cw0KZnJvbSBvcmcuamJv
 c3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb20gb3JnLnhkaS5veGF1dGguc2Vydml
 jZSBpbXBvcnQgVXNlclNlcnZpY2UNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgU2
 Vzc2lvblN0YXRlU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLmZpZG8udTJmIGltc
 G9ydCBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3Ry
 aW5nSGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLnV0aWwgaW1wb3J0IFNlcnZlclV0aWwNCmZyb20
 gb3JnLnhkaS51dGlsLnNlY3VyaXR5IGltcG9ydCBTdHJpbmdFbmNyeXB0ZXINCmZyb20gb3JnLnhkaS
 5veGF1dGgubW9kZWwuY29uZmlnIGltcG9ydCBDb25maWd1cmF0aW9uRmFjdG9yeQ0KZnJvbSBqYXZhL
 nV0aWwgaW1wb3J0IEFycmF5cw0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLm5ldCBpbXBvcnQg
 SHR0cFNlcnZpY2UNCmZyb20gb3JnLmFwYWNoZS5odHRwLnBhcmFtcyBpbXBvcnQgQ29yZUNvbm5lY3R
 pb25QTmFtZXMNCmZyb20gY29tLm5vdG5vb3AuYXBucyBpbXBvcnQgQVBOUw0KZnJvbSBjb20uZ29vZ2
 xlLmFuZHJvaWQuZ2NtLnNlcnZlciBpbXBvcnQgU2VuZGVyLCBNZXNzYWdlDQoNCg0KdHJ5Og0KICAgI
 GltcG9ydCBqc29uDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgaW1wb3J0IHNpbXBsZWpzb24gYXMg
 anNvbg0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNhdGlvblR5cGU
 pOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbG
 YuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZ
 iwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gSW5p
 dGlhbGl6YXRpb24iDQoNCiAgICAgICAgaWYgbm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnR
 haW5zS2V5KCJhdXRoZW50aWNhdGlvbl9tb2RlIik6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2
 x1dS4gSW5pdGlhbGl6YXRpb24uIFByb3BlcnR5IGF1dGhlbnRpY2F0aW9uX21vZGUgaXMgbWFuZGF0b
 3J5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2VsZi5yZWdpc3RyYXRpb25V
 cmkgPSBOb25lDQogICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJ
 yZWdpc3RyYXRpb25fdXJpIik6DQogICAgICAgICAgICBzZWxmLnJlZ2lzdHJhdGlvblVyaSA9IGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgicmVnaXN0cmF0aW9uX3VyaSIpLmdldFZhbHVlMigpDQoNC
 iAgICAgICAgYXV0aGVudGljYXRpb25fbW9kZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgi
 YXV0aGVudGljYXRpb25fbW9kZSIpLmdldFZhbHVlMigpDQogICAgICAgIGlmIFN0cmluZ0hlbHBlci5
 pc0VtcHR5KGF1dGhlbnRpY2F0aW9uX21vZGUpOg0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdX
 UuIEluaXRpYWxpemF0aW9uLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIGF1dGhlbnRpY2F0aW9uX21vZGUuI
 GF1dGhlbnRpY2F0aW9uX21vZGUgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXIgaXMgZW1wdHkiDQogICAg
 ICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgDQogICAgICAgIHNlbGYub25lU3RlcCA9IFN0cml
 uZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGF1dGhlbnRpY2F0aW9uX21vZGUsICJvbmVfc3RlcCIpDQ
 ogICAgICAgIHNlbGYudHdvU3RlcCA9IFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGF1dGhlb
 nRpY2F0aW9uX21vZGUsICJ0d29fc3RlcCIpDQoNCiAgICAgICAgaWYgbm90IChzZWxmLm9uZVN0ZXAg
 b3Igc2VsZi50d29TdGVwKToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbml0aWFsaXp
 hdGlvbi4gVmFsaWQgYXV0aGVudGljYXRpb25fbW9kZSB2YWx1ZXMgYXJlIG9uZV9zdGVwIGFuZCB0d2
 9fc3RlcCINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgc2VsZi5lb
 mFibGVkUHVzaE5vdGlmaWNhdGlvbnMgPSBzZWxmLmluaXRQdXNoTm90aWZpY2F0aW9uU2VydmljZShj
 b25maWd1cmF0aW9uQXR0cmlidXRlcykNCg0KICAgICAgICBzZWxmLmN1c3RvbUxhYmVsID0gTm9uZQ0
 KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgibGFiZWwiKToNCi
 AgICAgICAgICAgIHNlbGYuY3VzdG9tTGFiZWwgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoI
 mxhYmVsIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gSW5pdGlhbGl6
 ZWQgc3VjY2Vzc2Z1bGx5LiBvbmVTdGVwOiAnJXMnLCB0d29TdGVwOiAnJXMnLCBwdXNoTm90aWZpY2F
 0aW9uczogJyVzJywgY3VzdG9tTGFiZWw6ICclcyciICUgKHNlbGYub25lU3RlcCwgc2VsZi50d29TdG
 VwLCBzZWxmLmVuYWJsZWRQdXNoTm90aWZpY2F0aW9ucywgc2VsZi5jdXN0b21MYWJlbCkNCg0KICAgI
 CAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gRGVzdHJveSINCiAgICAgICAgcHJ
 pbnQgIlN1cGVyLUdsdXUuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcn
 VlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgI
 GRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0
 aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXR
 pdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaW
 J1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY
 29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAg
 Y3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICA
 gdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGNvbnRleHQgPS
 BDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBzZXNzaW9uX2F0dHJpYnV0ZXMgPSBjb
 250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKQ0KDQogICAgICAgIGNsaWVudF9yZWRpcmVjdF91
 cmkgPSBzZWxmLmdldENsaWVudFJlZGlyZWNVcmkoc2Vzc2lvbl9hdHRyaWJ1dGVzKQ0KICAgICAgICB
 pZiBjbGllbnRfcmVkaXJlY3RfdXJpID09IE5vbmU6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2
 x1dS4gQXV0aGVudGljYXRlLiByZWRpcmVjdF91cmkgaXMgbm90IHNldCINCiAgICAgICAgICAgIHJld
 HVybiBGYWxzZQ0KDQogICAgICAgIHNlbGYuc2V0RXZlbnRDb250ZXh0UGFyYW1ldGVycyhjb250ZXh0
 KQ0KDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICB
 kZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlID0gRGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5pbnN0YW
 5jZSgpDQogICAgICAgIGlmIHN0ZXAgPT0gMToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1L
 iBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCiAgICAgICAgICAgIGlmIHNlbGYub25lU3RlcDoNCiAg
 DQogICAgICAgICAgICAgICAgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzID0gc2VsZi5nZXRTZXNzaW9uRGV
 2aWNlU3RhdHVzKHNlc3Npb25fYXR0cmlidXRlcywgdXNlcl9uYW1lKQ0KICAgICAgICAgICAgICAgIG
 lmIHNlc3Npb25fZGV2aWNlX3N0YXR1cyA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICByZXR1c
 m4NCg0KICAgICAgICAgICAgICAgIHUyZl9kZXZpY2VfaWQgPSBzZXNzaW9uX2RldmljZV9zdGF0dXNb
 J2RldmljZV9pZCddDQoNCiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX3Jlc3VsdCA9IHNlbGYudmF
 saWRhdGVTZXNzaW9uRGV2aWNlU3RhdHVzKGNsaWVudF9yZWRpcmVjdF91cmksIHNlc3Npb25fZGV2aW
 NlX3N0YXR1cykNCiAgICAgICAgICAgICAgICBpZiB2YWxpZGF0aW9uX3Jlc3VsdDoNCiAgICAgICAgI
 CAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBVc2Vy
 IHN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkIHdpdGggdTJmX2RldmljZSAnJXMnIiAlIHUyZl9kZXZ
 pY2VfaWQNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRm
 Fsc2UNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgbm90IHNlc3Npb25fZ
 GV2aWNlX3N0YXR1c1snb25lX3N0ZXAnXToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVy
 LUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiB1MmZfZGV2aWNlICclcycgaXMgbm90IG9uZSB
 zdGVwIGRldmljZSIgJSB1MmZfZGV2aWNlX2lkDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYW
 xzZQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIFRoZXJlIGFyZSB0d28gc
 3RlcHMgb25seSBpbiBlbnJvbGxtZW50IG1vZGUNCiAgICAgICAgICAgICAgICBpZiBzZXNzaW9uX2Rl
 dmljZV9zdGF0dXNbJ2Vucm9sbCddOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGl
 vbl9yZXN1bHQNCg0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzdXBlcl9nbHV1X2NvdW50X2
 xvZ2luX3N0ZXBzIiwgMSkNCg0KICAgICAgICAgICAgICAgIHVzZXJfaW51bSA9IHNlc3Npb25fZGV2a
 WNlX3N0YXR1c1sndXNlcl9pbnVtJ10NCg0KICAgICAgICAgICAgICAgIHUyZl9kZXZpY2UgPSBkZXZp
 Y2VSZWdpc3RyYXRpb25TZXJ2aWNlLmZpbmRVc2VyRGV2aWNlUmVnaXN0cmF0aW9uKHVzZXJfaW51bSw
 gdTJmX2RldmljZV9pZCwgIm94SWQiKQ0KICAgICAgICAgICAgICAgIGlmIHUyZl9kZXZpY2UgPT0gTm
 9uZToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb
 3Igc3RlcCAxLiBGYWlsZWQgdG8gbG9hZCB1MmZfZGV2aWNlICclcyciICUgdTJmX2RldmljZV9pZA0K
 ICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIGxvZ2dlZF9
 pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUpDQogICAgICAgICAgICAgICAgaW
 Ygbm90IGxvZ2dlZF9pbjoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1d
 GhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIgJyVzJyIgJSB1
 c2VyX25hbWUNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICA
 gICBwcmludCAiU3VwZXItR2x1dS4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFVzZXIgJyVzJyBzdW
 NjZXNzZnVsbHkgYXV0aGVudGljYXRlZCB3aXRoIHUyZl9kZXZpY2UgJyVzJyIgJSAodXNlcl9uYW1lL
 CB1MmZfZGV2aWNlX2lkKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBU
 cnVlDQogICAgICAgICAgICBlbGlmIHNlbGYudHdvU3RlcDoNCiAgICAgICAgICAgICAgICBhdXRoZW5
 0aWNhdGVkX3VzZXIgPSBzZWxmLnByb2Nlc3NCYXNpY0F1dGhlbnRpY2F0aW9uKGNyZWRlbnRpYWxzKQ
 0KICAgICAgICAgICAgICAgIGlmIGF1dGhlbnRpY2F0ZWRfdXNlciA9PSBOb25lOg0KICAgICAgICAgI
 CAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICAgICAgICAgICAgICBhdXRoX21ldGhvZCA9
 ICdhdXRoZW50aWNhdGUnDQogICAgICAgICAgICAgICAgZW5yb2xsbWVudF9tb2RlID0gU2VydmVyVXR
 pbC5nZXRGaXJzdFZhbHVlKHJlcXVlc3RQYXJhbWV0ZXJzLCAibG9naW5Gb3JtOnJlZ2lzdGVyQnV0dG
 9uIikNCiAgICAgICAgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eShlbnJvbGxtZW50X
 21vZGUpOg0KICAgICAgICAgICAgICAgICAgICBhdXRoX21ldGhvZCA9ICdlbnJvbGwnDQogICAgICAg
 ICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgYXV0aF9tZXRob2QgPT0gJ2F1dGhlbnRpY2F0ZSc
 6DQogICAgICAgICAgICAgICAgICAgIHVzZXJfaW51bSA9IHVzZXJTZXJ2aWNlLmdldFVzZXJJbnVtKG
 F1dGhlbnRpY2F0ZWRfdXNlcikNCiAgICAgICAgICAgICAgICAgICAgdTJmX2RldmljZXNfbGlzdCA9I
 GRldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UuZmluZFVzZXJEZXZpY2VSZWdpc3RyYXRpb25zKHVzZXJf
 aW51bSwgY2xpZW50X3JlZGlyZWN0X3VyaSwgIm94SWQiKQ0KICAgICAgICAgICAgICAgICAgICBpZiB
 1MmZfZGV2aWNlc19saXN0LnNpemUoKSA9PSAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgYXV0aF
 9tZXRob2QgPSAnZW5yb2xsJw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsd
 XUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBUaGVyZSBpcyBubyBVMkYgJyVzJyB1c2VyIGRldmlj
 ZXMgYXNzb2NpYXRlZCB3aXRoIGFwcGxpY2F0aW9uICclcycuIENoYW5naW5nIGF1dGhfbWV0aG9kIHR
 vICclcyciICUgKHVzZXJfbmFtZSwgY2xpZW50X3JlZGlyZWN0X3VyaSwgYXV0aF9tZXRob2QpDQogIC
 AgDQogICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3Rlc
 CAxLiBhdXRoX21ldGhvZDogJyVzJyIgJSBhdXRoX21ldGhvZA0KICAgICAgICAgICAgICAgIA0KICAg
 ICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzdXBlcl9nbHV1X2F1dGhfbWV0aG9kIiwgYXV0aF9tZXR
 ob2QpDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgICAgICAgICByZXR1cm4gRm
 Fsc2UNCiAgICAgICAgZWxpZiBzdGVwID09IDI6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1d
 S4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIiDQogICAgICAgICAgICBzZXNzaW9uX2F0dHJpYnV0ZXMg
 PSBjb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKQ0KDQogICAgICAgICAgICBzZXNzaW9uX2R
 ldmljZV9zdGF0dXMgPSBzZWxmLmdldFNlc3Npb25EZXZpY2VTdGF0dXMoc2Vzc2lvbl9hdHRyaWJ1dG
 VzLCB1c2VyX25hbWUpDQogICAgICAgICAgICBpZiBzZXNzaW9uX2RldmljZV9zdGF0dXMgPT0gTm9uZ
 ToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgdTJmX2RldmljZV9p
 ZCA9IHNlc3Npb25fZGV2aWNlX3N0YXR1c1snZGV2aWNlX2lkJ10NCg0KICAgICAgICAgICAgIyBUaGV
 yZSBhcmUgdHdvIHN0ZXBzIG9ubHkgaW4gZW5yb2xsbWVudCBtb2RlDQogICAgICAgICAgICBpZiBzZW
 xmLm9uZVN0ZXAgYW5kIHNlc3Npb25fZGV2aWNlX3N0YXR1c1snZW5yb2xsJ106DQogICAgICAgICAgI
 CAgICAgYXV0aGVudGljYXRlZF91c2VyID0gc2VsZi5wcm9jZXNzQmFzaWNBdXRoZW50aWNhdGlvbihj
 cmVkZW50aWFscykNCiAgICAgICAgICAgICAgICBpZiBhdXRoZW50aWNhdGVkX3VzZXIgPT0gTm9uZTo
 NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICB1c2VyX2
 ludW0gPSB1c2VyU2VydmljZS5nZXRVc2VySW51bShhdXRoZW50aWNhdGVkX3VzZXIpDQogICAgICAgI
 CAgICAgICAgDQogICAgICAgICAgICAgICAgYXR0YWNoX3Jlc3VsdCA9IGRldmljZVJlZ2lzdHJhdGlv
 blNlcnZpY2UuYXR0YWNoVXNlckRldmljZVJlZ2lzdHJhdGlvbih1c2VyX2ludW0sIHUyZl9kZXZpY2V
 faWQpDQoNCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gQXV0aGVudGljYXRlIGZvci
 BzdGVwIDIuIFJlc3VsdCBhZnRlciBhdHRhY2hpbmcgdTJmX2RldmljZSAnJXMnIHRvIHVzZXIgJyVzJ
 zogJyVzJyIgJSAodTJmX2RldmljZV9pZCwgdXNlcl9uYW1lLCBhdHRhY2hfcmVzdWx0KSANCg0KICAg
 ICAgICAgICAgICAgIHJldHVybiBhdHRhY2hfcmVzdWx0DQogICAgICAgICAgICBlbGlmIHNlbGYudHd
 vU3RlcDoNCiAgICAgICAgICAgICAgICBpZiB1c2VyX25hbWUgPT0gTm9uZToNCiAgICAgICAgICAgIC
 AgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgd
 G8gZGV0ZXJtaW5lIHVzZXIgbmFtZSINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoN
 CiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX3Jlc3VsdCA9IHNlbGYudmFsaWRhdGVTZXNzaW9uRGV
 2aWNlU3RhdHVzKGNsaWVudF9yZWRpcmVjdF91cmksIHNlc3Npb25fZGV2aWNlX3N0YXR1cywgdXNlcl
 9uYW1lKQ0KICAgICAgICAgICAgICAgIGlmIHZhbGlkYXRpb25fcmVzdWx0Og0KICAgICAgICAgICAgI
 CAgICAgICBwcmludCAiU3VwZXItR2x1dS4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIFVzZXIgJyVz
 JyBzdWNjZXNzZnVsbHkgYXV0aGVudGljYXRlZCB3aXRoIHUyZl9kZXZpY2UgJyVzJyIgJSAodXNlcl9
 uYW1lLCB1MmZfZGV2aWNlX2lkKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgIC
 AgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHN1cGVyX
 2dsdXVfcmVxdWVzdCA9IGpzb24ubG9hZHMoc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWydzdXBlcl9nbHV1
 X3JlcXVlc3QnXSkNCiAgICAgICAgICAgICAgICBhdXRoX21ldGhvZCA9IHN1cGVyX2dsdXVfcmVxdWV
 zdFsnbWV0aG9kJ10NCiAgICAgICAgICAgICAgICBpZiBhdXRoX21ldGhvZCBpbiBbJ2Vucm9sbCcsIC
 dhdXRoZW50aWNhdGUnXToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25fcmVzd
 Wx0DQoNCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gQXV0aGVudGljYXRlIGZvciBz
 dGVwIDIuIFUyRiBhdXRoX21ldGhvZCBpcyBpbnZhbGlkIg0KDQogICAgICAgICAgICByZXR1cm4gRmF
 sc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIHByZX
 BhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVyc
 ywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAg
 ICAgICBzZXNzaW9uX2F0dHJpYnV0ZXMgPSBjb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKQ0
 KDQogICAgICAgIGNsaWVudF9yZWRpcmVjdF91cmkgPSBzZWxmLmdldENsaWVudFJlZGlyZWNVcmkoc2
 Vzc2lvbl9hdHRyaWJ1dGVzKQ0KICAgICAgICBpZiBjbGllbnRfcmVkaXJlY3RfdXJpID09IE5vbmU6D
 QogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcC4gcmVkaXJlY3Rf
 dXJpIGlzIG5vdCBzZXQiDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBzZWxmLnN
 ldEV2ZW50Q29udGV4dFBhcmFtZXRlcnMoY29udGV4dCkNCg0KICAgICAgICBpZiBzdGVwID09IDE6DQ
 ogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgI
 CAgICAgaWYgc2VsZi5vbmVTdGVwOg0KICAgICAgICAgICAgICAgIHNlc3Npb25fc3RhdGUgPSBTZXNz
 aW9uU3RhdGVTZXJ2aWNlLmluc3RhbmNlKCkuZ2V0U2Vzc2lvblN0YXRlRnJvbUNvb2tpZSgpDQogICA
 gICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkoc2Vzc2lvbl9zdGF0ZSk6DQogICAgIC
 AgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZ
 CB0byBkZXRlcm1pbmUgc2Vzc2lvbl9zdGF0ZSINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZh
 bHNlDQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpc3N1ZXIgPSBDb25maWd1cmF0aW9uRmF
 jdG9yeS5pbnN0YW5jZSgpLmdldENvbmZpZ3VyYXRpb24oKS5nZXRJc3N1ZXIoKQ0KICAgICAgICAgIC
 AgICAgIHN1cGVyX2dsdXVfcmVxdWVzdF9kaWN0aW9uYXJ5ID0geydhcHAnOiBjbGllbnRfcmVkaXJlY
 3RfdXJpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXNzdWVyJzogaXNzdWVy
 LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdGUnOiBzZXNzaW9uX3N0YXR
 lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZCc6IGRhdGV0aW1lLm
 RhdGV0aW1lLm5vdygpLmlzb2Zvcm1hdCgpfQ0KDQogICAgICAgICAgICAgICAgc2VsZi5hZGRHZW9sb
 2NhdGlvbkRhdGEoc2Vzc2lvbl9hdHRyaWJ1dGVzLCBzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFy
 eSkNCg0KICAgICAgICAgICAgICAgIHN1cGVyX2dsdXVfcmVxdWVzdCA9IGpzb24uZHVtcHMoc3VwZXJ
 fZ2x1dV9yZXF1ZXN0X2RpY3Rpb25hcnksIHNlcGFyYXRvcnM9KCcsJywnOicpKQ0KICAgICAgICAgIC
 AgICAgIHByaW50ICJTdXBlci1HbHV1LiBQcmVwYXJlIGZvciBzdGVwIDEuIFByZXBhcmVkIHN1cGVyX
 2dsdXVfcmVxdWVzdDoiLCBzdXBlcl9nbHV1X3JlcXVlc3QNCiAgICANCiAgICAgICAgICAgICAgICBj
 b250ZXh0LnNldCgic3VwZXJfZ2x1dV9yZXF1ZXN0Iiwgc3VwZXJfZ2x1dV9yZXF1ZXN0KQ0KIyAgICA
 gICAgICAgIGVsaWYgc2VsZi50d29TdGVwOg0KIyAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiZG
 lzcGxheV9yZWdpc3Rlcl9hY3Rpb24iLCBUcnVlKQ0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KI
 CAgICAgICBlbGlmIHN0ZXAgPT0gMjoNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBQcmVw
 YXJlIGZvciBzdGVwIDIiDQogICAgICAgICAgICBpZiBzZWxmLm9uZVN0ZXA6DQogICAgICAgICAgICA
 gICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW
 5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXIgPSBjcmVkZW50aWFscy5nZXRVc
 2VyKCkNCiAgICAgICAgICAgIGlmIHVzZXIgPT0gTm9uZToNCiAgICAgICAgICAgICAgICBwcmludCAi
 U3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHVzZXIgbmF
 tZSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgaWYgc2Vzc2lvbl
 9hdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzdXBlcl9nbHV1X3JlcXVlc3QiKToNCiAgICAgICAgICAgI
 CAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBSZXF1ZXN0IHdhcyBnZW5l
 cmF0ZWQgYWxyZWFkeSINCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgDQo
 gICAgICAgICAgICBzZXNzaW9uX3N0YXRlID0gU2Vzc2lvblN0YXRlU2VydmljZS5pbnN0YW5jZSgpLm
 dldFNlc3Npb25TdGF0ZUZyb21Db29raWUoKQ0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzR
 W1wdHkoc2Vzc2lvbl9zdGF0ZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFBy
 ZXBhcmUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZSBzZXNzaW9uX3N0YXRlIg0KICAgICA
 gICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBhdXRoX21ldGhvZCA9IHNlc3Npb2
 5fYXR0cmlidXRlcy5nZXQoInN1cGVyX2dsdXVfYXV0aF9tZXRob2QiKQ0KICAgICAgICAgICAgaWYgU
 3RyaW5nSGVscGVyLmlzRW1wdHkoYXV0aF9tZXRob2QpOg0KICAgICAgICAgICAgICAgIHByaW50ICJT
 dXBlci1HbHV1LiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBkZXRlcm1pbmUgYXV0aF9tZXR
 ob2QiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHByaW50ICJTdX
 Blci1HbHV1LiBQcmVwYXJlIGZvciBzdGVwIDIuIGF1dGhfbWV0aG9kOiAnJXMnIiAlIGF1dGhfbWV0a
 G9kDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlzc3VlciA9IENvbmZpZ3VyYXRpb25GYWN0b3J5
 Lmluc3RhbmNlKCkuZ2V0Q29uZmlndXJhdGlvbigpLmdldElzc3VlcigpDQogICAgICAgICAgICBzdXB
 lcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeSA9IHsndXNlcm5hbWUnOiB1c2VyLmdldFVzZXJJZCgpLA
 0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhcHAnOiBjbGllbnRfcmVkaXJlY3RfdXJpL
 A0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpc3N1ZXInOiBpc3N1ZXIsDQogICAgICAg
 ICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCc6IGF1dGhfbWV0aG9kLA0KICAgICAgICAgICA
 gICAgICAgICAgICAgICAgICAgICdzdGF0ZSc6IHNlc3Npb25fc3RhdGUsDQogICAgICAgICAgICAgIC
 AgICAgICAgICAgICAgICAgJ2NyZWF0ZWQnOiBkYXRldGltZS5kYXRldGltZS5ub3coKS5pc29mb3JtY
 XQoKX0NCg0KICAgICAgICAgICAgc2VsZi5hZGRHZW9sb2NhdGlvbkRhdGEoc2Vzc2lvbl9hdHRyaWJ1
 dGVzLCBzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeSkNCg0KICAgICAgICAgICAgc3VwZXJfZ2x
 1dV9yZXF1ZXN0ID0ganNvbi5kdW1wcyhzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeSwgc2VwYX
 JhdG9ycz0oJywnLCc6JykpDQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb
 3Igc3RlcCAyLiBQcmVwYXJlZCBzdXBlcl9nbHV1X3JlcXVlc3Q6Iiwgc3VwZXJfZ2x1dV9yZXF1ZXN0
 DQoNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzdXBlcl9nbHV1X3JlcXVlc3QiLCBzdXBlcl9nbHV
 1X3JlcXVlc3QpDQoNCiAgICAgICAgICAgIGlmIGF1dGhfbWV0aG9kIGluIFsnYXV0aGVudGljYXRlJ1
 06DQogICAgICAgICAgICAgICAgc2VsZi5zZW5kUHVzaE5vdGlmaWNhdGlvbihjbGllbnRfcmVkaXJlY
 3RfdXJpLCB1c2VyLCBzdXBlcl9nbHV1X3JlcXVlc3QpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVl
 DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHR
 yYVBhcmFtZXRlcnNGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCi
 AgICAgICAgaWYgc3RlcCA9PSAxOg0KICAgICAgICAgICAgaWYgc2VsZi5vbmVTdGVwOiAgICAgICAgD
 QogICAgICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5hc0xpc3QoInN1cGVyX2dsdXVfcmVxdWVzdCIp
 DQogICAgICAgICAgICBlbGlmIHNlbGYudHdvU3RlcDoNCiAgICAgICAgICAgICAgICByZXR1cm4gQXJ
 yYXlzLmFzTGlzdCgiZGlzcGxheV9yZWdpc3Rlcl9hY3Rpb24iKQ0KICAgICAgICBlbGlmIHN0ZXAgPT
 0gMjoNCiAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KCJzdXBlcl9nbHV1X2F1dGhfbWV0a
 G9kIiwgInN1cGVyX2dsdXVfcmVxdWVzdCIpDQogICAgICAgIA0KICAgICAgICByZXR1cm4gTm9uZQ0K
 DQogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR
 0cmlidXRlcyk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KIC
 AgICAgICBpZiBjb250ZXh0LmlzU2V0KCJzdXBlcl9nbHV1X2NvdW50X2xvZ2luX3N0ZXBzIik6DQogI
 CAgICAgICAgICByZXR1cm4gY29udGV4dC5nZXQoInN1cGVyX2dsdXVfY291bnRfbG9naW5fc3RlcHMi
 KQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9
 yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIHN0ZX
 AgPT0gMToNCiAgICAgICAgICAgIGlmIHNlbGYub25lU3RlcDogICAgICAgIA0KICAgICAgICAgICAgI
 CAgIHJldHVybiAiL2F1dGgvc3VwZXItZ2x1dS9sb2dpbi54aHRtbCINCiAgICAgICAgZWxpZiBzdGVw
 ID09IDI6DQogICAgICAgICAgICBpZiBzZWxmLm9uZVN0ZXA6DQogICAgICAgICAgICAgICAgcmV0dXJ
 uICIvbG9naW4ueGh0bWwiDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHJldHVybi
 AiL2F1dGgvc3VwZXItZ2x1dS9sb2dpbi54aHRtbCINCg0KICAgICAgICByZXR1cm4gIiINCg0KICAgI
 GRlZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJz
 KToNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBwcm9jZXNzQmFzaWNBdXRoZW50aWNhdGl
 vbihzZWxmLCBjcmVkZW50aWFscyk6DQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW
 5zdGFuY2UoKQ0KDQogICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNC
 iAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAg
 ICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICBpZiBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cml
 uZyh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3
 JkKToNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX
 25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgaWYgbm90IGxvZ2dlZF9pbjoNCiAgICAgICAg
 ICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmd
 ldFVzZXIodXNlcl9uYW1lKQ0KICAgICAgICBpZiBmaW5kX3VzZXJfYnlfdWlkID09IE5vbmU6DQogIC
 AgICAgICAgICBwcmludCAib3hQdXNoLiBQcm9jZXNzIGJhc2ljIGF1dGhlbnRpY2F0aW9uLiBGYWlsZ
 WQgdG8gZmluZCB1c2VyICclcyciICUgdXNlcl9uYW1lDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0K
 ICAgICAgICANCiAgICAgICAgcmV0dXJuIGZpbmRfdXNlcl9ieV91aWQNCg0KICAgIGRlZiB2YWxpZGF
 0ZVNlc3Npb25EZXZpY2VTdGF0dXMoc2VsZiwgY2xpZW50X3JlZGlyZWN0X3VyaSwgc2Vzc2lvbl9kZX
 ZpY2Vfc3RhdHVzLCB1c2VyX25hbWUgPSBOb25lKToNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU
 2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIGRldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UgPSBEZXZp
 Y2VSZWdpc3RyYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICB1MmZfZGV2aWNlX2lkID0
 gc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWydkZXZpY2VfaWQnXQ0KDQogICAgICAgIHUyZl9kZXZpY2UgPS
 BOb25lDQogICAgICAgIGlmIHNlc3Npb25fZGV2aWNlX3N0YXR1c1snZW5yb2xsJ10gYW5kIHNlc3Npb
 25fZGV2aWNlX3N0YXR1c1snb25lX3N0ZXAnXToNCiAgICAgICAgICAgIHUyZl9kZXZpY2UgPSBkZXZp
 Y2VSZWdpc3RyYXRpb25TZXJ2aWNlLmZpbmRPbmVTdGVwVXNlckRldmljZVJlZ2lzdHJhdGlvbih1MmZ
 fZGV2aWNlX2lkKQ0KICAgICAgICAgICAgaWYgdTJmX2RldmljZSA9PSBOb25lOg0KICAgICAgICAgIC
 AgICAgIHByaW50ICJTdXBlci1HbHV1LiBWYWxpZGF0ZSBzZXNzaW9uIGRldmljZSBzdGF0dXMuIFRoZ
 XJlIGlzIG5vIG9uZSBzdGVwIHUyZl9kZXZpY2UgJyVzJyIgJSB1MmZfZGV2aWNlX2lkDQogICAgICAg
 ICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICAjIFZhbGlkYXR
 lIGlmIHVzZXIgaGFzIHNwZWNpZmllZCBkZXZpY2VfaWQgZW5yb2xsbWVudA0KICAgICAgICAgICAgdX
 Nlcl9pbnVtID0gdXNlclNlcnZpY2UuZ2V0VXNlckludW0odXNlcl9uYW1lKQ0KDQogICAgICAgICAgI
 CBpZiBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ29uZV9zdGVwJ106DQogICAgICAgICAgICAgICAgdXNl
 cl9pbnVtID0gc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWyd1c2VyX2ludW0nXQ0KICAgIA0KICAgICAgICA
 gICAgdTJmX2RldmljZSA9IGRldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UuZmluZFVzZXJEZXZpY2VSZW
 dpc3RyYXRpb24odXNlcl9pbnVtLCB1MmZfZGV2aWNlX2lkKQ0KICAgICAgICAgICAgaWYgdTJmX2Rld
 mljZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBWYWxpZGF0ZSBz
 ZXNzaW9uIGRldmljZSBzdGF0dXMuIFRoZXJlIGlzIG5vIHUyZl9kZXZpY2UgJyVzJyBhc3NvY2lhdGV
 kIHdpdGggdXNlciAnJXMnIiAlICh1MmZfZGV2aWNlX2lkLCB1c2VyX2ludW0pDQogICAgICAgICAgIC
 AgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgaWYgbm90IFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vc
 mVDYXNlKGNsaWVudF9yZWRpcmVjdF91cmksIHUyZl9kZXZpY2UuYXBwbGljYXRpb24pOg0KICAgICAg
 ICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFZhbGlkYXRlIHNlc3Npb24gZGV2aWNlIHN0YXR1cy4gdTJ
 mX2RldmljZSAnJXMnIGFzc29jaWF0ZWQgd2l0aCBvdGhlciBhcHBsaWNhdGlvbiAnJXMnIiAlICh1Mm
 ZfZGV2aWNlX2lkLCB1MmZfZGV2aWNlLmFwcGxpY2F0aW9uKQ0KICAgICAgICAgICAgcmV0dXJuIEZhb
 HNlDQogICAgICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldFNlc3Npb25EZXZp
 Y2VTdGF0dXMoc2VsZiwgc2Vzc2lvbl9hdHRyaWJ1dGVzLCB1c2VyX25hbWUpOg0KICAgICAgICBwcml
 udCAiU3VwZXItR2x1dS4gR2V0IHNlc3Npb24gZGV2aWNlIHN0YXR1cyINCg0KICAgICAgICBpZiBub3
 Qgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzdXBlcl9nbHV1X3JlcXVlc3QiKToNCiAgI
 CAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBUaGVy
 ZSBpcyBubyBTdXBlci1HbHV1IHJlcXVlc3QgaW4gc2Vzc2lvbiBhdHRyaWJ1dGVzIg0KICAgICAgICA
 gICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAjIENoZWNrIHNlc3Npb24gc3RhdGUgZXh0ZW5kZWQNCi
 AgICAgICAgaWYgbm90IHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSgic2Vzc2lvbl9jdXN0b
 21fc3RhdGUiKToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBHZXQgc2Vzc2lvbiBkZXZp
 Y2Ugc3RhdHVzLiBUaGVyZSBpcyBubyBzZXNzaW9uX2N1c3RvbV9zdGF0ZSBpbiBzZXNzaW9uIGF0dHJ
 pYnV0ZXMiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIHNlc3Npb25fY3VzdG9tX3
 N0YXRlID0gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgic2Vzc2lvbl9jdXN0b21fc3RhdGUiKQ0KICAgI
 CAgICBpZiBub3QgU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UoImFwcHJvdmVkIiwgc2Vzc2lv
 bl9jdXN0b21fc3RhdGUpOg0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEdldCBzZXNzaW9
 uIGRldmljZSBzdGF0dXMuIFVzZXIgJyVzJyBub3QgYXBwcm92ZSBvciBub3QgcGFzcyBVMkYgYXV0aG
 VudGljYXRpb24uIHNlc3Npb25fY3VzdG9tX3N0YXRlOiAnJXMnIiAlICh1c2VyX25hbWUsIHNlc3Npb
 25fY3VzdG9tX3N0YXRlKQ0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAjIFRyeSB0
 byBmaW5kIGRldmljZV9pZCBpbiBzZXNzaW9uIGF0dHJpYnV0ZQ0KICAgICAgICBpZiBub3Qgc2Vzc2l
 vbl9hdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJveHB1c2gyX3UyZl9kZXZpY2VfaWQiKToNCiAgICAgIC
 AgICAgIHByaW50ICJTdXBlci1HbHV1LiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBUaGVyZSBpc
 yBubyB1MmZfZGV2aWNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHJlcXVlc3QiDQogICAgICAgICAgICBy
 ZXR1cm4gTm9uZQ0KDQogICAgICAgICMgVHJ5IHRvIGZpbmQgdXNlcl9pbnVtIGluIHNlc3Npb24gYXR
 0cmlidXRlDQogICAgICAgIGlmIG5vdCBzZXNzaW9uX2F0dHJpYnV0ZXMuY29udGFpbnNLZXkoIm94cH
 VzaDJfdTJmX2RldmljZV91c2VyX2ludW0iKToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1L
 iBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBUaGVyZSBpcyBubyB1c2VyX2ludW0gYXNzb2NpYXRl
 ZCB3aXRoIHRoaXMgcmVxdWVzdCINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICA
 gICAgICBlbnJvbGwgPSBGYWxzZQ0KICAgICAgICBpZiBzZXNzaW9uX2F0dHJpYnV0ZXMuY29udGFpbn
 NLZXkoIm94cHVzaDJfdTJmX2RldmljZV9lbnJvbGwiKToNCiAgICAgICAgICAgIGVucm9sbCA9IFN0c
 mluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKCJ0cnVlIiwgc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgi
 b3hwdXNoMl91MmZfZGV2aWNlX2Vucm9sbCIpKQ0KDQogICAgICAgIG9uZV9zdGVwID0gRmFsc2UNCiA
 gICAgICAgaWYgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJveHB1c2gyX3UyZl9kZXZpY2
 Vfb25lX3N0ZXAiKToNCiAgICAgICAgICAgIG9uZV9zdGVwID0gU3RyaW5nSGVscGVyLmVxdWFsc0lnb
 m9yZUNhc2UoInRydWUiLCBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJveHB1c2gyX3UyZl9kZXZpY2Vf
 b25lX3N0ZXAiKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICBzdXBlcl9nbHV1X3J
 lcXVlc3QgPSBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJzdXBlcl9nbHV1X3JlcXVlc3QiKQ0KICAgIC
 AgICB1MmZfZGV2aWNlX2lkID0gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgib3hwdXNoMl91MmZfZGV2a
 WNlX2lkIikNCiAgICAgICAgdXNlcl9pbnVtID0gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgib3hwdXNo
 Ml91MmZfZGV2aWNlX3VzZXJfaW51bSIpDQoNCiAgICAgICAgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzID0
 geyJzdXBlcl9nbHV1X3JlcXVlc3QiOiBzdXBlcl9nbHV1X3JlcXVlc3QsICJkZXZpY2VfaWQiOiB1Mm
 ZfZGV2aWNlX2lkLCAidXNlcl9pbnVtIiA6IHVzZXJfaW51bSwgImVucm9sbCIgOiBlbnJvbGwsICJvb
 mVfc3RlcCIgOiBvbmVfc3RlcH0NCiAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEdldCBzZXNzaW9u
 IGRldmljZSBzdGF0dXMuIHNlc3Npb25fZGV2aWNlX3N0YXR1czogJyVzJyIgJSAoc2Vzc2lvbl9kZXZ
 pY2Vfc3RhdHVzKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHNlc3Npb25fZGV2aWNlX3N0YXR1cw
 0KDQogICAgZGVmIGluaXRQdXNoTm90aWZpY2F0aW9uU2VydmljZShzZWxmLCBjb25maWd1cmF0aW9uQ
 XR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbml0aWFsaXplIG5vdGlmaWNh
 dGlvbiBzZXJ2aWNlcyINCiAgICAgICAgaWYgbm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnR
 haW5zS2V5KCJjcmVkZW50aWFsc19maWxlIik6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KIC
 AgICAgICBzdXBlcl9nbHV1X2NyZWRzX2ZpbGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoI
 mNyZWRlbnRpYWxzX2ZpbGUiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICMgTG9hZCBjcmVkZW50aWFs
 cyBmcm9tIGZpbGUNCiAgICAgICAgZiA9IG9wZW4oc3VwZXJfZ2x1dV9jcmVkc19maWxlLCAncicpDQo
 gICAgICAgIHRyeToNCiAgICAgICAgICAgIGNyZWRzID0ganNvbi5sb2FkcyhmLnJlYWQoKSkNCiAgIC
 AgICAgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEluaXRpYWxpemUgbm90a
 WZpY2F0aW9uIHNlcnZpY2VzLiBGYWlsZWQgdG8gbG9hZCBjcmVkZW50aWFscyBmcm9tIGZpbGU6Iiwg
 c3VwZXJfZ2x1dV9jcmVkc19maWxlDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgZml
 uYWxseToNCiAgICAgICAgICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgIC
 AgICAgICAgYW5kcm9pZF9jcmVkcyA9IGNyZWRzWyJhbmRyb2lkIl1bImdjbSJdDQogICAgICAgICAgI
 CBpb3NfY3JlYWRzID0gY3JlZHNbImlvcyJdWyJhcG5zIl0NCiAgICAgICAgZXhjZXB0Og0KICAgICAg
 ICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEluaXRpYWxpemUgbm90aWZpY2F0aW9uIHNlcnZpY2VzLiB
 JbnZhbGlkIGNyZWRlbnRpYWxzIGZpbGUgJyVzJyBmb3JtYXQ6IiAlIHN1cGVyX2dsdXVfY3JlZHNfZm
 lsZQ0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIA0KICAgICAgICBzZWxmLnB1c2hBb
 mRyb2lkU2VydmljZSA9IE5vbmUNCiAgICAgICAgc2VsZi5wdXNoQXBwbGVTZXJ2aWNlID0gTm9uZQ0K
 ICAgICAgICBpZiBhbmRyb2lkX2NyZWRzWyJlbmFibGVkIl06DQogICAgICAgICAgICBzZWxmLnB1c2h
 BbmRyb2lkU2VydmljZSA9IFNlbmRlcihhbmRyb2lkX2NyZWRzWyJhcGlfa2V5Il0pIA0KICAgICAgIC
 AgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEluaXRpYWxpemUgbm90aWZpY2F0aW9uIHNlcnZpY2VzLiBDc
 mVhdGVkIEFuZHJvaWQgbm90aWZpY2F0aW9uIHNlcnZpY2UiDQogICAgICAgICAgICANCiAgICAgICAg
 aWYgaW9zX2NyZWFkc1siZW5hYmxlZCJdOg0KICAgICAgICAgICAgcDEyX2ZpbGVfcGF0aCA9IGlvc19
 jcmVhZHNbInAxMl9maWxlX3BhdGgiXQ0KICAgICAgICAgICAgcDEyX3Bhc3Nvd3JkID0gaW9zX2NyZW
 Fkc1sicDEyX3Bhc3N3b3JkIl0NCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHN0c
 mluZ0VuY3J5cHRlciA9IFN0cmluZ0VuY3J5cHRlci5kZWZhdWx0SW5zdGFuY2UoKQ0KICAgICAgICAg
 ICAgICAgIHAxMl9wYXNzb3dyZCA9IHN0cmluZ0VuY3J5cHRlci5kZWNyeXB0KHAxMl9wYXNzb3dyZCk
 NCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAjIElnbm9yZSBleGNlcHRpb24uIF
 Bhc3N3b3JkIGlzIG5vdCBlbmNyeXB0ZWQNCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1d
 S4gSW5pdGlhbGl6ZSBub3RpZmljYXRpb24gc2VydmljZXMuIEFzc3VtaW5nIHRoYXQgJ3AxMl9wYXNz
 b3dyZCcgcGFzc3dvcmQgaW4gbm90IGVuY3J5cHRlZCINCg0KICAgICAgICAgICAgYXBuc1NlcnZpY2V
 CdWlsZGVyID0gIEFQTlMubmV3U2VydmljZSgpLndpdGhDZXJ0KHAxMl9maWxlX3BhdGgsIHAxMl9wYX
 Nzb3dyZCkNCiAgICAgICAgICAgIGlmIGlvc19jcmVhZHNbInByb2R1Y3Rpb24iXToNCiAgICAgICAgI
 CAgICAgICBzZWxmLnB1c2hBcHBsZVNlcnZpY2UgPSBhcG5zU2VydmljZUJ1aWxkZXIud2l0aFByb2R1
 Y3Rpb25EZXN0aW5hdGlvbigpLmJ1aWxkKCkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICA
 gICAgc2VsZi5wdXNoQXBwbGVTZXJ2aWNlID0gYXBuc1NlcnZpY2VCdWlsZGVyLndpdGhTYW5kYm94RG
 VzdGluYXRpb24oKS5idWlsZCgpDQoNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbml0a
 WFsaXplIG5vdGlmaWNhdGlvbiBzZXJ2aWNlcy4gQ3JlYXRlZCBpT1Mgbm90aWZpY2F0aW9uIHNlcnZp
 Y2UiDQoNCiAgICAgICAgZW5hYmxlZCA9IHNlbGYucHVzaEFuZHJvaWRTZXJ2aWNlICE9IE5vbmUgb3I
 gc2VsZi5wdXNoQXBwbGVTZXJ2aWNlICE9IE5vbmUNCg0KICAgICAgICByZXR1cm4gZW5hYmxlZA0KDQ
 ogICAgZGVmIHNlbmRQdXNoTm90aWZpY2F0aW9uKHNlbGYsIGNsaWVudF9yZWRpcmVjdF91cmksIHVzZ
 XIsIHN1cGVyX2dsdXVfcmVxdWVzdCk6DQogICAgICAgIGlmIG5vdCBzZWxmLmVuYWJsZWRQdXNoTm90
 aWZpY2F0aW9uczoNCiAgICAgICAgICAgIHJldHVybg0KDQogICAgICAgIHVzZXJfbmFtZSA9IHVzZXI
 uZ2V0VXNlcklkKCkNCiAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFNlbmQgcHVzaCBub3RpZmljYX
 Rpb24uIExvYWRpbmcgdXNlciAnJXMnIGRldmljZXMiICUgdXNlcl9uYW1lDQoNCiAgICAgICAgc2VuZ
 F9ub3RpZmljYXRpb24gPSBGYWxzZQ0KICAgICAgICBzZW5kX25vdGlmaWNhdGlvbl9yZXN1bHQgPSBU
 cnVlDQoNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICA
 gIGRldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UgPSBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmluc3
 RhbmNlKCkNCg0KICAgICAgICB1c2VyX2ludW0gPSB1c2VyU2VydmljZS5nZXRVc2VySW51bSh1c2VyX
 25hbWUpDQoNCiAgICAgICAgdTJmX2RldmljZXNfbGlzdCA9IGRldmljZVJlZ2lzdHJhdGlvblNlcnZp
 Y2UuZmluZFVzZXJEZXZpY2VSZWdpc3RyYXRpb25zKHVzZXJfaW51bSwgY2xpZW50X3JlZGlyZWN0X3V
 yaSwgIm94SWQiLCAib3hEZXZpY2VEYXRhIikNCiAgICAgICAgaWYgdTJmX2RldmljZXNfbGlzdC5zaX
 plKCkgPiAwOg0KICAgICAgICAgICAgZm9yIHUyZl9kZXZpY2UgaW4gdTJmX2RldmljZXNfbGlzdDoNC
 iAgICAgICAgICAgICAgICBkZXZpY2VfZGF0YSA9IHUyZl9kZXZpY2UuZ2V0RGV2aWNlRGF0YSgpDQoN
 CiAgICAgICAgICAgICAgICAjIERldmljZSBkYXRhIHdoaWNoIFN1cGVyLUdsdXUgZ2V0cyBkdXJpbmc
 gZW5yb2xsbWVudA0KICAgICAgICAgICAgICAgIGlmIGRldmljZV9kYXRhID09IE5vbmU6DQogICAgIC
 AgICAgICAgICAgICAgIGNvbnRpbnVlDQoNCiAgICAgICAgICAgICAgICBwbGF0Zm9ybSA9IGRldmljZ
 V9kYXRhLmdldFBsYXRmb3JtKCkNCiAgICAgICAgICAgICAgICBwdXNoX3Rva2VuID0gZGV2aWNlX2Rh
 dGEuZ2V0UHVzaFRva2VuKCkNCiAgICAgICAgICAgICAgICBkZWJ1ZyA9IEZhbHNlDQoNCiAgICAgICA
 gICAgICAgICBpZiBTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShwbGF0Zm9ybSwgImlvcyIpIG
 FuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eShwdXNoX3Rva2VuKToNCiAgICAgICAgICAgICAgICAgI
 CAgIyBTZW5kaW5nIG5vdGlmaWNhdGlvbiB0byBpT1MgdXNlcidzIGRldmljZQ0KICAgICAgICAgICAg
 ICAgICAgICBpZiBzZWxmLnB1c2hBcHBsZVNlcnZpY2UgPT0gTm9uZToNCiAgICAgICAgICAgICAgICA
 gICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBTZW5kIHB1c2ggbm90aWZpY2F0aW9uLiBBcHBsZSBwdX
 NoIG5vdGlmaWNhdGlvbiBzZXJ2aWNlIGlzIG5vdCBlbmFibGVkIg0KICAgICAgICAgICAgICAgICAgI
 CBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZF9ub3RpZmljYXRpb24gPSBUcnVlDQog
 ICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIlN
 1cGVyLUdsdXUiDQogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gIlN1cGVyLUdsdXUgbG
 9naW4gcmVxdWVzdCB0bzogJXMiICUgY2xpZW50X3JlZGlyZWN0X3VyaQ0KDQogICAgICAgICAgICAgI
 CAgICAgICAgICBhZGRpdGlvbmFsX2ZpZWxkcyA9IHsgInJlcXVlc3QiIDogc3VwZXJfZ2x1dV9yZXF1
 ZXN0IH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgbXNnQnVpbGRlciA9IEFQTlMubmV3UGF5bG9
 hZCgpLmFsZXJ0Qm9keShtZXNzYWdlKS5hbGVydFRpdGxlKHRpdGxlKS5zb3VuZCgiZGVmYXVsdCIpDQ
 ogICAgICAgICAgICAgICAgICAgICAgICBtc2dCdWlsZGVyLmNhdGVnb3J5KCdBQ1RJT05BQkxFJykuY
 mFkZ2UoMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIG1zZ0J1aWxkZXIuY3VzdG9tRmllbGRzKGFk
 ZGl0aW9uYWxfZmllbGRzKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kX25vdGlmaWNhdGl
 vbl9yZXN1bHQgPSBzZWxmLnB1c2hBcHBsZVNlcnZpY2UucHVzaChwdXNoX3Rva2VuLCBtc2dCdWlsZG
 VyLmJ1aWxkKCkpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkZWJ1ZzoNCiAgICAgICAgICAgI
 CAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gU2VuZCBwdXNoIG5vdGlmaWNhdGlvbi4g
 dG9rZW46ICclcycsIHNlbmRfbm90aWZpY2F0aW9uX3Jlc3VsdDogJyVzJyIgJSAocHVzaF90b2tlbiw
 gc2VuZF9ub3RpZmljYXRpb25fcmVzdWx0KQ0KDQogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscG
 VyLmVxdWFsc0lnbm9yZUNhc2UocGxhdGZvcm0sICJhbmRyb2lkIikgYW5kIFN0cmluZ0hlbHBlci5pc
 05vdEVtcHR5KHB1c2hfdG9rZW4pOg0KICAgICAgICAgICAgICAgICAgICAjIFNlbmRpbmcgbm90aWZp
 Y2F0aW9uIHRvIEFuZHJvaWQgdXNlcidzIGRldmljZQ0KICAgICAgICAgICAgICAgICAgICBpZiBzZWx
 mLnB1c2hBbmRyb2lkU2VydmljZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbn
 QgIlN1cGVyLUdsdXUuIFNlbmQgcHVzaCBub3RpZmljYXRpb24uIEFuZHJvaWQgcHVzaCBub3RpZmljY
 XRpb24gc2VydmljZSBpcyBub3QgZW5hYmxlZCINCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAg
 ICAgICAgICAgICAgICAgICAgICAgIHNlbmRfbm90aWZpY2F0aW9uID0gVHJ1ZQ0KDQogICAgICAgICA
 gICAgICAgICAgICAgICB0aXRsZSA9ICJTdXBlci1HbHV1Ig0KICAgICAgICAgICAgICAgICAgICAgIC
 AgbXNnQnVpbGRlciA9IE1lc3NhZ2UuQnVpbGRlcigpLmFkZERhdGEoIm1lc3NhZ2UiLCBzdXBlcl9nb
 HV1X3JlcXVlc3QpLmFkZERhdGEoInRpdGxlIiwgdGl0bGUpLmNvbGxhcHNlS2V5KCJzaW5nbGUiKS5j
 b250ZW50QXZhaWxhYmxlKFRydWUpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfbm90aWZ
 pY2F0aW9uX3Jlc3VsdCA9IHNlbGYucHVzaEFuZHJvaWRTZXJ2aWNlLnNlbmQobXNnQnVpbGRlci5idW
 lsZCgpLCBwdXNoX3Rva2VuLCAzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVidWc6DQogI
 CAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFNlbmQgcHVzaCBub3Rp
 ZmljYXRpb24uIHRva2VuOiAnJXMnLCBzZW5kX25vdGlmaWNhdGlvbl9yZXN1bHQ6ICclcyciICUgKHB
 1c2hfdG9rZW4sIHNlbmRfbm90aWZpY2F0aW9uX3Jlc3VsdCkNCg0KDQogICAgICAgIHByaW50ICJTdX
 Blci1HbHV1LiBTZW5kIHB1c2ggbm90aWZpY2F0aW9uLiBzZW5kX25vdGlmaWNhdGlvbjogJyVzJywgc
 2VuZF9ub3RpZmljYXRpb25fcmVzdWx0OiAnJXMnIiAlIChzZW5kX25vdGlmaWNhdGlvbiwgc2VuZF9u
 b3RpZmljYXRpb25fcmVzdWx0KQ0KDQogICAgZGVmIGdldENsaWVudFJlZGlyZWNVcmkoc2VsZiwgc2V
 zc2lvbl9hdHRyaWJ1dGVzKToNCiAgICAgICAgaWYgbm90IHNlc3Npb25fYXR0cmlidXRlcy5jb250YW
 luc0tleSgicmVkaXJlY3RfdXJpIik6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgI
 HJldHVybiBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJyZWRpcmVjdF91cmkiKQ0KDQogICAgZGVmIHNl
 dEV2ZW50Q29udGV4dFBhcmFtZXRlcnMoc2VsZiwgY29udGV4dCk6DQogICAgICAgIGlmIHNlbGYucmV
 naXN0cmF0aW9uVXJpICE9IE5vbmU6DQogICAgICAgICAgICBjb250ZXh0LnNldCgiZXh0ZXJuYWxfcm
 VnaXN0cmF0aW9uX3VyaSIsIHNlbGYucmVnaXN0cmF0aW9uVXJpKQ0KDQogICAgICAgIGlmIHNlbGYuY
 3VzdG9tTGFiZWwgIT0gTm9uZToNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzdXBlcl9nbHV1X2xh
 YmVsIiwgc2VsZi5jdXN0b21MYWJlbCkNCg0KICAgIGRlZiBhZGRHZW9sb2NhdGlvbkRhdGEoc2VsZiw
 gc2Vzc2lvbl9hdHRyaWJ1dGVzLCBzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeSk6DQogICAgIC
 AgIGlmIHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSgicmVtb3RlX2lwIik6DQogICAgICAgI
 CAgICByZW1vdGVfaXAgPSBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJyZW1vdGVfaXAiKQ0KICAgICAg
 ICAgICAgaWYgU3RyaW5nSGVscGVyLmlzTm90RW1wdHkocmVtb3RlX2lwKToNCiAgICAgICAgICAgICA
 gICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBBZGRpbmcgcmVxX2lwIGFuZC
 ByZXFfbG9jIHRvIHN1cGVyX2dsdXVfcmVxdWVzdCINCiAgICAgICAgICAgICAgICBzdXBlcl9nbHV1X
 3JlcXVlc3RfZGljdGlvbmFyeVsncmVxX2lwJ10gPSByZW1vdGVfaXANCg0KICAgICAgICAgICAgICAg
 IHJlbW90ZV9sb2NfZGljID0gc2VsZi5kZXRlcm1pbmVHZW9sb2NhdGlvbkRhdGEocmVtb3RlX2lwKQ0
 KICAgICAgICAgICAgICAgIGlmIHJlbW90ZV9sb2NfZGljID09IE5vbmU6DQogICAgICAgICAgICAgIC
 AgICAgIHByaW50ICJTdXBlci1HbHV1LiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBkZXRlc
 m1pbmUgcmVtb3RlIGxvY2F0aW9uIGJ5IHJlbW90ZSBJUCAnJXMnIiAlIHJlbW90ZV9pcA0KICAgICAg
 ICAgICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICAgICAgICAgIHJlbW90ZV9sb2MgPSAiJXMsICV
 zLCAlcyIgJSAoIHJlbW90ZV9sb2NfZGljWydjb3VudHJ5J10sIHJlbW90ZV9sb2NfZGljWydyZWdpb2
 5OYW1lJ10sIHJlbW90ZV9sb2NfZGljWydjaXR5J10gKQ0KICAgICAgICAgICAgICAgIHJlbW90ZV9sb
 2NfZW5jb2RlZCA9IHVybGxpYi5xdW90ZShyZW1vdGVfbG9jKQ0KICAgICAgICAgICAgICAgIHN1cGVy
 X2dsdXVfcmVxdWVzdF9kaWN0aW9uYXJ5WydyZXFfbG9jJ10gPSByZW1vdGVfbG9jX2VuY29kZWQNCg0
 KICAgIGRlZiBkZXRlcm1pbmVHZW9sb2NhdGlvbkRhdGEoc2VsZiwgcmVtb3RlX2lwKToNCiAgICAgIC
 AgcHJpbnQgIlN1cGVyLUdsdXUuIERldGVybWluZSByZW1vdGUgbG9jYXRpb24uIHJlbW90ZV9pcDogJ
 yVzJyIgJSByZW1vdGVfaXANCiAgICAgICAgaHR0cFNlcnZpY2UgPSBIdHRwU2VydmljZS5pbnN0YW5j
 ZSgpDQoNCiAgICAgICAgaHR0cF9jbGllbnQgPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpDQo
 gICAgICAgIGh0dHBfY2xpZW50X3BhcmFtcyA9IGh0dHBfY2xpZW50LmdldFBhcmFtcygpDQogICAgIC
 AgIGh0dHBfY2xpZW50X3BhcmFtcy5zZXRJbnRQYXJhbWV0ZXIoQ29yZUNvbm5lY3Rpb25QTmFtZXMuQ
 09OTkVDVElPTl9USU1FT1VULCAxNSAqIDEwMDApDQogICAgICAgIA0KICAgICAgICBnZW9sb2NhdGlv
 bl9zZXJ2aWNlX3VybCA9ICJodHRwOi8vaXAtYXBpLmNvbS9qc29uLyVzP2ZpZWxkcz00OTE3NyIgJSB
 yZW1vdGVfaXANCiAgICAgICAgZ2VvbG9jYXRpb25fc2VydmljZV9oZWFkZXJzID0geyAiQWNjZXB0Ii
 A6ICJhcHBsaWNhdGlvbi9qc29uIiB9DQoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaHR0cF9zZ
 XJ2aWNlX3Jlc3BvbnNlID0gaHR0cFNlcnZpY2UuZXhlY3V0ZUdldChodHRwX2NsaWVudCwgZ2VvbG9j
 YXRpb25fc2VydmljZV91cmwsICBnZW9sb2NhdGlvbl9zZXJ2aWNlX2hlYWRlcnMpDQogICAgICAgICA
 gICBodHRwX3Jlc3BvbnNlID0gaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlLmdldEh0dHBSZXNwb25zZSgpDQ
 ogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBEZXRlcm1pbmUgc
 mVtb3RlIGxvY2F0aW9uLiBFeGNlcHRpb246ICIsIHN5cy5leGNfaW5mbygpWzFdDQogICAgICAgICAg
 ICByZXR1cm4gTm9uZQ0KDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIG5vdCBodHRwU2Vydml
 jZS5pc1Jlc3BvbnNlU3Rhc3R1c0NvZGVPayhodHRwX3Jlc3BvbnNlKToNCiAgICAgICAgICAgICAgIC
 BwcmludCAiU3VwZXItR2x1dS4gRGV0ZXJtaW5lIHJlbW90ZSBsb2NhdGlvbi4gR2V0IGludmFsaWQgc
 mVzcG9uc2UgZnJvbSB2YWxpZGF0aW9uIHNlcnZlcjogIiwgc3RyKGh0dHBfcmVzcG9uc2UuZ2V0U3Rh
 dHVzTGluZSgpLmdldFN0YXR1c0NvZGUoKSkNCiAgICAgICAgICAgICAgICBodHRwU2VydmljZS5jb25
 zdW1lKGh0dHBfcmVzcG9uc2UpDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICANCiAgIC
 AgICAgICAgIHJlc3BvbnNlX2J5dGVzID0gaHR0cFNlcnZpY2UuZ2V0UmVzcG9uc2VDb250ZW50KGh0d
 HBfcmVzcG9uc2UpDQogICAgICAgICAgICByZXNwb25zZV9zdHJpbmcgPSBodHRwU2VydmljZS5jb252
 ZXJ0RW50aXR5VG9TdHJpbmcocmVzcG9uc2VfYnl0ZXMpDQogICAgICAgICAgICBodHRwU2VydmljZS5
 jb25zdW1lKGh0dHBfcmVzcG9uc2UpDQogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBodHRwX3
 NlcnZpY2VfcmVzcG9uc2UuY2xvc2VDb25uZWN0aW9uKCkNCg0KICAgICAgICBpZiByZXNwb25zZV9zd
 HJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBEZXRlcm1pbmUgcmVt
 b3RlIGxvY2F0aW9uLiBHZXQgZW1wdHkgcmVzcG9uc2UgZnJvbSBsb2NhdGlvbiBzZXJ2ZXIiDQogICA
 gICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgcmVzcG9uc2UgPSBqc29uLmxvYW
 RzKHJlc3BvbnNlX3N0cmluZykNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBTdHJpbmdIZWxwZXIuZ
 XF1YWxzSWdub3JlQ2FzZShyZXNwb25zZVsnc3RhdHVzJ10sICJzdWNjZXNzIik6DQogICAgICAgICAg
 ICBwcmludCAiU3VwZXItR2x1dS4gRGV0ZXJtaW5lIHJlbW90ZSBsb2NhdGlvbi4gR2V0IHJlc3BvbnN
 lIHdpdGggc3RhdHVzOiAnJXMnIiAlIHJlc3BvbnNlWydzdGF0dXMnXQ0KICAgICAgICAgICAgcmV0dX
 JuIE5vbmUNCg0KICAgICAgICByZXR1cm4gcmVzcG9uc2UNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!5018.F9CF,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: DUO authentication module
displayName: duo
gluuStatus: false
inum: %(inumOrg)s!0011!5018.F9CF
oxConfigurationProperty: {"value1":"duo_creds_file","value2":"/etc/certs/duo
 _creds.json","description":""}
oxConfigurationProperty: {"value1":"duo_host","value2":"api-random.duosecuri
 ty.com","description":""}
oxLevel: 20
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29ud
 GV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9t
 IG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGh
 lbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2
 VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyR3JvdXBTZXJ2a
 WNlDQpmcm9tIG9yZy54ZGkuc2VydmljZSBpbXBvcnQgTWFpbFNlcnZpY2UNCmZyb20gb3JnLnhk
 aS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJ
 heUhlbHBlcg0KDQppbXBvcnQgamF2YQ0KaW1wb3J0IGR1b193ZWINCnRyeToNCiAgICBpbXBvcn
 QganNvbg0KZXhjZXB0IEltcG9ydEVycm9yOg0KICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb
 24NCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25UeXBl
 KToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICB
 zZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbm
 l0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR1by4gS
 W5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgZHVvX2NyZWRzX2ZpbGUgPSBjb25maWd1cmF0aW9u
 QXR0cmlidXRlcy5nZXQoImR1b19jcmVkc19maWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgIyB
 Mb2FkIGNyZWRlbnRpYWxzIGZyb20gZmlsZQ0KICAgICAgICBmID0gb3BlbihkdW9fY3JlZHNfZm
 lsZSwgJ3InKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjcmVkcyA9IGpzb24ubG9hZHMoZ
 i5yZWFkKCkpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJEdW8uIEluaXRp
 YWxpemF0aW9uLiBGYWlsZWQgdG8gbG9hZCBjcmVkcyBmcm9tIGZpbGU6IiwgZHVvX2NyZWRzX2Z
 pbGUNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgIC
 AgICAgZi5jbG9zZSgpDQoNCiAgICAgICAgc2VsZi5pa2V5ID0gc3RyKGNyZWRzWyJpa2V5Il0pD
 QogICAgICAgIHNlbGYuc2tleSA9IHN0cihjcmVkc1sic2tleSJdKQ0KICAgICAgICBzZWxmLmFr
 ZXkgPSBzdHIoY3JlZHNbImFrZXkiXSkNCg0KICAgICAgICBzZWxmLnVzZV9kdW9fZ3JvdXAgPSB
 GYWxzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoIm
 R1b19ncm91cCIpKToNCiAgICAgICAgICAgIHNlbGYuZHVvX2dyb3VwID0gY29uZmlndXJhdGlvb
 kF0dHJpYnV0ZXMuZ2V0KCJkdW9fZ3JvdXAiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgc2Vs
 Zi51c2VfZHVvX2dyb3VwID0gVHJ1ZQ0KICAgICAgICAgICAgcHJpbnQgIkR1by4gSW5pdGlhbGl
 6YXRpb24uIFVzaW5nIER1byBvbmx5IGlmIHVzZXIgYmVsb25nIHRvIGdyb3VwOiIsIHNlbGYuZH
 VvX2dyb3VwDQoNCiAgICAgICAgc2VsZi51c2VfYXVkaXRfZ3JvdXAgPSBGYWxzZQ0KICAgICAgI
 CBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImF1ZGl0X2dyb3VwIikp
 Og0KICAgICAgICAgICAgc2VsZi5hdWRpdF9ncm91cCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGV
 zLmdldCgiYXVkaXRfZ3JvdXAiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICAgICBpZiAobm90IG
 NvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJhdWRpdF9ncm91cF9lbWFpbCIpK
 ToNCiAgICAgICAgICAgICAgICBwcmludCAiRHVvLiBJbml0aWFsaXphdGlvbi4gUHJvcGVydHkg
 YXVkaXRfZ3JvdXBfZW1haWwgaXMgbm90IHNwZWNpZmllZCINCiAgICAgICAgICAgICAgICByZXR
 1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2VsZi5hdWRpdF9lbWFpbCA9IGNvbmZpZ3VyYXRpb2
 5BdHRyaWJ1dGVzLmdldCgiYXVkaXRfZ3JvdXBfZW1haWwiKS5nZXRWYWx1ZTIoKQ0KICAgICAgI
 CAgICAgc2VsZi51c2VfYXVkaXRfZ3JvdXAgPSBUcnVlDQoNCiAgICAgICAgICAgIHByaW50ICJE
 dW8uIEluaXRpYWxpemF0aW9uLiBVc2luZyBhdWRpdG8gZ3JvdXA6Iiwgc2VsZi5hdWRpdF9ncm9
 1cA0KICAgICAgICAgICAgDQogICAgICAgIGlmIChzZWxmLnVzZV9kdW9fZ3JvdXAgb3Igc2VsZi
 51c2VfYXVkaXRfZ3JvdXApOg0KICAgICAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0c
 mlidXRlcy5jb250YWluc0tleSgiYXVkaXRfYXR0cmlidXRlIikpOg0KICAgICAgICAgICAgICAg
 IHByaW50ICJEdW8uIEluaXRpYWxpemF0aW9uLiBQcm9wZXJ0eSBhdWRpdF9hdHRyaWJ1dGUgaXM
 gbm90IHNwZWNpZmllZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgIC
 AgIGVsc2U6DQogICAgICAgICAgICAgICAgc2VsZi5hdWRpdF9hdHRyaWJ1dGUgPSBjb25maWd1c
 mF0aW9uQXR0cmlidXRlcy5nZXQoImF1ZGl0X2F0dHJpYnV0ZSIpLmdldFZhbHVlMigpDQoNCg0K
 ICAgICAgICBwcmludCAiRHVvLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJ
 ldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcyk6DQogICAgICAgIHByaW50ICJEdW8uIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJEd
 W8uIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBk
 ZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1Z
 hbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpd
 mVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2V
 sZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCi
 AgICAgICAgZHVvX2hvc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImR1b19ob3N0I
 ikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNl
 KCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXR
 Vc2VybmFtZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludC
 AiRHVvLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgICAgdXNlcl9wYXNzd
 29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9
 IEZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXN
 lcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZC
 kpOg0KICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoK
 Q0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1
 c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2l
 uKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgdXNlciA9IG
 NyZWRlbnRpYWxzLmdldFVzZXIoKQ0KICAgICAgICAgICAgaWYgKHNlbGYudXNlX2R1b19ncm91c
 Ck6DQogICAgICAgICAgICAgICAgcHJpbnQgIkR1by4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEu
 IENoZWNraW5nIGlmIHVzZXIgYmVsb25nIHRvIER1byBncm91cCINCiAgICAgICAgICAgICAgICB
 pc19tZW1iZXJfZHVvX2dyb3VwID0gc2VsZi5pc1VzZXJNZW1iZXJPZkdyb3VwKHVzZXIsIHNlbG
 YuYXVkaXRfYXR0cmlidXRlLCBzZWxmLmR1b19ncm91cCkNCiAgICAgICAgICAgICAgICBpZiAoa
 XNfbWVtYmVyX2R1b19ncm91cCk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBVc2VyICciICsgdXNlci5nZXRVc2VySWQoKSArICInIG1
 lbWJlciBvZiBEdW8gZ3JvdXAiDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3VudF9sb2dpbl
 9zdGVwcyA9IDINCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBzZ
 WxmLnByb2Nlc3NBdWRpdEdyb3VwKHVzZXIpDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3Vu
 dF9sb2dpbl9zdGVwcyA9IDENCg0KICAgICAgICAgICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5
 nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJkdW9fY291bn
 RfbG9naW5fc3RlcHMiLCBkdW9fY291bnRfbG9naW5fc3RlcHMpDQoNCiAgICAgICAgICAgIHJld
 HVybiBUcnVlDQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAi
 RHVvLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgc2lnX3Jlc3BvbnN
 lX2FycmF5ID0gcmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJzaWdfcmVzcG9uc2UiKQ0KICAgICAgIC
 AgICAgaWYgQXJyYXlIZWxwZXIuaXNFbXB0eShzaWdfcmVzcG9uc2VfYXJyYXkpOg0KICAgICAgI
 CAgICAgICAgIHByaW50ICJEdW8uIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBzaWdfcmVzcG9u
 c2UgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICA
 gIGR1b19zaWdfcmVzcG9uc2UgPSBzaWdfcmVzcG9uc2VfYXJyYXlbMF0NCg0KICAgICAgICAgIC
 AgcHJpbnQgIkR1by4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIGR1b19zaWdfcmVzcG9uc2U6I
 CIgKyBkdW9fc2lnX3Jlc3BvbnNlDQoNCiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRfdXNlcm5h
 bWUgPSBkdW9fd2ViLnZlcmlmeV9yZXNwb25zZShzZWxmLmlrZXksIHNlbGYuc2tleSwgc2VsZi5
 ha2V5LCBkdW9fc2lnX3Jlc3BvbnNlKQ0KDQogICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW
 50aWNhdGUgZm9yIHN0ZXAgMi4gYXV0aGVudGljYXRlZF91c2VybmFtZTogIiArIGF1dGhlbnRpY
 2F0ZWRfdXNlcm5hbWUgKyAiLCBleHBlY3RlZCB1c2VyX25hbWU6ICIgKyB1c2VyX25hbWUNCg0K
 ICAgICAgICAgICAgaWYgKG5vdCBTdHJpbmdIZWxwZXIuZXF1YWxzKHVzZXJfbmFtZSwgYXV0aGV
 udGljYXRlZF91c2VybmFtZSkpOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogIC
 AgICAgICAgICBzZWxmLnByb2Nlc3NBdWRpdEdyb3VwKGNyZWRlbnRpYWxzLmdldFVzZXIoKSkNC
 g0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJl
 dHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPS
 BDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KDQogICAgICAgIGR1b19ob3N0ID0gY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJkdW9faG9zdCIpLmdldFZhbHVlMigpDQoNCiAgICAgICAg
 Y3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICA
 gICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGlmIC
 hzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkR1by4gUHJlcGFyZSBmb3Igc3RlcCAxI
 g0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09IDIpOg0K
 ICAgICAgICAgICAgcHJpbnQgIkR1by4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICA
 gICBkdW9fc2lnX3JlcXVlc3QgPSBkdW9fd2ViLnNpZ25fcmVxdWVzdChzZWxmLmlrZXksIHNlbG
 Yuc2tleSwgc2VsZi5ha2V5LCB1c2VyX25hbWUpDQogICAgICAgICAgICBwcmludCAiRHVvLiBQc
 mVwYXJlIGZvciBzdGVwIDIuIGR1b19zaWdfcmVxdWVzdDogIiArIGR1b19zaWdfcmVxdWVzdA0K
 ICAgICAgICAgICAgDQogICAgICAgICAgICBjb250ZXh0LnNldCgiZHVvX2hvc3QiLCBkdW9faG9
 zdCkNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJkdW9fc2lnX3JlcXVlc3QiLCBkdW9fc2lnX3
 JlcXVlc3QpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgI
 CAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVw
 KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0dXJuIE5
 vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb
 250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRleHQuaXNTZXQoImR1b19jb3VudF9sb2dpbl9zdGVw
 cyIpKToNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldCgiZHVvX2NvdW50X2xvZ2luX3N
 0ZXBzIikNCg0KICAgICAgICByZXR1cm4gMg0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbG
 YsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gM
 ik6DQogICAgICAgICAgICByZXR1cm4gIi9hdXRoL2R1by9kdW9sb2dpbi54aHRtbCINCiAgICAg
 ICAgcmV0dXJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ
 1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZW
 YgaXNVc2VyTWVtYmVyT2ZHcm91cChzZWxmLCB1c2VyLCBhdHRyaWJ1dGUsIGdyb3VwKToNCiAgI
 CAgICAgaXNfbWVtYmVyID0gRmFsc2UNCiAgICAgICAgbWVtYmVyX29mX2xpc3QgPSB1c2VyLmdl
 dEF0dHJpYnV0ZVZhbHVlcyhhdHRyaWJ1dGUpDQogICAgICAgIGlmIChtZW1iZXJfb2ZfbGlzdCA
 hPSBOb25lKToNCiAgICAgICAgICAgIGZvciBtZW1iZXJfb2YgaW4gbWVtYmVyX29mX2xpc3Q6DQ
 ogICAgICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGdyb3VwL
 CBtZW1iZXJfb2YpKToNCiAgICAgICAgICAgICAgICAgICAgaXNfbWVtYmVyID0gVHJ1ZQ0KICAg
 ICAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgICAgIHJldHVybiBpc19tZW1iZXINCg0KICA
 gIGRlZiBwcm9jZXNzQXVkaXRHcm91cChzZWxmLCB1c2VyKToNCiAgICAgICAgaWYgKHNlbGYudX
 NlX2F1ZGl0X2dyb3VwKToNCiAgICAgICAgICAgIGlzX21lbWJlciA9IHNlbGYuaXNVc2VyTWVtY
 mVyT2ZHcm91cCh1c2VyLCBzZWxmLmF1ZGl0X2F0dHJpYnV0ZSwgc2VsZi5hdWRpdF9ncm91cCkN
 CiAgICAgICAgICAgIGlmIChpc19tZW1iZXIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJEdW8
 uIEF1dGhlbnRpY2F0ZSBmb3IgcHJvY2Vzc0F1ZGl0R3JvdXAuIFVzZXIgJyIgKyB1c2VyLmdldF
 VzZXJJZCgpICsgIicgbWVtYmVyIG9mIGF1ZGl0IGdyb3VwIg0KICAgICAgICAgICAgICAgIHBya
 W50ICJEdW8uIEF1dGhlbnRpY2F0ZSBmb3IgcHJvY2Vzc0F1ZGl0R3JvdXAuIFNlbmRpbmcgZS1t
 YWlsIGFib3V0IHVzZXIgJyIgKyB1c2VyLmdldFVzZXJJZCgpICsgIicgbG9naW4gdG8iLCBzZWx
 mLmF1ZGl0X2VtYWlsDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBTZW5kIG
 UtbWFpbCB0byBhZG1pbmlzdHJhdG9yDQogICAgICAgICAgICAgICAgdXNlcl9pZCA9IHVzZXIuZ
 2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBtYWlsU2VydmljZSA9IE1haWxTZXJ2aWNlLmlu
 c3RhbmNlKCkNCiAgICAgICAgICAgICAgICBzdWJqZWN0ID0gIlVzZXIgbG9nIGluOiAiICsgdXN
 lcl9pZA0KICAgICAgICAgICAgICAgIGJvZHkgPSAiVXNlciBsb2cgaW46ICIgKyB1c2VyX2lkDQ
 ogICAgICAgICAgICAgICAgbWFpbFNlcnZpY2Uuc2VuZE1haWwoc2VsZi5hdWRpdF9lbWFpbCwgc
 3ViamVjdCwgYm9keSkNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!2124.0CF1,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Cert authentication module
displayName: cert
gluuStatus: false
inum: %(inumOrg)s!2124.0CF1
oxConfigurationProperty: {"value1":"chain_cert_file_path","value2":"/etc/certs/c
 hain_cert.pem","description":""}
oxConfigurationProperty: {"value1":"credentials_file","value2":"/etc/certs/cert_
 creds.json","description":""}
oxConfigurationProperty: {"value1":"map_user_cert","value2":"true","description"
 :""}
oxConfigurationProperty: {"value1":"use_generic_validator","value2":"true","desc
 ription":""}
oxConfigurationProperty: {"value1":"use_path_validator","value2":"true","descrip
 tion":""}
oxConfigurationProperty: {"value1":"use_ocsp_validator","value2":"true","descrip
 tion":""}
oxConfigurationProperty: {"value1":"use_crl_validator","value2":"false","descript
 ion":""}
oxConfigurationProperty: {"value1":"crl_max_response_size","value2":"10485760","
 description":""}
oxLevel: 25
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""
 }
oxRevision: 1
oxScript:: Iw0KIyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuDQoj
 IENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0
 KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdX
 RoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLmpib3NzLnNlYW0uY29udGV4dHMgaW1wb3J0IENvbnRle
 HQsIENvbnRleHRzDQpmcm9tIGphdmF4LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0K
 ZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb20gb3JnLnhkaS5
 veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydC
 BTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJheUhlbHBlcg0KZnJvbSBvc
 mcueGRpLm94YXV0aC51dGlsIGltcG9ydCBTZXJ2ZXJVdGlsDQpmcm9tIG9yZy54ZGkudXRpbC5zZWN1
 cml0eSBpbXBvcnQgU3RyaW5nRW5jcnlwdGVyIA0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEhhc2hNYXA
 sIEFycmF5cw0KZnJvbSBqYXZhLnNlY3VyaXR5IGltcG9ydCBNZXNzYWdlRGlnZXN0DQpmcm9tIG9yZy
 5hcGFjaGUuY29tbW9ucy5jb2RlYy5iaW5hcnkgaW1wb3J0IEhleA0KZnJvbSBvcmcueGRpLm94YXV0a
 C5jZXJ0LmZpbmdlcnByaW50IGltcG9ydCBGaW5nZXJwcmludEhlbHBlcg0KZnJvbSBvcmcueGRpLm94
 YXV0aC5jZXJ0LnZhbGlkYXRpb24gaW1wb3J0IEdlbmVyaWNDZXJ0aWZpY2F0ZVZlcmlmaWVyLCBQYXR
 oQ2VydGlmaWNhdGVWZXJpZmllciwgT0NTUENlcnRpZmljYXRlVmVyaWZpZXIsIENSTENlcnRpZmljYX
 RlVmVyaWZpZXINCmZyb20gb3JnLnhkaS5veGF1dGguY2VydC52YWxpZGF0aW9uLm1vZGVsIGltcG9yd
 CBWYWxpZGF0aW9uU3RhdHVzDQpmcm9tIG9yZy54ZGkub3hhdXRoLnV0aWwgaW1wb3J0IENlcnRVdGls
 DQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UubmV0IGltcG9ydCBIdHRwU2VydmljZQ0KZnJvbSB
 vcmcuYXBhY2hlLmh0dHAucGFyYW1zIGltcG9ydCBDb3JlQ29ubmVjdGlvblBOYW1lcw0KDQppbXBvcn
 QgamF2YQ0KaW1wb3J0IHN5cw0KaW1wb3J0IGJhc2U2NA0KaW1wb3J0IHVybGxpYg0KDQp0cnk6DQogI
 CAgaW1wb3J0IGpzb24NCmV4Y2VwdCBJbXBvcnRFcnJvcjoNCiAgICBpbXBvcnQgc2ltcGxlanNvbiBh
 cyBqc29uDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVHl
 wZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2
 VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZ
 WxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFs
 aXphdGlvbiINCg0KICAgICAgICBpZiBub3QgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5
 zS2V5KCJjaGFpbl9jZXJ0X2ZpbGVfcGF0aCIpKToNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbm
 l0aWFsaXphdGlvbi4gUHJvcGVydHkgY2hhaW5fY2VydF9maWxlX3BhdGggaXMgbWFuZGF0b3J5Ig0KI
 CAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgaWYgbm90IChjb25maWd1cmF0aW9uQXR0
 cmlidXRlcy5jb250YWluc0tleSgibWFwX3VzZXJfY2VydCIpKToNCiAgICAgICAgICAgIHByaW50ICJ
 DZXJ0LiBJbml0aWFsaXphdGlvbi4gUHJvcGVydHkgbWFwX3VzZXJfY2VydCBpcyBtYW5kYXRvcnkiDQ
 ogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBjaGFpbl9jZXJ0X2ZpbGVfcGF0aCA9I
 GNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2hhaW5fY2VydF9maWxlX3BhdGgiKS5nZXRWYWx1
 ZTIoKQ0KDQogICAgICAgIHNlbGYuY2hhaW5fY2VydHMgPSBDZXJ0VXRpbC5sb2FkWDUwOUNlcnRpZml
 jYXRlRnJvbUZpbGUoY2hhaW5fY2VydF9maWxlX3BhdGgpDQogICAgICAgIHByaW50ICJDZXJ0LiBJbm
 l0aWFsaXphdGlvbi4gTG9hZGVkICclZCcgY2hhaW4gY2VydGlmaWNhdGVzIiAlIHNlbGYuY2hhaW5fY
 2VydHMuc2l6ZSgpDQogICAgICAgIA0KICAgICAgICBjcmxfbWF4X3Jlc3BvbnNlX3NpemUgPSA1ICog
 MTAyNCAqIDEwMjQgICMgMTBNYg0KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb25
 0YWluc0tleSgiY3JsX21heF9yZXNwb25zZV9zaXplIik6DQogICAgICAgICAgICBjcmxfbWF4X3Jlc3
 BvbnNlX3NpemUgPSBTdHJpbmdIZWxwZXIudG9JbnRlZ2VyKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzL
 mdldCgiY3JsX21heF9yZXNwb25zZV9zaXplIikuZ2V0VmFsdWUyKCksIGNybF9tYXhfcmVzcG9uc2Vf
 c2l6ZSkNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXphdGlvbi4gQ1JMIG1heCByZXN
 wb25zZSBzaXplIGlzICclZCciICUgY3JsX21heF9yZXNwb25zZV9zaXplDQoNCiAgICAgICAgIyBEZW
 ZpbmUgYXJyYXkgdG8gb3JkZXIgbWV0aG9kcyBjb3JyZWN0bHkNCiAgICAgICAgc2VsZi52YWxpZGF0b
 3JfdHlwZXMgPSBbICdnZW5lcmljJywgJ3BhdGgnLCAnb2NzcCcsICdjcmwnXQ0KICAgICAgICBzZWxm
 LnZhbGlkYXRvcnMgPSB7ICdnZW5lcmljJyA6IFtHZW5lcmljQ2VydGlmaWNhdGVWZXJpZmllcigpLCB
 GYWxzZV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhdGgnIDogW1BhdGhDZXJ0aWZpY2
 F0ZVZlcmlmaWVyKEZhbHNlKSwgRmFsc2VdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdvY
 3NwJyA6IFtPQ1NQQ2VydGlmaWNhdGVWZXJpZmllcigpLCBGYWxzZV0sDQogICAgICAgICAgICAgICAg
 ICAgICAgICAgICAgJ2NybCcgOiBbQ1JMQ2VydGlmaWNhdGVWZXJpZmllcihjcmxfbWF4X3Jlc3BvbnN
 lX3NpemUpLCBGYWxzZV0gfQ0KDQogICAgICAgIGZvciB0eXBlIGluIHNlbGYudmFsaWRhdG9yX3R5cG
 VzOg0KICAgICAgICAgICAgdmFsaWRhdG9yX3BhcmFtX25hbWUgPSAidXNlXyVzX3ZhbGlkYXRvciIgJ
 SB0eXBlDQogICAgICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSh2
 YWxpZGF0b3JfcGFyYW1fbmFtZSk6DQogICAgICAgICAgICAgICAgdmFsaWRhdG9yX3N0YXR1cyA9IFN
 0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KHZhbGlkYXRvcl
 9wYXJhbV9uYW1lKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQogICAgICAgICAgICAgICAgc2VsZi52YWxpZ
 GF0b3JzW3R5cGVdWzFdID0gdmFsaWRhdG9yX3N0YXR1cw0KDQogICAgICAgICAgICBwcmludCAiQ2Vy
 dC4gSW5pdGlhbGl6YXRpb24uIFZhbGlkYXRpb24gbWV0aG9kICclcycgc3RhdHVzOiAnJXMnIiAlICh
 0eXBlLCBzZWxmLnZhbGlkYXRvcnNbdHlwZV1bMV0pDQoNCiAgICAgICAgc2VsZi5tYXBfdXNlcl9jZX
 J0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoIm1hc
 F91c2VyX2NlcnQiKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQogICAgICAgIHByaW50ICJDZXJ0LiBJbml0
 aWFsaXphdGlvbi4gbWFwX3VzZXJfY2VydDogJyVzJyIgJSBzZWxmLm1hcF91c2VyX2NlcnQNCg0KICA
 gICAgICBzZWxmLmVuYWJsZWRfcmVjYXB0Y2hhID0gc2VsZi5pbml0UmVjYXB0Y2hhKGNvbmZpZ3VyYX
 Rpb25BdHRyaWJ1dGVzKQ0KICAgICAgICBwcmludCAiQ2VydC4gSW5pdGlhbGl6YXRpb24uIGVuYWJsZ
 WRfcmVjYXB0Y2hhOiAnJXMnIiAlIHNlbGYuZW5hYmxlZF9yZWNhcHRjaGENCg0KICAgICAgICBwcmlu
 dCAiQ2VydC4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICA
 gDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgIC
 AgIHByaW50ICJDZXJ0LiBEZXN0cm95Ig0KDQogICAgICAgIGZvciB0eXBlIGluIHNlbGYudmFsaWRhd
 G9yX3R5cGVzOg0KICAgICAgICAgICAgc2VsZi52YWxpZGF0b3JzW3R5cGVdWzBdLmRlc3Ryb3koKQ0K
 DQogICAgICAgIHByaW50ICJDZXJ0LiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJ
 ldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuID
 ENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb
 25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0
 QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXR
 pb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdG
 Uoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNC
 iAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkN
 CiAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGN
 vbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICB1c2VyU2VydmljZSA9IF
 VzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBpZiBzdGVwID09IDE6DQogICAgICAgICAgI
 CBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQogICAgICAgICAgICBsb2dpbl9i
 dXR0b24gPSBTZXJ2ZXJVdGlsLmdldEZpcnN0VmFsdWUocmVxdWVzdFBhcmFtZXRlcnMsICJsb2dpbkZ
 vcm06bG9naW5CdXR0b24iKQ0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkobG9naW
 5fYnV0dG9uKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzd
 GVwIDEuIEZvcm0gd2VyZSBzdWJtaXR0ZWQgaW5jb3JyZWN0bHkiDQogICAgICAgICAgICAgICAgcmV0
 dXJuIEZhbHNlDQogICAgICAgICAgICBpZiBzZWxmLmVuYWJsZWRfcmVjYXB0Y2hhOg0KICAgICAgICA
 gICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVmFsaWRhdGluZyByZW
 NhcHRjaGEgcmVzcG9uc2UiDQogICAgICAgICAgICAgICAgcmVjYXB0Y2hhX3Jlc3BvbnNlID0gU2Vyd
 mVyVXRpbC5nZXRGaXJzdFZhbHVlKHJlcXVlc3RQYXJhbWV0ZXJzLCAiZy1yZWNhcHRjaGEtcmVzcG9u
 c2UiKQ0KDQogICAgICAgICAgICAgICAgcmVjYXB0Y2hhX3Jlc3VsdCA9IHNlbGYudmFsaWRhdGVSZWN
 hcHRjaGEocmVjYXB0Y2hhX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdX
 RoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcmVjYXB0Y2hhX3Jlc3VsdDogJyVzJyIgJSByZWNhcHRjaGFfc
 mVzdWx0DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHJlY2FwdGNoYV9y
 ZXN1bHQNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiBzdGVwID09IDI6DQo
 gICAgICAgICAgICBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIiDQoNCiAgICAgIC
 AgICAgICMgVmFsaWRhdGUgaWYgdXNlciBzZWxlY3RlZCBjZXJ0aWZpY2F0ZQ0KICAgICAgICAgICAgY
 2VydF94NTA5ID0gc2VsZi5nZXRTZXNzaW9uQXR0cmlidXRlKCJjZXJ0X3g1MDkiKQ0KICAgICAgICAg
 ICAgaWYgY2VydF94NTA5ID09IE5vbmU6DQogICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAyLiBVc2VyIG5vdCBzZWxlY3RlZCBhbnkgY2VydHMiDQogICAgICAgIC
 AgICAgICAgY29udGV4dC5zZXQoImNlcnRfc2VsZWN0ZWQiLCBGYWxzZSkNCiAgICAgICAgICAgICAgI
 CAgICAgDQogICAgICAgICAgICAgICAgIyBSZXR1cm4gVHJ1ZSB0byBpbmZvcm0gdXNlciBob3cgdG8g
 cmVzZXQgd29ya2Zsb3cNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZWx
 zZToNCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF9zZWxlY3RlZCIsIFRydWUpDQogIC
 AgICAgICAgICAgICAgeDUwOUNlcnRpZmljYXRlID0gc2VsZi5jZXJ0RnJvbVN0cmluZyhjZXJ0X3g1M
 DkpDQoNCiAgICAgICAgICAgIHN1YmplY3RYNTAwUHJpbmNpcGFsID0geDUwOUNlcnRpZmljYXRlLmdl
 dFN1YmplY3RYNTAwUHJpbmNpcGFsKCkNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWN
 hdGUgZm9yIHN0ZXAgMi4gVXNlciBzZWxlY3RlZCBjZXJ0aWZpY2F0ZSB3aXRoIEROICclcyciICUgc3
 ViamVjdFg1MDBQcmluY2lwYWwNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBWYWxpZGF0ZSBjZ
 XJ0aWZpY2F0ZXMgd2hpY2ggdXNlciBzZWxlY3RlZA0KICAgICAgICAgICAgdmFsaWQgPSBzZWxmLnZh
 bGlkYXRlQ2VydGlmaWNhdGUoeDUwOUNlcnRpZmljYXRlKQ0KICAgICAgICAgICAgaWYgbm90IHZhbGl
 kOg0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gQ2
 VydGlmaWNhdGUgRE4gJyVzJyBpcyBub3QgdmFsaWQiICUgc3ViamVjdFg1MDBQcmluY2lwYWwNCiAgI
 CAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF92YWxpZCIsIEZhbHNlKQ0KICAgICAgICAgICAg
 ICAgIA0KICAgICAgICAgICAgICAgICMgUmV0dXJuIFRydWUgdG8gaW5mb3JtIHVzZXIgaG93IHRvIHJ
 lc2V0IHdvcmtmbG93DQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgY2
 9udGV4dC5zZXQoImNlcnRfdmFsaWQiLCBUcnVlKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjI
 ENhbGN1bGF0ZSBjZXJ0aWZpY2F0ZSBmaW5nZXJwcmludA0KICAgICAgICAgICAgeDUwOUNlcnRpZmlj
 YXRlRmluZ2VycHJpbnQgPSBzZWxmLmNhbGN1bGF0ZUNlcnRpZmljYXRlRmluZ2VycHJpbnQoeDUwOUN
 lcnRpZmljYXRlKQ0KICAgICAgICAgICAgY29udGV4dC5zZXQoImNlcnRfeDUwOV9maW5nZXJwcmludC
 IsIHg1MDlDZXJ0aWZpY2F0ZUZpbmdlcnByaW50KQ0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1d
 GhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGaW5nZXJwcmludCBpcyAnJXMnIG9mIGNlcnRpZmljYXRlIHdp
 dGggRE4gJyVzJyIgJSAoeDUwOUNlcnRpZmljYXRlRmluZ2VycHJpbnQsIHN1YmplY3RYNTAwUHJpbmN
 pcGFsKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIEF0dGVtcHQgdG8gZmluZCB1c2VyIGJ5IG
 NlcnRpZmljYXRlIGZpbmdlcnByaW50DQogICAgICAgICAgICBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkI
 D0gImNlcnQ6ICVzIiAlIHg1MDlDZXJ0aWZpY2F0ZUZpbmdlcnByaW50DQogICAgICAgICAgICBwcmlu
 dCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ
 5IG94RXh0ZXJuYWxVaWQgYXR0cmlidXRlIHZhbHVlICVzIiAlIGNlcnRfdXNlcl9leHRlcm5hbF91aW
 QNCg0KICAgICAgICAgICAgZmluZF91c2VyX2J5X2V4dGVybmFsX3VpZCA9IHVzZXJTZXJ2aWNlLmdld
 FVzZXJCeUF0dHJpYnV0ZSgib3hFeHRlcm5hbFVpZCIsIGNlcnRfdXNlcl9leHRlcm5hbF91aWQpDQog
 ICAgICAgICAgICBpZiBmaW5kX3VzZXJfYnlfZXh0ZXJuYWxfdWlkID09IE5vbmU6DQogICAgICAgICA
 gICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZmluZC
 B1c2VyIg0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIHNlbGYubWFwX3VzZXJfY
 2VydDoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3Rl
 cCAyLiBTdG9yaW5nIGNlcnRfdXNlcl9leHRlcm5hbF91aWQgZm9yIHN0ZXAgMyINCiAgICAgICAgICA
 gICAgICAgICAgY29udGV4dC5zZXQoImNlcnRfdXNlcl9leHRlcm5hbF91aWQiLCBjZXJ0X3VzZXJfZX
 h0ZXJuYWxfdWlkKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgI
 CAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9y
 IHN0ZXAgMi4gTWFwcGluZyBjZXQgdG8gdXNlciBhY2NvdW50IGlzIG5vdCBhbGxvd2VkIg0KICAgICA
 gICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF9jb3VudF9sb2dpbl9zdGVwcyIsIDIpDQogIC
 AgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBmb3VuZFVzZXJOYW1lI
 D0gZmluZF91c2VyX2J5X2V4dGVybmFsX3VpZC5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgcHJpbnQg
 IkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBmb3VuZFVzZXJOYW1lOiAiICsgZm91bmRVc2V
 yTmFtZQ0KDQogICAgICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgdXNlclNlcn
 ZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU
 2VydmljZS5hdXRoZW50aWNhdGUoZm91bmRVc2VyTmFtZSkNCiAgICAgICAgDQogICAgICAgICAgICBw
 cmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIFNldHRpbmcgY291bnQgc3RlcHMgdG8
 gMiINCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJjZXJ0X2NvdW50X2xvZ2luX3N0ZXBzIiwgMikNCg
 0KICAgICAgICAgICAgcmV0dXJuIGxvZ2dlZF9pbg0KICAgICAgICBlbGlmIHN0ZXAgPT0gMzoNCiAgI
 CAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMyINCg0KICAgICAgICAg
 ICAgY2VydF91c2VyX2V4dGVybmFsX3VpZCA9IHNlbGYuZ2V0U2Vzc2lvbkF0dHJpYnV0ZSgiY2VydF9
 1c2VyX2V4dGVybmFsX3VpZCIpDQogICAgICAgICAgICBpZiBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkID
 09IE5vbmU6DQogICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3Rlc
 CAzLiBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkIGlzIGVtcHR5Ig0KICAgICAgICAgICAgICAgIHJldHVy
 biBGYWxzZQ0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V
 0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm
 5hbWUoKQ0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkK
 CkNCg0KICAgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNCiAgICAgICAgICAgIGlmIChTdHJpbmdI
 ZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB
 0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogICAgICAgICAgICAgICAgbG9nZ2VkX2luID0gdXNlcl
 NlcnZpY2UuYXV0aGVudGljYXRlKHVzZXJfbmFtZSwgdXNlcl9wYXNzd29yZCkNCg0KICAgICAgICAgI
 CAgaWYgKG5vdCBsb2dnZWRfaW4pOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAg
 ICAgICAgICAjIERvdWJsZSBjaGVjayBqdXN0IHRvIG1ha2Ugc3VyZS4gV2UgZGlkIGNoZWNraW5nIGl
 uIHByZXZpb3VzIHN0ZXANCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aGljaC
 BoYXMgY2VydF91c2VyX2V4dGVybmFsX3VpZA0KICAgICAgICAgICAgIyBBdm9pZCBtYXBwaW5nIHVzZ
 XIgY2VydCB0byBtb3JlIHRoYW4gb25lIElEUCBhY2NvdW50DQogICAgICAgICAgICBmaW5kX3VzZXJf
 YnlfZXh0ZXJuYWxfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmF
 sVWlkIiwgY2VydF91c2VyX2V4dGVybmFsX3VpZCkNCiAgICAgICAgICAgIGlmIGZpbmRfdXNlcl9ieV
 9leHRlcm5hbF91aWQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAjIEFkZCBjZXJ0X3VzZXJfZXh0Z
 XJuYWxfdWlkIHRvIHVzZXIncyBleHRlcm5hbCBHVUlEIGxpc3QNCiAgICAgICAgICAgICAgICBmaW5k
 X3VzZXJfYnlfZXh0ZXJuYWxfdWlkID0gdXNlclNlcnZpY2UuYWRkVXNlckF0dHJpYnV0ZSh1c2VyX25
 hbWUsICJveEV4dGVybmFsVWlkIiwgY2VydF91c2VyX2V4dGVybmFsX3VpZCkNCiAgICAgICAgICAgIC
 AgICBpZiBmaW5kX3VzZXJfYnlfZXh0ZXJuYWxfdWlkID09IE5vbmU6DQogICAgICAgICAgICAgICAgI
 CAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMy4gRmFpbGVkIHRvIHVwZGF0ZSBj
 dXJyZW50IHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICA
 gICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIC
 AgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgcHJlcGFyZUZvclN0Z
 XAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToN
 CiAgICAgICAgcHJpbnQgIkNlcnQuIFByZXBhcmUgZm9yIHN0ZXAgJWQiICUgc3RlcA0KICAgICAgICB
 jb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgDQogICAgICAgIGlmIH
 N0ZXAgPT0gMToNCiAgICAgICAgICAgIGlmIHNlbGYuZW5hYmxlZF9yZWNhcHRjaGE6DQogICAgICAgI
 CAgICAgICAgY29udGV4dC5zZXQoInJlY2FwdGNoYV9zaXRlX2tleSIsIHNlbGYucmVjYXB0Y2hhX2Ny
 ZWRzWydzaXRlX2tleSddKQ0KICAgICAgICBlbGlmIHN0ZXAgPT0gMjoNCiAgICAgICAgICAgICMgU3R
 vcmUgY2VydGlmaWNhdGUgaW4gc2Vzc2lvbg0KICAgICAgICAgICAgcmVxdWVzdCA9IEZhY2VzQ29udG
 V4dC5nZXRDdXJyZW50SW5zdGFuY2UoKS5nZXRFeHRlcm5hbENvbnRleHQoKS5nZXRSZXF1ZXN0KCkNC
 iAgICAgICAgICAgIHg1MDlDZXJ0aWZpY2F0ZXMgPSByZXF1ZXN0LmdldEF0dHJpYnV0ZSgnamF2YXgu
 c2VydmxldC5yZXF1ZXN0Llg1MDlDZXJ0aWZpY2F0ZScpDQogICAgICAgICAgICBpZiAoeDUwOUNlcnR
 pZmljYXRlcyAhPSBOb25lKSBhbmQgKGxlbih4NTA5Q2VydGlmaWNhdGVzKSA+IDApOg0KICAgICAgIC
 AgICAgICAgIGNvbnRleHQuc2V0KCJjZXJ0X3g1MDkiLCBzZWxmLmNlcnRUb1N0cmluZyh4NTA5Q2Vyd
 GlmaWNhdGVzKSkNCiAgICAgICAgICAgICAgICBwcmludCAiQ2VydC4gUHJlcGFyZSBmb3Igc3RlcCAy
 LiBTdG9yaW5nIHVzZXIgY2VydGlmaWNhdGUiDQoNCiAgICAgICAgaWYgc3RlcCA8IDQ6DQogICAgICA
 gICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQ
 oNCiAgICBkZWYgZ2V0RXh0cmFQYXJhbWV0ZXJzRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0c
 mlidXRlcywgc3RlcCk6DQogICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KCJjZXJ0X3NlbGVjdGVk
 IiwgImNlcnRfdmFsaWQiLCAiY2VydF94NTA5IiwgImNlcnRfeDUwOV9maW5nZXJwcmludCIsICJjZXJ
 0X2NvdW50X2xvZ2luX3N0ZXBzIiwgImNlcnRfdXNlcl9leHRlcm5hbF91aWQiKQ0KDQogICAgZGVmIG
 dldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6D
 QogICAgICAgIGNlcnRfY291bnRfbG9naW5fc3RlcHMgPSBzZWxmLmdldFNlc3Npb25BdHRyaWJ1dGUo
 ImNlcnRfY291bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICBpZiBjZXJ0X2NvdW50X2xvZ2luX3N0ZXB
 zICE9IE5vbmU6DQogICAgICAgICAgICByZXR1cm4gY2VydF9jb3VudF9sb2dpbl9zdGVwcw0KICAgIC
 AgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIDMNCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZ
 WxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIHN0ZXAgPT0gMToN
 CiAgICAgICAgICAgIHJldHVybiAiL2F1dGgvY2VydC9sb2dpbi54aHRtbCINCiAgICAgICAgaWYgc3R
 lcCA9PSAyOg0KICAgICAgICAgICAgcmV0dXJuICIvY2VydC1sb2dpbi54aHRtbCINCiAgICAgICAgZW
 xpZiBzdGVwID09IDM6DQogICAgICAgICAgICBjZXJ0X3NlbGVjdGVkID0gc2VsZi5nZXRTZXNzaW9uQ
 XR0cmlidXRlKCJjZXJ0X3NlbGVjdGVkIikNCiAgICAgICAgICAgIGlmIFRydWUgIT0gY2VydF9zZWxl
 Y3RlZDoNCiAgICAgICAgICAgICAgICByZXR1cm4gIi9hdXRoL2NlcnQvY2VydC1ub3Qtc2VsZWN0ZWQ
 ueGh0bWwiDQoNCiAgICAgICAgICAgIGNlcnRfdmFsaWQgPSBzZWxmLmdldFNlc3Npb25BdHRyaWJ1dG
 UoImNlcnRfdmFsaWQiKQ0KICAgICAgICAgICAgaWYgVHJ1ZSAhPSBjZXJ0X3ZhbGlkOg0KICAgICAgI
 CAgICAgICAgIHJldHVybiAiL2F1dGgvY2VydC9jZXJ0LWludmFsaWQueGh0bWwiDQogICAgICAgICAg
 ICANCiAgICAgICAgICAgIHJldHVybiAiL2xvZ2luLnhodG1sIg0KDQogICAgICAgIHJldHVybiAiIg0
 KDQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcm
 FtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIHByb2Nlc3NCYXNpY0F1dGhlb
 nRpY2F0aW9uKHNlbGYsIGNyZWRlbnRpYWxzKToNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2Vy
 dmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5
 hbWUoKQ0KICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KDQ
 ogICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFb
 XB0eVN0cmluZyh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2Vy
 X3Bhc3N3b3JkKSk6DQogICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWN
 hdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgIGlmIChub3QgbG9nZ2VkX2luKT
 oNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZ
 XJTZXJ2aWNlLmdldFVzZXIodXNlcl9uYW1lKQ0KICAgICAgICBpZiAoZmluZF91c2VyX2J5X3VpZCA9
 PSBOb25lKToNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBQcm9jZXNzIGJhc2ljIGF1dGhlbnRpY2F
 0aW9uLiBGYWlsZWQgdG8gZmluZCB1c2VyICclcyciICUgdXNlcl9uYW1lDQogICAgICAgICAgICByZX
 R1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGZpbmRfdXNlcl9ieV91aWQNCg0KICAgI
 GRlZiBnZXRTZXNzaW9uQXR0cmlidXRlKHNlbGYsIGF0dHJpYnV0ZV9uYW1lKToNCiAgICAgICAgY29u
 dGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQoNCiAgICAgICAgIyBUcnkgdG8gZ2V0IGF
 0dHJpYnV0ZSB2YWx1ZSBmcm9tIFNlYW0gZXZlbnQgY29udGV4dA0KICAgICAgICBpZiBjb250ZXh0Lm
 lzU2V0KGF0dHJpYnV0ZV9uYW1lKToNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldChhdHRya
 WJ1dGVfbmFtZSkNCiAgICAgICAgDQogICAgICAgICMgVHJ5IHRvIGdldCBhdHRyaWJ1dGUgZnJvbSBw
 ZXJzaXN0ZW50IHNlc3Npb24NCiAgICAgICAgc2Vzc2lvbl9hdHRyaWJ1dGVzID0gY29udGV4dC5nZXQ
 oInNlc3Npb25BdHRyaWJ1dGVzIikNCiAgICAgICAgaWYgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnRhaW
 5zS2V5KGF0dHJpYnV0ZV9uYW1lKToNCiAgICAgICAgICAgIHJldHVybiBzZXNzaW9uX2F0dHJpYnV0Z
 XMuZ2V0KGF0dHJpYnV0ZV9uYW1lKQ0KDQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgY2Fs
 Y3VsYXRlQ2VydGlmaWNhdGVGaW5nZXJwcmludChzZWxmLCB4NTA5Q2VydGlmaWNhdGUpOg0KICAgICA
 gICBwcmludCAiQ2VydC4gQ2FsY3VsYXRlIGZpbmdlcnByaW50IGZvciBjZXJ0aWZpY2F0ZSBETiAnJX
 MnIiAlIHg1MDlDZXJ0aWZpY2F0ZS5nZXRTdWJqZWN0WDUwMFByaW5jaXBhbCgpDQogICAgICAgIA0KI
 CAgICAgICBwdWJsaWNLZXkgPSB4NTA5Q2VydGlmaWNhdGUuZ2V0UHVibGljS2V5KCkNCiAgICAgICAg
 DQogICAgICAgICMgVXNlIG94QXV0aCBpbXBsZW1lbnRhdGlvbg0KICAgICAgICBmaW5nZXJwcmludCA
 9IEZpbmdlcnByaW50SGVscGVyLmdldFB1YmxpY0tleVNzaEZpbmdlcnByaW50KHB1YmxpY0tleSkNCi
 AgICAgICAgDQogICAgICAgIHJldHVybiBmaW5nZXJwcmludCAgICAgIA0KDQogICAgZGVmIHZhbGlkY
 XRlQ2VydGlmaWNhdGUoc2VsZiwgeDUwOUNlcnRpZmljYXRlKToNCiAgICAgICAgc3ViamVjdFg1MDBQ
 cmluY2lwYWwgPSB4NTA5Q2VydGlmaWNhdGUuZ2V0U3ViamVjdFg1MDBQcmluY2lwYWwoKQ0KDQogICA
 gICAgIHByaW50ICJDZXJ0LiBWYWxpZGF0aW5nIGNlcnRpZmljYXRlIHdpdGggRE4gJyVzJyIgJSBzdW
 JqZWN0WDUwMFByaW5jaXBhbA0KICAgICAgICANCiAgICAgICAgdmFsaWRhdGlvbl9kYXRlID0gamF2Y
 S51dGlsLkRhdGUoKQ0KDQogICAgICAgIGZvciB0eXBlIGluIHNlbGYudmFsaWRhdG9yX3R5cGVzOg0K
 ICAgICAgICAgICAgaWYgc2VsZi52YWxpZGF0b3JzW3R5cGVdWzFdOg0KICAgICAgICAgICAgICAgIHJ
 lc3VsdCA9IHNlbGYudmFsaWRhdG9yc1t0eXBlXVswXS52YWxpZGF0ZSh4NTA5Q2VydGlmaWNhdGUsIH
 NlbGYuY2hhaW5fY2VydHMsIHZhbGlkYXRpb25fZGF0ZSkNCiAgICAgICAgICAgICAgICBwcmludCAiQ
 2VydC4gVmFsaWRhdGUgY2VydGlmaWNhdGU6ICclcycuIFZhbGlkYXRpb24gbWV0aG9kICclcycgcmVz
 dWx0OiAnJXMnIiAlIChzdWJqZWN0WDUwMFByaW5jaXBhbCwgdHlwZSwgcmVzdWx0KQ0KICAgICAgICA
 gICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZ2V0VmFsaWRpdHkoKSAhPSBWYWxpZG
 F0aW9uU3RhdHVzLkNlcnRpZmljYXRlVmFsaWRpdHkuVkFMSUQpOg0KICAgICAgICAgICAgICAgICAgI
 CBwcmludCAiQ2VydC4gQ2VydGlmaWNhdGU6ICclcycgaXMgaW52YWxpZCIgJSBzdWJqZWN0WDUwMFBy
 aW5jaXBhbA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgDQogICAgICA
 gIHJldHVybiBUcnVlDQoNCiAgICBkZWYgY2VydFRvU3RyaW5nKHNlbGYsIHg1MDlDZXJ0aWZpY2F0ZX
 MpOg0KICAgICAgICByZXR1cm4gYmFzZTY0LmI2NGVuY29kZSh4NTA5Q2VydGlmaWNhdGVzWzBdLmdld
 EVuY29kZWQoKSkNCg0KICAgIGRlZiBjZXJ0RnJvbVN0cmluZyhzZWxmLCB4NTA5Q2VydGlmaWNhdGVF
 bmNvZGVkKToNCiAgICAgICAgeDUwOUNlcnRpZmljYXRlRGVjb2RlZCA9IGJhc2U2NC5iNjRkZWNvZGU
 oeDUwOUNlcnRpZmljYXRlRW5jb2RlZCkNCg0KICAgICAgICByZXR1cm4gQ2VydFV0aWwueDUwOUNlcn
 RpZmljYXRlRnJvbUJ5dGVzKHg1MDlDZXJ0aWZpY2F0ZURlY29kZWQpDQoNCiAgICBkZWYgaW5pdFJlY
 2FwdGNoYShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDZXJ0
 LiBJbml0aWFsaXplIHJlY2FwdGNoYSINCiAgICAgICAgaWYgbm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ
 1dGVzLmNvbnRhaW5zS2V5KCJjcmVkZW50aWFsc19maWxlIik6DQogICAgICAgICAgICByZXR1cm4gRm
 Fsc2UNCg0KICAgICAgICBjZXJ0X2NyZWRzX2ZpbGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZ
 XQoImNyZWRlbnRpYWxzX2ZpbGUiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICMgTG9hZCBjcmVkZW50
 aWFscyBmcm9tIGZpbGUNCiAgICAgICAgZiA9IG9wZW4oY2VydF9jcmVkc19maWxlLCAncicpDQogICA
 gICAgIHRyeToNCiAgICAgICAgICAgIGNyZWRzID0ganNvbi5sb2FkcyhmLnJlYWQoKSkNCiAgICAgIC
 AgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEluaXRpYWxpemUgcmVjYXB0Y2hhLiBGY
 WlsZWQgdG8gbG9hZCBjcmVkZW50aWFscyBmcm9tIGZpbGU6ICVzIiAlIGNlcnRfY3JlZHNfZmlsZQ0K
 ICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBmLmN
 sb3NlKCkNCiAgICAgICAgDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHJlY2FwdGNoYV9jcmVkcy
 A9IGNyZWRzWyJyZWNhcHRjaGEiXQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludCAiQ
 2VydC4gSW5pdGlhbGl6ZSByZWNhcHRjaGEuIEludmFsaWQgY3JlZGVudGlhbHMgZmlsZSAnJXMnIGZv
 cm1hdDoiICUgY2VydF9jcmVkc19maWxlDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICA
 gDQogICAgICAgIHNlbGYucmVjYXB0Y2hhX2NyZWRzID0gTm9uZQ0KICAgICAgICBpZiByZWNhcHRjaG
 FfY3JlZHNbImVuYWJsZWQiXToNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXplIHJlY
 2FwdGNoYS4gUmVjYXB0Y2hhIGlzIGVuYWJsZWQiDQoNCiAgICAgICAgICAgIHN0cmluZ0VuY3J5cHRl
 ciA9IFN0cmluZ0VuY3J5cHRlci5kZWZhdWx0SW5zdGFuY2UoKQ0KDQogICAgICAgICAgICBzaXRlX2t
 leSA9IHJlY2FwdGNoYV9jcmVkc1sic2l0ZV9rZXkiXQ0KICAgICAgICAgICAgc2VjcmV0X2tleSA9IH
 JlY2FwdGNoYV9jcmVkc1sic2VjcmV0X2tleSJdDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgI
 CAgICAgICBzaXRlX2tleSA9IHN0cmluZ0VuY3J5cHRlci5kZWNyeXB0KHNpdGVfa2V5KQ0KICAgICAg
 ICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICMgSWdub3JlIGV4Y2VwdGlvbi4gVmFsdWUgaXM
 gbm90IGVuY3J5cHRlZA0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXplIHJlY2
 FwdGNoYS4gQXNzdW1pbmcgdGhhdCAnc2l0ZV9rZXknIGluIG5vdCBlbmNyeXB0ZWQiDQoNCiAgICAgI
 CAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBzZWNyZXRfa2V5ID0gc3RyaW5nRW5jcnlwdGVyLmRl
 Y3J5cHQoc2VjcmV0X2tleSkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAjIEl
 nbm9yZSBleGNlcHRpb24uIFZhbHVlIGlzIG5vdCBlbmNyeXB0ZWQNCiAgICAgICAgICAgICAgICBwcm
 ludCAiQ2VydC4gSW5pdGlhbGl6ZSByZWNhcHRjaGEuIEFzc3VtaW5nIHRoYXQgJ3NlY3JldF9rZXknI
 GluIG5vdCBlbmNyeXB0ZWQiDQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZWNhcHRj
 aGFfY3JlZHMgPSB7ICdzaXRlX2tleScgOiBzaXRlX2tleSwgInNlY3JldF9rZXkiIDogc2VjcmV0X2t
 leSB9DQogICAgICAgICAgICBwcmludCAib3hQdXNoMi4gSW5pdGlhbGl6ZSByZWNhcHRjaGEuIFJlY2
 FwdGNoYSBpcyBjb25maWd1cmVkIGNvcnJlY3RseSINCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNC
 iAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBJbml0aWFsaXplIHJlY2Fw
 dGNoYS4gUmVjYXB0Y2hhIGlzIGRpc2FibGVkIg0KDQogICAgICAgIHJldHVybiBGYWxzZQ0KDQogICA
 gZGVmIHZhbGlkYXRlUmVjYXB0Y2hhKHNlbGYsIHJlY2FwdGNoYV9yZXNwb25zZSk6DQogICAgICAgIH
 ByaW50ICJDZXJ0LiBWYWxpZGF0ZSByZWNhcHRjaGEgcmVzcG9uc2UiDQoNCiAgICAgICAgcmVxdWVzd
 CA9IEZhY2VzQ29udGV4dC5nZXRDdXJyZW50SW5zdGFuY2UoKS5nZXRFeHRlcm5hbENvbnRleHQoKS5n
 ZXRSZXF1ZXN0KCkNCiAgICAgICAgcmVtb3RlaXAgPSByZXF1ZXN0LmdldEhlYWRlcigiWC1GT1JXQVJ
 ERUQtRk9SIikNCiAgICAgICAgaWYgcmVtb3RlaXAgPT0gTm9uZToNCiAgICAgICAgICAgIHJlbW90ZW
 lwID0gcmVxdWVzdC5nZXRSZW1vdGVBZGRyKCkNCiAgICAgICAgcHJpbnQgIkNlcnQuIFZhbGlkYXRlI
 HJlY2FwdGNoYSByZXNwb25zZS4gcmVtb3RlaXA6ICclcyciICUgcmVtb3RlaXANCg0KICAgICAgICBo
 dHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCk7DQoNCiAgICAgICAgaHR0cF9jbGllbnQ
 gPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpOw0KICAgICAgICBodHRwX2NsaWVudF9wYXJhbX
 MgPSBodHRwX2NsaWVudC5nZXRQYXJhbXMoKTsNCiAgICAgICAgaHR0cF9jbGllbnRfcGFyYW1zLnNld
 EludFBhcmFtZXRlcihDb3JlQ29ubmVjdGlvblBOYW1lcy5DT05ORUNUSU9OX1RJTUVPVVQsIDE1ICog
 MTAwMCk7DQogICAgICAgIA0KICAgICAgICByZWNhcHRjaGFfdmFsaWRhdGlvbl91cmwgPSAiaHR0cHM
 6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL3NpdGV2ZXJpZnkiDQogICAgICAgIHJlY2FwdG
 NoYV92YWxpZGF0aW9uX3JlcXVlc3QgPSB1cmxsaWIudXJsZW5jb2RlKHsgInNlY3JldCIgOiBzZWxmL
 nJlY2FwdGNoYV9jcmVkc1snc2VjcmV0X2tleSddLCAicmVzcG9uc2UiIDogcmVjYXB0Y2hhX3Jlc3Bv
 bnNlLCAicmVtb3RlaXAiIDogcmVtb3RlaXAgfSkNCiAgICAgICAgcmVjYXB0Y2hhX3ZhbGlkYXRpb25
 faGVhZGVycyA9IHsgIkNvbnRlbnQtdHlwZSIgOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbm
 NvZGVkIiwgIkFjY2VwdCIgOiAiYXBwbGljYXRpb24vanNvbiIgfQ0KDQogICAgICAgIHRyeToNCiAgI
 CAgICAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZSA9IGh0dHBTZXJ2aWNlLmV4ZWN1dGVQb3N0KGh0
 dHBfY2xpZW50LCByZWNhcHRjaGFfdmFsaWRhdGlvbl91cmwsIE5vbmUsIHJlY2FwdGNoYV92YWxpZGF
 0aW9uX2hlYWRlcnMsIHJlY2FwdGNoYV92YWxpZGF0aW9uX3JlcXVlc3QpDQogICAgICAgICAgICBodH
 RwX3Jlc3BvbnNlID0gaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlLmdldEh0dHBSZXNwb25zZSgpDQogICAgI
 CAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBWYWxpZGF0ZSByZWNhcHRjaGEgcmVz
 cG9uc2UuIEV4Y2VwdGlvbjogIiwgc3lzLmV4Y19pbmZvKClbMV0NCiAgICAgICAgICAgIHJldHVybiB
 GYWxzZQ0KDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIG5vdCBodHRwU2VydmljZS5pc1Jlc3
 BvbnNlU3Rhc3R1c0NvZGVPayhodHRwX3Jlc3BvbnNlKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ
 2VydC4gVmFsaWRhdGUgcmVjYXB0Y2hhIHJlc3BvbnNlLiBHZXQgaW52YWxpZCByZXNwb25zZSBmcm9t
 IHZhbGlkYXRpb24gc2VydmVyOiAiLCBzdHIoaHR0cF9yZXNwb25zZS5nZXRTdGF0dXNMaW5lKCkuZ2V
 0U3RhdHVzQ29kZSgpKQ0KICAgICAgICAgICAgICAgIGh0dHBTZXJ2aWNlLmNvbnN1bWUoaHR0cF9yZX
 Nwb25zZSkNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICAgICAgICAgIHJlc
 3BvbnNlX2J5dGVzID0gaHR0cFNlcnZpY2UuZ2V0UmVzcG9uc2VDb250ZW50KGh0dHBfcmVzcG9uc2Up
 DQogICAgICAgICAgICByZXNwb25zZV9zdHJpbmcgPSBodHRwU2VydmljZS5jb252ZXJ0RW50aXR5VG9
 TdHJpbmcocmVzcG9uc2VfYnl0ZXMpDQogICAgICAgICAgICBodHRwU2VydmljZS5jb25zdW1lKGh0dH
 BfcmVzcG9uc2UpDQogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBodHRwX3NlcnZpY2VfcmVzc
 G9uc2UuY2xvc2VDb25uZWN0aW9uKCkNCg0KICAgICAgICBpZiByZXNwb25zZV9zdHJpbmcgPT0gTm9u
 ZToNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBWYWxpZGF0ZSByZWNhcHRjaGEgcmVzcG9uc2UuIEd
 ldCBlbXB0eSByZXNwb25zZSBmcm9tIHZhbGlkYXRpb24gc2VydmVyIg0KICAgICAgICAgICAgcmV0dX
 JuIEZhbHNlDQogICAgICAgIA0KICAgICAgICByZXNwb25zZSA9IGpzb24ubG9hZHMocmVzcG9uc2Vfc
 3RyaW5nKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJzdWNjZXNzIl0NCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!14AF.A70C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: CAS authentication module
displayName: cas
gluuStatus: false
inum: %(inumOrg)s!0011!14AF.A70C
oxConfigurationProperty: {"value1":"cas_map_user","value2":"true","description":""}
oxConfigurationProperty: {"value1":"cas_renew_opt","value2":"false","description":""}
oxConfigurationProperty: {"value1":"cas_host","value2":"https://%(hostname)s/cas","description":""}
oxLevel: 30
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuI
 FNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuDQojIENv
 cHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KZnJ
 vbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4dHMNCmZyb20gb3
 JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIG9yZy5qYm9zcy5zZWFtI
 GltcG9ydCBDb21wb25lbnQNCmZyb20gamF2YXguZmFjZXMuY29udGV4dCBpbXBvcnQgRmFjZXNDb250
 ZXh0DQpmcm9tIG9yZy5qYm9zcy5zZWFtIGltcG9ydCBDb21wb25lbnQNCmZyb20gb3JnLmFwYWNoZS5
 odHRwLmVudGl0eSBpbXBvcnQgQ29udGVudFR5cGUgDQpmcm9tIG9yZy54ZGkubW9kZWwuY3VzdG9tLn
 NjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcue
 GRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5z
 ZXJ2aWNlIGltcG9ydCBBdXRoZW50aWNhdGlvblNlcnZpY2UNCmZyb20gb3JnLnhkaS5veGF1dGguc2V
 ydmljZS5uZXQgaW1wb3J0IEh0dHBTZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW
 5nSGVscGVyDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgQXJyYXlIZWxwZXINCmZyb20gb3JnLmFwY
 WNoZS5odHRwLnBhcmFtcyBpbXBvcnQgQ29yZUNvbm5lY3Rpb25QTmFtZXMNCmZyb20gamF2YS51dGls
 IGltcG9ydCBBcnJheXMNCmZyb20gamF2YS51dGlsIGltcG9ydCBIYXNoTWFwDQoNCmltcG9ydCBqYXZ
 hDQppbXBvcnQgc3lzDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2
 F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgI
 CAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYg
 aW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDQVMyLiB
 Jbml0aWFsaXphdGlvbiINCiAgICAgICAgcHJpbnQgIkNBUzIuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdW
 xseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvbmZpZ
 3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkNBUzIuIERlc3Ryb3kiDQogICAgICAg
 IHByaW50ICJDQVMyLiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZQ0
 KDQogICAgZGVmIGdldEFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZW
 YgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvb
 kF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ0FTMi4gUmVzdCBBUEkgYXV0aGVudGljYXRlIGlz
 VmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZCINCg0KICAgICAgICBpZiAobm90IChjb25maWd1cmF0aW9
 uQXR0cmlidXRlcy5jb250YWluc0tleSgiY2FzX3ZhbGlkYXRpb25fdXJpIikgYW5kDQogICAgICAgIC
 AgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiY2FzX3ZhbGlkYXRpb25fcGF0d
 GVybiIpIGFuZA0KICAgICAgICAgICAgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXko
 ImNhc192YWxpZGF0aW9uX3RpbWVvdXQiKSkpOg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICA
 gICAgICBjYXNfdmFsaWRhdGlvbl91cmkgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc1
 92YWxpZGF0aW9uX3VyaSIpLmdldFZhbHVlMigpDQogICAgICAgIGNhc192YWxpZGF0aW9uX3BhdHRlc
 m4gPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc192YWxpZGF0aW9uX3BhdHRlcm4iKS5n
 ZXRWYWx1ZTIoKQ0KICAgICAgICBjYXNfdmFsaWRhdGlvbl90aW1lb3V0ID0gaW50KGNvbmZpZ3VyYXR
 pb25BdHRyaWJ1dGVzLmdldCgiY2FzX3ZhbGlkYXRpb25fdGltZW91dCIpLmdldFZhbHVlMigpKSAqID
 EwMDANCg0KICAgICAgICBodHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCk7DQoNCiAgI
 CAgICAgaHR0cF9jbGllbnQgPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpOw0KICAgICAgICBo
 dHRwX2NsaWVudF9wYXJhbXMgPSBodHRwX2NsaWVudC5nZXRQYXJhbXMoKTsNCiAgICAgICAgaHR0cF9
 jbGllbnRfcGFyYW1zLnNldEludFBhcmFtZXRlcihDb3JlQ29ubmVjdGlvblBOYW1lcy5DT05ORUNUSU
 9OX1RJTUVPVVQsIGNhc192YWxpZGF0aW9uX3RpbWVvdXQpOw0KDQogICAgICAgIHRyeToNCiAgICAgI
 CAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZSA9IGh0dHBTZXJ2aWNlLmV4ZWN1dGVHZXQoaHR0cF9j
 bGllbnQsIGNhc192YWxpZGF0aW9uX3VyaSkNCiAgICAgICAgICAgIGh0dHBfcmVzcG9uc2UgPSBodHR
 wX3NlcnZpY2VfcmVzcG9uc2UuZ2V0SHR0cFJlc3BvbnNlKCkNCiAgICAgICAgZXhjZXB0Og0KICAgIC
 AgICAgICAgcHJpbnQgIkNBUzIuIFJlc3QgQVBJIGF1dGhlbnRpY2F0ZSBpc1ZhbGlkQXV0aGVudGljY
 XRpb25NZXRob2QuIEV4Y2VwdGlvbjogIiwgc3lzLmV4Y19pbmZvKClbMV0NCiAgICAgICAgICAgIHJl
 dHVybiBGYWxzZQ0KDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIChodHRwX3Jlc3BvbnNlLmd
 ldFN0YXR1c0xpbmUoKS5nZXRTdGF0dXNDb2RlKCkgIT0gMjAwKToNCiAgICAgICAgICAgICAgICBwcm
 ludCAiQ0FTMi4gUmVzdCBBUEkgYXV0aGVudGljYXRlIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZ
 C4gR2V0IGludmFsaWQgcmVzcG9uc2UgZnJvbSBDQVMyIHNlcnZlcjogIiwgc3RyKGh0dHBfcmVzcG9u
 c2UuZ2V0U3RhdHVzTGluZSgpLmdldFN0YXR1c0NvZGUoKSkNCiAgICAgICAgICAgICAgICBodHRwU2V
 ydmljZS5jb25zdW1lKGh0dHBfcmVzcG9uc2UpDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQ
 ogICAgDQogICAgICAgICAgICB2YWxpZGF0aW9uX3Jlc3BvbnNlX2J5dGVzID0gaHR0cFNlcnZpY2UuZ
 2V0UmVzcG9uc2VDb250ZW50KGh0dHBfcmVzcG9uc2UpDQogICAgICAgICAgICB2YWxpZGF0aW9uX3Jl
 c3BvbnNlX3N0cmluZyA9IGh0dHBTZXJ2aWNlLmNvbnZlcnRFbnRpdHlUb1N0cmluZyh2YWxpZGF0aW9
 uX3Jlc3BvbnNlX2J5dGVzKQ0KICAgICAgICAgICAgaHR0cFNlcnZpY2UuY29uc3VtZShodHRwX3Jlc3
 BvbnNlKQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgICAgICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlL
 mNsb3NlQ29ubmVjdGlvbigpDQoNCiAgICAgICAgaWYgKHZhbGlkYXRpb25fcmVzcG9uc2Vfc3RyaW5n
 ID09IE5vbmUgb3IgdmFsaWRhdGlvbl9yZXNwb25zZV9zdHJpbmcuZmluZChjYXNfdmFsaWRhdGlvbl9
 wYXR0ZXJuKSA9PSAtMSk6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gUmVzdCBBUEkgYXV0aGVudG
 ljYXRlIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZC4gR2V0IGludmFsaWQgbG9naW4gcGFnZSBmc
 m9tIENBUzIgc2VydmVyOiINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHJldHVy
 biBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB
 1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgY2FzX2FsdF9hdXRoX2
 1vZGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc19hbHRfYXV0aF9tb2RlIikuZ2V0V
 mFsdWUyKCkNCiAgICAgICAgcmV0dXJuIGNhc19hbHRfYXV0aF9tb2RlDQoNCiAgICBkZWYgYXV0aGVu
 dGljYXRlKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3R
 lcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgIC
 BhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW50aWNhdGlvblNlcnZpY2UuaW5zdGFuY2UoKQ0KI
 CAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgaHR0cFNl
 cnZpY2UgPSBIdHRwU2VydmljZS5pbnN0YW5jZSgpOw0KDQogICAgICAgIGNhc19ob3N0ID0gY29uZml
 ndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjYXNfaG9zdCIpLmdldFZhbHVlMigpDQogICAgICAgIGNhc1
 9tYXBfdXNlciA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ
 2V0KCJjYXNfbWFwX3VzZXIiKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQogICAgICAgIGNhc19yZW5ld19v
 cHQgPSBTdHJpbmdIZWxwZXIudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2F
 zX3JlbmV3X29wdCIpLmdldFZhbHVlMigpLCBGYWxzZSkNCg0KICAgICAgICBjYXNfZXh0cmFfb3B0cy
 A9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJjY
 XNfZXh0cmFfb3B0cyIpKToNCiAgICAgICAgICAgIGNhc19leHRyYV9vcHRzID0gY29uZmlndXJhdGlv
 bkF0dHJpYnV0ZXMuZ2V0KCJjYXNfZXh0cmFfb3B0cyIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgaWY
 gKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdG
 VwIDEiDQogICAgICAgICAgICB0aWNrZXRfYXJyYXkgPSByZXF1ZXN0UGFyYW1ldGVycy5nZXQoInRpY
 2tldCIpDQogICAgICAgICAgICBpZiBBcnJheUhlbHBlci5pc0VtcHR5KHRpY2tldF9hcnJheSk6DQog
 ICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiB0aWNrZXQ
 gaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHRpY2
 tldCA9IHRpY2tldF9hcnJheVswXQ0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0Z
 SBmb3Igc3RlcCAxLiB0aWNrZXQ6ICIgKyB0aWNrZXQNCg0KICAgICAgICAgICAgaWYgKFN0cmluZ0hl
 bHBlci5pc0VtcHR5U3RyaW5nKHRpY2tldCkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiB
 BdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gdGlja2V0IGlzIGludmFsaWQiDQogICAgICAgICAgICAgIC
 AgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICMgVmFsaWRhdGUgdGlja2V0DQogICAgICAgICAgI
 CByZXF1ZXN0ID0gRmFjZXNDb250ZXh0LmdldEN1cnJlbnRJbnN0YW5jZSgpLmdldEV4dGVybmFsQ29u
 dGV4dCgpLmdldFJlcXVlc3QoKQ0KDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwID0gSGFzaE1hcCg
 pDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgic2VydmljZSIsIGh0dHBTZXJ2aWNlLmNvbn
 N0cnVjdFNlcnZlclVybChyZXF1ZXN0KSArICIvcG9zdGxvZ2luIikNCiAgICAgICAgICAgIGlmIChjY
 XNfcmVuZXdfb3B0KToNCiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgicmVuZXciLCAi
 dHJ1ZSIpDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgidGlja2V0IiwgdGlja2V0KQ0KICA
 gICAgICAgICAgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UucG
 FyYW1ldGVyc0FzU3RyaW5nKHBhcmFtZXRlcnNNYXApDQogICAgICAgICAgICBjYXNfc2VydmljZV9yZ
 XF1ZXN0X3VyaSA9IGNhc19ob3N0ICsgIi9zZXJ2aWNlVmFsaWRhdGU/IiArIGNhc19zZXJ2aWNlX3Jl
 cXVlc3RfdXJpDQogICAgICAgICAgICBpZiAoY2FzX2V4dHJhX29wdHMgIT0gTm9uZSk6DQogICAgICA
 gICAgICAgICAgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgPSBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaS
 ArICImIiArIGNhc19leHRyYV9vcHRzDQoNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50a
 WNhdGUgZm9yIHN0ZXAgMS4gY2FzX3NlcnZpY2VfcmVxdWVzdF91cmk6ICIgKyBjYXNfc2VydmljZV9y
 ZXF1ZXN0X3VyaQ0KDQogICAgICAgICAgICBodHRwX2NsaWVudCA9IGh0dHBTZXJ2aWNlLmdldEh0dHB
 zQ2xpZW50KCk7DQogICAgICAgICAgICBodHRwX3NlcnZpY2VfcmVzcG9uc2UgPSBodHRwU2VydmljZS
 5leGVjdXRlR2V0KGh0dHBfY2xpZW50LCBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSkNCiAgICAgICAgI
 CAgIA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fY29udGVudCA9
 IGh0dHBTZXJ2aWNlLmNvbnZlcnRFbnRpdHlUb1N0cmluZyhodHRwU2VydmljZS5nZXRSZXNwb25zZUN
 vbnRlbnQoaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlLmdldEh0dHBSZXNwb25zZSgpKSkNCiAgICAgICAgIC
 AgIGZpbmFsbHk6DQogICAgICAgICAgICAgICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlLmNsb3NlQ29ub
 mVjdGlvbigpDQoNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAg
 MS4gdmFsaWRhdGlvbl9jb250ZW50OiAiICsgdmFsaWRhdGlvbl9jb250ZW50DQogICAgICAgICAgICB
 pZiBTdHJpbmdIZWxwZXIuaXNFbXB0eSh2YWxpZGF0aW9uX2NvbnRlbnQpOg0KICAgICAgICAgICAgIC
 AgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVGlja2V0IHZhbGlkYXRpb24gc
 mVzcG9uc2UgaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAg
 ICAgICAgY2FzMl9hdXRoX2ZhaWx1cmUgPSBzZWxmLnBhcnNlX3RhZyh2YWxpZGF0aW9uX2NvbnRlbnQ
 sICJjYXM6YXV0aGVudGljYXRpb25GYWlsdXJlIikNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdX
 RoZW50aWNhdGUgZm9yIHN0ZXAgMS4gY2FzMl9hdXRoX2ZhaWx1cmU6ICIsIGNhczJfYXV0aF9mYWlsd
 XJlDQoNCiAgICAgICAgICAgIGNhczJfdXNlcl91aWQgPSBzZWxmLnBhcnNlX3RhZyh2YWxpZGF0aW9u
 X2NvbnRlbnQsICJjYXM6dXNlciIpDQogICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXR
 lIGZvciBzdGVwIDEuIGNhczJfdXNlcl91aWQ6ICIsIGNhczJfdXNlcl91aWQNCiAgICAgICAgICAgIA
 0KICAgICAgICAgICAgaWYgKChjYXMyX2F1dGhfZmFpbHVyZSAhPSBOb25lKSBvciAoY2FzMl91c2VyX
 3VpZCA9PSBOb25lKSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBm
 b3Igc3RlcCAxLiBUaWNrZXQgaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2U
 NCg0KICAgICAgICAgICAgaWYgKGNhc19tYXBfdXNlcik6DQogICAgICAgICAgICAgICAgcHJpbnQgIk
 NBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBve
 EV4dGVybmFsVWlkOiBjYXMyOiIgKyBjYXMyX3VzZXJfdWlkDQoNCiAgICAgICAgICAgICAgICAjIENo
 ZWNrIGlmIHRoZSBpcyB1c2VyIHdpdGggc3BlY2lmaWVkIGNhczJfdXNlcl91aWQNCiAgICAgICAgICA
 gICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveE
 V4dGVybmFsVWlkIiwgImNhczI6IiArIGNhczJfdXNlcl91aWQpDQoNCiAgICAgICAgICAgICAgICBpZ
 iAoZmluZF91c2VyX2J5X3VpZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkNB
 UzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZmluZCB1c2VyIg0KICAgICAgICA
 gICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY2
 91bnQgc3RlcHMgdG8gMiINCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImNhczJfY291b
 nRfbG9naW5fc3RlcHMiLCAyKQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2FzMl91
 c2VyX3VpZCIsIGNhczJfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQo
 NCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZX
 JJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxL
 iBmb3VuZF91c2VyX25hbWU6ICIgKyBmb3VuZF91c2VyX25hbWUNCg0KICAgICAgICAgICAgICAgIGNy
 ZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICA
 gICAgICAgY3JlZGVudGlhbHMuc2V0VXNlcm5hbWUoZm91bmRfdXNlcl9uYW1lKQ0KICAgICAgICAgIC
 AgICAgIGNyZWRlbnRpYWxzLnNldFVzZXIoZmluZF91c2VyX2J5X3VpZCkNCiAgICAgICAgICAgIA0KI
 CAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGlu
 ZyBjb3VudCBzdGVwcyB0byAxIg0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJjYXMyX2NvdW5
 0X2xvZ2luX3N0ZXBzIiwgMSkNCg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIC
 AgICBlbHNlOg0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0Z
 XAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgdWlkOiIgKyBjYXMyX3VzZXJfdWlkDQoNCiAg
 ICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZSBpcyB1c2VyIHdpdGggc3BlY2lmaWVkIGNhczJfdXN
 lcl91aWQNCiAgICAgICAgICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VX
 NlcihjYXMyX3VzZXJfdWlkKQ0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09I
 E5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBz
 dGVwIDEuIEZhaWxlZCB0byBmaW5kIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWx
 zZQ0KDQogICAgICAgICAgICAgICAgZm91bmRfdXNlcl9uYW1lID0gZmluZF91c2VyX2J5X3VpZC5nZX
 RVc2VySWQoKQ0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0Z
 XAgMS4gZm91bmRfdXNlcl9uYW1lOiAiICsgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgICAgICAg
 ICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICA
 gICAgICAgICAgIGNyZWRlbnRpYWxzLnNldFVzZXJuYW1lKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgIC
 AgICAgICAgICBjcmVkZW50aWFscy5zZXRVc2VyKGZpbmRfdXNlcl9ieV91aWQpDQoNCiAgICAgICAgI
 CAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQg
 c3RlcHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2FzMl9jb3VudF9sb2dpbl9
 zdGVwcyIsIDEpDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdG
 VwID09IDIpOg0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyI
 g0KDQogICAgICAgICAgICBzZXNzaW9uQXR0cmlidXRlcyA9IGNvbnRleHQuZ2V0KCJzZXNzaW9uQXR0
 cmlidXRlcyIpDQogICAgICAgICAgICBpZiAoc2Vzc2lvbkF0dHJpYnV0ZXMgPT0gTm9uZSkgb3Igbm9
 0IHNlc3Npb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJjYXMyX3VzZXJfdWlkIik6DQogICAgICAgIC
 AgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBjYXMyX3VzZXJfdWlkI
 GlzIGVtcHR5Ig0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBjYXMy
 X3VzZXJfdWlkID0gc2Vzc2lvbkF0dHJpYnV0ZXMuZ2V0KCJjYXMyX3VzZXJfdWlkIikNCiAgICAgICA
 gICAgIHBhc3NlZF9zdGVwMSA9IFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKGNhczJfdXNlcl
 91aWQpDQogICAgICAgICAgICBpZiAobm90IHBhc3NlZF9zdGVwMSk6DQogICAgICAgICAgICAgICAgc
 mV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2Uo
 KS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXR
 Vc2VybmFtZSgpDQogICAgICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3
 dvcmQoKQ0KDQogICAgICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0c
 mluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05v
 dEVtcHR5U3RyaW5nKHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB
 1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgIC
 AgICAgICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNC
 iAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aGljaCBoYXMgY2FzMl91c2VyX3Vp
 ZA0KICAgICAgICAgICAgIyBBdm9pZCBtYXBwaW5nIENBUzIgYWNjb3VudCB0byBtb3JlIHRoYW4gb25
 lIElEUCBhY2NvdW50DQogICAgICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2
 V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgImNhczI6IiArIGNhczJfdXNlcl91aWQpD
 QoNCiAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAg
 ICAgICMgQWRkIGNhczJfdXNlcl91aWQgdG8gdXNlciBvbmUgaWQgVUlEcw0KICAgICAgICAgICAgICA
 gIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5hZGRVc2VyQXR0cmlidXRlKHVzZXJfbmFtZS
 wgIm94RXh0ZXJuYWxVaWQiLCAiY2FzMjoiICsgY2FzMl91c2VyX3VpZCkNCiAgICAgICAgICAgICAgI
 CBpZiAoZmluZF91c2VyX2J5X3VpZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQg
 IkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gdXBkYXRlIGN1cnJlbnQgdXN
 lciINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICByZX
 R1cm4gVHJ1ZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hb
 WUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIkNB
 UzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBmb3VuZF91c2VyX25hbWU6ICIgKyBmb3VuZF91c2V
 yX25hbWUNCiAgICANCiAgICAgICAgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuZXF1YWxzKHVzZXJfbm
 FtZSwgZm91bmRfdXNlcl9uYW1lKToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgI
 CAgICAgDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAg
 IHJldHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb2
 50ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBd
 XRoZW50aWNhdGlvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBodHRwU2VydmljZSA9IEh0dHBT
 ZXJ2aWNlLmluc3RhbmNlKCk7DQoNCiAgICAgICAgY2FzX2hvc3QgPSBjb25maWd1cmF0aW9uQXR0cml
 idXRlcy5nZXQoImNhc19ob3N0IikuZ2V0VmFsdWUyKCkNCiAgICAgICAgY2FzX3JlbmV3X29wdCA9IF
 N0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjYXNfcmVuZ
 Xdfb3B0IikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAgIGNhc19leHRyYV9vcHRzID0gTm9u
 ZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImNhc19leHR
 yYV9vcHRzIikpOg0KICAgICAgICAgICAgY2FzX2V4dHJhX29wdHMgPSBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcy5nZXQoImNhc19leHRyYV9vcHRzIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBpZiAoc3Rlc
 CA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBQcmVwYXJlIGZvciBzdGVwIDEiDQoNCiAg
 ICAgICAgICAgIHJlcXVlc3QgPSBGYWNlc0NvbnRleHQuZ2V0Q3VycmVudEluc3RhbmNlKCkuZ2V0RXh
 0ZXJuYWxDb250ZXh0KCkuZ2V0UmVxdWVzdCgpDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwID0gSG
 FzaE1hcCgpDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgic2VydmljZSIsIGh0dHBTZXJ2a
 WNlLmNvbnN0cnVjdFNlcnZlclVybChyZXF1ZXN0KSArICIvcG9zdGxvZ2luIikNCiAgICAgICAgICAg
 IGlmIChjYXNfcmVuZXdfb3B0KToNCiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgicmV
 uZXciLCAidHJ1ZSIpDQogICAgICAgICAgICBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSA9IGF1dGhlbn
 RpY2F0aW9uU2VydmljZS5wYXJhbWV0ZXJzQXNTdHJpbmcocGFyYW1ldGVyc01hcCkNCiAgICAgICAgI
 CAgIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpID0gY2FzX2hvc3QgKyAiL2xvZ2luPyIgKyBjYXNfc2Vy
 dmljZV9yZXF1ZXN0X3VyaQ0KICAgICAgICAgICAgaWYgY2FzX2V4dHJhX29wdHMgIT0gTm9uZToNCiA
 gICAgICAgICAgICAgICBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSA9IGNhc19zZXJ2aWNlX3JlcXVlc3
 RfdXJpICsgIiYiICsgY2FzX2V4dHJhX29wdHMNCg0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIFByZ
 XBhcmUgZm9yIHN0ZXAgMS4gY2FzX3NlcnZpY2VfcmVxdWVzdF91cmk6ICIgKyBjYXNfc2VydmljZV9y
 ZXF1ZXN0X3VyaQ0KDQogICAgICAgICAgICBjb250ZXh0LnNldCgiY2FzX3NlcnZpY2VfcmVxdWVzdF9
 1cmkiLCBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSkNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCi
 AgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBQcmVwYXJlI
 GZvciBzdGVwIDIiDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAg
 ICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwKHN
 lbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMi
 k6DQogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgiY2FzMl91c2VyX3VpZCIpDQogICAgI
 CAgIA0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25T
 dGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIGNvbnRleHQgPSBDb25
 0ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBpZiAoY29udGV4dC5pc1NldCgiY2FzMl9jb3
 VudF9sb2dpbl9zdGVwcyIpKToNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldCgiY2FzMl9jb
 3VudF9sb2dpbl9zdGVwcyIpDQogICAgICAgIA0KICAgICAgICByZXR1cm4gMg0KDQogICAgZGVmIGdl
 dFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICA
 gaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICByZXR1cm4gIi9hdXRoL2NhczIvY2FzMmxvZ2luLn
 hodG1sIg0KICAgICAgICByZXR1cm4gIi9hdXRoL2NhczIvY2FzMnBvc3Rsb2dpbi54aHRtbCINCg0KI
 CAgIGRlZiBwYXJzZV90YWcoc2VsZiwgc3RyLCB0YWcpOg0KICAgICAgICB0YWcxX3BvczEgPSBzdHIu
 ZmluZCgiPCIgKyB0YWcpDQogICAgICAgICMgIE5vIHRhZyBmb3VuZCwgcmV0dXJuIGVtcHR5IHN0cml
 uZy4NCiAgICAgICAgaWYgdGFnMV9wb3MxID09IC0xOiByZXR1cm4gTm9uZQ0KICAgICAgICB0YWcxX3
 BvczIgPSBzdHIuZmluZCgiPiIsIHRhZzFfcG9zMSkNCiAgICAgICAgaWYgdGFnMV9wb3MyID09IC0xO
 iByZXR1cm4gTm9uZQ0KICAgICAgICB0YWcyX3BvczEgPSBzdHIuZmluZCgiPC8iICsgdGFnLCB0YWcx
 X3BvczIpDQogICAgICAgIGlmIHRhZzJfcG9zMSA9PSAtMTogcmV0dXJuIE5vbmUNCg0KICAgICAgICB
 yZXR1cm4gc3RyW3RhZzFfcG9zMisxOnRhZzJfcG9zMV0uc3RyaXAoKQ0KDQogICAgZGVmIGxvZ291dC
 hzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpOg0KICAgICAgI
 CByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!7523.8F2D,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Google+ authentication module
displayName: gplus
gluuStatus: false
inum: %(inumOrg)s!0011!7523.8F2D
oxConfigurationProperty: {"value1":"gplus_client_secrets_file","value2":"/et
 c/certs/gplus_client_secrets.json","description":""}
oxConfigurationProperty: {"value1":"gplus_deployment_type","value2":"enroll"
 ,"description":""}
oxConfigurationProperty: {"value1":"gplus_remote_attributes_list","value2":"
 email, email, name, family_name, given_name, locale","description":""}
oxConfigurationProperty: {"value1":"gplus_local_attributes_list","value2":"u
 id, mail, givenName, sn, cn, preferredLanguage","description":""}
oxLevel: 40
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4d
 HMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIGphdmF4
 LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3R
 vbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3
 JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIENsaWVudFNlcnZpY2UsIEF1d
 GhlbnRpY2F0aW9uU2VydmljZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlciwg
 QXJyYXlIZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdCwgSGFzaE1
 hcCwgSWRlbnRpdHlIYXNoTWFwDQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLmNvbW1vbiBpbXBvcn
 QgVXNlcg0KZnJvbSBvcmcueGRpLm94YXV0aC5jbGllbnQgaW1wb3J0IFRva2VuQ2xpZW50LCBUb2tlb
 lJlcXVlc3QsIFVzZXJJbmZvQ2xpZW50DQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLmNvbW1vbiBp
 bXBvcnQgR3JhbnRUeXBlLCBBdXRoZW50aWNhdGlvbk1ldGhvZA0KZnJvbSBvcmcueGRpLm94YXV0aC5
 tb2RlbC5qd3QgaW1wb3J0IEp3dCwgSnd0Q2xhaW1OYW1lDQoNCmltcG9ydCBqYXZhDQoNCnRyeToNCi
 AgICBpbXBvcnQganNvbg0KZXhjZXB0IEltcG9ydEVycm9yOg0KICAgIGltcG9ydCBzaW1wbGVqc29uI
 GFzIGpzb24NCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25U
 eXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICB
 zZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbml0KH
 NlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pd
 GlhbGl6YXRpb24iDQoNCiAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250
 YWluc0tleSgiZ3BsdXNfY2xpZW50X3NlY3JldHNfZmlsZSIpKToNCiAgICAgICAgICAgIHByaW50ICJ
 Hb29nbGUrIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgZ3BsdXNfY2xpZW50X3NlY3JldHNfZm
 lsZSBpcyBlbXB0eSINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgI
 CAgIGNsaWVudFNlY3JldHNGaWxlID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c19j
 bGllbnRfc2VjcmV0c19maWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgc2VsZi5jbGllbnRTZWNyZXR
 zID0gc2VsZi5sb2FkQ2xpZW50U2VjcmV0cyhjbGllbnRTZWNyZXRzRmlsZSkNCiAgICAgICAgaWYgKH
 NlbGYuY2xpZW50U2VjcmV0cyA9PSBOb25lKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIElua
 XRpYWxpemF0aW9uLiBGaWxlIHdpdGggR29vZ2xlKyBjbGllbnQgc2VjcmV0cyBzaG91bGQgYmUgbm90
 IGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2VsZi5hdHRyaWJ1dGV
 zTWFwcGluZyA9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW
 5zS2V5KCJncGx1c19yZW1vdGVfYXR0cmlidXRlc19saXN0IikgYW5kDQogICAgICAgICAgICBjb25ma
 Wd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZ3BsdXNfbG9jYWxfYXR0cmlidXRlc19saXN0
 IikpOg0KDQogICAgICAgICAgICByZW1vdGVBdHRyaWJ1dGVzTGlzdCA9IGNvbmZpZ3VyYXRpb25BdHR
 yaWJ1dGVzLmdldCgiZ3BsdXNfcmVtb3RlX2F0dHJpYnV0ZXNfbGlzdCIpLmdldFZhbHVlMigpDQogIC
 AgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkocmVtb3RlQXR0cmlidXRlc0xpc3QpKToNC
 iAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gVGhlIHByb3BlcnR5
 IGdwbHVzX3JlbW90ZV9hdHRyaWJ1dGVzX2xpc3QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV
 0dXJuIEZhbHNlICAgIA0KDQogICAgICAgICAgICBsb2NhbEF0dHJpYnV0ZXNMaXN0ID0gY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c19sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiKS5nZXRWYWx1Z
 TIoKQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc0VtcHR5KGxvY2FsQXR0cmlidXRlc0xp
 c3QpKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gVGhlIHB
 yb3BlcnR5IGdwbHVzX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCBpcyBlbXB0eSINCiAgICAgICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2VsZi5hdHRyaWJ1dGVzTWFwcGluZyA9IHNlb
 GYucHJlcGFyZUF0dHJpYnV0ZXNNYXBwaW5nKHJlbW90ZUF0dHJpYnV0ZXNMaXN0LCBsb2NhbEF0dHJp
 YnV0ZXNMaXN0KQ0KICAgICAgICAgICAgaWYgKHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPT0gTm9uZSk
 6DQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pdGlhbGl6YXRpb24uIFRoZSBhdHRyaW
 J1dGVzIG1hcHBpbmcgaXNuJ3QgdmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNC
 iAgICAgICAgc2VsZi5leHRlbnNpb25Nb2R1bGUgPSBOb25lDQogICAgICAgIGlmIChjb25maWd1cmF0
 aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZXh0ZW5zaW9uX21vZHVsZSIpKToNCiAgICAgICAgICA
 gIGV4dGVuc2lvbk1vZHVsZU5hbWUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImV4dGVuc2
 lvbl9tb2R1bGUiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgI
 HNlbGYuZXh0ZW5zaW9uTW9kdWxlID0gX19pbXBvcnRfXyhleHRlbnNpb25Nb2R1bGVOYW1lKQ0KICAg
 ICAgICAgICAgICAgIGV4dGVuc2lvbk1vZHVsZUluaXRSZXN1bHQgPSBzZWxmLmV4dGVuc2lvbk1vZHV
 sZS5pbml0KGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKQ0KICAgICAgICAgICAgICAgIGlmIChub3QgZX
 h0ZW5zaW9uTW9kdWxlSW5pdFJlc3VsdCk6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZ
 Q0KICAgICAgICAgICAgZXhjZXB0IEltcG9ydEVycm9yLCBleDoNCiAgICAgICAgICAgICAgICBwcmlu
 dCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gRmFpbGVkIHRvIGxvYWQgZ3BsdXNfZXh0ZW5zaW9uX21
 vZHVsZToiLCBleHRlbnNpb25Nb2R1bGVOYW1lDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZS
 sgSW5pdGlhbGl6YXRpb24uIFVuZXhwZWN0ZWQgZXJyb3I6IiwgZXgNCiAgICAgICAgICAgICAgICByZ
 XR1cm4gRmFsc2UNCg0KICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXplZCBzdWNjZXNzZnVs
 bHkiDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBhdXRoQ29
 uZmlndXJhdGlvbik6DQogICAgICAgIHByaW50ICJHb29nbGUrIERlc3Ryb3kiDQogICAgICAgIHByaW
 50ICJHb29nbGUrIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvb
 ihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25N
 ZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJ
 ldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZW
 xmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vb
 mUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJl
 cXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW5
 0Q29udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2
 VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY
 2UoKQ0KDQogICAgICAgIG1hcFVzZXJEZXBsb3ltZW50ID0gRmFsc2UNCiAgICAgICAgZW5yb2xsVXNl
 ckRlcGxveW1lbnQgPSBGYWxzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29
 udGFpbnNLZXkoImdwbHVzX2RlcGxveW1lbnRfdHlwZSIpKToNCiAgICAgICAgICAgIGRlcGxveW1lbn
 RUeXBlID0gU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdld
 CgiZ3BsdXNfZGVwbG95bWVudF90eXBlIikuZ2V0VmFsdWUyKCkpDQogICAgICAgICAgICANCiAgICAg
 ICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkZXBsb3ltZW50VHlwZSwgIm1
 hcCIpKToNCiAgICAgICAgICAgICAgICBtYXBVc2VyRGVwbG95bWVudCA9IFRydWUNCiAgICAgICAgIC
 AgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkZXBsb3ltZW50VHlwZSwgImVucm9sb
 CIpKToNCiAgICAgICAgICAgICAgICBlbnJvbGxVc2VyRGVwbG95bWVudCA9IFRydWUNCg0KICAgICAg
 ICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxIg0KIA0KICAgICAgICAgICAgZ3BsdXNBdXRoQ29kZUFycmF5ID0gcmVxdWVzdFBhcm
 FtZXRlcnMuZ2V0KCJncGx1c19hdXRoX2NvZGUiKQ0KICAgICAgICAgICAgZ3BsdXNBdXRoQ29kZSA9I
 GdwbHVzQXV0aENvZGVBcnJheVswXQ0KDQogICAgICAgICAgICAjIENoZWNrIGlmIHVzZXIgdXNlcyBi
 YXNpYyBtZXRob2QgdG8gbG9nIGluDQogICAgICAgICAgICB1c2VCYXNpY0F1dGggPSBGYWxzZQ0KICA
 gICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc0VtcHR5U3RyaW5nKGdwbHVzQXV0aENvZGUpKToNCi
 AgICAgICAgICAgICAgICB1c2VCYXNpY0F1dGggPSBUcnVlDQoNCiAgICAgICAgICAgICMgVXNlIGJhc
 2ljIG1ldGhvZCB0byBsb2cgaW4NCiAgICAgICAgICAgIGlmICh1c2VCYXNpY0F1dGgpOg0KICAgICAg
 ICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBCYXNpYyBhdXR
 oZW50aWNhdGlvbiINCiAgICAgICAgDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2
 NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCiAgICAgICAgDQogICAgICAgICAgICAgICAgY3JlZGVudGlhb
 HMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgICAgICB1
 c2VyTmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgICAgICB1c2VyUGF
 zc3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQogICAgICAgIA0KICAgICAgICAgICAgIC
 AgIGxvZ2dlZEluID0gRmFsc2UNCiAgICAgICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90R
 W1wdHlTdHJpbmcodXNlck5hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2Vy
 UGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5
 pbnN0YW5jZSgpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlZEluID0gdXNlclNlcnZpY2UuYXV0aG
 VudGljYXRlKHVzZXJOYW1lLCB1c2VyUGFzc3dvcmQpDQogICAgICAgIA0KICAgICAgICAgICAgICAgI
 GlmIChub3QgbG9nZ2VkSW4pOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAg
 ICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgIyBVc2UgR29vZ2x
 lKyBtZXRob2QgdG8gbG9nIGluDQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdG
 UgZm9yIHN0ZXAgMS4gZ3BsdXNBdXRoQ29kZToiLCBncGx1c0F1dGhDb2RlDQoNCiAgICAgICAgICAgI
 GN1cnJlbnRDbGllbnRTZWNyZXRzID0gc2VsZi5nZXRDdXJyZW50Q2xpZW50U2VjcmV0cyhzZWxmLmNs
 aWVudFNlY3JldHMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycykNCiA
 gICAgICAgICAgIGlmIChjdXJyZW50Q2xpZW50U2VjcmV0cyA9PSBOb25lKToNCiAgICAgICAgICAgIC
 AgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQ2xpZW50IHNlY3JldHMgY
 29uZmlndXJhdGlvbiBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAg
 ICAgICAgICAgDQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXA
 gMS4gQXR0ZW1wdGluZyB0byBnZXRzIHRva2VucyINCiAgICAgICAgICAgIHRva2VuUmVzcG9uc2UgPS
 BzZWxmLmdldFRva2Vuc0J5Q29kZShzZWxmLmNsaWVudFNlY3JldHMsIGNvbmZpZ3VyYXRpb25BdHRya
 WJ1dGVzLCBncGx1c0F1dGhDb2RlKTsNCiAgICAgICAgICAgIGlmICgodG9rZW5SZXNwb25zZSA9PSBO
 b25lKSBvciAodG9rZW5SZXNwb25zZS5nZXRJZFRva2VuKCkgPT0gTm9uZSkgb3IgKHRva2VuUmVzcG9
 uc2UuZ2V0QWNjZXNzVG9rZW4oKSA9PSBOb25lKSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2
 dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBnZXQgdG9rZW5zIg0KICAgICAgI
 CAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBw
 cmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU3VjY2Vzc2Z1bGx5IGdldHMgdG9
 rZW5zIg0KDQogICAgICAgICAgICBqd3QgPSBKd3QucGFyc2UodG9rZW5SZXNwb25zZS5nZXRJZFRva2
 VuKCkpDQogICAgICAgICAgICAjIFRPRE86IFZhbGlkYXRlIElEIFRva2VuIFNpZ25hdHVyZSAgDQoNC
 iAgICAgICAgICAgIGdwbHVzVXNlclVpZCA9IGp3dC5nZXRDbGFpbXMoKS5nZXRDbGFpbUFzU3RyaW5n
 KEp3dENsYWltTmFtZS5TVUJKRUNUX0lERU5USUZJRVIpOw0KICAgICAgICAgICAgcHJpbnQgIkdvb2d
 sZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZvdW5kIEdvb2dsZSB1c2VyIElEIGluIHRoZSBJRC
 B0b2tlbjogIiwgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChtYXBVc
 2VyRGVwbG95bWVudCk6DQogICAgICAgICAgICAgICAgIyBVc2UgbWFwcGluZyB0byBsb2NhbCBJRFAg
 dXNlcg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCA
 xLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBncGx1czoiLCBncGx1c1
 VzZXJVaWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aXRoIHNwZ
 WNpZmllZCBncGx1c1VzZXJVaWQNCiAgICAgICAgICAgICAgICBmb3VuZFVzZXIgPSB1c2VyU2Vydmlj
 ZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiZ3BsdXM6IiArIGdwbHVzVXNlclV
 pZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgIC
 AgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZ
 mluZCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUg
 Zm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAyIg0KICAgICAgICAgICAgICAgICAgICB
 jb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAyKQ0KICAgICAgICAgICAgICAgIC
 AgICBjb250ZXh0LnNldCgiZ3BsdXNfdXNlcl91aWQiLCBncGx1c1VzZXJVaWQpDQogICAgICAgICAgI
 CAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgICAgICAgICBmb3VuZFVzZXJOYW1lID0gZm91
 bmRVc2VyLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGl
 jYXRlIGZvciBzdGVwIDEuIGZvdW5kVXNlck5hbWU6IiwgZm91bmRVc2VyTmFtZQ0KICAgICAgICAgIC
 AgICAgIA0KICAgICAgICAgICAgICAgIHVzZXJBdXRoZW50aWNhdGVkID0gYXV0aGVudGljYXRpb25TZ
 XJ2aWNlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lKQ0KICAgICAgICAgICAgICAgIGlmICh1c2Vy
 QXV0aGVudGljYXRlZCA9PSBGYWxzZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGU
 rIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogIC
 AgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgI
 CAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3Rl
 cHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3R
 lcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlbnNpb2
 5Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZvdW5kVXNlcikNCiAgICAgICAgICAgI
 CAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcG9zdExvZ2luUmVzdWx0
 OiIsIHBvc3RMb2dpblJlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2dpblJlc3V
 sdA0KICAgICAgICAgICAgZWxpZiAoZW5yb2xsVXNlckRlcGxveW1lbnQpOg0KICAgICAgICAgICAgIC
 AgICMgVXNlIGF1dG8gZW5yb2xsbWVudCB0byBsb2NhbCBJRFANCiAgICAgICAgICAgICAgICBwcmlud
 CAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIg
 Ynkgb3hFeHRlcm5hbFVpZDogZ3BsdXM6IiwgZ3BsdXNVc2VyVWlkDQogDQogICAgICAgICAgICAgICA
 gIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdpdGggc3BlY2lmaWVkIGdwbHVzVXNlclVpZA0KICAgIC
 AgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFe
 HRlcm5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNVc2VyVWlkKQ0KIA0KICAgICAgICAgICAgICAgIGlm
 IChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICMgQXV0byB1c2VyIGVucm9
 sbGVtbnQNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvci
 BzdGVwIDEuIFRoZXJlIGlzIG5vIHVzZXIgaW4gTERBUC4gQWRkaW5nIHVzZXIgdG8gbG9jYWwgTERBU
 CINCg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0
 ZXAgMS4gQXR0ZW1wdGluZyB0byBnZXRzIHVzZXIgaW5mbyINCiAgICAgICAgICAgICAgICAgICAgdXN
 lckluZm9SZXNwb25zZSA9IHNlbGYuZ2V0VXNlckluZm8oY3VycmVudENsaWVudFNlY3JldHMsIGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzLCB0b2tlblJlc3BvbnNlLmdldEFjY2Vzc1Rva2VuKCkpDQogICAgI
 CAgICAgICAgICAgICAgIGlmICgodXNlckluZm9SZXNwb25zZSA9PSBOb25lKSBvciAodXNlckluZm9S
 ZXNwb25zZS5nZXRDbGFpbXMoKS5zaXplKCkgPT0gMCkpOg0KICAgICAgICAgICAgICAgICAgICAgICA
 gcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBnZXQgdXNlci
 BpbmZvIg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgI
 CAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50
 aWNhdGUgZm9yIHN0ZXAgMS4gU3VjY2Vzc2Z1bGx5IGdldHMgdXNlciBpbmZvIg0KICAgICAgICAgICA
 gICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZ3BsdXNSZXNwb25zZUF0dHJpYnV0ZXMgPSB1c2
 VySW5mb1Jlc3BvbnNlLmdldENsYWltcygpDQogDQogICAgICAgICAgICAgICAgICAgICMgQ29udmVyd
 CBHb29nbGUrIHVzZXIgY2xhaW1zIHRvIGxvdmVyIGNhc2UNCiAgICAgICAgICAgICAgICAgICAgZ3Bs
 dXNSZXNwb25zZU5vcm1hbGl6ZWRBdHRyaWJ1dGVzID0gSGFzaE1hcCgpDQogICAgICAgICAgICAgICA
 gICAgIGZvciBncGx1c1Jlc3BvbnNlQXR0cmlidXRlRW50cnkgaW4gZ3BsdXNSZXNwb25zZUF0dHJpYn
 V0ZXMuZW50cnlTZXQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGdwbHVzUmVzcG9uc2VOb3JtY
 WxpemVkQXR0cmlidXRlcy5wdXQoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nSGVs
 cGVyLnRvTG93ZXJDYXNlKGdwbHVzUmVzcG9uc2VBdHRyaWJ1dGVFbnRyeS5nZXRLZXkoKSksIGdwbHV
 zUmVzcG9uc2VBdHRyaWJ1dGVFbnRyeS5nZXRWYWx1ZSgpKQ0KIA0KICAgICAgICAgICAgICAgICAgIC
 BjdXJyZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLmdldEN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZ
 yhzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBh
 cmFtZXRlcnMpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxLiBVc2luZyBuZXh0IGF0dHJpYnV0ZXMgbWFwcGluZyIsIGN1cnJlbnRBdHRyaWJ1dG
 VzTWFwcGluZw0KIA0KICAgICAgICAgICAgICAgICAgICBuZXdVc2VyID0gVXNlcigpDQogICAgICAgI
 CAgICAgICAgICAgIGZvciBhdHRyaWJ1dGVzTWFwcGluZ0VudHJ5IGluIGN1cnJlbnRBdHRyaWJ1dGVz
 TWFwcGluZy5lbnRyeVNldCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3RlQXR0cmlidXR
 lID0gYXR0cmlidXRlc01hcHBpbmdFbnRyeS5nZXRLZXkoKQ0KICAgICAgICAgICAgICAgICAgICAgIC
 AgbG9jYWxBdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzTWFwcGluZ0VudHJ5LmdldFZhbHVlKCkNCiANCiAgI
 CAgICAgICAgICAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlVmFsdWUgPSBncGx1c1Jlc3BvbnNlTm9y
 bWFsaXplZEF0dHJpYnV0ZXMuZ2V0KHJlbW90ZUF0dHJpYnV0ZSkNCiAgICAgICAgICAgICAgICAgICA
 gICAgIGlmIChsb2NhbEF0dHJpYnV0ZSAhPSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIC
 AgICBuZXdVc2VyLnNldEF0dHJpYnV0ZShsb2NhbEF0dHJpYnV0ZSwgbG9jYWxBdHRyaWJ1dGVWYWx1Z
 SkNCiANCiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1VzZXIuZ2V0QXR0cmlidXRlKCJzbiIpID09
 IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3VXNlci5zZXRBdHRyaWJ1dGUoInNuIiw
 gZ3BsdXNVc2VyVWlkKQ0KIA0KICAgICAgICAgICAgICAgICAgICBpZiAobmV3VXNlci5nZXRBdHRyaW
 J1dGUoImNuIikgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdVc2VyLnNldEF0d
 HJpYnV0ZSgiY24iLCBncGx1c1VzZXJVaWQpDQoNCiAgICAgICAgICAgICAgICAgICAgbmV3VXNlci5z
 ZXRBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiZ3BsdXM6IiArIGdwbHVzVXNlclVpZCkNCiAgICA
 gICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dG
 VtcHRpbmcgdG8gYWRkIHVzZXIiLCBncGx1c1VzZXJVaWQsICIgd2l0aCBuZXh0IGF0dHJpYnV0ZXMiL
 CBuZXdVc2VyLmdldEN1c3RvbUF0dHJpYnV0ZXMoKQ0KIA0KICAgICAgICAgICAgICAgICAgICBmb3Vu
 ZFVzZXIgPSB1c2VyU2VydmljZS5hZGRVc2VyKG5ld1VzZXIsIFRydWUpDQogICAgICAgICAgICAgICA
 gICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBZGRlZCBuZXcgdXNlci
 B3aXRoIFVJRCIsIGZvdW5kVXNlci5nZXRVc2VySWQoKQ0KDQogICAgICAgICAgICAgICAgZm91bmRVc
 2VyTmFtZSA9IGZvdW5kVXNlci5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgICAgIHByaW50ICJHb29n
 bGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZFVzZXJOYW1lOiIsIGZvdW5kVXNlck5hbWU
 NCg0KICAgICAgICAgICAgICAgIHVzZXJBdXRoZW50aWNhdGVkID0gYXV0aGVudGljYXRpb25TZXJ2aW
 NlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lKQ0KICAgICAgICAgICAgICAgIGlmICh1c2VyQXV0a
 GVudGljYXRlZCA9PSBGYWxzZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICA
 gICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZS
 sgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8gMSINCiAgICAgI
 CAgICAgICAgICBjb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAg
 ICAgICAgICAgICAgcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlbnNpb25Qb3N0TG9naW4oY29uZml
 ndXJhdGlvbkF0dHJpYnV0ZXMsIGZvdW5kVXNlcikNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2
 xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcG9zdExvZ2luUmVzdWx0OiIsIHBvc3RMb2dpblJlc
 3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2dpblJlc3VsdA0KICAgICAgICAgICAg
 ZWxzZToNCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZXJlIGlzIHVzZXIgd2l0aCBzcGVjaWZ
 pZWQgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYX
 RlIGZvciBzdGVwIDEuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IHVpZDoiLCBncGx1c1VzZXJVa
 WQNCg0KICAgICAgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXIoZ3BsdXNV
 c2VyVWlkKQ0KICAgICAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICA
 gICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG
 8gZmluZCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgI
 CAgICAgIGZvdW5kVXNlck5hbWUgPSBmb3VuZFVzZXIuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAg
 ICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gZm91bmRVc2VyTmFtZToiLCB
 mb3VuZFVzZXJOYW1lDQoNCiAgICAgICAgICAgICAgICB1c2VyQXV0aGVudGljYXRlZCA9IGF1dGhlbn
 RpY2F0aW9uU2VydmljZS5hdXRoZW50aWNhdGUoZm91bmRVc2VyTmFtZSkNCiAgICAgICAgICAgICAgI
 CBpZiAodXNlckF1dGhlbnRpY2F0ZWQgPT0gRmFsc2UpOg0KICAgICAgICAgICAgICAgICAgICBwcmlu
 dCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB
 1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIH
 ByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzI
 HRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBz
 IiwgMSkNCg0KICAgICAgICAgICAgICAgIHBvc3RMb2dpblJlc3VsdCA9IHNlbGYuZXh0ZW5zaW9uUG9
 zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmb3VuZFVzZXIpDQogICAgICAgICAgICAgIC
 AgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHBvc3RMb2dpblJlc3VsdDoiL
 CBwb3N0TG9naW5SZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQN
 CiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAyIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZXNzaW9uQXR0cm
 lidXRlcyA9IGNvbnRleHQuZ2V0KCJzZXNzaW9uQXR0cmlidXRlcyIpDQogICAgICAgICAgICBpZiAoc
 2Vzc2lvbkF0dHJpYnV0ZXMgPT0gTm9uZSkgb3Igbm90IHNlc3Npb25BdHRyaWJ1dGVzLmNvbnRhaW5z
 S2V5KCJncGx1c191c2VyX3VpZCIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAyLiBncGx1c191c2VyX3VpZCBpcyBlbXB0eSINCiAgICAgICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgZ3BsdXNVc2VyVWlkID0gc2Vzc2lvbkF0dHJpY
 nV0ZXMuZ2V0KCJncGx1c191c2VyX3VpZCIpDQogICAgICAgICAgICBwYXNzZWRfc3RlcDEgPSBTdHJp
 bmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyhncGx1c1VzZXJVaWQpDQogICAgICAgICAgICBpZiAobm9
 0IHBhc3NlZF9zdGVwMSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgIC
 AgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgI
 CAgICAgICB1c2VyTmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVz
 ZXJQYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2V
 kSW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKH
 VzZXJOYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlclBhc3N3b3JkKSk6D
 QogICAgICAgICAgICAgICAgbG9nZ2VkSW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlck5h
 bWUsIHVzZXJQYXNzd29yZCkNCg0KICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRJbik6DQogICAgICA
 gICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdX
 NlciB3aGljaCBoYXMgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICAjIEF2b2lkIG1hcHBpbmcgR29vZ
 2xlIGFjY291bnQgdG8gbW9yZSB0aGFuIG9uZSBJRFAgYWNjb3VudA0KICAgICAgICAgICAgZm91bmRV
 c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgImdwbHV
 zOiIgKyBncGx1c1VzZXJVaWQpDQoNCiAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQ
 ogICAgICAgICAgICAgICAgIyBBZGQgZ3BsdXNVc2VyVWlkIHRvIHVzZXIgb25lIGlkIFVJRHMNCiAgI
 CAgICAgICAgICAgICBmb3VuZFVzZXIgPSB1c2VyU2VydmljZS5hZGRVc2VyQXR0cmlidXRlKHVzZXJO
 YW1lLCAib3hFeHRlcm5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNVc2VyVWlkKQ0KICAgICAgICAgICA
 gICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb2
 9nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gdXBkYXRlIGN1cnJlbnQgdXNlc
 iINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBwb3N0
 TG9naW5SZXN1bHQgPSBzZWxmLmV4dGVuc2lvblBvc3RMb2dpbihjb25maWd1cmF0aW9uQXR0cmlidXR
 lcywgZm91bmRVc2VyKQ0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZS
 Bmb3Igc3RlcCAyLiBwb3N0TG9naW5SZXN1bHQ6IiwgcG9zdExvZ2luUmVzdWx0DQoNCiAgICAgICAgI
 CAgICAgICByZXR1cm4gcG9zdExvZ2luUmVzdWx0DQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAg
 ICAgICAgIGZvdW5kVXNlck5hbWUgPSBmb3VuZFVzZXIuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICA
 gICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gZm91bmRVc2VyTmFtZToiLC
 Bmb3VuZFVzZXJOYW1lDQogICAgDQogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFsc
 yh1c2VyTmFtZSwgZm91bmRVc2VyTmFtZSk6DQogICAgICAgICAgICAgICAgICAgIHBvc3RMb2dpblJl
 c3VsdCA9IHNlbGYuZXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmb3V
 uZFVzZXIpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3
 Igc3RlcCAyLiBwb3N0TG9naW5SZXN1bHQ6IiwgcG9zdExvZ2luUmVzdWx0DQogICAgDQogICAgICAgI
 CAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCiAgICAgICAgDQogICAgICAgICAgICBy
 ZXR1cm4gRmFsc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICA
 gZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UG
 FyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRle
 HQoKQ0KICAgICAgICBhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW50aWNhdGlvblNlcnZpY2Uu
 aW5zdGFuY2UoKQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkd
 vb2dsZSsgUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBjdXJyZW
 50Q2xpZW50U2VjcmV0cyA9IHNlbGYuZ2V0Q3VycmVudENsaWVudFNlY3JldHMoc2VsZi5jbGllbnRTZ
 WNyZXRzLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAg
 ICAgICBpZiAoY3VycmVudENsaWVudFNlY3JldHMgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcHJ
 pbnQgIkdvb2dsZSsgUHJlcGFyZSBmb3Igc3RlcCAxLiBHb29nbGUrIGNsaWVudCBjb25maWd1cmF0aW
 9uIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICANC
 iAgICAgICAgICAgIGNvbnRleHQuc2V0KCJncGx1c19jbGllbnRfaWQiLCBjdXJyZW50Q2xpZW50U2Vj
 cmV0c1sid2ViIl1bImNsaWVudF9pZCJdKQ0KICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2N
 saWVudF9zZWNyZXQiLCBjdXJyZW50Q2xpZW50U2VjcmV0c1sid2ViIl1bImNsaWVudF9zZWNyZXQiXS
 kNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgI
 CAgICAgICAgIHByaW50ICJHb29nbGUrIFByZXBhcmUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAg
 cmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICA
 gZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZX
 MsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHJldHVybiBBcnJhe
 XMuYXNMaXN0KCJncGx1c191c2VyX3VpZCIpDQoNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRl
 ZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 pOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaW
 YgKGNvbnRleHQuaXNTZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBzIikpOg0KICAgICAgICAgICAgc
 mV0dXJuIGNvbnRleHQuZ2V0KCJncGx1c19jb3VudF9sb2dpbl9zdGVwcyIpDQogICAgICAgIA0KICAg
 ICAgICByZXR1cm4gMg0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICByZX
 R1cm4gIi9hdXRoL2dwbHVzL2dwbHVzbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIvYXV0a
 C9ncGx1cy9ncGx1c3Bvc3Rsb2dpbi54aHRtbCINCg0KICAgIGRlZiBsb2dvdXQoc2VsZiwgY29uZmln
 dXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgIyBUT0RPIFJldm9
 rZSB0b2tlbg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGxvYWRDbGllbnRTZWNyZXRzKH
 NlbGYsIGNsaWVudFNlY3JldHNGaWxlKToNCiAgICAgICAgY2xpZW50U2VjcmV0cyA9IE5vbmUNCg0KI
 CAgICAgICAjIExvYWQgY2VydGlmaWNhdGUgZnJvbSBmaWxlDQogICAgICAgIGYgPSBvcGVuKGNsaWVu
 dFNlY3JldHNGaWxlLCAncicpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGNsaWVudFNlY3JldHM
 gPSBqc29uLmxvYWRzKGYucmVhZCgpKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludC
 AiRmFpbGVkIHRvIGxvYWQgR29vZ2xlKyBjbGllbnQgc2VjcmV0cyBmcm9tIGZpbGU6IiwgY2xpZW50U
 2VjcmV0cw0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgZmluYWxseToNCiAgICAgICAg
 ICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGNsaWVudFNlY3JldHMNCg0KICA
 gIGRlZiBnZXRDbGllbnRDb25maWd1cmF0aW9uKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLC
 ByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgICMgR2V0IGNsaWVudCBjb25maWd1cmF0aW9uDQogI
 CAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZ3BsdXNfY2xpZW50
 X2NvbmZpZ3VyYXRpb25fYXR0cmlidXRlIikpOg0KICAgICAgICAgICAgY2xpZW50Q29uZmlndXJhdGl
 vbkF0dHJpYnV0ZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiZ3BsdXNfY2xpZW50X2Nvbm
 ZpZ3VyYXRpb25fYXR0cmlidXRlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgICAgIHByaW50ICJHb29nb
 GUrIEdldENsaWVudENvbmZpZ3VyYXRpb24uIFVzaW5nIGNsaWVudCBhdHRyaWJ1dGU6IiwgY2xpZW50
 Q29uZmlndXJhdGlvbkF0dHJpYnV0ZQ0KDQogICAgICAgICAgICBpZiAocmVxdWVzdFBhcmFtZXRlcnM
 gPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW
 50SWQgPSBOb25lDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgQXR0ZW1wdCB0byBkZXRlcm1pb
 mUgY2xpZW50X2lkIGZyb20gcmVxdWVzdA0KICAgICAgICAgICAgY2xpZW50SWRBcnJheSA9IHJlcXVl
 c3RQYXJhbWV0ZXJzLmdldCgiY2xpZW50X2lkIikNCiAgICAgICAgICAgIGlmIChBcnJheUhlbHBlci5
 pc05vdEVtcHR5KGNsaWVudElkQXJyYXkpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZy
 hjbGllbnRJZEFycmF5WzBdKSk6DQogICAgICAgICAgICAgICAgY2xpZW50SWQgPSBjbGllbnRJZEFyc
 mF5WzBdDQoNCiAgICAgICAgICAgICMgQXR0ZW1wdCB0byBkZXRlcm1pbmUgY2xpZW50X2lkIGZyb20g
 ZXZlbnQgY29udGV4dA0KICAgICAgICAgICAgaWYgKGNsaWVudElkID09IE5vbmUpOg0KICAgICAgICA
 gICAgICAgIGV2ZW50Q29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIC
 AgICAgICAgaWYgKGV2ZW50Q29udGV4dC5pc1NldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKSk6DQogICAgI
 CAgICAgICAgICAgICAgIGNsaWVudElkID0gZXZlbnRDb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0
 ZXMiKS5nZXQoImNsaWVudF9pZCIpDQoNCiAgICAgICAgICAgIGlmIChjbGllbnRJZCA9PSBOb25lKTo
 NCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBjbG
 llbnRfaWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgI
 CAgY2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgY2xp
 ZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZW50SWQpDQogICAgICAgICAgICBpZiAoY2x
 pZW50ID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEdldENsaWVudENvbm
 ZpZ3VyYXRpb24uIEZhaWxlZCB0byBmaW5kIGNsaWVudCIsIGNsaWVudElkLCAiIGluIGxvY2FsIExEQ
 VAiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW50Q29uZmln
 dXJhdGlvbiA9IGNsaWVudFNlcnZpY2UuZ2V0Q3VzdG9tQXR0cmlidXRlKGNsaWVudCwgY2xpZW50Q29
 uZmlndXJhdGlvbkF0dHJpYnV0ZSkNCiAgICAgICAgICAgIGlmICgoY2xpZW50Q29uZmlndXJhdGlvbi
 A9PSBOb25lKSBvciBTdHJpbmdIZWxwZXIuaXNFbXB0eShjbGllbnRDb25maWd1cmF0aW9uLmdldFZhb
 HVlKCkpKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0
 aW9uLiBDbGllbnQiLCBjbGllbnRJZCwgIiBhdHRyaWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR
 0cmlidXRlLCAiIGlzIGVtcHR5Ig0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcm
 ludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBDbGllbnQiLCBjbGllbnRJZCwgIiBhd
 HRyaWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR0cmlidXRlLCAiIGlzIiwgY2xpZW50Q29uZmln
 dXJhdGlvbg0KICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnRDb25maWd1cmF0aW9uDQoNCiAgICA
 gICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDdXJyZW50Q2xpZW50U2VjcmV0cyhzZWxmLCBjdX
 JyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0Z
 XJzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJh
 dGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgIGl
 mIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbn
 RDbGllbnRTZWNyZXRzDQogICAgICAgIA0KICAgICAgICBjbGllbnRDb25maWd1cmF0aW9uVmFsdWUgP
 SBqc29uLmxvYWRzKGNsaWVudENvbmZpZ3VyYXRpb24uZ2V0VmFsdWUoKSkNCg0KICAgICAgICByZXR1
 cm4gY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJncGx1cyJdDQoNCiAgICBkZWYgZ2V0Q3VycmVudEF
 0dHJpYnV0ZXNNYXBwaW5nKHNlbGYsIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZywgY29uZmlndXJhdG
 lvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhd
 GlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywg
 cmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgIGlmIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmU
 pOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZw0KDQogICAgICAgIG
 NsaWVudENvbmZpZ3VyYXRpb25WYWx1ZSA9IGpzb24ubG9hZHMoY2xpZW50Q29uZmlndXJhdGlvbi5nZ
 XRWYWx1ZSgpKQ0KDQogICAgICAgIGNsaWVudEF0dHJpYnV0ZXNNYXBwaW5nID0gc2VsZi5wcmVwYXJl
 QXR0cmlidXRlc01hcHBpbmcoY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJncGx1c19yZW1vdGVfYXR
 0cmlidXRlc19saXN0Il0sIGNsaWVudENvbmZpZ3VyYXRpb25WYWx1ZVsiZ3BsdXNfbG9jYWxfYXR0cm
 lidXRlc19saXN0Il0pDQogICAgICAgIGlmIChjbGllbnRBdHRyaWJ1dGVzTWFwcGluZyA9PSBOb25lK
 ToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEdldEN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZy4g
 Q2xpZW50IGF0dHJpYnV0ZXMgbWFwcGluZyBpcyBpbnZhbGlkLiBVc2luZyBkZWZhdWx0IG9uZSINCiA
 gICAgICAgICAgIHJldHVybiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICByZXR1cm
 4gY2xpZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgIGRlZiBwcmVwYXJlQXR0cmlidXRlc01hcHBpb
 mcoc2VsZiwgcmVtb3RlQXR0cmlidXRlc0xpc3QsIGxvY2FsQXR0cmlidXRlc0xpc3QpOg0KICAgICAg
 ICByZW1vdGVBdHRyaWJ1dGVzTGlzdEFycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KHJlbW90ZUF0dHJ
 pYnV0ZXNMaXN0LCAiLCIpDQogICAgICAgIGlmIChBcnJheUhlbHBlci5pc0VtcHR5KHJlbW90ZUF0dH
 JpYnV0ZXNMaXN0QXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIFByZXBhcmVBdHRya
 WJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gYXR0cmlidXRlcyBzcGVjaWZpZWQgaW4gcmVtb3RlQXR0
 cmlidXRlc0xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiA
 gICAgICAgbG9jYWxBdHRyaWJ1dGVzTGlzdEFycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KGxvY2FsQX
 R0cmlidXRlc0xpc3QsICIsIikNCiAgICAgICAgaWYgKEFycmF5SGVscGVyLmlzRW1wdHkobG9jYWxBd
 HRyaWJ1dGVzTGlzdEFycmF5KSk6DQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQcmVwYXJlQXR0
 cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIGF0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIGxvY2FsQXR
 0cmlidXRlc0xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIG
 lmIChsZW4ocmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkgIT0gbGVuKGxvY2FsQXR0cmlidXRlc0xpc
 3RBcnJheSkpOg0KICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUHJlcGFyZUF0dHJpYnV0ZXNNYXBw
 aW5nLiBUaGUgbnVtYmVyIG9mIGF0dHJpYnV0ZXMgaW4gcmVtb3RlQXR0cmlidXRlc0xpc3QgYW5kIGx
 vY2FsQXR0cmlidXRlc0xpc3QgaXNuJ3QgZXF1YWwiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KIC
 AgICAgICANCiAgICAgICAgYXR0cmlidXRlTWFwcGluZyA9IElkZW50aXR5SGFzaE1hcCgpDQogICAgI
 CAgIGNvbnRhaW5zVWlkID0gRmFsc2UNCiAgICAgICAgaSA9IDANCiAgICAgICAgY291bnQgPSBsZW4o
 cmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkNCiAgICAgICAgd2hpbGUgKGkgPCBjb3VudCk6DQogICA
 gICAgICAgICByZW1vdGVBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2UocmVtb3RlQX
 R0cmlidXRlc0xpc3RBcnJheVtpXSkNCiAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlID0gU3RyaW5nS
 GVscGVyLnRvTG93ZXJDYXNlKGxvY2FsQXR0cmlidXRlc0xpc3RBcnJheVtpXSkNCiAgICAgICAgICAg
 IGF0dHJpYnV0ZU1hcHBpbmcucHV0KHJlbW90ZUF0dHJpYnV0ZSwgbG9jYWxBdHRyaWJ1dGUpDQoNCiA
 gICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShsb2NhbEF0dHJpYnV0ZS
 wgInVpZCIpKToNCiAgICAgICAgICAgICAgICBjb250YWluc1VpZCA9IFRydWUNCg0KICAgICAgICAgI
 CAgaSA9IGkgKyAxDQoNCiAgICAgICAgaWYgKG5vdCBjb250YWluc1VpZCk6DQogICAgICAgICAgICBw
 cmludCAiR29vZ2xlKyBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIG1hcHBpbmc
 gdG8gbWFuZGF0b3J5ICd1aWQnIGF0dHJpYnV0ZSINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogIC
 AgICAgIA0KICAgICAgICByZXR1cm4gYXR0cmlidXRlTWFwcGluZw0KDQogICAgZGVmIGdldFRva2Vuc
 0J5Q29kZShzZWxmLCBjdXJyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMs
 IGNvZGUpOg0KICAgICAgICB0b2tlblJlcXVlc3QgPSBUb2tlblJlcXVlc3QoR3JhbnRUeXBlLkNMSUV
 OVF9DUkVERU5USUFMUykNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhlbnRpY2F0aW9uTWV0aG
 9kKEF1dGhlbnRpY2F0aW9uTWV0aG9kLkNMSUVOVF9TRUNSRVRfUE9TVCkNCiAgICAgICAgdG9rZW5SZ
 XF1ZXN0LnNldENvZGUoY29kZSkNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhVc2VybmFtZShj
 dXJyZW50Q2xpZW50U2VjcmV0c1sid2ViIl1bImNsaWVudF9pZCJdKQ0KICAgICAgICB0b2tlblJlcXV
 lc3Quc2V0QXV0aFBhc3N3b3JkKGN1cnJlbnRDbGllbnRTZWNyZXRzWyJ3ZWIiXVsiY2xpZW50X3NlY3
 JldCJdKQ0KICAgICAgICB0b2tlblJlcXVlc3Quc2V0UmVkaXJlY3RVcmkoInBvc3RtZXNzYWdlIikNC
 iAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEdyYW50VHlwZShHcmFudFR5cGUuQVVUSE9SSVpBVElPTl9D
 T0RFKQ0KDQogICAgICAgIHRva2VuQ2xpZW50ID0gVG9rZW5DbGllbnQoY3VycmVudENsaWVudFNlY3J
 ldHNbIndlYiJdWyJ0b2tlbl91cmkiXSkNCiAgICAgICAgdG9rZW5DbGllbnQuc2V0UmVxdWVzdCh0b2
 tlblJlcXVlc3QpDQogICAgICAgIA0KICAgICAgICB0b2tlblJlc3BvbnNlID0gdG9rZW5DbGllbnQuZ
 XhlYygpDQogICAgICAgIGlmICgodG9rZW5SZXNwb25zZSA9PSBOb25lKSBvciAodG9rZW5SZXNwb25z
 ZS5nZXRTdGF0dXMoKSAhPSAyMDApKToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICA
 gcmV0dXJuIHRva2VuUmVzcG9uc2UNCg0KICAgIGRlZiBnZXRVc2VySW5mbyhzZWxmLCBjdXJyZW50Q2
 xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGFjY2Vzc1Rva2VuKToNCiAgICAgI
 CAgdXNlckluZm9DbGllbnQgPSBVc2VySW5mb0NsaWVudCgiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5j
 b20vcGx1cy92MS9wZW9wbGUvbWUvb3BlbklkQ29ubmVjdCIpDQoNCiAgICAgICAgdXNlckluZm9SZXN
 wb25zZSA9IHVzZXJJbmZvQ2xpZW50LmV4ZWNVc2VySW5mbyhhY2Nlc3NUb2tlbikNCiAgICAgICAgaW
 YgKCh1c2VySW5mb1Jlc3BvbnNlID09IE5vbmUpIG9yICh1c2VySW5mb1Jlc3BvbnNlLmdldFN0YXR1c
 ygpICE9IDIwMCkpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICByZXR1cm4gdXNl
 ckluZm9SZXNwb25zZQ0KDQogICAgZGVmIGV4dGVuc2lvblBvc3RMb2dpbihzZWxmLCBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcywgdXNlcik6DQogICAgICAgIGlmIChzZWxmLmV4dGVuc2lvbk1vZHVsZSAhPS
 BOb25lKToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBwb3N0TG9naW5SZXN1bHQgP
 SBzZWxmLmV4dGVuc2lvbk1vZHVsZS5wb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHVz
 ZXIpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUG9zdExvZ2luIHJlc3VsdDoiLCBwb3N
 0TG9naW5SZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCiAgIC
 AgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nb
 GUrIFBvc3RMb2dpbi4gRmFpbGVkIHRvIGV4ZWN1dGUgcG9zdExvZ2luIG1ldGhvZCINCiAgICAgICAg
 ICAgICAgICBwcmludCAiR29vZ2xlKyBQb3N0TG9naW4uIFVuZXhwZWN0ZWQgZXJyb3I6IiwgZXgNCiA
 gICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgIGV4Y2VwdCBqYXZhLmxhbmcuVG
 hyb3dhYmxlLCBleDoNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQb3N0TG9naW4uIEZha
 WxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAgICAgICAgICAgZXgucHJpbnRT
 dGFja1RyYWNlKCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgICA
 gICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!D40C.1CA3,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Saml authentication module
displayName: saml
gluuStatus: false
inum: %(inumOrg)s!0011!D40C.1CA3
oxConfigurationProperty: {"value1":"saml_certificate_file","value2":"/etc/ce
 rts/saml.pem","description":""}
oxConfigurationProperty: {"value1":"saml_deployment_type","value2":"enroll",
 "description":""}
oxConfigurationProperty: {"value1":"saml_idp_attributes_list","value2":"http
 ://schemas.xmlsoap.org/ws/2005/05/identity/claims/name, http://schemas.xmls
 oap.org/ws/2005/05/identity/claims/emailaddress, http://schemas.xmlsoap.org
 /ws/2005/05/identity/claims/givenname, http://schemas.xmlsoap.org/ws/2005/0
 5/identity/claims/surname, http://schemas.xmlsoap.org/ws/2005/05/identity/c
 laims/surname","description":""}
oxConfigurationProperty: {"value1":"saml_local_attributes_list","value2":"ui
 d, mail, givenName, sn, cn","description":""}
oxConfigurationProperty: {"value1":"saml_name_identifier_format","value2":"u
 rn:oasis:names:tc:SAML:2.0:nameid-format:persistent","description":""}
oxConfigurationProperty: {"value1":"saml_use_authn_context","value2":"true",
 "description":""}
oxConfigurationProperty: {"value1":"saml_validate_response","value2":"true",
 "description":""}
oxConfigurationProperty: {"value1":"saml_idp_sso_target_url","value2":"https
 ://idp.gluu.info/idp/profile/SAML2/Redirect/SSO","description":""}
oxConfigurationProperty: {"value1":"saml_issuer","value2":"https://sp.gluu.i
 nfo/shibboleth","description":""}
oxLevel: 50
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4d
 HMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIGphdmF4
 LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3R
 vbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3
 JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIENsaWVudFNlcnZpY2UsIEF1d
 GhlbnRpY2F0aW9uU2VydmljZSwgQXR0cmlidXRlU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5z
 ZXJ2aWNlLm5ldCBpbXBvcnQgSHR0cFNlcnZpY2UNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJ
 pbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJheUhlbHBlcg0KZnJvbSBvcmcuZ2
 x1dS5zYW1sIGltcG9ydCBTYW1sQ29uZmlndXJhdGlvbiwgQXV0aFJlcXVlc3QsIFJlc3BvbnNlDQpmc
 m9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QsIEhhc2hNYXAsIElkZW50aXR5SGFz
 aE1hcA0KZnJvbSBvcmcueGRpLm94YXV0aC5tb2RlbC5jb21tb24gaW1wb3J0IFVzZXINCmZyb20gb3J
 nLnhkaS5sZGFwLm1vZGVsIGltcG9ydCBDdXN0b21BdHRyaWJ1dGUNCg0KaW1wb3J0IGphdmENCg0KdH
 J5Og0KICAgIGltcG9ydCBqc29uDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgaW1wb3J0IHNpbXBsZ
 Wpzb24gYXMganNvbg0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNh
 dGlvblR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICA
 gICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIG
 luaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2FtbC4gS
 W5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgc2FtbF9jZXJ0aWZpY2F0ZV9maWxlID0gY29uZmlndXJh
 dGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2NlcnRpZmljYXRlX2ZpbGUiKS5nZXRWYWx1ZTIoKQ0KICA
 gICAgICBzYW1sX2lkcF9zc29fdGFyZ2V0X3VybCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldC
 gic2FtbF9pZHBfc3NvX3RhcmdldF91cmwiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBzYW1sX2lzc3Vlc
 iA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2FtbF9pc3N1ZXIiKS5nZXRWYWx1ZTIoKQ0K
 ICAgICAgICBzYW1sX3VzZV9hdXRobl9jb250ZXh0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25
 maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfdXNlX2F1dGhuX2NvbnRleHQiKS5nZXRWYWx1ZT
 IoKSwgVHJ1ZSkNCiAgICAgICAgaWYgKHNhbWxfdXNlX2F1dGhuX2NvbnRleHQpOg0KICAgICAgICAgI
 CAgc2FtbF9uYW1lX2lkZW50aWZpZXJfZm9ybWF0ID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0
 KCJzYW1sX25hbWVfaWRlbnRpZmllcl9mb3JtYXQiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBlbHNlOg0
 KICAgICAgICAgICAgc2FtbF9uYW1lX2lkZW50aWZpZXJfZm9ybWF0ID0gTm9uZQ0KDQogICAgICAgIH
 NhbWxfY2VydGlmaWNhdGUgPSBzZWxmLmxvYWRDZXJpdGlmaWNhdGUoc2FtbF9jZXJ0aWZpY2F0ZV9ma
 WxlKQ0KICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkoc2FtbF9jZXJ0aWZpY2F0ZSkpOg0K
 ICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBGaWxlIHdpdGggeDUwOSBjZXJ
 0aWZpY2F0ZSBzaG91bGQgYmUgbm90IGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgc2FtbENvbmZpZ3VyYXRpb24gPSBTYW1sQ29uZmlndXJhdGlvbigpDQoNCiAgICAgICAgI
 yBTZXQgdGhlIGlzc3VlciBvZiB0aGUgYXV0aGVudGljYXRpb24gcmVxdWVzdC4gVGhpcyB3b3VsZCB1
 c3VhbGx5IGJlIHRoZSBVUkwgb2YgdGhlIGlzc3Vpbmcgd2ViIGFwcGxpY2F0aW9uDQogICAgICAgIHN
 hbWxDb25maWd1cmF0aW9uLnNldElzc3VlcihzYW1sX2lzc3VlcikNCg0KICAgICAgICAjIFRlbGxzIH
 RoZSBJZFAgdG8gcmV0dXJuIGEgcGVyc2lzdGVudCBpZGVudGlmaWVyIGZvciB0aGUgdXNlcg0KICAgI
 CAgICBzYW1sQ29uZmlndXJhdGlvbi5zZXROYW1lSWRlbnRpZmllckZvcm1hdChzYW1sX25hbWVfaWRl
 bnRpZmllcl9mb3JtYXQpDQogIA0KICAgICAgICAjIFRoZSBVUkwgYXQgdGhlIElkZW50aXR5IFByb3Z
 pZGVyIHdoZXJlIHRvIHRoZSBhdXRoZW50aWNhdGlvbiByZXF1ZXN0IHNob3VsZCBiZSBzZW50DQogIC
 AgICAgIHNhbWxDb25maWd1cmF0aW9uLnNldElkcFNzb1RhcmdldFVybChzYW1sX2lkcF9zc29fdGFyZ
 2V0X3VybCkNCg0KICAgICAgICAjIEVuYWJsZWRpYWJsZSBSZXF1ZXN0ZWRBdXRobkNvbnRleHQNCiAg
 ICAgICAgc2FtbENvbmZpZ3VyYXRpb24uc2V0VXNlUmVxdWVzdGVkQXV0aG5Db250ZXh0KHNhbWxfdXN
 lX2F1dGhuX2NvbnRleHQpDQogICAgICAgIA0KICAgICAgICAjIExvYWQgeDUwOSBjZXJ0aWZpY2F0ZQ
 0KICAgICAgICBzYW1sQ29uZmlndXJhdGlvbi5sb2FkQ2VydGlmaWNhdGVGcm9tU3RyaW5nKHNhbWxfY
 2VydGlmaWNhdGUpDQogICAgICAgIA0KICAgICAgICBzZWxmLnNhbWxDb25maWd1cmF0aW9uID0gc2Ft
 bENvbmZpZ3VyYXRpb24NCg0KICAgICAgICBzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nID0gTm9uZQ0KICA
 gICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfaWRwX2F0dH
 JpYnV0ZXNfbGlzdCIpIGFuZA0KICAgICAgICAgICAgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29ud
 GFpbnNLZXkoInNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IikpOg0KDQogICAgICAgICAgICBzYW1s
 X2lkcF9hdHRyaWJ1dGVzX2xpc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfaWR
 wX2F0dHJpYnV0ZXNfbGlzdCIpLmdldFZhbHVlMigpDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscG
 VyLmlzRW1wdHkoc2FtbF9pZHBfYXR0cmlidXRlc19saXN0KSk6DQogICAgICAgICAgICAgICAgcHJpb
 nQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgc2FtbF9pZHBfYXR0cmlidXRlc19s
 aXN0IGlzIGVtcHR5Ig0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICB
 zYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2
 FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgaWYgKFN0c
 mluZ0hlbHBlci5pc0VtcHR5KHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0KSk6DQogICAgICAgICAg
 ICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgc2FtbF9sb2NhbF9
 hdHRyaWJ1dGVzX2xpc3QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgICAgIHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLnByZXBhcmVBdHRyaWJ1dGVzT
 WFwcGluZyhzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QsIHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0
 KQ0KICAgICAgICAgICAgaWYgKHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPT0gTm9uZSk6DQogICAgICA
 gICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBUaGUgYXR0cmlidXRlcyBtYXBwaW
 5nIGlzbid0IHZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHNlb
 GYuc2FtbEV4dGVuc2lvbk1vZHVsZSA9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzLmNvbnRhaW5zS2V5KCJzYW1sX2V4dGVuc2lvbl9tb2R1bGUiKSk6DQogICAgICAgICAgICB
 zYW1sX2V4dGVuc2lvbl9tb2R1bGVfbmFtZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2
 FtbF9leHRlbnNpb25fbW9kdWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgICAgIHRyeToNCiAgICAgI
 CAgICAgICAgICBzZWxmLnNhbWxFeHRlbnNpb25Nb2R1bGUgPSBfX2ltcG9ydF9fKHNhbWxfZXh0ZW5z
 aW9uX21vZHVsZV9uYW1lKQ0KICAgICAgICAgICAgICAgIHNhbWxfZXh0ZW5zaW9uX21vZHVsZV9pbml
 0X3Jlc3VsdCA9IHNlbGYuc2FtbEV4dGVuc2lvbk1vZHVsZS5pbml0KGNvbmZpZ3VyYXRpb25BdHRyaW
 J1dGVzKQ0KICAgICAgICAgICAgICAgIGlmIChub3Qgc2FtbF9leHRlbnNpb25fbW9kdWxlX2luaXRfc
 mVzdWx0KToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICBleGNl
 cHQgSW1wb3J0RXJyb3IsIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBJbml0aWFsaXp
 hdGlvbi4gRmFpbGVkIHRvIGxvYWQgc2FtbF9leHRlbnNpb25fbW9kdWxlOiIsIHNhbWxfZXh0ZW5zaW
 9uX21vZHVsZV9uYW1lDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uL
 iBVbmV4cGVjdGVkIGVycm9yOiIsIGV4DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAg
 ICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJ
 uIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKT
 oNCiAgICAgICAgcHJpbnQgIlNhbWwuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJTYW1sLiBEZXN0c
 m95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZl
 cnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgaXNWYWxpZEF1dGhlbnRpY2F
 0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgIC
 AgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFsdGVybmF0aXZlQXV0aGVudGljYXRpb25NZXRob
 2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVy
 biBOb25lDQoNCiAgICBkZWYgYXV0aGVudGljYXRlKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGV
 zLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZX
 RFdmVudENvbnRleHQoKQ0KICAgICAgICBhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW50aWNhd
 GlvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmlu
 c3RhbmNlKCkNCg0KICAgICAgICBzYW1sX21hcF91c2VyID0gRmFsc2UNCiAgICAgICAgc2FtbF9lbnJ
 vbGxfdXNlciA9IEZhbHNlDQogICAgICAgIHNhbWxfZW5yb2xsX2FsbF91c2VyX2F0dHIgPSBGYWxzZQ
 0KICAgICAgICAjIFVzZSBzYW1sX2RlcGxveW1lbnRfdHlwZSBvbmx5IGlmIHRoZXJlIGlzIG5vIGF0d
 HJpYnV0ZXMgbWFwcGluZw0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFp
 bnNLZXkoInNhbWxfZGVwbG95bWVudF90eXBlIikpOg0KICAgICAgICAgICAgc2FtbF9kZXBsb3ltZW5
 0X3R5cGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2UoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2
 V0KCJzYW1sX2RlcGxveW1lbnRfdHlwZSIpLmdldFZhbHVlMigpKQ0KICAgICAgICAgICAgDQogICAgI
 CAgICAgICBpZiAoU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2Uoc2FtbF9kZXBsb3ltZW50X3R5
 cGUsICJtYXAiKSk6DQogICAgICAgICAgICAgICAgc2FtbF9tYXBfdXNlciA9IFRydWUNCg0KICAgICA
 gICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKHNhbWxfZGVwbG95bWVudF90eX
 BlLCAiZW5yb2xsIikpOg0KICAgICAgICAgICAgICAgIHNhbWxfZW5yb2xsX3VzZXIgPSBUcnVlDQoNC
 iAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShzYW1sX2RlcGxveW1l
 bnRfdHlwZSwgImVucm9sbF9hbGxfYXR0ciIpKToNCiAgICAgICAgICAgICAgICBzYW1sX2Vucm9sbF9
 hbGxfdXNlcl9hdHRyID0gVHJ1ZQ0KDQogICAgICAgIHNhbWxfYWxsb3dfYmFzaWNfbG9naW4gPSBGYW
 xzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfY
 Wxsb3dfYmFzaWNfbG9naW4iKSk6DQogICAgICAgICAgICBzYW1sX2FsbG93X2Jhc2ljX2xvZ2luID0g
 U3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfYWx
 sb3dfYmFzaWNfbG9naW4iKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQoNCiAgICAgICAgdXNlX2Jhc2ljX2
 F1dGggPSBGYWxzZQ0KICAgICAgICBpZiAoc2FtbF9hbGxvd19iYXNpY19sb2dpbik6DQogICAgICAgI
 CAgICAjIERldGVjdCBpZiB1c2VyIHVzZWQgYmFzaWMgYXV0aG5ldGljYXRpb24gbWV0aG9kDQogICAg
 ICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0
 KDQogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgIC
 AgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KICAgICAgICAgI
 CAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5p
 c05vdEVtcHR5KHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c2VfYmFzaWNfYXV0aCA
 9IFRydWUNCg0KICAgICAgICBpZiAoKHN0ZXAgPT0gMSkgYW5kIHNhbWxfYWxsb3dfYmFzaWNfbG9naW
 4gYW5kIHVzZV9iYXNpY19hdXRoKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhd
 GUgZm9yIHN0ZXAgMS4gQmFzaWMgYXV0aGVudGljYXRpb24iDQoNCiAgICAgICAgICAgIGNvbnRleHQu
 c2V0KCJzYW1sX2NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHM
 gPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXJfbm
 FtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgP
 SBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQoNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNl
 DQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSB
 hbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgIC
 AgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgI
 CAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFz
 c3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgICB
 yZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICBpZiAoc3RlcC
 A9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINC
 g0KICAgICAgICAgICAgY3VycmVudFNhbWxDb25maWd1cmF0aW9uID0gc2VsZi5nZXRDdXJyZW50U2Ft
 bENvbmZpZ3VyYXRpb24oc2VsZi5zYW1sQ29uZmlndXJhdGlvbiwgY29uZmlndXJhdGlvbkF0dHJpYnV
 0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKQ0KICAgICAgICAgICAgaWYgKGN1cnJlbnRTYW1sQ29uZmlndX
 JhdGlvbiA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gUHJlcGFyZSBmb3Igc
 3RlcCAxLiBDbGllbnQgc2FtbCBjb25maWd1cmF0aW9uIGlzIGludmFsaWQiDQogICAgICAgICAgICAg
 ICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHNhbWxfcmVzcG9uc2VfYXJyYXkgPSByZXF1ZXN
 0UGFyYW1ldGVycy5nZXQoIlNBTUxSZXNwb25zZSIpDQogICAgICAgICAgICBpZiBBcnJheUhlbHBlci
 5pc0VtcHR5KHNhbWxfcmVzcG9uc2VfYXJyYXkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sL
 iBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gc2FtbF9yZXNwb25zZSBpcyBlbXB0eSINCiAgICAgICAg
 ICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2FtbF9yZXNwb25zZSA9IHNhbWxfcmV
 zcG9uc2VfYXJyYXlbMF0NCg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3
 Igc3RlcCAxLiBzYW1sX3Jlc3BvbnNlOiIsIHNhbWxfcmVzcG9uc2UNCg0KICAgICAgICAgICAgc2Ftb
 FJlc3BvbnNlID0gUmVzcG9uc2UoY3VycmVudFNhbWxDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAg
 c2FtbFJlc3BvbnNlLmxvYWRYbWxGcm9tQmFzZTY0KHNhbWxfcmVzcG9uc2UpDQogICAgICAgICAgICA
 NCiAgICAgICAgICAgIHNhbWxfdmFsaWRhdGVfcmVzcG9uc2UgPSBUcnVlDQogICAgICAgICAgICBpZi
 AoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfdmFsaWRhdGVfcmVzcG9uc
 2UiKSk6DQogICAgICAgICAgICAgICAgc2FtbF92YWxpZGF0ZV9yZXNwb25zZSA9IFN0cmluZ0hlbHBl
 ci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX3ZhbGlkYXRlX3Jlc3B
 vbnNlIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAgICAgICBpZiAoc2FtbF92YWxpZGF0ZV
 9yZXNwb25zZSk6DQogICAgICAgICAgICAgICAgaWYgKG5vdCBzYW1sUmVzcG9uc2UuaXNWYWxpZCgpK
 ToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAx
 LiBzYW1sX3Jlc3BvbnNlIGlzbid0IHZhbGlkIg0KDQogICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX25
 hbWVfaWQgPSBzYW1sUmVzcG9uc2UuZ2V0TmFtZUlkKCkNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZW
 xwZXIuaXNFbXB0eShzYW1sX3Jlc3BvbnNlX25hbWVfaWQpKToNCiAgICAgICAgICAgICAgICBwcmlud
 CAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHNhbWxfcmVzcG9uc2VfbmFtZV9pZCBpcyBp
 bnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBwcmludCA
 iU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHNhbWxfcmVzcG9uc2VfbmFtZV9pZDoiLCBzYW
 1sX3Jlc3BvbnNlX25hbWVfaWQNCg0KICAgICAgICAgICAgc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVzI
 D0gc2FtbFJlc3BvbnNlLmdldEF0dHJpYnV0ZXMoKQ0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBhdHRyaWJ1dGVzOiAiLCBzYW1sX3Jlc3BvbnNlX2F0dHJpYnV
 0ZXMNCg0KICAgICAgICAgICAgIyBVc2UgcGVyc2lzdGVudCBJZCBhcyBzYW1sX3VzZXJfdWlkDQogIC
 AgICAgICAgICBzYW1sX3VzZXJfdWlkID0gc2FtbF9yZXNwb25zZV9uYW1lX2lkDQogICAgICAgICAgI
 CANCiAgICAgICAgICAgIGlmIChzYW1sX21hcF91c2VyKToNCiAgICAgICAgICAgICAgICAjIFVzZSBt
 YXBwaW5nIHRvIGxvY2FsIElEUCB1c2VyDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVW
 lkOiBzYW1sOiIsIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlI
 GlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpbmRf
 dXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQ
 iLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZX
 JfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVud
 GljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBmaW5kIHVzZXIiDQogICAgICAgICAgICAgICAgICAg
 IHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB
 0byAyIg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic2FtbF9jb3VudF9sb2dpbl9zdG
 VwcyIsIDIpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzYW1sX3VzZXJfdWlkIiwgc
 2FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAg
 ICAgICAgIGZvdW5kX3VzZXJfbmFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICA
 gICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZX
 JfbmFtZToiLCBmb3VuZF91c2VyX25hbWUNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgI
 CB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZv
 dW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZ
 hbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3
 RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJld
 HVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICA
 gICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgIC
 AgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQg
 IlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2x
 vZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogIC
 AgICAgICAgICBlbGlmIChzYW1sX2Vucm9sbF91c2VyKToNCiAgICAgICAgICAgICAgICAjIFVzZSBhd
 XRvIGVucm9sbG1lbnQgdG8gbG9jYWwgSURQDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmF
 sVWlkOiBzYW1sOiIsIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdG
 hlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpb
 mRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxV
 aWQiLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3V
 zZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAjIEF1dG8gdXNlciBlbnJvbG
 xlbW50DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0Z
 XAgMS4gVGhlcmUgaXMgbm8gdXNlciBpbiBMREFQLiBBZGRpbmcgdXNlciB0byBsb2NhbCBMREFQIg0K
 DQogICAgICAgICAgICAgICAgICAgICMgQ29udmVydCBzYW1sIHJlc3VsdCBhdHRyaWJ1dGVzIGtleXM
 gdG8gbG92ZXIgY2FzZQ0KICAgICAgICAgICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZW
 RfYXR0cmlidXRlcyA9IEhhc2hNYXAoKQ0KICAgICAgICAgICAgICAgICAgICBmb3Igc2FtbF9yZXNwb
 25zZV9hdHRyaWJ1dGVfZW50cnkgaW4gc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVzLmVudHJ5U2V0KCk6
 DQogICAgICAgICAgICAgICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZWRfYXR0cmlidXR
 lcy5wdXQoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nSGVscGVyLnRvTG93ZXJDYX
 NlKHNhbWxfcmVzcG9uc2VfYXR0cmlidXRlX2VudHJ5LmdldEtleSgpKSwgc2FtbF9yZXNwb25zZV9hd
 HRyaWJ1dGVfZW50cnkuZ2V0VmFsdWUoKSkNCg0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXR0
 cmlidXRlc01hcHBpbmcgPSBzZWxmLnByZXBhcmVDdXJyZW50QXR0cmlidXRlc01hcHBpbmcoc2VsZi5
 hdHRyaWJ1dGVzTWFwcGluZywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZX
 JzKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwI
 DEuIFVzaW5nIG5leHQgYXR0cmlidXRlcyBtYXBwaW5nIiwgY3VycmVudEF0dHJpYnV0ZXNNYXBwaW5n
 DQoNCiAgICAgICAgICAgICAgICAgICAgbmV3VXNlciA9IFVzZXIoKQ0KICAgICAgICAgICAgICAgICA
 gICBmb3IgYXR0cmlidXRlc01hcHBpbmdFbnRyeSBpbiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcuZW
 50cnlTZXQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkcEF0dHJpYnV0ZSA9IGF0dHJpYnV0Z
 XNNYXBwaW5nRW50cnkuZ2V0S2V5KCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsQXR0cmli
 dXRlID0gYXR0cmlidXRlc01hcHBpbmdFbnRyeS5nZXRWYWx1ZSgpDQoNCiAgICAgICAgICAgICAgICA
 gICAgICAgIGxvY2FsQXR0cmlidXRlVmFsdWUgPSBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZWRfYXR0cm
 lidXRlcy5nZXQoaWRwQXR0cmlidXRlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsQ
 XR0cmlidXRlICE9IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1VzZXIuc2V0
 QXR0cmlidXRlKGxvY2FsQXR0cmlidXRlLCBsb2NhbEF0dHJpYnV0ZVZhbHVlKQ0KDQogICAgICAgICA
 gICAgICAgICAgIG5ld1VzZXIuc2V0QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgInNhbWw6IiArIH
 NhbWxfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhd
 GUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBhZGQgdXNlciIsIHNhbWxfdXNlcl91aWQsICIgd2l0
 aCBuZXh0IGF0dHJpYnV0ZXMiLCBuZXdVc2VyLmdldEN1c3RvbUF0dHJpYnV0ZXMoKQ0KDQogICAgICA
 gICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5hZGRVc2VyKG5ld1VzZX
 IsIFRydWUpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yI
 HN0ZXAgMS4gQWRkZWQgbmV3IHVzZXIgd2l0aCBVSUQiLCBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJ
 ZCgpDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmd
 ldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3
 RlcCAxLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgICAgICAgI
 CB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZv
 dW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZ
 hbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3
 RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJld
 HVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Ig
 c3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5
 zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdF9sb2
 dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2xvZ2luX3Jlc3VsdA0
 KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgICAgICBlbG
 lmIChzYW1sX2Vucm9sbF9hbGxfdXNlcl9hdHRyKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2Ftb
 C4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IG94RXh0
 ZXJuYWxVaWQ6IHNhbWw6IiArIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2s
 gaWYgdGhlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgIC
 AgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0Z
 XJuYWxVaWQiLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgICAgIGlmIChm
 aW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4
 gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBmaW5kIHVzZXIiDQoNCiAgICAgICAgIC
 AgICAgICAgICAgdXNlciA9IFVzZXIoKQ0KICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1d
 GVzID0gQXJyYXlMaXN0KCkNCiAgICAgICAgICAgICAgICAgICAgZm9yIGtleSBpbiBhdHRyaWJ1dGVz
 LmtleVNldCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgbGRhcEF0dHJpYnV0ZXMgPSBhdHRyaWJ
 1dGVTZXJ2aWNlLmdldEFsbEF0dHJpYnV0ZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG
 xkYXBBdHRyaWJ1dGUgaW4gbGRhcEF0dHJpYnV0ZXM6DQogICAgICAgICAgICAgICAgICAgICAgICAgI
 CAgc2FtbDJVcmkgPSBsZGFwQXR0cmlidXRlLmdldFNhbWwyVXJpKCkNCiAgICAgICAgICAgICAgICAg
 ICAgICAgICAgICBpZihzYW1sMlVyaSA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgICA
 gICAgICAgc2FtbDJVcmkgPSBhdHRyaWJ1dGVTZXJ2aWNlLmdldERlZmF1bHRTYW1sMlVyaShsZGFwQX
 R0cmlidXRlLmdldE5hbWUoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzYW1sMlVya
 SA9PSBrZXkpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBDdXN0
 b21BdHRyaWJ1dGUobGRhcEF0dHJpYnV0ZS5nZXROYW1lKCkpDQogICAgICAgICAgICAgICAgICAgICA
 gICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZXMoYXR0cmlidXRlcy5nZXQoa2V5KSkNCiAgICAgIC
 AgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tQXR0cmlidXRlcy5hZGQoYXR0cmlidXRlKQ0KD
 QogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IEN1c3RvbUF0dHJpYnV0ZSgib3hFeHRlcm5h
 bFVpZCIpDQogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZSgic2FtbDoiICsgc2F
 tbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgY3VzdG9tQXR0cmlidXRlcy5hZGQoYXR0cm
 lidXRlKQ0KICAgICAgICAgICAgICAgICAgICB1c2VyLnNldEN1c3RvbUF0dHJpYnV0ZXMoY3VzdG9tQ
 XR0cmlidXRlcykNCg0KICAgICAgICAgICAgICAgICAgICBpZih1c2VyLmdldEF0dHJpYnV0ZSgic24i
 KSA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IEN1c3RvbUF0dHJ
 pYnV0ZSgic24iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLnNldFZhbHVlKHNhbW
 xfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1dGVzLmFkZChhd
 HRyaWJ1dGUpDQoNCiAgICAgICAgICAgICAgICAgICAgaWYodXNlci5nZXRBdHRyaWJ1dGUoImNuIikg
 PT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBDdXN0b21BdHRyaWJ
 1dGUoImNuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZShzYW1sX3
 VzZXJfdWlkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tQXR0cmlidXRlcy5hZGQoYXR0c
 mlidXRlKQ0KDQogICAgICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2Vydmlj
 ZS5hZGRVc2VyKHVzZXIsIFRydWUpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXR
 oZW50aWNhdGUgZm9yIHN0ZXAgMS4gQWRkZWQgbmV3IHVzZXIgd2l0aCBVSUQiLCBmaW5kX3VzZXJfYn
 lfdWlkLmdldFVzZXJJZCgpDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX
 3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQoNCiA
 gICAgICAgICAgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYX
 V0aGVudGljYXRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZ
 W50aWNhdGVkID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICA
 gICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dG
 hlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgI
 CAgICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAg
 ICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZml
 ndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbn
 QgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X
 2xvZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQog
 ICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l
 0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdX
 RoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgdWlkOiIsIHNhb
 WxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2Vydmlj
 ZS5nZXRVc2VyKHNhbWxfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV9
 1aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdG
 UgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGZpbmQgdXNlciINCiAgICAgICAgICAgICAgICAgICAgcmV0d
 XJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlf
 dWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgIC
 AgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljY
 XRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVk
 ID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgIC
 AgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0Z
 SBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29u
 dGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9
 zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbk
 F0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuI
 EF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2xvZ2luX3Jl
 c3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgIGV
 saWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvci
 BzdGVwIDIiDQoNCiAgICAgICAgICAgIHNlc3Npb25BdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc
 3Npb25BdHRyaWJ1dGVzIikNCiAgICAgICAgICAgIGlmIChzZXNzaW9uQXR0cmlidXRlcyA9PSBOb25l
 KSBvciBub3Qgc2Vzc2lvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfdXNlcl91aWQiKToNCiA
 gICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIHNhbWxfdX
 Nlcl91aWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgI
 CAgIHNhbWxfdXNlcl91aWQgPSBzZXNzaW9uQXR0cmlidXRlcy5nZXQoInNhbWxfdXNlcl91aWQiKQ0K
 ICAgICAgICAgICAgcGFzc2VkX3N0ZXAxID0gU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcoc2F
 tbF91c2VyX3VpZCkNCiAgICAgICAgICAgIGlmIChub3QgcGFzc2VkX3N0ZXAxKToNCiAgICAgICAgIC
 AgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pb
 nN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRp
 YWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50aWFscy5
 nZXRQYXNzd29yZCgpDQoNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgIC
 BpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVsc
 GVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgIGxvZ2dl
 ZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQo
 NCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRm
 Fsc2UNCg0KICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdoaWNoIGhhcyBzYW1sX
 3VzZXJfdWlkDQogICAgICAgICAgICAjIEF2b2lkIG1hcHBpbmcgU2FtbCBhY2NvdW50IHRvIG1vcmUg
 dGhhbiBvbmUgSURQIGFjY291bnQNCiAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2V
 ydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAic2FtbDoiICsgc2FtbF91c2
 VyX3VpZCkNCg0KICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgI
 CAgICAgICAgICAgIyBBZGQgc2FtbF91c2VyX3VpZCB0byB1c2VyIG9uZSBpZCBVSURzDQogICAgICAg
 ICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmFkZFVzZXJBdHRyaWJ1dGUodXN
 lcl9uYW1lLCAib3hFeHRlcm5hbFVpZCIsICJzYW1sOiIgKyBzYW1sX3VzZXJfdWlkKQ0KICAgICAgIC
 AgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgI
 CBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEZhaWxlZCB0byB1cGRhdGUgY3Vy
 cmVudCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICA
 gICAgIHBvc3RfbG9naW5fcmVzdWx0ID0gc2VsZi5zYW1sRXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3
 VyYXRpb25BdHRyaWJ1dGVzLCBmaW5kX3VzZXJfYnlfdWlkKQ0KICAgICAgICAgICAgICAgIHByaW50I
 CJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gcG9zdF9sb2dpbl9yZXN1bHQ6IiwgcG9zdF9s
 b2dpbl9yZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc3VsdA0KICA
 gICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZX
 JfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY
 2F0ZSBmb3Igc3RlcCAyLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQogICAgDQog
 ICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFscyh1c2VyX25hbWUsIGZvdW5kX3VzZXJ
 fbmFtZSk6DQogICAgICAgICAgICAgICAgICAgIHBvc3RfbG9naW5fcmVzdWx0ID0gc2VsZi5zYW1sRX
 h0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmaW5kX3VzZXJfYnlfdWlkK
 Q0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIu
 IHBvc3RfbG9naW5fcmVzdWx0OiIsIHBvc3RfbG9naW5fcmVzdWx0DQogICAgDQogICAgICAgICAgICA
 gICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc3VsdA0KICAgICAgICANCiAgICAgICAgICAgIHJldH
 VybiBGYWxzZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZ
 WYgcHJlcGFyZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJh
 bWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCg
 pDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2VydmljZS5pbn
 N0YW5jZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiU2Ftb
 C4gUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBodHRwU2Vydmlj
 ZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCk7DQogICAgICAgICAgICByZXF1ZXN0ID0gRmFjZXNDb25
 0ZXh0LmdldEN1cnJlbnRJbnN0YW5jZSgpLmdldEV4dGVybmFsQ29udGV4dCgpLmdldFJlcXVlc3QoKQ
 0KICAgICAgICAgICAgYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJsID0gaHR0cFNlcnZpY2UuY29uc
 3RydWN0U2VydmVyVXJsKHJlcXVlc3QpICsgIi9wb3N0bG9naW4iDQogICAgICAgICAgICBwcmludCAi
 U2FtbC4gUHJlcGFyZSBmb3Igc3RlcCAxLiBQcmVwYXJlZCBhc3NlcnRpb25Db25zdW1lclNlcnZpY2V
 Vcmw6IiwgYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJsDQogICAgICAgICAgICANCiAgICAgICAgIC
 AgIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q3VycmVudFNhbWxDb25maWd1cmF0a
 W9uKHNlbGYuc2FtbENvbmZpZ3VyYXRpb24sIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0
 UGFyYW1ldGVycykNCiAgICAgICAgICAgIGlmIChjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24gPT0gTm9
 uZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmUgZm9yIHN0ZXAgMS4gQ2xpZW
 50IHNhbWwgY29uZmlndXJhdGlvbiBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGY
 WxzZQ0KDQogICAgICAgICAgICAjIEdlbmVyYXRlIGFuIEF1dGhSZXF1ZXN0IGFuZCBzZW5kIGl0IHRv
 IHRoZSBpZGVudGl0eSBwcm92aWRlcg0KICAgICAgICAgICAgc2FtbEF1dGhSZXF1ZXN0ID0gQXV0aFJ
 lcXVlc3QoY3VycmVudFNhbWxDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgZXh0ZXJuYWxfYXV0aF
 9yZXF1ZXN0X3VyaSA9IGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbi5nZXRJZHBTc29UYXJnZXRVcmwoK
 SArICI/U0FNTFJlcXVlc3Q9IiArIHNhbWxBdXRoUmVxdWVzdC5nZXRSZXF1ZXN0KFRydWUsIGFzc2Vy
 dGlvbkNvbnN1bWVyU2VydmljZVVybCkNCg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmU
 gZm9yIHN0ZXAgMS4gZXh0ZXJuYWxfYXV0aF9yZXF1ZXN0X3VyaToiLCBleHRlcm5hbF9hdXRoX3JlcX
 Vlc3RfdXJpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJleHRlcm5hbF9hd
 XRoX3JlcXVlc3RfdXJpIiwgZXh0ZXJuYWxfYXV0aF9yZXF1ZXN0X3VyaSkNCg0KICAgICAgICAgICAg
 cmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJ
 TYW1sLiBQcmVwYXJlIGZvciBzdGVwIDIiDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgIC
 AgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZ
 XRlcnNGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAg
 aWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgic2FtbF91c2V
 yX3VpZCIpDQoNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2
 F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBjb250ZXh0I
 D0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRleHQuaXNTZXQoInNh
 bWxfY291bnRfbG9naW5fc3RlcHMiKSk6DQogICAgICAgICAgICByZXR1cm4gY29udGV4dC5nZXQoInN
 hbWxfY291bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIDINCg0KICAgIG
 RlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogI
 CAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgc2FtbF9hbGxvd19iYXNpY19sb2dpbiA9
 IEZhbHNlDQogICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXk
 oInNhbWxfYWxsb3dfYmFzaWNfbG9naW4iKSk6DQogICAgICAgICAgICAgICAgc2FtbF9hbGxvd19iYX
 NpY19sb2dpbiA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ
 2V0KCJzYW1sX2FsbG93X2Jhc2ljX2xvZ2luIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAg
 ICAgICBpZiAoc2FtbF9hbGxvd19iYXNpY19sb2dpbik6DQogICAgICAgICAgICAgICAgcmV0dXJuICI
 vbG9naW4ueGh0bWwiDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHJldHVybiAiL2
 F1dGgvc2FtbC9zYW1sbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIvYXV0aC9zYW1sL3Nhb
 Wxwb3N0bG9naW4ueGh0bWwiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWY
 gaXNQYXNzZWRTdGVwMSgpOg0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKC
 kuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2Vyb
 mFtZSgpDQogICAgICAgIHBhc3NlZF9zdGVwMSA9IFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5n
 KHVzZXJfbmFtZSkNCg0KICAgICAgICByZXR1cm4gcGFzc2VkX3N0ZXAxDQoNCiAgICBkZWYgbG9hZEN
 lcml0aWZpY2F0ZShzZWxmLCBzYW1sX2NlcnRpZmljYXRlX2ZpbGUpOg0KICAgICAgICBzYW1sX2Nlcn
 RpZmljYXRlID0gTm9uZQ0KDQogICAgICAgICMgTG9hZCBjZXJ0aWZpY2F0ZSBmcm9tIGZpbGUNCiAgI
 CAgICAgZiA9IG9wZW4oc2FtbF9jZXJ0aWZpY2F0ZV9maWxlLCAncicpDQogICAgICAgIHRyeToNCiAg
 ICAgICAgICAgIHNhbWxfY2VydGlmaWNhdGUgPSBmLnJlYWQoKQ0KICAgICAgICBleGNlcHQ6DQogICA
 gICAgICAgICBwcmludCAiRmFpbGVkIHRvIGxvYWQgY2VydGlmaWNhdGUgZnJvbSBmaWxlOiIsIHNhbW
 xfY2VydGlmaWNhdGVfZmlsZQ0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgZmluYWxse
 ToNCiAgICAgICAgICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHNhbWxfY2Vy
 dGlmaWNhdGUNCg0KICAgIGRlZiBnZXRDbGllbnRDb25maWd1cmF0aW9uKHNlbGYsIGNvbmZpZ3VyYXR
 pb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgICMgR2V0IGNsaWVudCBjb2
 5maWd1cmF0aW9uDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tle
 Sgic2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKSk6DQogICAgICAgICAgICBzYW1s
 X2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmd
 ldCgic2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKS5nZXRWYWx1ZTIoKQ0KICAgIC
 AgICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIFVzaW5nIGNsaWVudCBhd
 HRyaWJ1dGU6Iiwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUNCg0KICAgICAgICAg
 ICAgaWYgKHJlcXVlc3RQYXJhbWV0ZXJzID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHJldHVybiB
 Ob25lDQoNCiAgICAgICAgICAgIGNsaWVudF9pZCA9IE5vbmUNCiAgICAgICAgICAgIGNsaWVudF9pZF
 9hcnJheSA9IHJlcXVlc3RQYXJhbWV0ZXJzLmdldCgiY2xpZW50X2lkIikNCiAgICAgICAgICAgIGlmI
 ChBcnJheUhlbHBlci5pc05vdEVtcHR5KGNsaWVudF9pZF9hcnJheSkgYW5kIFN0cmluZ0hlbHBlci5p
 c05vdEVtcHR5U3RyaW5nKGNsaWVudF9pZF9hcnJheVswXSkpOg0KICAgICAgICAgICAgICAgIGNsaWV
 udF9pZCA9IGNsaWVudF9pZF9hcnJheVswXQ0KDQogICAgICAgICAgICBpZiAoY2xpZW50X2lkID09IE
 5vbmUpOg0KICAgICAgICAgICAgICAgIGV2ZW50Q29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29ud
 GV4dCgpDQogICAgICAgICAgICAgICAgaWYgKGV2ZW50Q29udGV4dC5pc1NldCgic2Vzc2lvbkF0dHJp
 YnV0ZXMiKSk6DQogICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZCA9IGV2ZW50Q29udGV4dC5nZXQ
 oInNlc3Npb25BdHRyaWJ1dGVzIikuZ2V0KCJjbGllbnRfaWQiKQ0KDQogICAgICAgICAgICBpZiAoY2
 xpZW50X2lkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBHZXRDbGllbnRDb
 25maWd1cmF0aW9uLiBjbGllbnRfaWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5v
 bmUNCg0KICAgICAgICAgICAgY2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW5zdGFuY2UoKQ0
 KICAgICAgICAgICAgY2xpZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZW50X2lkKQ0KIC
 AgICAgICAgICAgaWYgKGNsaWVudCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2Ftb
 C4gR2V0Q2xpZW50Q29uZmlndXJhdGlvbi4gRmFpbGVkIHRvIGZpbmQgY2xpZW50IiwgY2xpZW50X2lk
 LCAiIGluIGxvY2FsIExEQVAiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICA
 gICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9IGNsaWVudFNlcnZpY2UuZ2V0Q3VzdG9tQXR0cm
 lidXRlKGNsaWVudCwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUpDQogICAgICAgI
 CAgICBpZiAoKHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb24gPT0gTm9uZSkgb3IgU3RyaW5nSGVscGVy
 LmlzRW1wdHkoc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbi5nZXRWYWx1ZSgpKSk6DQogICAgICAgICA
 gICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIENsaWVudCIsIGNsaWVudF
 9pZCwgIiBhdHRyaWJ1dGUiLCBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSwgIiBpc
 yBlbXB0eSINCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEdl
 dENsaWVudENvbmZpZ3VyYXRpb24uIENsaWVudCIsIGNsaWVudF9pZCwgIiBhdHRyaWJ1dGUiLCBzYW1
 sX2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSwgIiBpcyIsIHNhbWxfY2xpZW50X2NvbmZpZ3
 VyYXRpb24NCiAgICAgICAgICAgICAgICByZXR1cm4gc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbg0KD
 QogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgZ2V0Q3VycmVudFNhbWxDb25maWd1cmF0aW9u
 KHNlbGYsIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJ
 lcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9IHNlbG
 YuZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhc
 mFtZXRlcnMpDQogICAgICAgIGlmIChzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uID09IE5vbmUpOg0K
 ICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbg0KICAgICAgICANCiAgICA
 gICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1ZSA9IGpzb24ubG9hZHMoc2FtbF9jbGllbn
 RfY29uZmlndXJhdGlvbi5nZXRWYWx1ZSgpKQ0KDQogICAgICAgIGNsaWVudF9zYW1sX2NlcnRpZmljY
 XRlID0gTm9uZSAgICAgIA0KICAgICAgICBjbGllbnRfc2FtbF9jZXJ0aWZpY2F0ZV9maWxlID0gc2Ft
 bF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1ZVsic2FtbF9jZXJ0aWZpY2F0ZV9maWxlIl0NCiAgICA
 gICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KGNsaWVudF9zYW1sX2NlcnRpZmljYXRlX2ZpbG
 UpKToNCiAgICAgICAgICAgIGNsaWVudF9zYW1sX2NlcnRpZmljYXRlID0gc2VsZi5sb2FkQ2VyaXRpZ
 mljYXRlKGNsaWVudF9zYW1sX2NlcnRpZmljYXRlX2ZpbGUpDQogICAgICAgICAgICBpZiAoU3RyaW5n
 SGVscGVyLmlzRW1wdHkoY2xpZW50X3NhbWxfY2VydGlmaWNhdGUpKToNCiAgICAgICAgICAgICAgICB
 wcmludCAiU2FtbC4gQnVpbGRDbGllbnRTYW1sQ29uZmlndXJhdGlvbi4gRmlsZSB3aXRoIHg1MDkgY2
 VydGlmaWNhdGUgc2hvdWxkIGJlIG5vdCBlbXB0eS4gVXNpbmcgZGVmYXVsdCBjb25maWd1cmF0aW9uI
 g0KICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24NCg0KICAgICAg
 ICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbiA9IGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbi5jbG9uZSg
 pDQogICAgICAgIA0KICAgICAgICBpZiAoY2xpZW50X3NhbWxfY2VydGlmaWNhdGUgIT0gTm9uZSk6DQ
 ogICAgICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbi5sb2FkQ2VydGlmaWNhdGVGcm9tU3Rya
 W5nKGNsaWVudF9zYW1sX2NlcnRpZmljYXRlKQ0KDQogICAgICAgIGNsaWVudF9zYW1sX2lzc3VlciA9
 IHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb25fdmFsdWVbInNhbWxfaXNzdWVyIl0NCiAgICAgICAgY2x
 pZW50U2FtbENvbmZpZ3VyYXRpb24uc2V0SXNzdWVyKGNsaWVudF9zYW1sX2lzc3VlcikNCiAgICAgIC
 AgDQogICAgICAgIHNhbWxfdXNlX2F1dGhuX2NvbnRleHQgPSBzYW1sX2NsaWVudF9jb25maWd1cmF0a
 W9uX3ZhbHVlWyJzYW1sX3VzZV9hdXRobl9jb250ZXh0Il0NCiAgICAgICAgY2xpZW50X3VzZV9zYW1s
 X3VzZV9hdXRobl9jb250ZXh0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihzYW1sX3VzZV9hdXRobl9
 jb250ZXh0LCBUcnVlKQ0KICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbi5zZXRVc2VSZXF1ZX
 N0ZWRBdXRobkNvbnRleHQoY2xpZW50X3VzZV9zYW1sX3VzZV9hdXRobl9jb250ZXh0KQ0KDQogICAgI
 CAgIHJldHVybiBjbGllbnRTYW1sQ29uZmlndXJhdGlvbg0KDQogICAgZGVmIHByZXBhcmVBdHRyaWJ1
 dGVzTWFwcGluZyhzZWxmLCBzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QsIHNhbWxfbG9jYWxfYXR0cml
 idXRlc19saXN0KToNCiAgICAgICAgc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5ID0gU3RyaW
 5nSGVscGVyLnNwbGl0KHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCwgIiwiKQ0KICAgICAgICBpZiAoQ
 XJyYXlIZWxwZXIuaXNFbXB0eShzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXkpKToNCiAgICAg
 ICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIGF
 0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCBwcm9wZXJ0eSINCi
 AgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBzYW1sX2xvY2FsX2F0dHJpY
 nV0ZXNfbGlzdF9hcnJheSA9IFN0cmluZ0hlbHBlci5zcGxpdChzYW1sX2xvY2FsX2F0dHJpYnV0ZXNf
 bGlzdCwgIiwiKQ0KICAgICAgICBpZiAoQXJyYXlIZWxwZXIuaXNFbXB0eShzYW1sX2xvY2FsX2F0dHJ
 pYnV0ZXNfbGlzdF9hcnJheSkpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVBdHRyaW
 J1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gYXR0cmlidXRlcyBzcGVjaWZpZWQgaW4gc2FtbF9sb2Nhb
 F9hdHRyaWJ1dGVzX2xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAg
 ICAgIGlmIChsZW4oc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5KSAhPSBsZW4oc2FtbF9sb2N
 hbF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYX
 JlQXR0cmlidXRlc01hcHBpbmcuIFRoZSBudW1iZXIgb2YgYXR0cmlidXRlcyBpbiBzYW1sX2lkcF9hd
 HRyaWJ1dGVzX2xpc3QgYW5kIHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IGlzbid0IGVxdWFsIg0K
 ICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgICAgIGF0dHJpYnV0ZU1hcHBpbmc
 gPSBJZGVudGl0eUhhc2hNYXAoKQ0KICAgICAgICBjb250YWluc1VpZCA9IEZhbHNlDQogICAgICAgIG
 kgPSAwDQogICAgICAgIGNvdW50ID0gbGVuKHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSkNC
 iAgICAgICAgd2hpbGUgKGkgPCBjb3VudCk6DQogICAgICAgICAgICBpZHBBdHRyaWJ1dGUgPSBTdHJp
 bmdIZWxwZXIudG9Mb3dlckNhc2Uoc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5W2ldKQ0KICA
 gICAgICAgICAgbG9jYWxBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2Uoc2FtbF9sb2
 NhbF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXlbaV0pDQogICAgICAgICAgICBhdHRyaWJ1dGVNYXBwaW5nL
 nB1dChpZHBBdHRyaWJ1dGUsIGxvY2FsQXR0cmlidXRlKQ0KDQogICAgICAgICAgICBpZiAoU3RyaW5n
 SGVscGVyLmVxdWFsc0lnbm9yZUNhc2UobG9jYWxBdHRyaWJ1dGUsICJ1aWQiKSk6DQogICAgICAgICA
 gICAgICAgY29udGFpbnNVaWQgPSBUcnVlDQoNCiAgICAgICAgICAgIGkgPSBpICsgMQ0KDQogICAgIC
 AgIGlmIChub3QgY29udGFpbnNVaWQpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVBd
 HRyaWJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gbWFwcGluZyB0byBtYW5kYXRvcnkgJ3VpZCcgYXR0
 cmlidXRlIg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgICAgIHJldHVybiB
 hdHRyaWJ1dGVNYXBwaW5nDQoNCiAgICBkZWYgcHJlcGFyZUN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZy
 hzZWxmLCBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZ
 XF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb24gPSBzZWxm
 LmdldENsaWVudENvbmZpZ3VyYXRpb24oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJ
 hbWV0ZXJzKQ0KICAgICAgICBpZiAoc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9PSBOb25lKToNCi
 AgICAgICAgICAgIHJldHVybiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICBzYW1sX
 2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlID0ganNvbi5sb2FkcyhzYW1sX2NsaWVudF9jb25maWd1
 cmF0aW9uLmdldFZhbHVlKCkpDQoNCiAgICAgICAgY2xpZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWx
 mLnByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZyhzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlWy
 JzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QiXSwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1Z
 Vsic2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiXSkNCiAgICAgICAgaWYgKGNsaWVudEF0dHJpYnV0
 ZXNNYXBwaW5nID09IE5vbmUpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVDdXJyZW5
 0QXR0cmlidXRlc01hcHBpbmcuIENsaWVudCBhdHRyaWJ1dGVzIG1hcHBpbmcgaXMgaW52YWxpZC4gVX
 NpbmcgZGVmYXVsdCBvbmUiDQogICAgICAgICAgICByZXR1cm4gY3VycmVudEF0dHJpYnV0ZXNNYXBwa
 W5nDQoNCiAgICAgICAgcmV0dXJuIGNsaWVudEF0dHJpYnV0ZXNNYXBwaW5nDQoNCiAgICBkZWYgc2Ft
 bEV4dGVuc2lvblBvc3RMb2dpbihzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgdXNlcik6DQo
 gICAgICAgIGlmIChzZWxmLnNhbWxFeHRlbnNpb25Nb2R1bGUgIT0gTm9uZSk6DQogICAgICAgICAgIC
 B0cnk6DQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb
 25Nb2R1bGUucG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCB1c2VyKQ0KICAgICAgICAg
 ICAgICAgIHByaW50ICJTYW1sLiBFeHRlbnNpb25Qb3N0bG9naW4gcmVzdWx0OiIsIHBvc3RfbG9naW5
 fcmVzdWx0DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gcG9zdF9sb2dpbl9yZXN1bHQNCiAgICAgIC
 AgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBFe
 HRlbnNpb25Qb3N0bG9naW4uIEZhaWxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAg
 ICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEV4dGVuc2lvblBvc3Rsb2dpbi4gVW5leHBlY3RlZCBlcnJ
 vcjoiLCBleA0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZXhjZXB0IG
 phdmEubGFuZy5UaHJvd2FibGUsIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBFeHRlb
 nNpb25Qb3N0bG9naW4uIEZhaWxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAg
 ICAgICAgICAgZXgucHJpbnRTdGFja1RyYWNlKCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHN
 lDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!DAA9.B788,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Client Registration script
displayName: client_registration
gluuStatus: false
inum: %(inumOrg)s!0011!DAA9.B788
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5jbGllbnQgaW1wb
 3J0IENsaWVudFJlZ2lzdHJhdGlvblR5cGUNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJp
 bmdIZWxwZXIsIEFycmF5SGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J
 0IFNjb3BlU2VydmljZQ0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQ
 oNCmltcG9ydCBqYXZhDQoNCmNsYXNzIENsaWVudFJlZ2lzdHJhdGlvbihDbGllbnRSZWdpc3RyY
 XRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0K
 ICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICA
 gIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbn
 QgIkNsaWVudCByZWdpc3RyYXRpb24uIEluaXRpYWxpemF0aW9uIg0KDQogICAgICAgIHNlbGYuc
 2NvcGVTZXJ2aWNlID0gU2NvcGVTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBwcmludCAi
 Q2xpZW50IHJlZ2lzdHJhdGlvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICA
 gIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDbGllbnQgcmVnaXN0cmF0aW9uLiBEZXN0cm95I
 g0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzdHJhdGlvbi4gRGVzdHJveWVkIHN1Y2Nlc3Nm
 dWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgICMgVXBkYXRlIGNsaWVudCBlbnR
 yeSBiZWZvcmUgcGVyc2lzdGVudCBpdA0KICAgICMgICByZWdpc3RlclJlcXVlc3QgaXMgb3JnLn
 hkaS5veGF1dGguY2xpZW50LlJlZ2lzdGVyUmVxdWVzdA0KICAgICMgICBjbGllbnQgaXMgb3JnL
 nhkaS5veGF1dGgubW9kZWwucmVnaXN0cmF0aW9uLkNsaWVudA0KICAgICMgICBjb25maWd1cmF0
 aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGV
 ydHk+DQogICAgZGVmIHVwZGF0ZUNsaWVudChzZWxmLCByZWdpc3RlclJlcXVlc3QsIGNsaWVudC
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzd
 HJhdGlvbi4gVXBkYXRlQ2xpZW50IG1ldGhvZCINCg0KICAgICAgICByZWRpcmVjdFVyaXMgPSBj
 bGllbnQuZ2V0UmVkaXJlY3RVcmlzKCkNCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXR
 pb24uIFJlZGlyZWN0IFVyaXM6IiwgcmVkaXJlY3RVcmlzDQoNCiAgICAgICAgYWRkQWRkcmVzc1
 Njb3BlID0gRmFsc2UNCiAgICAgICAgZm9yIHJlZGlyZWN0VXJpIGluIHJlZGlyZWN0VXJpczoNC
 iAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShyZWRpcmVjdFVy
 aSwgImh0dHBzOi8vY2xpZW50LmV4YW1wbGUuY29tL2V4YW1wbGUxIikpOg0KICAgICAgICAgICA
 gICAgIGFkZEFkZHJlc3NTY29wZSA9IFRydWUNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgIC
 AgICANCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIElzIGFkZCBhZGRyZXNzI
 HNjb3BlOiIsIGFkZEFkZHJlc3NTY29wZQ0KDQogICAgICAgIGlmIChhZGRBZGRyZXNzU2NvcGUp
 Og0KICAgICAgICAgICAgY3VycmVudFNjb3BlcyA9IGNsaWVudC5nZXRTY29wZXMoKQ0KICAgICA
 gICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIEN1cnJlbnQgc2NvcGVzOiIsIGN1cn
 JlbnRTY29wZXMNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYWRkcmVzc1Njb3BlID0gc2VsZ
 i5zY29wZVNlcnZpY2UuZ2V0U2NvcGVCeURpc3BsYXlOYW1lKCJhZGRyZXNzIikNCiAgICAgICAg
 ICAgIG5ld1Njb3BlcyA9IEFycmF5SGVscGVyLmFkZEl0ZW1Ub1N0cmluZ0FycmF5KGN1cnJlbnR
 TY29wZXMsIGFkZHJlc3NTY29wZS5nZXREbigpKQ0KICAgIA0KICAgICAgICAgICAgcHJpbnQgIk
 NsaWVudCByZWdpc3RyYXRpb24uIFJlc3VsdCBzY29wZXM6IiwgbmV3U2NvcGVzDQogICAgICAgI
 CAgICBjbGllbnQuc2V0U2NvcGVzKG5ld1Njb3BlcykNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
 DQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFB
 hcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb2
 4oc2VsZik6DQogICAgICAgIHJldHVybiAxDQo=
oxScriptType: client_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!DAA9.B789,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Application Session script
displayName: application_session
gluuStatus: false
inum: %(inumOrg)s!0011!DAA9.B789
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zZXNzaW9uIGltc
 G9ydCBBcHBsaWNhdGlvblNlc3Npb25UeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3Ry
 aW5nSGVscGVyLCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJ
 yYXlMaXN0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEFwcGxpY2F0aW9uU2Vzc2lvbihBcHBsaW
 NhdGlvblNlc3Npb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNa
 WxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxs
 aXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICA
 gICAgcHJpbnQgIkFwcGxpY2F0aW9uIHNlc3Npb24uIEluaXRpYWxpemF0aW9uIg0KICAgICAgIC
 BwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KD
 QogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1
 cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiB
 EZXN0cm95Ig0KICAgICAgICBwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gRGVzdHJveWVkIH
 N1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBnZXRBcGlWZ
 XJzaW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgIyBBcHBsaWNhdGlvbiBjYWxs
 cyBpdCBhdCBlbmQgc2Vzc2lvbiByZXF1ZXN0IHRvIGFsbG93IG5vdGlmeSAzcmQgcGFydCBzeXN
 0ZW1zDQogICAgIyAgIGh0dHBSZXF1ZXN0IGlzIGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2Vydm
 xldFJlcXVlc3QNCiAgICAjICAgYXV0aG9yaXphdGlvbkdyYW50IGlzIG9yZy54ZGkub3hhdXRoL
 m1vZGVsLmNvbW1vbi5BdXRob3JpemF0aW9uR3JhbnQNCiAgICAjICAgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5Pg0
 KICAgIGRlZiBlbmRTZXNzaW9uKHNlbGYsIGh0dHBSZXF1ZXN0LCBhdXRob3JpemF0aW9uR3Jhbn
 QsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkFwcGxpY2F0aW9uI
 HNlc3Npb24uIFN0YXJ0aW5nIGV4dGVybmFsIHNlc3Npb24gZW5kIg0KDQogICAgICAgIHByaW50
 ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiBFeHRlcm5hbCBzZXNzaW9uIGVuZGVkIHN1Y2Nlc3NmdWx
 seSINCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: application_session
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!031C.5621,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Dynamic Scope script
displayName: dynamic_scope
gluuStatus: false
inum: %(inumOrg)s!0011!031C.5621
oxLevel: 100
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zY29wZSBpbXBvcn
 QgRHluYW1pY1Njb3BlVHlwZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlc
 iwgQXJyYXlIZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdA0K
 DQppbXBvcnQgamF2YQ0KDQpjbGFzcyBEeW5hbWljU2NvcGUoRHluYW1pY1Njb3BlVHlwZSk6DQo
 gICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi
 5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZ
 WxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJEeW5hbWljIHNj
 b3BlLiBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29wZS4gSW5
 pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgIC
 BkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHBya
 W50ICJEeW5hbWljIHNjb3BlLiBEZXN0cm95Ig0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29w
 ZS4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICA
 gICMgVXBkYXRlIEpzb24gV2ViIHRva2VuIGJlZm9yZSBzaWduaW5nL2VuY3J5cHJpbmcgaXQNCi
 AgICAjICAgZHluYW1pY1Njb3BlQ29udGV4dCBpcyBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLmV4d
 GVybmFsLmNvbnRleHQuRHluYW1pY1Njb3BlRXh0ZXJuYWxDb250ZXh0DQogICAgIyAgIGNvbmZp
 Z3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21
 Qcm9wZXJ0eT4NCiAgICBkZWYgdXBkYXRlKHNlbGYsIGR5bmFtaWNTY29wZUNvbnRleHQsIGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR5bmFtaWMgc2NvcGUuIFVwZ
 GF0ZSBtZXRob2QiDQoNCiAgICAgICAgZHluYW1pY1Njb3BlcyA9IGR5bmFtaWNTY29wZUNvbnRl
 eHQuZ2V0RHluYW1pY1Njb3BlcygpDQogICAgICAgIGF1dGhvcml6YXRpb25HcmFudCA9IGR5bmF
 taWNTY29wZUNvbnRleHQuZ2V0QXV0aG9yaXphdGlvbkdyYW50KCkNCiAgICAgICAgdXNlciA9IG
 R5bmFtaWNTY29wZUNvbnRleHQuZ2V0VXNlcigpDQogICAgICAgIGpzb25XZWJSZXNwb25zZSA9I
 GR5bmFtaWNTY29wZUNvbnRleHQuZ2V0SnNvbldlYlJlc3BvbnNlKCkNCiAgICAgICAgY2xhaW1z
 ID0ganNvbldlYlJlc3BvbnNlLmdldENsYWltcygpDQoNCiAgICAgICAgIyBJdGVyYXRlIHRocm9
 1Z2ggbGlzdCBvZiBkeW5hbWljIHNjb3BlcyBpbiBvcmRlciB0byBhZGQgY3VzdG9tIHNjb3Blcy
 BpZiBuZWVkZWQNCiAgICAgICAgcHJpbnQgIkR5bmFtaWMgc2NvcGUuIER5bmFtaWMgc2NvcGVzO
 iIsIGR5bmFtaWNTY29wZXMNCiAgICAgICAgZm9yIGR5bmFtaWNTY29wZSBpbiBkeW5hbWljU2Nv
 cGVzOg0KICAgICAgICAgICAgIyBBZGQgb3JnYW5pemF0aW9uIG5hbWUgaWYgdGhlcmUgaXMgc2N
 vcGUgPSBvcmdfbmFtZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcm
 VDYXNlKGR5bmFtaWNTY29wZSwgIm9yZ19uYW1lIikpOg0KICAgICAgICAgICAgICAgIGNsYWltc
 y5zZXRDbGFpbSgib3JnX25hbWUiLCAiR2x1dSwgSW5jLiIpDQogICAgICAgICAgICAgICAgY29u
 dGludWUNCg0KICAgICAgICAgICAgIyBBZGQgd29yayBwaG9uZSBpZiB0aGVyZSBpcyBzY29wZSA
 9IHdvcmtfcGhvbmUNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2
 FzZShkeW5hbWljU2NvcGUsICJ3b3JrX3Bob25lIikpOg0KICAgICAgICAgICAgICAgIHdvcmtQa
 G9uZSA9IHVzZXIuZ2V0QXR0cmlidXRlKCJ0ZWxlcGhvbmVOdW1iZXIiKTsNCiAgICAgICAgICAg
 ICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHkod29ya1Bob25lKSk6DQogICAgICAgICA
 gICAgICAgICAgIGNsYWltcy5zZXRDbGFpbSgid29ya19waG9uZSIsIHdvcmtQaG9uZSkNCiAgIC
 AgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgb
 G9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6
 DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiA
 gICAgICAgcmV0dXJuIDENCg==
oxScriptType: dynamic_scope
programmingLanguage: python

version: 1
dn: inum=%(inumOrg)s!0011!A910.56AB,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample script for SCIM events
displayName: scim_event_handler
gluuStatus: false
inum: %(inumOrg)s!0011!A910.56AB
oxConfigurationProperty: {"value1":"testProp1","value2":"Test value 1","description":""}
oxConfigurationProperty: {"value1":"testProp2","value2":"Test value 2","description":""}
oxLevel: 100
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zY2ltIGltcG9yd
 CBTY2ltVHlwZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlciwgQXJyYXlI
 ZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdA0KZnJvbSBvcmc
 uZ2x1dS5veHRydXN0LmxkYXAuc2VydmljZSBpbXBvcnQgSVBlcnNvblNlcnZpY2UsIFBlcnNvbl
 NlcnZpY2UNCmZyb20gb3JnLmdsdXUub3h0cnVzdC5tb2RlbCBpbXBvcnQgR2x1dUN1c3RvbVBlc
 nNvbg0KDQppbXBvcnQgamF2YQ0KDQpjbGFzcyBTY2ltRXZlbnRIYW5kbGVyKFNjaW1UeXBlKToN
 Cg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHN
 lbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaX
 Qoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2NpbUV2Z
 W50SGFuZGxlciAoaW5pdCk6IEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0
 dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ
 1dGVzKToNCiAgICAgICAgcHJpbnQgIlNjaW1FdmVudEhhbmRsZXIgKGRlc3Ryb3kpOiBEZXN0cm
 95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGdld
 EFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgY3JlYXRlVXNl
 cihzZWxmLCB1c2VyLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQoNCiAgICAgICAgcHJpbnQ
 gIlNjaW1FdmVudEhhbmRsZXIgKGNyZWF0ZVVzZXIpOiBDdXJyZW50IGlkID0gIiArIHVzZXIuZ2
 V0VWlkKCkNCg0KICAgICAgICB0ZXN0UHJvcDEgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZ
 XQoInRlc3RQcm9wMSIpLmdldFZhbHVlMigpDQogICAgICAgIHRlc3RQcm9wMiA9IGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzLmdldCgidGVzdFByb3AyIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICB
 wcmludCAiU2NpbUV2ZW50SGFuZGxlciAoY3JlYXRlVXNlcik6IHRlc3RQcm9wMSA9ICIgKyB0ZX
 N0UHJvcDENCiAgICAgICAgcHJpbnQgIlNjaW1FdmVudEhhbmRsZXIgKGNyZWF0ZVVzZXIpOiB0Z
 XN0UHJvcDIgPSAiICsgdGVzdFByb3AyDQoNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRl
 ZiB1cGRhdGVVc2VyKHNlbGYsIHVzZXIsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICA
 gICAgcGVyc29uU2VydmljZSA9IFBlcnNvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBvbG
 RVc2VyID0gcGVyc29uU2VydmljZS5nZXRQZXJzb25CeVVpZCh1c2VyLmdldFVpZCgpKQ0KICAgI
 CAgICBwcmludCAiU2NpbUV2ZW50SGFuZGxlciAodXBkYXRlVXNlcik6IE9sZCBkaXNwbGF5TmFt
 ZSA9ICIgKyBvbGRVc2VyIC5nZXREaXNwbGF5TmFtZSgpDQogICAgICAgIHByaW50ICJTY2ltRXZ
 lbnRIYW5kbGVyICh1cGRhdGVVc2VyKTogTmV3IGRpc3BsYXlOYW1lID0gIiArIHVzZXIuZ2V0RG
 lzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGRlbGV0ZVVzZXIoc
 2VsZiwgdXNlciwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2Np
 bUV2ZW50SGFuZGxlciAoZGVsZXRlVXNlcik6IEN1cnJlbnQgaWQgPSAiICsgdXNlci5nZXRVaWQ
 oKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGNyZWF0ZUdyb3VwKHNlbGYsIGdyb3
 VwLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJTY2ltRXZlbnRIY
 W5kbGVyIChjcmVhdGVHcm91cCk6IEN1cnJlbnQgZGlzcGxheU5hbWUgPSAiICsgZ3JvdXAuZ2V0
 RGlzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIHVwZGF0ZUdyb3V
 wKHNlbGYsIGdyb3VwLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50IC
 JTY2ltRXZlbnRIYW5kbGVyICh1cGRhdGVHcm91cCk6IEN1cnJlbnQgZGlzcGxheU5hbWUgPSAiI
 CsgZ3JvdXAuZ2V0RGlzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVm
 IGRlbGV0ZUdyb3VwKHNlbGYsIGdyb3VwLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICA
 gICAgIHByaW50ICJTY2ltRXZlbnRIYW5kbGVyIChkZWxldGVHcm91cCk6IEN1cnJlbnQgZGlzcGxheU5hbWUgPSAiICsgZ3JvdXAuZ2V0RGlzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: scim
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!24FD.B96E,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: top
objectClass: oxCustomScript
description: OTP Validation of passwords using Yubicloud
displayName: yubicloud
gluuStatus: false
inum: %(inumOrg)s!0011!24FD.B96E
oxConfigurationProperty: {"value1":"yubicloud_uri","value2":"api.yubico.com"
 ,"description":""}
oxConfigurationProperty: {"value1":"yubicloud_api_key","value2":"","descript
 ion":""}
oxConfigurationProperty: {"value1":"yubicloud_id","value2":"","description":
 ""}
oxLevel: 90
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""
 }
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 sIEFydW5tb3poaQ0KIw0KDQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGltcG9ydCBJZG
 VudGl0eQ0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9yd
 CBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBp
 bXBvcnQgVXNlclNlcnZpY2UNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXI
 NCg0KaW1wb3J0IGphdmENCg0KaW1wb3J0IHVybGxpYjINCmltcG9ydCB1cmxsaWINCmltcG9ydC
 B1dWlkDQppbXBvcnQgdHJhY2ViYWNrDQoNCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oU
 GVyc29uQXV0aGVudGljYXRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVu
 dFRpbWVNaWxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFR
 pbWVNaWxsaXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKT
 oNCiAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHBya
 W50ICJZdWJpY2xvdWQuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCg0KICAgICAgICBzZWxm
 LmFwaV9zZXJ2ZXIgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInl1YmljbG91ZF91cmk
 iKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBzZWxmLmFwaV9rZXkgPSBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcy5nZXQoInl1YmljbG91ZF9hcGlfa2V5IikuZ2V0VmFsdWUyKCkNCiAgICAgICAgc2VsZ
 i5jbGllbnRfaWQgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInl1YmljbG91ZF9pZCIp
 LmdldFZhbHVlMigpDQoNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBkZXN0cm95KHN
 lbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIll1YmljbG91ZC
 4gRGVzdHJveSINCiAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gRGVzdHJveWVkIHN1Y2Nlc3Nmd
 WxseSINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYp
 Og0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGh
 vZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcm
 V0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kK
 HNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1
 cm4gTm9uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cml
 idXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKT
 oNCiAgICAgICAgICAgIHByaW50ICJZdWJpY2xvdWQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxI
 g0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3Jl
 ZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcm5hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmF
 tZSgpDQogICAgICAgICAgICBvdHAgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQoNCiAgIC
 AgICAgICAgIHByaW50ICJZdWJpY2xvdWQuIFVzZXJuYW1lOiAgJXMiICUgKHVzZXJuYW1lKQ0KI
 CAgICAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gT1RQOiAgJXMiICUgKG90cCkNCg0KICAgICAg
 ICAgICAgIyBWYWxpZGF0ZSBvdHAgbGVuZ3RoDQogICAgICAgICAgICBpZiBsZW4ob3RwKSA8IDM
 yIG9yIGxlbihvdHApID4gNDg6DQogICAgICAgICAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gSW
 52YWxpZCBPVFAgbGVuZ3RoIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgI
 CAgICAgICB1c2VyX3NlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAg
 ICB1c2VyID0gdXNlcl9zZXJ2aWNlLmdldFVzZXIodXNlcm5hbWUpDQoNCiAgICAgICAgICAgIHB
 1YmxpY19rZXkgPSB1c2VyLmdldEF0dHJpYnV0ZSgneXViaWtleUlkJykNCg0KICAgICAgICAgIC
 AgcHJpbnQgIll1YmljbG91ZC4gUHVibGljIEtleTogJXMiICUgKHB1YmxpY19rZXkpDQoNCiAgI
 CAgICAgICAgICMgTWF0Y2ggdGhlIHVzZXIgd2l0aCB0aGUgeXViaWtleQ0KICAgICAgICAgICAg
 aWYgcHVibGljX2tleSBub3QgaW4gb3RwOg0KICAgICAgICAgICAgICAgIHByaW50ICJZdWJpY2x
 vdWQuIFB1YmxpYyBLZXkgbm90IG1hdGNoaW5nIE9UUCINCiAgICAgICAgICAgICAgICByZXR1cm
 4gRmFsc2UNCg0KICAgICAgICAgICAgZGF0YSA9ICIiDQogICAgICAgICAgICB0cnk6DQogICAgI
 CAgICAgICAgICAgbm9uY2UgPSBzdHIodXVpZC51dWlkNCgpKS5yZXBsYWNlKCItIiwgIiIpDQog
 ICAgICAgICAgICAgICAgcGFyYW1zID0gdXJsbGliLnVybGVuY29kZSh7ImlkIjogc2VsZi5jbGl
 lbnRfaWQsICJvdHAiOiBvdHAsICJub25jZSI6IG5vbmNlfSkNCiAgICAgICAgICAgICAgICB1cm
 wgPSAiaHR0cHM6Ly8iICsgc2VsZi5hcGlfc2VydmVyICsgIi93c2FwaS8yLjAvdmVyaWZ5Lz8iI
 CsgcGFyYW1zDQogICAgICAgICAgICAgICAgZiA9IHVybGxpYjIudXJsb3Blbih1cmwpDQogICAg
 ICAgICAgICAgICAgZGF0YSA9IGYucmVhZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgcmVwcih
 kYXRhKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgIC
 AgIHByaW50ICJZdWJpY2xvdWQuIEV4Y2VwdGlvbiAiLCBlDQoNCiAgICAgICAgICAgIGlmICdzd
 GF0dXM9T0snIGluIGRhdGE6DQogICAgICAgICAgICAgICAgdXNlcl9zZXJ2aWNlLmF1dGhlbnRp
 Y2F0ZSh1c2VybmFtZSkNCiAgICAgICAgICAgICAgICBwcmludCAiWXViaWNsb3VkLiBBdXRoZW5
 0aWNhdGlvbiBTdWNjZXNzZnVsIg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgIC
 AgICAgICAgIHByaW50ICJZdWJpY2xvdWQuIEVuZCBvZiBTdGVwIDEuIFJldHVybmluZyBGYWxzZ
 S4iDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAg
 IHJldHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXR
 pb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGlmIChzdG
 VwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gUHJlcGFyZSBmb3IgU3Rlc
 CAxIg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAg
 IHJldHVybiBGYWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiw
 gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQ
 ogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQ
 XR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAo
 c2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gIiI
 NCg0KICAgIGRlZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3
 RQYXJhbWV0ZXJzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python
